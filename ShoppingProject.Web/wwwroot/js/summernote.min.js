!function(n,t){if("function"==typeof define&&define.amd)define(["jquery","jquery-ui"],t);else if("undefined"!=typeof exports){var i,r;try{i=require("jquery");r=require("jquery-ui")}catch(n){}module.exports=t(i)}else t(n.jQuery,n.jQuery.ui,!0)}(this,function(n,t,i){function o(n,t){var i,r;1<n.originalEvent.touches.length||(u(n.currentTarget).hasClass("touch-punch-keep-default")||n.preventDefault(),i=n.originalEvent.changedTouches[0],(r=document.createEvent("MouseEvents")).initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(r))}function ft(n,t){for(var i in t)if(void 0!==n[t[i]])return t[i];return n[t[i]]="",t[i]}var p,h,c,w,l,a,v,b,y,k,d,u,e,g,nt,s,tt,it,f,rt,ut,r=function(t,i,u){function nr(t){var l,i,v,r,y,u,s,h={},p={};2.1<=f.api?(f.commandMap=t.options.uiCmdMap&&Object.keys(t.options.uiCmdMap).length?t.options.uiCmdMap:{},yr!==JSON.stringify(f.commandMap)&&(yr=JSON.stringify(f.commandMap))):f.options.sync=0;t.init?(o={},a={}):(y=c,l="elfinder-subtree-loaded "+f.res("class","navexpand"),f.res("class","navcollapse"),i=Object.keys(o),v=function(n){if(!o[n])return!0;var i="directory"===o[n].mime,t=o[n].phash;!(!i||h[t]||!p[t]&&f.navHash2Elm(o[n].hash).is(":hidden")&&100<f.navHash2Elm(t).next(".elfinder-navbar-subtree").children().length)||!i&&t===c||dt[n]?i&&(p[t]=!0):(i&&!h[t]&&(h[t]=!0,f.navHash2Elm(t).removeClass(l).next(".elfinder-navbar-subtree").empty()),ki(o[n]))},r=function(){i.length&&(bi&&bi._abort(),bi=f.asyncJob(v,i,{interval:20,numPerOnce:100}).done(function(){var t=f.storage("hide")||{items:{}};Object.keys(at).length&&n.each(at,function(n){t.items[n]||delete at[n]})}))},f.trigger("filesgc").one("filesgc",function(){i=[]}),f.one("opendone",function(){y!==c&&(e.data("lazycnt")?f.one("lazydone",r):r())}));f.sorters={};c=t.cwd.hash;w(t.files);o[c]?(s=f.diff([t.cwd],!0)).changed.length&&(w(s.changed,"change"),f.change({changed:s.changed})):w([t.cwd]);t.changed&&t.changed.length&&w(t.changed,"change");u=JSON.stringify(f.sorters);vr!==u&&(f.trigger("sorterupdate"),vr=u);f.lastDir(c);f.autoSync()}function dr(t){var r,i=t.keyCode,u=!(!t.ctrlKey&&!t.metaKey),o="mousedown"===t.type;o||(f.keyState.keyCode=i);f.keyState.ctrlKey=u;f.keyState.shiftKey=t.shiftKey;f.keyState.metaKey=t.metaKey;f.keyState.altKey=t.altKey;o||("keyup"!==t.type?y&&(n.each(st,function(n,r){r.type==t.type&&r.keyCode==i&&r.shiftKey==t.shiftKey&&r.ctrlKey==u&&r.altKey==t.altKey&&(t.preventDefault(),t.stopPropagation(),r.callback(t,f),f.debug("shortcut-exec",n+" : "+r.description))}),i!=n.ui.keyCode.TAB||n(t.target).is(":input")||t.preventDefault(),"keydown"===t.type&&i==n.ui.keyCode.ESCAPE&&(e.find(".ui-widget:visible").length||f.clipboard().length&&f.clipboard([]),n.ui.ddmanager&&(r=n.ui.ddmanager.current)&&r.helper&&r.cancel(),f.toHide(e.find(".ui-widget.elfinder-button-menu.elfinder-frontmost:visible")),f.trigger("keydownEsc",t))):f.keyState.keyCode=null)}function wr(){e.data("cssautoloadHide")&&(e.data("cssautoloadHide").remove(),e.removeData("cssautoloadHide"))}function br(){f.cssloaded||(wr(),f.cssloaded=!0,f.trigger("cssloaded"))}function kr(n){var t;n.target===window&&n.data&&n.data.elm&&(t=n.data.elm,oi&&cancelAnimationFrame(oi),oi=requestAnimationFrame(function(){t.trigger("resize",{maximize:"on"})}))}var tr,b,ir,k,ot,rr,ht,yt,ur,fr,pt,er,d,or,wt,ui,sr,fi,rt,ut,ct,bt,ei,oi,kt,l,g,lt,si,ft,f=this,hi=[],gr=["button","tooltip"],e=n(t),nu=n.extend(!0,{},n._data(e.get(0),"events")),ci=n("<div><\/div>").append(e.contents()).attr("class",e.attr("class")||"").attr("style",e.attr("style")||""),hr=e.attr("id")||e.attr("id","elfauto"+n(".elfinder").length).attr("id"),s="elfinder-"+hr,cr="mousedown."+s,lr="keydown."+s,tu="keypress."+s,iu="keyup."+s,y=!1,li=!1,c="",ar={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadOverwrite:!0,uploadMaxSize:0,jpgQuality:100,tmbCrop:!1,tmbReqCustomData:!1,tmb:!1},v={},o={},at={},a={},vt=[],p={},st={},nt=[],dt={},gt=[],ni=[],ai=new f.command(f),vi="auto",yi=400,h=null,pi="sounds/",vr="",wi=!1,ti=n(document.createElement("audio")).hide().appendTo("body")[0],ii=0,yr="",bi=null,w=function(t,i){function v(t){var i=t||{},r=[];n.each(f.sortRules,function(n){(d[n]||void 0!==i[n]||"mode"===n&&void 0!==i.perm)&&r.push(n)});f.sorters=f.arrayFlip(r,!0);f.sorters._checked=!0}for(var r,u,y,h,i=i||"files",e=["sizeInfo","encoding"],d={name:!0,perm:!0,date:!0,size:!0,kind:!0},l=!f.sorters._checked&&"files"===i,p=t.length,w={},b=f.storage("hide")||{},k=b.items||{},s=0;s<p;s++)if(r=Object.assign({},t[s]),h=!(b.show||!k[r.hash]),r.name&&r.hash&&r.mime){if(h||(l&&r.phash===c&&(v(r),l=!1),!r.phash||"add"!==i&&("change"!==i||o[r.hash]&&r.size===o[r.hash])||(y=f.parents(r.phash))&&n.each(y,function(){w[this]=!0})),o[r.hash]){for(u=0;u<e.length;u++)o[r.hash][e[u]]&&!r[e[u]]&&(r[e[u]]=o[r.hash][e[u]]);r.sizeInfo&&!r.size&&(r.size=r.sizeInfo.size);ki(o[r.hash],!0)}k[r.hash]&&(at[r.hash]=r);h?(p--,t.splice(s--,1)):("directory"!==(o[r.hash]=r).mime||a[r.hash]||(a[r.hash]={}),r.phash&&(a[r.phash]||(a[r.phash]={}),a[r.phash][r.hash]=!0))}n.each(Object.keys(w),function(){var n=o[this];n&&n.sizeInfo&&delete n.sizeInfo});l&&v()},pr=function(t){var r,u=t.length,i={},e=function(t){var u=o[t];u&&("directory"===u.mime&&(i[t]&&delete f.roots[i[t]],n.each(f.leafRoots,function(i,r){var e,u;-1!==(e=n.inArray(t,r))&&(1===r.length?((u=Object.assign({},o[i]))&&u._realStats&&(n.each(u._realStats,function(n,t){u[n]=t}),pr(o[i]._realStats),f.change({changed:[u]})),delete f.leafRoots[i]):f.leafRoots[i].splice(e,1))}),f.searchStatus.state<2&&n.each(o,function(n,i){i.phash==t&&e(n)})),u.phash&&(r=f.parents(u.phash))&&n.each(r,function(){s[this]=!0}),ki(o[t]))},s={};for(n.each(f.roots,function(n,t){i[t]=n});u--;)e(t[u]);n.each(Object.keys(s),function(){var n=o[this];n&&n.sizeInfo&&delete n.sizeInfo})},ki=function(n,t){var i=n.hash,r=n.phash;r&&a[r]&&delete a[r][i];t||(a[i]&&delete a[i],f.optionsByHashes[i]&&delete f.optionsByHashes[i]);delete o[i]},di=0,et=[],tt=null,gi=new Date,it=window.parent!==window,ri=function(){var t,i;if(it)try{(i=n("iframe",window.parent.document)).length&&n.each(i,function(i,r){if(r.contentWindow===window)return t=n(r),!1})}catch(i){}return t}();i=i||{};f.UA.Mobile&&n(window).on("orientationchange."+s,function(){var n=(screen&&screen.orientation&&screen.orientation.angle||window.orientation||0)+0;-90===n&&(n=270);f.UA.Angle=n;f.UA.Rotated=n%180!=0}).trigger("orientationchange."+s);i.bootCallback&&"function"==typeof i.bootCallback&&(yt=u,ur=i.bootCallback,u=function(n,t){yt&&"function"==typeof yt&&yt.call(this,n,t);ur.call(this,n,t)});delete i.bootCallback;this.api=null;this.newAPI=!1;this.oldAPI=!1;this.netDrivers=[];this.baseUrl="";this.i18nBaseUrl="";this.cssloaded=!1;this.theme=null;this.mimesCanMakeEmpty={};this.bootCallback;this.reloadCallback;this.id=hr;this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?(f.UA.Safari&&(window.localStorage.setItem("elfstoragecheck",1),window.localStorage.removeItem("elfstoragecheck")),f.localStorage):f.cookie}catch(n){return f.cookie}}();this.pauseUnloadCheck=function(n,t){if(void 0===n)return wi;wi=!!n;n&&!t&&requestAnimationFrame(function(){wi=!1})};this.options=Object.assign({},this._options);i.uiOptions&&i.uiOptions.toolbar&&Array.isArray(i.uiOptions.toolbar)&&n.isPlainObject(i.uiOptions.toolbar[i.uiOptions.toolbar.length-1])&&(f.options.uiOptions.toolbarExtra=Object.assign(f.options.uiOptions.toolbarExtra||{},i.uiOptions.toolbar.pop()));(fr=function(t,i){n.isPlainObject(t)&&n.each(t,function(t,r){n.isPlainObject(r)?(i[t]||(i[t]={}),fr(r,i[t])):i[t]=r})})(i,f.options);this.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra);delete this.options.uiOptions.toolbarExtra;this.toUnbindEvents={};this.bind=function(n,t,i){var r,u;if(t&&("function"==typeof t||"function"==typeof t.done))for(u=(n=(""+n).toLowerCase().replace(/^\s+|\s+$/g,"").split(/\s+/)).length,r=0;r<u;r++)void 0===p[n[r]]&&(p[n[r]]=[]),p[n[r]][i?"unshift":"push"](t);return this};this.unbind=function(t,i){for(var r,f,e=(t=(""+t).toLowerCase().split(/\s+/)).length,u=0;u<e;u++)(r=p[t[u]])&&-1<(f=n.inArray(i,r))&&r.splice(f,1);return i=null,this};this.trigger=function(t,i,r){var u,c,h,e,o=t.toLowerCase(),a="object"==typeof i,s=p[o]||[],l=[];if(this.debug("event-"+o,i),a&&void 0!==r||(r=!0),c=s.length){for(e=n.Event(o),i&&(i._getEvent=function(){return e}),r&&(e.data=i),u=0;u<c;u++)if(s[u])if(s[u].done)l.push(s[u].done);else{if(s[u].length&&!r){if(void 0===h)try{h=JSON.stringify(i)}catch(t){h=!1}e.data=h?JSON.parse(h):i}try{if(!1===s[u].call(e,e,this)||e.isDefaultPrevented()){this.debug("event-stoped",e.type);break}}catch(t){window.console&&window.console.log&&window.console.log(t)}}if(c=l.length)for(u=0;u<c;u++)try{if(!1===l[u].call(e,e,this)||e.isDefaultPrevented()){this.debug("event-stoped",e.type+"(done)");break}}catch(t){window.console&&window.console.log&&window.console.log(t)}this.toUnbindEvents[o]&&this.toUnbindEvents[o].length&&(n.each(this.toUnbindEvents[o],function(n,t){f.unbind(t.type,t.callback)}),delete this.toUnbindEvents[o])}return this};this.getListeners=function(n){return n?p[n.toLowerCase()]:p};this.baseUrl=f.options.baseUrl?f.options.baseUrl:(d="",pt=null,n("head > script").each(function(){if(this.src&&this.src.match(/js\/elfinder(?:-[a-z0-9_-]+)?\.(?:min|full)\.js$/i))return pt=n(this),!1}),pt&&((d=pt.attr("src").replace(/js\/[^\/]+$/,"")).match(/^(https?\/\/|\/)/)||(er=n("head > base[href]").attr("href"))&&(d=er.replace(/\/$/,"")+"/"+d)),""!==d?f.options.baseUrl=d:(f.options.baseUrl||(f.options.baseUrl="./"),d=f.options.baseUrl),d);this.i18nBaseUrl=(this.options.i18nBaseUrl||this.baseUrl+"js/i18n").replace(/\/$/,"")+"/";this.options.maxErrorDialogs=Math.max(1,parseInt(this.options.maxErrorDialogs||5));ar.dispInlineRegex=this.options.dispInlineRegex;this.options.cssAutoLoad&&(or=f.baseUrl,n('head > link[href$="css/elfinder.min.css"],link[href$="css/elfinder.full.css"]:first').length||(f.cssloaded=null),Array.isArray(f.options.cssAutoLoad)&&(f.options.themes.default?!0===f.cssloaded?f.loadCss(f.options.cssAutoLoad):f.bind("cssloaded",function(){f.loadCss(f.options.cssAutoLoad)}):(f.options.themes=Object.assign({"default":{name:"default",cssurls:f.options.cssAutoLoad}},f.options.themes),f.options.theme||(f.options.theme="default"))),null===f.cssloaded&&(e.addClass("elfinder").data("cssautoloadHide",n("<style>.elfinder{visibility:hidden;overflow:hidden}<\/style>")),n("head").append(e.data("cssautoloadHide")),f.options.themes.default||(f.options.themes=Object.assign({"default":{name:"default",cssurls:"css/theme.css",author:"elFinder Project",license:"3-clauses BSD"}},f.options.themes),f.options.theme||(f.options.theme="default")),requestAnimationFrame(function(){"hidden"===e.css("visibility")?f.loadCss([or+"css/elfinder.min.css"],{dfd:n.Deferred().done(function(){br()}).fail(function(){wr();f.cssloaded||(f.cssloaded=!1,f.bind("init",function(){f.cssloaded||f.error(["errRead","CSS (elfinder.min)"])}))})}):br()})));ui=f.options.themes;(sr=Object.keys(ui||{})).length&&(ui[wt=f.storage("theme")||f.options.theme]||(wt=sr[0]),f.cssloaded?f.changeTheme(wt):f.bind("cssloaded",function(){f.changeTheme(wt)}));this.optionProperties={icon:void 0,csscls:void 0,tmbUrl:void 0,uiCmdMap:{},netkey:void 0,disabled:[]};it||this.options.enableAlways||2!==n("body").children().length||(this.options.enableAlways=!0);!0===this.options.debug?this.options.debug="all":Array.isArray(this.options.debug)?(fi={},n.each(f.options.debug,function(){fi[this]=!0}),f.options.debug=fi):this.options.debug=!1;this.noConflicts={};this.noConflict=function(){n.each(gr,function(t,i){n.fn[i]&&"function"==typeof n.fn[i].noConflict&&(f.noConflicts[i]=n.fn[i].noConflict())})};this.noConflict();this.isCORS=!1;void 0!==f.options.cors&&null!==f.options.cors?f.isCORS=!!f.options.cors:(rt=document.createElement("a"),ct=window.location.protocol,bt=function(n){return"https:"===(n=n&&":"!==n?n:ct)?/\:443$/:/\:80$/},ei=window.location.host.replace(bt(ct),""),rt.href=i.url,i.urlUpload&&i.urlUpload!==i.url&&((ut=document.createElement("a")).href=i.urlUpload),(ei!==rt.host.replace(bt(rt.protocol),"")||":"!==rt.protocol&&""!==rt.protocol&&ct!==rt.protocol||ut&&(ei!==ut.host.replace(bt(ut.protocol),"")||":"!==ut.protocol&&""!==ut.protocol&&ct!==ut.protocol))&&(f.isCORS=!0));f.isCORS&&(n.isPlainObject(f.options.customHeaders)||(f.options.customHeaders={}),n.isPlainObject(f.options.xhrFields)||(f.options.xhrFields={}),f.options.requestType="post",f.options.customHeaders["X-Requested-With"]="XMLHttpRequest",f.options.xhrFields.withCredentials=!0);this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get";ir=Math.max(parseInt(this.options.requestMaxConn),1);this.optsCustomData=n.isPlainObject(this.options.customData)?this.options.customData:{};this.customData=Object.assign({},this.optsCustomData);this.prevCustomData=null;this.customHeaders=n.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{};this.xhrFields=n.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{};this.replaceXhrSend=function(){ht=ht||XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){var t=this;return f.customHeaders&&n.each(f.customHeaders,function(n){t.setRequestHeader(n,this)}),f.xhrFields&&n.each(f.xhrFields,function(n){n in t&&(t[n]=this)}),ht.apply(this,arguments)}};this.restoreXhrSend=function(){ht&&(XMLHttpRequest.prototype.send=ht)};this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||["tmb","parents"];this.navPrefix="nav"+(r.prototype.uniqueid?r.prototype.uniqueid:"")+"-";this.cwdPrefix=r.prototype.uniqueid?"cwd"+r.prototype.uniqueid+"-":"";++r.prototype.uniqueid;this.uploadURL=i.urlUpload||i.url;this.namespace=s;this.today=new Date(gi.getFullYear(),gi.getMonth(),gi.getDate()).getTime()/1e3;this.yesterday=this.today-86400;k=this.options.UTCDate?"UTC":"";this.getHours="get"+k+"Hours";this.getMinutes="get"+k+"Minutes";this.getSeconds="get"+k+"Seconds";this.getDate="get"+k+"Date";this.getDay="get"+k+"Day";this.getMonth="get"+k+"Month";this.getFullYear="get"+k+"FullYear";this.zIndex;this.searchStatus={state:0,query:"",target:"",mime:"",mixed:!1,ininc:!1};this.lang=this.storage("lang")||this.options.lang;"jp"===this.lang&&(this.lang=this.options.lang="ja");this.viewType=this.storage("view")||this.options.defaultView||"icons";this.sortType=this.storage("sortType")||this.options.sortType||"name";this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc";this.sortStickFolders=this.storage("sortStickFolders");this.sortStickFolders=null===this.sortStickFolders?!!this.options.sortStickFolders:!!this.sortStickFolders;this.sortAlsoTreeview=this.storage("sortAlsoTreeview");this.sortAlsoTreeview=null===this.sortAlsoTreeview||null===this.options.sortAlsoTreeview?!!this.options.sortAlsoTreeview:!!this.sortAlsoTreeview;this.sortRules=n.extend(!0,{},this._sortRules,this.options.sortRules);n.each(this.sortRules,function(n,t){"function"!=typeof t&&delete f.sortRules[n]});this.compare=n.proxy(this.compare,this);this.notifyDelay=0<this.options.notifyDelay?parseInt(this.options.notifyDelay):500;this.draggingUiHelper=null;this.droppable={greedy:!0,tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename",hoverClass:this.res("class","adroppable"),classes:{"ui-droppable-hover":this.res("class","adroppable")},autoDisable:!0,drop:function(t,i){var l,r,u,e=n(this),h=n.grep(i.helper.data("files")||[],function(n){return!!n}),a=[],v=[],y=[],p=i.helper.hasClass("elfinder-drag-helper-plus");if(void 0===t.button||i.helper.data("namespace")!==s||!f.insideWorkzone(t.pageX,t.pageY))return!1;for(r=e.hasClass(f.res("class","cwdfile"))?f.cwdId2Hash(e.attr("id")):e.hasClass(f.res("class","navdir"))?f.navId2Hash(e.attr("id")):c,l=h.length;l--;)(u=h[l])!=r&&o[u].phash!=r?a.push(u):(p&&u!==r&&o[r].write?v:y).push(u);if(y.length)return!1;i.helper.data("droped",!0);v.length&&(i.helper.hide(),f.exec("duplicate",v,{_userAction:!0}));a.length&&(i.helper.hide(),f.clipboard(a,!p),f.exec("paste",r,{_userAction:!0},r).always(function(){f.clipboard([]);f.trigger("unlockfiles",{files:h})}),f.trigger("drop",{files:h}))}};this.enabled=function(){return y&&this.visible()};this.visible=function(){return e[0].elfinder&&e.is(":visible")};this.isRoot=function(n){return!(!n.isroot&&n.phash)};this.root=function(t,i){var r,u;if(t=t||c,!i&&(n.each(f.roots,function(n,i){if(0===t.indexOf(n))return r=i,!1}),r))return r;for(r=o[t];r&&r.phash&&(i||!r.isroot);)r=o[r.phash];if(r)return r.hash;for(;u in o&&o.hasOwnProperty(u);)if("directory"===(r=o[u]).mime&&!r.phash&&r.read)return r.hash;return""};this.cwd=function(){return o[c]||{}};this.option=function(t,i){var r,u;return i=i||c,f.optionsByHashes[i]&&void 0!==f.optionsByHashes[i][t]?f.optionsByHashes[i][t]:!f.hasVolOptions||c===i||(u=f.file(i))&&u.phash===c?v[t]||"":(r="",n.each(f.volOptions,function(n,u){if(0===i.indexOf(n))return r=u[t]||"",!1}),r)};this.getDisabledCmds=function(t,i){var r={hidden:!0};return Array.isArray(t)||(t=[t]),n.each(t,function(n,t){var i=f.option("disabledFlip",t);i&&Object.assign(r,i)}),i?r:Object.keys(r)};this.file=function(n,t){if(n)return o[n]||(t?at[n]:void 0)};this.files=function(t){var i={};return t?a[t]?(n.each(a[t],function(n){o[n]?i[n]=o[n]:delete a[t][n]}),Object.assign({},i)):{}:Object.assign({},o)};this.parents=function(n){for(var t,i=[];n&&(t=this.file(n));)i.unshift(t.hash),n=t.phash;return i};this.path2array=function(n,t){for(var i,r=[];n;){if(!(i=o[n])||!i.hash){r=[];break}r.unshift(t&&i.i18?i.i18:i.name);n=i.isroot?null:i.phash}return r};this.path=function(t,i,r){var e=o[t]&&o[t].path?o[t].path:this.path2array(t,i).join(v.separator);if(r&&o[t]){r=Object.assign({notify:{type:"parents",cnt:1,hideCnt:!0}},r);function c(){f.request({data:{cmd:"parents",target:o[t].phash},notify:u,preventFail:!0}).done(a).fail(function(){s.reject()})}var l,s=n.Deferred(),u=r.notify,h=!1,a=function(){f.one("parentsdone",function(){""===(e=f.path(t,i))&&h?(h=!1,c()):(u&&(clearTimeout(l),u.cnt=-parseInt(u.cnt||0),f.notify(u)),s.resolve(e))})};return e?s.resolve(e):(f.ui.tree?(u&&(l=setTimeout(function(){f.notify(u)},f.notifyDelay)),a(h=!0)):c(),s)}return e};this.url=function(t,i){function c(n){return n&&p&&(n=f.convAbsUrl(n)),n}function l(i){if(i)return c(i);if(r.url)return c(r.url);if(void 0===e&&(e=v()),e)return c(e+n.map(f.path2array(t),function(n){return encodeURIComponent(n)}).slice(1).join("/"));var u=Object.assign({},f.customData,{cmd:"file",target:r.hash});return f.oldAPI&&(u.cmd="open",u.current=r.phash),c(f.options.url+(-1===f.options.url.indexOf("?")?"?":"&")+n.param(u,!0))}var e,r=o[t],s=i||{},u=s.async||!1,a=s.temporary||!1,y=s.onetime&&f.option("onetimeUrl",t)||!1,p=s.absurl||!1,h=u||y?n.Deferred():null,v=function(){return f.option("url",!f.isRoot(r)&&r.phash||r.hash)};if(!r||!r.read)return u?h.resolve(""):"";if(!y||r.url&&"1"!=r.url||(e=v()))if("1"!=r.url&&(!a||r.url||(e=v()))){if(!u)return l();h.resolve(l())}else this.request({data:{cmd:"url",target:t,options:{temporary:a?1:0}},preventDefault:!0,options:{async:u},notify:u?{type:a?"file":"url",cnt:1,hideCnt:!0}:{},progressBar:s.progressBar}).done(function(n){r.url=n.url||""}).fail(function(){r.url=""}).always(function(){var n;if(r.url&&a&&(n=r.url,r.url="1"),!u)return l(n);h.resolve(l(n))});else u=!0,this.request({data:{cmd:"url",target:t,options:{onetime:1}},preventDefault:!0,options:{async:u},notify:{type:"file",cnt:1,hideCnt:!0},progressBar:s.progressBar}).done(function(n){h.resolve(c(n.url||""))}).fail(function(){h.resolve("")});if(u)return h};this.forExternalUrl=function(n,t){var i={async:!0,absurl:!0};return i[f.option("onetimeUrl",n)?"onetime":"temporary"]=!0,f.url(n,Object.assign({},t,i))};this.openUrl=function(t,i,r,u){var s=o[t],e="",h=(u||{}).onetimeSize||5242880;return s&&s.read?i&&"sameorigin"!==i||(s.url?1!=s.url&&(e=s.url):v.url&&0===s.hash.indexOf(f.cwd().volumeid)&&(e=v.url+n.map(this.path2array(t),function(n){return encodeURIComponent(n)}).slice(1).join("/")),i&&!this.isSameOrigin(e)||!e)?r&&this.hasParrotHeaders()?(u?delete u.onetimeSize:u={},!u.onetime&&!u.temporary&&s.size>h&&(s.mime.match(/^video|audio/)?u.temporary=!0:u.onetime=!0),u.onetime||u.temporary?this.url(s.hash,Object.assign({async:!0},u)).done(function(n){r(n)}).fail(function(){r("")}):this.getContents(t,"blob",u).done(function(n){e=(window.URL||window.webkitURL).createObjectURL(n);r(e)}).fail(function(){r("")})):(e=(e=this.options.url)+(-1===e.indexOf("?")?"?":"&")+(this.oldAPI?"cmd=open&current="+s.phash:"cmd=file")+"&target="+s.hash+"&_t="+(s.ts||parseInt(new Date/1e3)),!0===i&&(e+="&download=1"),n.each(this.customData,function(n,t){e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t)}),r?void r(e):e):(e+=(e.match(/\?/)?"&":"?")+"_".repeat((e.match(/[\?&](_+)t=/g)||["&t="]).sort().shift().match(/[\?&](_*)t=/)[1].length+1)+"t="+(s.ts||parseInt(new Date/1e3)),r?void r(e):e):""};this.tmb=function(t){var r,e="elfinder-cwd-bgurl",i="",u={},o=0;return!(!n.isPlainObject(t)||((f.searchStatus.state&&0!==t.hash.indexOf(f.cwd().volumeid)?(r=f.option("tmbUrl",t.hash),f.option("tmbCrop",t.hash)):(r=v.tmbUrl,v.tmbCrop))&&(e+=" elfinder-cwd-bgurl-crop"),"self"===r&&0===t.mime.indexOf("image/")?(i=f.openUrl(t.hash),e+=" elfinder-cwd-bgself"):(f.oldAPI||r)&&t&&t.tmb&&1!=t.tmb?i=r+t.tmb:f.newAPI&&t&&t.tmb&&1!=t.tmb&&(i=t.tmb),!i))&&("self"!==r&&(t.ts&&(u._t=t.ts),v.tmbReqCustomData&&Object.keys(this.customData).length&&(u=Object.assign(u,this.customData)),Object.keys(u).length&&(i+=i.match(/\?/)?"&":"?",n.each(u,function(n,t){i+=(0==o++?"":"&")+encodeURIComponent(n)+"="+encodeURIComponent(t)}))),{url:i,className:e})};this.selected=function(){return vt.slice(0)};this.selectedFiles=function(){return n.map(vt,function(n){return o[n]?Object.assign({},o[n]):null})};this.fileByName=function(n,t){for(var i in o)if(o.hasOwnProperty(i)&&o[i].phash==t&&o[i].name==n)return o[i]};this.validResponse=function(n,t){return t.error||this.rules[this.rules[n]?n:"defaults"](t)};this.returnBytes=function(n){var t;return isNaN(n)?(t=(n=(n=n||"").replace(/b$/i,"")).charAt(n.length-1).toLowerCase(),n=n.replace(/[tgmk]$/i,""),"t"==t?n=1099511627776*n:"g"==t?n=1073741824*n:"m"==t?n=1048576*n:"k"==t&&(n*=1024),n=isNaN(n)?0:parseInt(n)):(n=parseInt(n))<1&&(n=0),n};this.request=function(t){function vt(t){t.warning&&i.error(t.warning);s?nr(t):i.updateCache(t);i.lazy(function(){t.removed&&t.removed.length&&i.remove(t);t.added&&t.added.length&&i.add(t);t.changed&&t.changed.length&&i.change(t)}).then(function(){return i.lazy(function(){i.trigger(u,t,!1)})}).then(function(){return i.lazy(function(){i.trigger(u+"done")})}).then(function(){t.toasts&&Array.isArray(t.toasts)&&n.each(t.toasts,function(){this.msg&&i.toast(this)});t.sync&&i.sync()})}function yt(n,t){var f,e,o=i.options.debug;switch(t){case"abort":f=n.quiet?"":["errConnect","errAbort"];break;case"timeout":f=["errConnect","errTimeout"];break;case"parsererror":f=["errResponse","errDataNotJSON"];n.responseText&&(c&&(!o||"all"!==o&&!o["backend-error"])||f.push(n.responseText));break;default:if(n.responseText)try{(e=JSON.parse(n.responseText))&&e.error&&(f=e.error)}catch(n){}if(!f)if(403==n.status)f=["errConnect","errAccess","HTTP error "+n.status];else if(404==n.status)f=["errConnect","errNotFound","HTTP error "+n.status];else if(500<=n.status)f=["errResponse","errServerError","HTTP error "+n.status];else{if(414==n.status&&"get"===h.type)return h.type="post",i.abortXHR(n),void(r.xhr=n=i.transport.send(h).fail(f).done(lt));f=n.quiet?"":["errConnect","HTTP error "+n.status]}}i.trigger(u+"done");r.reject({error:f},n,t)}function ut(n){f&&"pending"===f.state()&&(i.abortXHR(f,{quiet:!0,abort:!0}),n&&("unload"===n.type||"destroy"===n.type)||i.autoSync())}function b(n){if(i.trigger(u+"done"),"autosync"==n.type){if("stop"!=n.data.action)return}else if(!("unload"==n.type||"destroy"==n.type||"openxhrabort"==n.type||n.data.added&&n.data.added.length))return;ut(n)}function nt(t){function o(){a=!1;r.reject()}if(t&&"cmd"===t)return u;if(s){if(tt&&"pending"===tt.state()){if(tt._target===e.target)return r.reject("openabort");tt.xhr?tt.xhr.queueAbort():tt.reject("openabort")}(tt=r)._target=e.target}if(r.always(function(){delete h.headers["X-elFinderReqid"];s&&(tt=null)}).fail(function(t,r,f){var o,h;s&&"openabort"===t&&(t="",a=!1);o={cmd:u,err:t,xhr:r,rc:f};0===t&&et.length&&(et=n.grep(et,function(n){return n("cmd")!==u}));i.trigger("requestError",o);o._getEvent&&o._getEvent().isDefaultPrevented()&&(a=ht=!1,t&&(t.error=""));ut();s&&(d=i.file(e.target))&&d.volumeid&&i.isRoot(d)&&delete i.volumeExpires[d.volumeid];i.trigger(u+"fail",f);(h="object"==typeof t?t.error:t)&&(ht?i.error(h):i.debug("error",i.i18n(h)));a&&i.sync()}),!u)return a=!1,r.reject({error:"errCmdReq"});if(i.maxTargets&&e.targets&&e.targets.length>i.maxTargets)return a=!1,r.reject({error:["errMaxTargets",i.maxTargets]});if(pt&&r.done(vt),s){for(;k=gt.pop();)k.queueAbort();if(c!==e.target)for(;k=ni.pop();)k.queueAbort()}return-1!==n.inArray(u,(i.cmdsToAdd+" autosync").split(" "))&&("autosync"!==u&&(i.autoSync("stop"),r.always(function(){i.autoSync()})),i.trigger("openxhrabort")),delete h.preventFail,2.1029<=i.api&&(dt?h.headers["X-elFinderReqid"]=it:Object.assign(h.data,{reqid:it})),r.syncOnFail=function(n){a=!!n},di++,r.xhr=f=i.transport.send(h).always(function(){h._xhr&&void 0!==h._xhr.responseURL&&(f.responseURL=h._xhr.responseURL||"");--di;et.length&&et.shift()()}).fail(yt).done(lt),2.1029<=i.api&&(f._requestId=it),s||e.compare&&"info"===u?(f.queueAbort=o,gt.unshift(f),e.compare&&i.bind(i.cmdsToAdd+" autosync openxhrabort",b),r.always(function(){var t=n.inArray(f,gt);e.compare&&i.unbind(i.cmdsToAdd+" autosync openxhrabort",b);-1!==t&&gt.splice(t,1)})):-1!==n.inArray(u,i.abortCmdsOnOpen)&&(f.queueAbort=o,ni.unshift(f),r.always(function(){var t=n.inArray(f,ni);-1!==t&&ni.splice(t,1)})),i.bind("unload destroy",b),r.always(function(){i.unbind("unload destroy",b)}),r}function ft(){return o.type&&o.cnt&&(wt&&(o.cancel=r,t.eachCancel&&(o.id=+new Date)),ot=setTimeout(function(){y=setTimeout(at,1e3);i.notify(o);g=!0;r.always(function(){o.cnt=-(parseInt(o.cnt)||0);i.notify(o);g=!1})},i.notifyDelay),r.always(function(){clearTimeout(ot)})),di<ir?nt():(s?et.unshift(nt):et.push(nt),r)}var ot,f,k,d,i=this,st=this.options,r=n.Deferred(),it=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),e=Object.assign({},i.customData,{mimes:st.onlyMimes},t.data||t),u=e.cmd,rt="binary"===(t.options||{}).dataType,s=!t.asNotOpen&&"open"===u,ht=!(rt||t.preventDefault||t.preventFail),pt=!(rt||t.preventDefault||t.preventDone),p=t.progressVal||20,y=null,g=!1,o=!t.progressBar&&t.notify?Object.assign({progress:p*t.notify.cnt},t.notify):{},wt=!!t.cancel,bt=rt||!!t.raw,a=t.syncOnFail,kt=!!t.lazy,ct=t.prepare,l=t.navigate,dt=(t.options||{}).cache,h=Object.assign({url:st.url,async:!0,type:this.requestType,dataType:"json",cache:2.1029<=i.api,data:e,headers:this.customHeaders,xhrFields:this.xhrFields,progress:function(n){var r=n.loaded/n.total*100;if(y&&clearTimeout(y),t.progressBar)try{t.progressBar.width(r+"%")}catch(n){}else g&&o.type&&(r*=o.cnt,p<r&&(i.notify({type:o.type,progress:r-p,cnt:0,hideCnt:o.hideCnt}),p=r));if(t.progress)try{t.progress(n)}catch(n){}}},t.options||{}),lt=function(t){function o(){function h(r){i.leafRoots[e.target]&&t[r]&&n.each(i.leafRoots[e.target],function(n,u){var f;(f=i.file(u))&&t[r].push(f)})}function c(){i.textMimes={};n.each(i.res("mimes","text"),function(){i.textMimes[this.toLowerCase()]=!0})}var o;if(s?h("files"):"tree"===u&&h("tree"),t=i.normalize(t),!i.validResponse(u,t))return r.reject({error:t.norError||"errResponse"},f,t);s&&(i.api||(i.api=t.api||1,"2.0"==i.api&&void 0!==t.options.uploadMaxSize&&(i.api="2.1"),i.newAPI=2<=i.api,i.oldAPI=!i.newAPI),t.textMimes&&Array.isArray(t.textMimes)&&(i.resources.mimes.text=t.textMimes,c()),i.textMimes||c(),t.options&&(v=Object.assign({},ar,t.options)),t.netDrivers&&(i.netDrivers=t.netDrivers),t.maxTargets&&(i.maxTargets=t.maxTargets),e.init&&(i.uplMaxSize=i.returnBytes(t.uplMaxSize),i.uplMaxFile=t.uplMaxFile?Math.min(parseInt(t.uplMaxFile),50):20));"function"==typeof ct&&ct(t);l&&(o=l.target||"added",t[o]&&t[o].length&&i.one(u+"done",function(){function e(){var t=i.cwd().hash;return n.map(r,function(n){return n.phash&&t===n.phash?n.hash:null})}function s(t){var u,s,r,h=void 0,o=t.action?t.action.data:void 0;return(o||f.length)&&t.action&&(s=t.action.msg)&&(u=t.action.cmd)&&(!t.action.cwdNot||t.action.cwdNot!==i.cwd().hash)&&(r=t.action.done,o=t.action.data,h=n("<div><\/div>").append(n('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+i.i18n(s)+"<\/span><\/button>").on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click",function(){i.exec(u,o||f,{_userAction:!0,_currentType:"toast",_currentNode:n(this)});r&&i.one(u+"done",function(){"function"==typeof r?r():"select"===r&&i.trigger("selectfiles",{files:e()})})}))),delete t.action,t.extNode=h,t}var r=t[o],u=i.findCwdNodes(r),f=e();l.toast||(l.toast={});l.noselect||i.trigger("selectfiles",{files:1<i.searchStatus.state?n.map(r,function(n){return n.hash}):f});u.length?(l.noscroll||(u.first().trigger("scrolltoview",{blink:!1}),i.resources.blink(u,"lookme")),n.isPlainObject(l.toast.incwd)&&i.toast(s(l.toast.incwd))):n.isPlainObject(l.toast.inbuffer)&&i.toast(s(l.toast.inbuffer))}));r.resolve(t);t.debug&&i.debug("backend-debug",t)}if(i.currentReqCmd=u,t.debug&&i.responseDebug(t),i.setCustomHeaderByXhr(f),bt)return i.abortXHR(f),t&&t.debug&&i.debug("backend-debug",t),r.resolve(t);if(!t)return r.reject({error:["errResponse","errDataEmpty"]},f,t);if(!n.isPlainObject(t))return r.reject({error:["errResponse","errDataNotJSON"]},f,t);if(t.error)return s&&n.each(i.leafRoots,function(t,r){i.leafRoots[t]=n.grep(r,function(n){return n!==e.target})}),r.reject({error:t.error},f,t);i.abortXHR(f);kt?i.lazy(o):o()},at=function(){var n;g&&y&&(n=+o.cnt,y=null,i.notify({type:o.type,progress:n,cnt:0,hideCnt:o.hideCnt}),(p+=n)/o.cnt<80&&(y=setTimeout(at,500)))},w={opts:t,result:!0};return i.api||e.init?(i.trigger("request."+u,w,!0),w.result?"object"==typeof w.result&&w.result.promise?(w.result.done(ft).fail(function(){i.trigger(u+"done");r.reject()}),r):ft():(i.trigger(u+"done"),r.reject())):(a=!1,r.reject())};this.cache=function(n,t){Array.isArray(n)||(n=[n]);w(n,t)};this.updateCache=function(t){n.isPlainObject(t)&&(t.files&&t.files.length&&w(t.files,"files"),t.tree&&t.tree.length&&w(t.tree,"tree"),t.removed&&t.removed.length&&pr(t.removed),t.added&&t.added.length&&w(t.added,"add"),t.changed&&t.changed.length&&w(t.changed,"change"))};this.diff=function(t,i,r){var e={},h=[],s=[],u=[],f=null;return n.each(t,function(n,t){e[t.hash]=t}),r&&r.length&&(f={},n.each(r,function(){f[this]=!0})),n.each(o,function(n,t){e[n]||i&&t.phash!==i||s.push(n)}),n.each(e,function(t,i){var e,s=o[t],r={};s?(n.each(Object.keys(s),function(){r[this]=!0}),n.each(i,function(n){if(delete r[n],!(f&&f[n]||i[n]===s[n]))return u.push(i),!(r={})}),0!==(e=Object.keys(r).length)&&(f&&n.each(r,function(n){f[n]&&--e}),0!==e&&u.push(i))):h.push(i)}),n.each(s,function(t,i){var f=o[i],r=f.phash;r&&"directory"==f.mime&&-1===n.inArray(r,s)&&e[r]&&!function(n){for(var t=u.length;t--;)if(u[t].hash==n)return!0}(r)&&u.push(e[r])}),{added:h,removed:s,changed:u}};this.sync=function(t,i){this.autoSync("stop");var l,e,s,f,r=this,a=(e="",f=s=0,t&&i&&n.each(o,function(n,i){i.phash&&i.phash===t&&(++s,f=Math.max(f,i.ts));e=s+":"+f}),e),u=n.Deferred().always(function(){l||r.trigger("sync")}),h=[this.request({data:{cmd:"open",reload:1,target:c,tree:!t&&this.ui.tree?1:0,compare:a},preventDefault:!0})];return!t&&2<=r.api&&(c!==this.root()&&h.push(this.request({data:{cmd:"parents",target:c},preventDefault:!0})),n.each(function(){for(var i,u=[],t=r.file(r.root(c)),f=t?t.volumeid:null,n=r.cwd().phash;n;)n=(i=r.file(n))?(0!==n.indexOf(f)&&(u.push({target:n,cmd:"tree"}),r.isRoot(i)||u.push({target:n,cmd:"parents"}),f=(t=r.file(r.root(n)))?t.volumeid:null),i.phash):null;return u}(),function(n,t){h.push(r.request({data:{cmd:t.cmd,target:t.target},preventDefault:!0}))})),n.when.apply(n,h).fail(function(t,f){l=f&&200!=f.status;i&&-1===n.inArray("errOpen",t)?u.reject(t&&0!=f.status?t:void 0):(u.reject(t),r.parseError(t)&&r.request({data:{cmd:"open",target:r.lastDir("")||r.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}}))}).done(function(n){var i,o,e,f;if(n.cwd.compare&&a===n.cwd.compare)return u.reject();if(i={tree:[]},1<(o=arguments.length))for(e=1;e<o;e++)arguments[e].tree&&arguments[e].tree.length&&i.tree.push.apply(i.tree,arguments[e].tree);return(r.api<2.1&&(i.tree||(i.tree=[]),i.tree.push(n.cwd)),n=r.normalize(n),!r.validResponse("open",n))?u.reject(n.norError||"errResponse"):(i=r.normalize(i),!r.validResponse("tree",i))?u.reject(i.norError||"errResponse"):(f=r.diff(n.files.concat(i&&i.tree?i.tree:[]),t),f.added.push(n.cwd),r.updateCache(f),f.removed.length&&r.remove(f),f.added.length&&r.add(f),f.changed.length&&r.change(f),u.resolve(f))}).always(function(){r.autoSync()}),u};this.upload=function(n){return this.transport.upload(n,this)};this.shortcut=function(t){var e,r,i,u,f;if(this.options.allowShortcuts&&t.pattern&&n.isFunction(t.callback))for(e=t.pattern.toUpperCase().split(/\s+/),u=0;u<e.length;u++)(i=1==(i=(f=(r=e[u]).split("+")).pop()).length?0<i?i:i.charCodeAt(0):0<i?i:n.ui.keyCode[i])&&!st[r]&&(st[r]={keyCode:i,altKey:-1!=n.inArray("ALT",f),ctrlKey:-1!=n.inArray("CTRL",f),shiftKey:-1!=n.inArray("SHIFT",f),type:t.type||"keydown",callback:t.callback,description:t.description,pattern:r});return this};this.shortcuts=function(){var t=[];return n.each(st,function(n,i){t.push([i.pattern,f.i18n(i.description)])}),t};this.clipboard=function(t,i){function r(){return n.map(nt,function(n){return n.hash})}return void 0!==t&&(nt.length&&this.trigger("unlockfiles",{files:r()}),dt={},nt=n.map(t||[],function(n){var t=o[n];return t?(dt[n]=!0,{hash:n,phash:t.phash,name:t.name,mime:t.mime,read:t.read,locked:t.locked,cut:!!i}):null}),this.trigger("changeclipboard",{clipboard:nt.slice(0,nt.length)}),i&&this.trigger("lockfiles",{files:r()})),nt.slice(0,nt.length)};this.isCommandEnabled=function(n,t){var i,r,u=f.cwd().volumeid||"";return!t&&1<f.searchStatus.state&&f.selected().length&&(t=f.selected()[0]),i=!t||u&&0===t.indexOf(u)?v.disabledFlip:f.option("disabledFlip",t),!!(r=this._commands[n])&&(r.alwaysEnabled||!i[n])};this.exec=function(t,i,r,u){var e,o;return!u&&this.commandMap[t]&&"hidden"!==this.commandMap[t]&&(t=this.commandMap[t]),"open"===t&&((this.searchStatus.state||this.searchStatus.ininc)&&this.trigger("searchend",{noupdate:!0}),this.autoSync("stop")),!u&&i&&(n.isArray(i)?i.length&&(u=i[0]):u=i),"object"==(o=typeof(e=this._commands[t]&&this.isCommandEnabled(t,u)?this._commands[t].exec(i,r):n.Deferred().reject("errUnknownCmd")))&&e.promise||(f.debug("warning",'"cmd.exec()" should be returned "$.Deferred" but cmd "'+t+'" returned "'+o+'"'),e=n.Deferred().resolve()),this.trigger("exec",{dfrd:e,cmd:t,files:i,opts:r,dstHash:u}),e};this.dialog=function(t,i){function u(){!r.data("draged")&&r.is(":visible")&&r.elfinderdialog("posInit")}var r=n("<div><\/div>").append(t).appendTo(e).elfinderdialog(i,f),o=r.closest(".ui-dialog");return o.length&&(f.bind("resize",u),o.on("remove",function(){f.unbind("resize",u)})),r};this.toast=function(t){return n('<div class="ui-front"><\/div>').appendTo(this.ui.toast).elfindertoast(t||{},this)};this.getUI=function(t){return t?this.ui[t]||n():e};this.getCommand=function(n){return void 0===n?this._commands:this._commands[n]};this.resize=function(t,i){var u,s=!e.hasClass("ui-resizable"),o=e.data("resizeSize")||{w:0,h:0},r={};h&&h.data("resizeTm")&&clearTimeout(h.data("resizeTm"));"string"==typeof i&&(u=i.match(/^([0-9.]+)%$/))&&(h&&h.length||(h=n(window)),h.data("marginToMyNode")||h.data("marginToMyNode",function(){for(var t=e.outerHeight(!0)-e.innerHeight(),n=e;n.get(0)!==h.get(0)&&(t+=(n=n.parent()).outerHeight(!0)-n.innerHeight(),n.parent().length););return t}()),h.data("fitToBaseFunc")||h.data("fitToBaseFunc",function(n){var t=h.data("resizeTm");n.preventDefault();n.stopPropagation();t&&cancelAnimationFrame(t);e.hasClass("elfinder-fullscreen")||f.UA.Mobile&&h.data("rotated")===f.UA.Rotated||(h.data("rotated",f.UA.Rotated),h.data("resizeTm",requestAnimationFrame(function(){f.restoreSize()})))}),void 0===h.data("rotated")&&h.data("rotated",f.UA.Rotated),i=h.height()*(u[1]/100)-h.data("marginToMyNode"),h.off("resize."+f.namespace,h.data("fitToBaseFunc")),s&&h.on("resize."+f.namespace,h.data("fitToBaseFunc")));e.css({width:t,height:parseInt(i)});r.w=Math.round(e.width());r.h=Math.round(e.height());e.data("resizeSize",r);r.w===o.w&&r.h===o.h||(e.trigger("resize"),this.trigger("resize",{width:r.w,height:r.h}))};this.restoreSize=function(){this.resize(vi,yi)};this.show=function(){e.show();this.enable().trigger("show")};this.hide=function(){this.options.enableAlways&&(li=y,y=!1);this.disable();this.trigger("hide");e.hide()};this.lazy=function(t,i,r){function o(n){var i,t=e.data("lazycnt");n?(i=!e.data("lazyrepaint")&&r.repaint,t?e.data("lazycnt",++t):e.data("lazycnt",1).addClass("elfinder-processing"),i&&e.data("lazyrepaint",!0).css("display")):t&&1<t?e.data("lazycnt",--t):(i=e.data("lazyrepaint"),e.data("lazycnt",0).removeData("lazyrepaint").removeClass("elfinder-processing"),i&&e.css("display"),f.trigger("lazydone"))}function s(){u.resolve(t.call(u));o(!1)}var u=n.Deferred();return i=i||0,r=r||{},o(!0),i?setTimeout(s,i):requestAnimationFrame(s),u};this.destroy=function(){e&&e[0].elfinder&&(e.hasClass("elfinder-fullscreen")&&f.toggleFullscreen(e),this.options.syncStart=!1,this.autoSync("forcestop"),this.trigger("destroy").disable(),nt=[],vt=[],p={},st={},n(window).off("."+s),n(document).off("."+s),f.trigger=function(){},n(ti).remove(),e.off().removeData().empty().append(ci.contents()).attr("class",ci.attr("class")).attr("style",ci.attr("style")),delete e[0].elfinder,n.each(nu,function(t,i){n.each(i,function(n,t){e.on(t.type+(t.namespace?"."+t.namespace:""),t.selector,t.handler)})}))};this.autoSync=function(t){var i;if(1e3<=f.options.sync){if(b&&(clearTimeout(b),b=null,f.trigger("autosync",{action:"stop"})),"stop"===t?++ii:ii=Math.max(0,--ii),ii||"forcestop"===t||!f.options.syncStart)return;(i=function(t){var r;v.syncMinMs&&(t||b)&&(t&&f.trigger("autosync",{action:"start"}),r=Math.max(f.options.sync,v.syncMinMs),b&&clearTimeout(b),b=setTimeout(function(){var u,e=!0,t=c;v.syncChkAsTs&&o[t]&&(u=o[t].ts)?f.request({data:{cmd:"info",targets:[t],compare:u,reload:1},preventDefault:!0}).done(function(n){var r;e=!0;n.compare&&(r=n.compare)==u&&(e=!1);e?f.sync(t).always(function(){r&&(o[t].ts=r);i()}):i()}).fail(function(t,u){var e=f.parseError(t);e&&0!=u.status?(f.error(e),Array.isArray(e)&&-1!==n.inArray("errOpen",e)&&f.request({data:{cmd:"open",target:f.lastDir("")||f.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})):b=setTimeout(function(){i()},r)}):f.sync(c,!0).always(function(){i()})},r))})(!0)}};this.insideWorkzone=function(n,t,i){var r=this.getUI("workzone").data("rectangle");return i=i||1,!(n<r.left+i||n>r.left+r.width+i||t<r.top+i||t>r.top+r.height+i)};this.toFront=function(t){var i=e.children(".ui-front").removeClass("elfinder-frontmost"),r=i.last();i.css("z-index","");n(t).addClass("ui-front elfinder-frontmost").css("z-index",r.css("z-index")+1)};this.toHide=function(t,i){var r,u=n(t);i||u.hide();u.hasClass("elfinder-frontmost")&&(u.removeClass("elfinder-frontmost"),(r=e.children(".ui-front:visible:not(.elfinder-frontmost)").last()).length&&requestAnimationFrame(function(){e.children(".elfinder-frontmost:visible").length||(f.toFront(r),r.trigger("frontmost"))}))};this.getMaximizeCss=function(){return{width:"100%",height:"100%",margin:0,top:0,left:0,display:"block",position:"fixed",zIndex:Math.max(f.zIndex?f.zIndex+1:0,1e3),maxWidth:"",maxHeight:""}},function(){function c(){var t=0,i=0;n.each(e.children(".ui-dialog,.ui-draggable"),function(r,u){var f=n(u),e=f.position();e.top<0&&(f.css("top",t),t+=20);e.left<0&&(f.css("left",i),i+=20)})}function l(){var r=f.storage("useFullscreen");i=f.UA.Fullscreen&&(r?0<r:"screen"===f.options.commandsOptions.fullscreen.mode)?{fullElm:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null},exitFull:function(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():void 0},toFull:function(n){return n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():!!n.msRequestFullscreen&&n.msRequestFullscreen()}}:{fullElm:function(){var n;return e.hasClass(u)?e.get(0):(n=e.find("."+u)).length?n.get(0):null},exitFull:function(){var i;n(window).off("resize."+s,h);void 0!==o&&n("body").css("overflow",o);o=void 0;t&&(i=t.elm,v(i),n(i).trigger("resize",{fullscreen:"off"}));n(window).trigger("resize")},toFull:function(t){return o=n("body").css("overflow")||"",n("body").css("overflow","hidden"),n(t).css(f.getMaximizeCss()).addClass(u).trigger("resize",{fullscreen:"on"}),c(),n(window).on("resize."+s,h).trigger("resize"),!0}}}it&&f.UA.Fullscreen&&(f.UA.Fullscreen=!1,ri&&void 0!==ri.attr("allowfullscreen")&&(f.UA.Fullscreen=!0));var t,o,r,i,u="elfinder-fullscreen",a="elfinder-fullscreen-native",v=function(i){t&&t.elm==i&&(n(i).removeClass(u+" "+a).attr("style",t.style),t=null)},h=function(t){var u;t.target===window&&(r&&cancelAnimationFrame(r),r=requestAnimationFrame(function(){(u=i.fullElm())&&n(u).trigger("resize",{fullscreen:"on"})}))};l();n(document).on("fullscreenchange."+s+" webkitfullscreenchange."+s+" mozfullscreenchange."+s+" MSFullscreenChange."+s,function(){var e,o;f.UA.Fullscreen&&(e=i.fullElm(),o=n(window),r&&cancelAnimationFrame(r),null===e?(o.off("resize."+s,h),t&&(e=t.elm,v(e),n(e).trigger("resize",{fullscreen:"off"}))):(n(e).addClass(u+" "+a).attr("style","width:100%; height:100%; margin:0; padding:0;").trigger("resize",{fullscreen:"on"}),o.on("resize."+s,h),c()),o.trigger("resize"))});f.toggleFullscreen=function(r,u){var e,f=n(r).get(0);if(e=i.fullElm()){if(e==f){if(!0===u)return e}else if(!1===u)return e;return i.exitFull(),null}return!1===u?null:(l(),!(t={elm:f,style:n(f).attr("style")})!==i.toFull(f)?f:t=null)}}();kt="elfinder-maximized";f.toggleMaximize=function(t,i){var u,r,e=n(t);if(e.hasClass(kt)){if(!0===i)return;r=e;n(window).off("resize."+s,kr);n("body").css("overflow",r.data("bodyOvf"));r.removeClass(kt).attr("style",r.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle");r.trigger("resize",{maximize:"off"})}else{if(!1===i)return;(u=e).data("bodyOvf",n("body").css("overflow")||"").data("orgStyle",u.attr("style")).addClass(kt).css(f.getMaximizeCss());n("body").css("overflow","hidden");n(window).on("resize."+s,{elm:u},kr);u.trigger("resize",{maximize:"on"})}};Object.assign(n.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DIG0:48,DIG1:49,DIG2:50,DIG3:51,DIG4:52,DIG5:53,DIG6:54,DIG7:55,DIG8:56,DIG9:57,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,CONTEXTMENU:93,DOT:190});this.dragUpload=!1;this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData;this.transport={};"object"==typeof this.options.transport&&(this.transport=this.options.transport,"function"==typeof this.transport.init&&this.transport.init(this));"function"!=typeof this.transport.send&&(this.transport.send=function(t){return f.UA.IE||(t._xhr=new XMLHttpRequest,t.xhr=function(){return t.progress&&t._xhr.addEventListener("progress",t.progress),t._xhr}),n.ajax(t)});"iframe"==this.transport.upload?this.transport.upload=n.proxy(this.uploads.iframe,this):"function"==typeof this.transport.upload?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload&&this.options.dragUploadAllow?(this.transport.upload=n.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=n.proxy(this.uploads.iframe,this);this.decodeRawString=function(n){return function(n){for(var t,r=String.fromCharCode,i=0,f=n.length,u="";t=n[i],i<f;i++)u+=t<=127?r(t):t<=223&&194<=t?r((31&t)<<6|63&n[++i]):t<=239&&224<=t?r((15&t)<<12|(63&n[++i])<<6|63&n[++i]):t<=247&&240<=t?r(55296|((7&t)<<8|(63&n[++i])<<2|n[++i]>>>4&3)-64,56320|(15&n[i++])<<6|63&n[i]):r(65533);return u}(function(n){var t,u,i,r=[];for("string"==typeof n&&(n=function(n){for(var t=0,r=n.length,i=[];t<r;t++)i.push(n.charCodeAt(t));return i}(n)),t=0,u=n.length;i=n[t],t<u;t++)55296<=i&&i<=56319?r.push(64+(1023&i)<<10|1023&n[++t]):r.push(i);return r}(n))};this.getContents=function(t,i,r){var u,f,e=n.Deferred(),o=i||"arraybuffer";return e.fail(function(){f&&"pending"===f.state()&&f.reject()}),u=this.openUrl(t),this.isSameOrigin(u)||(u=this.openUrl(t,!0)),f=this.request(Object.assign({data:{cmd:"get"},options:{url:u,type:"get",cache:!0,dataType:"binary",responseType:o,processData:!1},notify:{type:"file",cnt:1,hideCnt:!0},cancel:!0},r||{})).fail(function(){e.reject()}).done(function(n){e.resolve(n)}),e};this.getBinaryByUrl=function(t,i,r){var u,f=n.Deferred();return f.fail(function(){u&&"pending"===u.state()&&u.reject()}),u=this.request(Object.assign({data:{cmd:"get"},options:Object.assign({type:"get",cache:!0,dataType:"binary",responseType:"blob",processData:!1},t)},r||{})).fail(function(){f.reject()}).done(function(n){i&&i(n);f.resolve(n)}),f};this.getMimetype=function(n,t){var r,i=t,u=(n+"").match(/\.([^.]+)$/);return u&&(r=u[1])&&((i=(tr=tr||f.arrayFlip(f.mimeTypes))[r.toLowerCase()])||(i=t)),i};f.hashCheckers=[];l=this;g={};window.Worker&&window.ArrayBuffer&&(l.options.cdns.sparkmd5&&(g.SparkMD5=!0,l.hashCheckers.push("md5")),l.options.cdns.jssha&&(g.jsSHA=!0,l.hashCheckers=l.hashCheckers.concat(["sha1","sha224","sha256","sha384","sha512","sha3-224","sha3-256","sha3-384","sha3-512","shake128","shake256"])));l.getContentsHashes=function(t,i,r,u){var s,f=n.Deferred(),h=l.arrayFlip(i||["md5"],!0),o=[],e={},c=r||{shake128len:256,shake256len:512};return f.fail(function(){s&&s.reject()}),Object.keys(g).length?s=l.getContents(t,"arraybuffer",u).done(function(i){h.md5&&g.SparkMD5&&o.push(function(){var u=n.Deferred(),r;try{r=l.getWorker();u.fail(function(){r&&r.terminate()});r.onmessage=function(n){var i;r&&r.terminate();n.data.hash?(e.md5=n.data.hash,(i=l.file(t))&&(i.md5=e.md5)):n.data.error&&(e.md5=n.data.error);f.notify(e);u.resolve()};r.onerror=function(){u.reject()};r.postMessage({scripts:[l.options.cdns.sparkmd5,l.getWorkerUrl("calcfilehash.js")],data:{type:"md5",bin:i}});f.fail(function(){u.reject()})}catch(o){u.reject();delete g.SparkMD5}return u}());g.jsSHA&&n.each(["1","224","256","384","512","3-224","3-256","3-384","3-512","ke128","ke256"],function(r,u){h["sha"+u]&&o.push(function(){var o=n.Deferred(),r;try{r=l.getWorker();o.fail(function(){r&&r.terminate()});r.onmessage=function(n){var i;r&&r.terminate();n.data.hash?(e["sha"+u]=n.data.hash,(i=l.file(t))&&(i["sha"+u]=e["sha"+u])):n.data.error&&(e["sha"+u]=n.data.error);f.notify(e);o.resolve()};r.onerror=function(){o.reject()};r.postMessage({scripts:[l.options.cdns.jssha,l.getWorkerUrl("calcfilehash.js")],data:{type:u,bin:i,hashOpts:c}});f.fail(function(){o.reject()})}catch(s){o.reject();delete g.jsSHA}return o}())});o.length?n.when.apply(null,o).always(function(){f.resolve(e)}):f.reject()}).fail(function(){f.reject()}):f.reject(),f};this.parseError=function(t){var i=t;return n.isPlainObject(i)&&(i=i.error),i};this.error=function(){var n,t=arguments[0],i=arguments[1]||null;return 1==arguments.length&&"function"==typeof t?f.bind("error",t):!0!==(n=this.parseError(t))&&n?f.trigger("error",{error:n,opts:i}):this};n.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","selectfiles","unselectfiles","dragstart","dragstop","search","searchend","viewchange"],function(t,i){f[i]=function(){var t=arguments[0];return 1==arguments.length&&"function"==typeof t?f.bind(i,t):f.trigger(i,n.isPlainObject(t)?t:{})}});this.enable(function(){!y&&f.api&&f.visible()&&f.ui.overlay.is(":hidden")&&!e.children(".elfinder-dialog."+f.res("class","editing")+":visible").length&&(y=!0,document.activeElement&&document.activeElement.blur(),e.removeClass("elfinder-disabled"))}).disable(function(){li=y;y=!1;e.addClass("elfinder-disabled")}).open(function(){vt=[]}).select(function(t){var r=0,i=[];vt=n.grep(t.data.selected||t.data.value||[],function(n){return i.length||f.maxTargets&&++r>f.maxTargets?(i.push(n),!1):!!o[n]});i.length&&(f.trigger("unselectfiles",{files:i,inselect:!0}),f.toast({mode:"warning",msg:f.i18n(["errMaxTargets",f.maxTargets])}))}).error(function(t){var u,i,r={cssClass:"elfinder-dialog-error",title:f.i18n("error"),resizable:!1,destroyOnClose:!0,buttons:{}},e=f.getUI();e.children(".elfinder-dialog-error").length<f.options.maxErrorDialogs?(r.buttons[f.i18n(f.i18n("btnClose"))]=function(){n(this).elfinderdialog("close")},t.data.opts&&n.isPlainObject(t.data.opts)&&Object.assign(r,t.data.opts),f.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"><\/span>'+f.i18n(t.data.error),r)):(i=(u=e.children(".elfinder-dialog-error:last").children(".ui-dialog-content:first")).children(".elfinder-error-counter")).length?i.data("cnt",parseInt(i.data("cnt"))+1).html(f.i18n(["moreErrors",i.data("cnt")])):(i=n('<span class="elfinder-error-counter">'+f.i18n(["moreErrors",1])+"<\/span>").data("cnt",1),u.append("<br/>",i))}).bind("tmb",function(t){n.each(t.data.images||[],function(n,t){o[n]&&(o[n].tmb=t)})}).bind("searchstart",function(n){Object.assign(f.searchStatus,n.data);f.searchStatus.state=1}).bind("search",function(){f.searchStatus.state=2}).bind("searchend",function(){f.searchStatus.state=0;f.searchStatus.ininc=!1;f.searchStatus.mixed=!1}).bind("canMakeEmptyFile",function(t){var i=t.data,r={};i&&Array.isArray(i.mimes)&&(i.unshift||(r=f.mimesCanMakeEmpty),n.each(i.mimes,function(){r[this]||(r[this]=f.mimeTypes[this])}),i.unshift&&(f.mimesCanMakeEmpty=Object.assign(r,f.mimesCanMakeEmpty)))}).bind("themechange",function(){requestAnimationFrame(function(){f.trigger("uiresize")})});!0===this.options.sound&&this.bind("playsound",function(t){var i=ti.canPlayType&&ti.canPlayType('audio/wav; codecs="1"'),r=t.data&&t.data.soundFile;i&&r&&""!=i&&"no"!=i&&n(ti).html('<source src="'+pi+r+'" type="audio/wav">')[0].play()});n.each(this.options.handlers,function(n,t){f.bind(n,t)});this.history=new this.history(this);this.roots={};this.leafRoots={};this.volumeExpires={};this._commands={};Array.isArray(this.options.commands)||(this.options.commands=[]);-1!==n.inArray("*",this.options.commands)&&(this.options.commands=Object.keys(this.commands));this.commandMap={};this.volOptions={};this.hasVolOptions=!1;this.trashes={};this.optionsByHashes={};this.uiAutoHide=[];this.one("open",function(){f.uiAutoHide.length&&setTimeout(function(){f.trigger("uiautohide")},500)});this.bind("uiautohide",function(){f.uiAutoHide.length&&f.uiAutoHide.shift()()});this.options.width&&(vi=this.options.width);this.options.height&&(yi=this.options.height);this.options.heightBase&&(h=n(this.options.heightBase));pi=this.options.soundPath?this.options.soundPath.replace(/\/+$/,"")+"/":this.baseUrl+pi;this.options.parrotHeaders&&Array.isArray(this.options.parrotHeaders)&&this.options.parrotHeaders.length?(this.parrotHeaders=this.options.parrotHeaders,n.each(this.parrotHeaders,function(n,t){var i=f.sessionStorage("core-ph:"+t);i&&(f.customHeaders[t]=i)})):this.parrotHeaders=[];f.one("opendone",function(){var t;n(document).on("click."+s,function(t){!y||f.options.enableAlways||n(t.target).closest(e).length||f.disable()}).on(lr+" "+tu+" "+iu+" "+cr,dr);f.options.useBrowserHistory&&n(window).on("popstate."+s,function(t){var u,o,i=t.originalEvent.state||{},s=!!i.thash,r=e.find(".elfinder-frontmost:visible"),h=e.find(".elfinder-navbar-dir,.elfinder-cwd-filename").find("input,textarea");s||(i={thash:f.cwd().hash},n("html,body").animate({scrollTop:e.offset().top}));r.length||h.length?(history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash),r.length?r.hasClass(f.res("class","preventback"))||(r.hasClass("elfinder-contextmenu")?n(document).trigger(n.Event("keydown",{keyCode:n.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1})):r.hasClass("elfinder-dialog")?r.elfinderdialog("close"):r.trigger("close")):h.trigger(n.Event("keydown",{keyCode:n.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))):s?n.isEmptyObject(f.files())||f.request({data:{cmd:"open",target:i.thash,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0}):(u=function(){o.trigger("click")},f.one("open",u,!0),o=f.toast({msg:f.i18n("pressAgainToExit"),onHidden:function(){f.unbind("open",u);history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash)}}))});n(window).on("resize."+s,function(n){n.target===this&&(t&&cancelAnimationFrame(t),t=requestAnimationFrame(function(){var t=e.data("resizeSize")||{w:0,h:0},n={w:Math.round(e.width()),h:Math.round(e.height())};e.data("resizeSize",n);n.w===t.w&&n.h===t.h||(e.trigger("resize"),f.trigger("resize",{width:n.w,height:n.h}))}))}).on("beforeunload."+s,function(t){var i,r;if(!f.pauseUnloadCheck()){if(e.is(":visible")&&(f.ui.notify.children().length&&-1!==n.inArray("hasNotifyDialog",f.options.windowCloseConfirm)?i=f.i18n("ntfsmth"):e.find("."+f.res("class","editing")).length&&-1!==n.inArray("editingFile",f.options.windowCloseConfirm)?i=f.i18n("editingFile"):(r=Object.keys(f.selected()).length)&&-1!==n.inArray("hasSelectedItem",f.options.windowCloseConfirm)?i=f.i18n("hasSelected",""+r):(r=Object.keys(f.clipboard()).length)&&-1!==n.inArray("hasClipboardData",f.options.windowCloseConfirm)&&(i=f.i18n("hasClipboard",""+r)),i))return t.returnValue=i;f.trigger("unload")}});n(window).on("message."+s,function(n){var i,t,r=n.originalEvent||null;if(r&&(0===f.convAbsUrl(f.options.url).indexOf(r.origin)||0===f.convAbsUrl(f.uploadURL).indexOf(r.origin)))try{(t=(i=JSON.parse(r.data)).data||null)&&(t.error?(i.bind&&f.trigger(i.bind+"fail",t),f.error(t.error)):(t.warning&&f.error(t.warning),f.updateCache(t),t.removed&&t.removed.length&&f.remove(t),t.added&&t.added.length&&f.add(t),t.changed&&t.changed.length&&f.change(t),i.bind&&(f.trigger(i.bind,t),f.trigger(i.bind+"done")),t.sync&&f.sync()))}catch(n){f.sync()}});f.options.enableAlways?(n(window).on("focus."+s,function(n){n.target===this&&f.enable()}),it&&n(window.top).on("focus."+s,function(){f.enable()&&(!ri||ri.is(":visible"))&&requestAnimationFrame(function(){n(window).trigger("focus")})})):it&&n(window).on("blur."+s,function(n){y&&n.target===this&&f.disable()});it&&e.on("click",function(){n(window).trigger("focus")});f.options.enableByMouseOver&&e.on("mouseenter touchstart",function(){it&&n(window).trigger("focus");f.enabled()||f.enable()});n(window).on("visibilitychange."+s,function(){var n=document.hidden||document.webkitHidden||document.msHidden;f.options.syncStart&&f.autoSync(n?"stop":void 0)})});e[0].elfinder=this;hi.push((lt=f.lang,si=f.i18nBaseUrl+"elfinder."+lt+".js",ft=n.Deferred().done(function(){f.i18[lt]&&(f.lang=lt);f.trigger("i18load");ot="en"===f.lang?f.i18.en:n.extend(!0,{},f.i18.en,f.i18[f.lang])}),f.i18[lt]?ft.resolve():(f.lang="en",f.hasRequire?require([si],function(){ft.resolve()},function(){ft.resolve()}):f.loadScript([si],function(){ft.resolve()},{loadType:"tag",error:function(){ft.resolve()}})),ft));rr=function(){function ni(n){var t=(n.originalEvent.touches||[{}])[0].pageY||null;(!r||t<r)&&(n.preventDefault(),g&&clearTimeout(g))}function ti(n){n.preventDefault();g&&clearTimeout(g)}function et(t){return"TEXTAREA"!==t.target.nodeName&&"INPUT"!==t.target.nodeName&&0===n(t.target).closest("div.ui-dialog-content").length}function ht(){v&&cancelAnimationFrame(v);v=null}var wt,ct,c,rt,lt,bt,at,b,k,i,r,u,l,d,vt,g,nt,h,t,yt,a,v,tt,ut,w,kt,ft,gt,pt;if(f.messages=ot.messages,!(n.fn.selectable&&n.fn.draggable&&n.fn.droppable&&n.fn.resizable&&n.fn.button&&n.fn.slider))return alert(f.i18n("errJqui"));if(!e.length)return alert(f.i18n("errNode"));if(!f.options.url)return alert(f.i18n("errURL"));wt=Object.assign({name:f.i18n("name"),perm:f.i18n("perms"),date:f.i18n("modify"),size:f.i18n("size"),kind:f.i18n("kind"),modestr:f.i18n("mode"),modeoct:f.i18n("mode"),modeboth:f.i18n("mode")},f.options.uiOptions.cwd.listView.columnsCustomName);f.getColumnName=function(n){return wt[n]||f.i18n(n)};f.direction=ot.direction;f.dateFormat=f.options.dateFormat||ot.dateFormat;f.fancyFormat=f.options.fancyDateFormat||ot.fancyDateFormat;f.nonameDateFormat=(f.options.nonameDateFormat||ot.nonameDateFormat).replace(/[\/\\]/g,"_");f.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==f.direction?"rtl":"ltr")+(f.UA.Touch?" elfinder-touch"+(f.options.resizable?" touch-punch":""):"")+(f.UA.Mobile?" elfinder-mobile":"")+(f.UA.iOS?" elfinder-ios":"")+" "+f.options.cssClass;e.addClass(f.cssClass).on(cr,function(){y||f.enable()});at=lr+"draggable keyup."+s+"draggable";f.draggable={appendTo:e,addClasses:!1,distance:4,revert:!0,refreshPositions:!1,cursor:"crosshair",cursorAt:{left:50,top:47},scroll:!1,start:function(t,i){var u,h,r=i.helper,s=n.grep(r.data("files")||[],function(n){return!!n&&(dt[n]=!0)}),l=!1;for(bt=e.attr("style"),e.width(e.width()).height(e.height()),ct="ltr"===f.direction,c=f.getUI("workzone").data("rectangle"),rt=c.top+c.height,lt=rt-f.getUI("navdock").outerHeight(!0),f.draggingUiHelper=r,u=s.length;u--;)if(h=s[u],o[h].locked){l=!0;r.data("locked",!0);break}l||f.trigger("lockfiles",{files:s});r.data("autoScrTm",setInterval(function(){r.data("autoScr")&&f.autoScroll[r.data("autoScr")](r.data("autoScrVal"))},50))},drag:function(t,i){var u,f,e,r=i.helper;((f=c.top>t.pageY)||lt<t.pageY)&&(u=c.cwdEdge>t.pageX?(ct?"navbar":"cwd")+(f?"Up":"Down"):(ct?"cwd":"navbar")+(f?"Up":"Down"),f||("cwd"===u.substr(0,3)?rt<t.pageY?e=rt:u=null:e=lt),u&&(r.data("autoScr",u),r.data("autoScrVal",Math.pow(f?c.top-t.pageY:t.pageY-e,1.3))));u||r.data("autoScr")&&r.data("refreshPositions",1).data("autoScr",null);r.data("refreshPositions")&&n(this).elfUiWidgetInstance("draggable")&&(0<r.data("refreshPositions")?(n(this).draggable("option",{refreshPositions:!0,elfRefresh:!0}),r.data("refreshPositions",-1)):(n(this).draggable("option",{refreshPositions:!1,elfRefresh:!1}),r.data("refreshPositions",null)))},stop:function(t,i){var u,r=i.helper;n(document).off(at);n(this).elfUiWidgetInstance("draggable")&&n(this).draggable("option",{refreshPositions:!1});f.draggingUiHelper=null;f.trigger("focus").trigger("dragstop");r.data("droped")||(u=n.grep(r.data("files")||[],function(n){return!!n}),f.trigger("unlockfiles",{files:u}),f.trigger("selectfiles",{files:f.selected()}));f.enable();e.attr("style",bt);r.data("autoScrTm")&&clearInterval(r.data("autoScrTm"))},helper:function(t){function c(t){var u=t.mime,r=f.tmb(t),i='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+f.mime2class(u)+' ui-corner-all"><\/div>';return r?i=n(i).addClass(r.className).css("background-image","url('"+r.url+"')").get(0).outerHTML:t.icon&&(i=n(i).css(f.getIconStyle(t,!0)).get(0).outerHTML),t.csscls&&(i='<div class="'+t.csscls+'">'+i+"<\/div>"),i}var r,e,u,h=this.id?n(this):n(this).parents("[id]:first"),i=n('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"><\/span><\/div>');return f.draggingUiHelper&&f.draggingUiHelper.stop(!0,!0),f.trigger("dragstart",{target:h[0],originalEvent:t},!0),r=h.hasClass(f.res("class","cwdfile"))?f.selected():[f.navId2Hash(h.attr("id"))],i.append(c(o[r[0]])).data("files",r).data("locked",!1).data("droped",!1).data("namespace",s).data("dropover",0),1<(e=r.length)&&i.append(c(o[r[e-1]])+'<span class="elfinder-drag-num">'+e+"<\/span>"),n(document).on(at,function(n){var t=n.shiftKey||n.ctrlKey||n.metaKey;u!==t&&(u=t,i.is(":visible")&&i.data("dropover")&&!i.data("droped")&&(i.toggleClass("elfinder-drag-helper-plus",!!i.data("locked")||u),f.trigger(u?"unlockfiles":"lockfiles",{files:r,helper:i})))}),i}};f.commands.getfile&&("function"==typeof f.options.getFileCallback?(f.bind("dblclick",function(n){n.preventDefault();f.exec("getfile").fail(function(){f.exec("open",n.data&&n.data.file?[n.data.file]:void 0)})}),f.shortcut({pattern:"enter",description:f.i18n("cmdgetfile"),callback:function(){f.exec("getfile").fail(function(){f.exec("mac"==f.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:f.i18n("mac"==f.OS?"cmdrename":"cmdopen"),callback:function(){f.exec("mac"==f.OS?"rename":"open")}})):f.options.getFileCallback=null);n.each(f.commands,function(t,i){var r,u,e=Object.assign({},i.prototype);if(n.isFunction(i)&&!f._commands[t]&&(i.prototype.forceLoad||-1!==n.inArray(t,f.options.commands))){if(r=i.prototype.extendsCmd||""){if(!n.isFunction(f.commands[r]))return!0;i.prototype=Object.assign({},ai,new f.commands[r],i.prototype)}else i.prototype=Object.assign({},ai,i.prototype);f._commands[t]=new i;i.prototype=e;u=f.options.commandsOptions[t]||{};r&&f.options.commandsOptions[r]&&(u=n.extend(!0,{},f.options.commandsOptions[r],u));f._commands[t].setup(t,u);f._commands[t].linkedCmds.length&&n.each(f._commands[t].linkedCmds,function(t,i){var r=f.commands[i];n.isFunction(r)&&!f._commands[i]&&(r.prototype=ai,f._commands[i]=new r,f._commands[i].setup(i,f.options.commandsOptions[i]||{}))})}});f.ui={workzone:n("<div><\/div>").appendTo(e).elfinderworkzone(f),navbar:n("<div><\/div>").appendTo(e).elfindernavbar(f,f.options.uiOptions.navbar||{}),navdock:n("<div><\/div>").appendTo(e).elfindernavdock(f,f.options.uiOptions.navdock||{}),contextmenu:n("<div><\/div>").appendTo(e).elfindercontextmenu(f),overlay:n("<div><\/div>").appendTo(e).elfinderoverlay({show:function(){f.disable()},hide:function(){li&&f.enable()}}),cwd:n("<div><\/div>").appendTo(e).elfindercwd(f,f.options.uiOptions.cwd||{}),notify:f.dialog("",{cssClass:"elfinder-dialog-notify"+(f.options.notifyDialog.canClose?"":" elfinder-titlebar-button-hide"),position:f.options.notifyDialog.position,absolute:!0,resizable:!1,autoOpen:!1,allowMinimize:!0,closeOnEscape:!!f.options.notifyDialog.canClose,title:"&nbsp;",width:f.options.notifyDialog.width?parseInt(f.options.notifyDialog.width):null,minHeight:null,minimize:function(){f.ui.notify.trigger("minimize")}}),statusbar:n('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"><\/div>').hide().appendTo(e),toast:n('<div class="elfinder-toast"><\/div>').appendTo(e),bottomtray:n('<div class="elfinder-bottomtray">').appendTo(e),progressbar:n('<div class="elfinder-ui-progressbar">').appendTo(e)};f.trigger("uiready");n.each(f.options.ui||[],function(t,i){var r="elfinder"+i,u=f.options.uiOptions[i]||{};!f.ui[i]&&n.fn[r]&&(f.ui[i]=n("<"+(u.tag||"div")+"/>").appendTo(e),f.ui[i][r](f,u))});f.ui.progressbar.appendTo(f.ui.workzone);f.ui.notify.prev(".ui-dialog-titlebar").append('<div class="elfinder-ui-progressbar"><\/div>');f.resize(vi,yi);f.options.resizable&&(e.resizable({resize:function(n,t){f.resize(t.size.width,t.size.height)},handles:"se",minWidth:300,minHeight:200}),f.UA.Touch&&e.addClass("touch-punch"));b=f.getUI("navbar");k=f.getUI("cwd").parent();f.autoScroll={navbarUp:function(n){b.scrollTop(Math.max(0,b.scrollTop()-n))},navbarDown:function(n){b.scrollTop(b.scrollTop()+n)},cwdUp:function(n){k.scrollTop(Math.max(0,k.scrollTop()-n))},cwdDown:function(n){k.scrollTop(k.scrollTop()+n)}};f.UA.Touch&&(h=f.getUI("navbar"),t=f.getUI("toolbar"),yt="touchmove.stopscroll",h=h.children().length?h:null,t=t.length?t:null,e.on("touchstart touchmove touchend",function(n){if("touchend"===n.type)return r=i=!1,void(g=setTimeout(function(){e.off(yt)},100));var c,p,v,w,b,y=n.originalEvent.touches||[{}],o=y[0].pageX||null,s=y[0].pageY||null,a="ltr"===f.direction;null===o||null===s||"touchstart"===n.type&&1<y.length||("touchstart"===n.type?(u=e.offset(),l=e.width(),h&&(i=!1,h.is(":hidden")?(nt=nt||Math.max(50,l/10),(a?o-u.left:l+u.left-o)<nt&&(i=o)):n.originalEvent._preventSwipeX||(d=h.width(),p=a?o<u.left+d:o>u.left+l-d,i=!!p&&(nt=Math.max(50,l/10),o))),t&&(r=!1,n.originalEvent._preventSwipeY||(vt=t.height(),s-u.top<(t.is(":hidden")?50:vt+30)&&(r=s,e.on(yt,t.is(":hidden")?ti:ni))))):(h&&!1!==i&&(c=(a?o<i:i<o)?"navhide":"navshow",v=Math.abs(i-o),("navhide"==c&&.6*d<v||("navhide"==c?d/3:45)<v&&("navshow"==c||(a?o<u.left+20:o>u.left+l-20)))&&(f.getUI("navbar").trigger(c,{handleW:nt}),i=!1)),t&&!1!==r&&(w=t.offset().top,Math.abs(r-s)>Math.min(45,vt/3)&&("slideDown"==(b=s<r?"slideUp":"slideDown")||s<w+20)&&(t.is("slideDown"==b?":hidden":":visible")&&t.stop(!0,!0).trigger("toggle",{duration:100,handleH:50}),r=!1))))}));f.dragUpload&&(tt="native-drag-enter",ut="native-drag-disable",w="class",kt=f.res(w,"navdir"),f.res(w,"droppable"),f.res(w,"adroppable"),f.res(w,"navarrow"),ft=f.res(w,"adroppable"),gt=f.getUI("workzone"),pt="ltr"===f.direction,e.on("dragenter",function(n){ht();et(n)&&(n.preventDefault(),n.stopPropagation(),a=gt.data("rectangle"))}).on("dragleave",function(n){ht();et(n)&&(n.preventDefault(),n.stopPropagation())}).on("dragover",function(n){var t;et(n)?(n.preventDefault(),n.stopPropagation(),n.originalEvent.dataTransfer.dropEffect="none",v=v||requestAnimationFrame(function(){var i,r=a.top+a.height,u=r-f.getUI("navdock").outerHeight(!0);((t=n.pageY<a.top)||n.pageY>u)&&(i=a.cwdEdge>n.pageX?(pt?"navbar":"cwd")+(t?"Up":"Down"):(pt?"cwd":"navbar")+(t?"Up":"Down"),t||"cwd"===i.substr(0,3)&&(r<n.pageY?u=r:i=""),i&&f.autoScroll[i](Math.pow(t?a.top-n.pageY:n.pageY-u,1.3)));v=null})):ht()}).on("drop",function(n){ht();et(n)&&(n.stopPropagation(),n.preventDefault())}),e.on("dragenter",".native-droppable",function(t){if(t.originalEvent.dataTransfer){var u,i=n(t.currentTarget),r=null;if(!(t.currentTarget.id||null)){r=f.cwd();i.data(ut,!1);try{n.each(t.originalEvent.dataTransfer.types,function(n,t){"elfinderfrom:"===t.substr(0,13)&&(u=t.substr(13).toLowerCase())})}catch(t){}}r&&(!r.write||u&&u===(window.location.href+r.hash).toLowerCase())?i.data(ut,!0):(t.preventDefault(),t.stopPropagation(),i.data(tt,!0),i.addClass(ft))}}).on("dragleave",".native-droppable",function(t){var i;t.originalEvent.dataTransfer&&(i=n(t.currentTarget),t.preventDefault(),t.stopPropagation(),i.data(tt)?i.data(tt,!1):i.removeClass(ft))}).on("dragover",".native-droppable",function(t){var i;t.originalEvent.dataTransfer&&(i=n(t.currentTarget),t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect=i.data(ut)?"none":"copy",i.data(tt,!1))}).on("drop",".native-droppable",function(t){var r,i;t.originalEvent&&t.originalEvent.dataTransfer&&(r=n(t.currentTarget),t.preventDefault(),t.stopPropagation(),r.removeClass(ft),i=t.currentTarget.id?r.hasClass(kt)?f.navId2Hash(t.currentTarget.id):f.cwdId2Hash(t.currentTarget.id):f.cwd().hash,t.originalEvent._target=i,f.exec("upload",{dropEvt:t.originalEvent,target:i},void 0,i))}));!1===f.cssloaded&&(f.cssloaded=!0,f.trigger("cssloaded"));f.zIndexCalc();f.trigger("init").request({data:{cmd:"open",target:f.startDir(),init:1,tree:1},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){f.trigger("fail").disable().lastDir("");p={};st={};n(document).add(e).off("."+s);f.trigger=function(){}}).done(function(t){function r(n){var t=f.file(f.trashes[n]);f.options.debug;t&&t.volumeid&&delete f.volOptions[t.volumeid].trashHash;f.trashes[n]=!1;f.debug("backend-error",'Trash hash "'+n+'" was not found or not writable.')}var i={};f.options.rawStringDecoder&&f.registRawStringDecoder(f.options.rawStringDecoder);f.zIndexCalc();f.load().debug("api",f.api);e.trigger("resize");nr(t);f.trigger("open",t,!1);f.trigger("opendone");it&&f.options.enableAlways&&n(window).trigger("focus");n.each(f.trashes,function(n){var t=f.file(n);t?"directory"===t.mime&&t.write||r(n):i[n]=!0});Object.keys(i).length&&f.request({data:{cmd:"info",targets:Object.keys(i)},preventDefault:!0}).done(function(t){t&&t.files&&n.each(t.files,function(n,t){"directory"===t.mime&&t.write&&delete i[t.hash]})}).always(function(){n.each(i,r)});f[f.options.enableAlways?"enable":"disable"]()})};u&&"function"==typeof u&&(f.bootCallback=u).call(e.get(0),f,{dfrdsBeforeBootup:hi});n.when.apply(null,hi).done(function(){rr()}).fail(function(n){f.error(n)})};return void 0!==(i=i||!1)&&!i||(window.elFinder=r),r.prototype={uniqueid:0,res:function(n,t){return this.resources[n]&&this.resources[n][t]},OS:-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",UA:(l=!document.unqueID&&!window.opera&&!window.sidebar&&"localStorage"in window&&"WebkitAppearance"in document.documentElement.style,a=l&&window.chrome,{ltIE6:void 0===window.addEventListener&&void 0===document.documentElement.style.maxHeight,ltIE7:void 0===window.addEventListener&&void 0===document.querySelectorAll,ltIE8:void 0===window.addEventListener&&void 0===document.getElementsByClassName,ltIE9:document.uniqueID&&document.documentMode<=9,ltIE10:document.uniqueID&&document.documentMode<=10,gtIE11:document.uniqueID&&11<=document.documentMode,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:l,Chrome:a,Edge:!(!a||!window.msCredentials),Safari:l&&!window.chrome,Mobile:void 0!==window.orientation,Touch:void 0!==window.ontouchstart,iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),Mac:navigator.platform.match(/^Mac/),Fullscreen:void 0!==(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen),Angle:0,Rotated:!1,CSS:(c=document.createElement("a").style,w=document.createElement("p").style,c.cssText="position:sticky;position:-webkit-sticky;width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;",{positionSticky:-1!==c.position.indexOf("sticky"),widthMaxContent:-1!==c.width.indexOf("max-content"),flex:void 0!==w.flex})}),cookieEnabled:(h="elftest=",document.cookie=h+"1",p=2===document.cookie.split(h).length,document.cookie=h+";max-age=0",p),hasRequire:"function"==typeof define&&define.amd,currentReqCmd:"",keyState:{},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",nonameDateFormat:"ymd-His",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["msJan","msFeb","msMar","msApr","msMay","msJun","msJul","msAug","msSep","msOct","msNov","msDec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",group:"Selects",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},mimeTypes:{},rules:{defaults:function(n){return!(!n||n.added&&!Array.isArray(n.added)||n.removed&&!Array.isArray(n.removed)||n.changed&&!Array.isArray(n.changed))},open:function(t){return t&&t.cwd&&t.files&&n.isPlainObject(t.cwd)&&Array.isArray(t.files)},tree:function(n){return n&&n.tree&&Array.isArray(n.tree)},parents:function(n){return n&&n.tree&&Array.isArray(n.tree)},tmb:function(t){return t&&t.images&&(n.isPlainObject(t.images)||Array.isArray(t.images))},upload:function(t){return t&&(n.isPlainObject(t.added)||Array.isArray(t.added))},search:function(n){return n&&n.files&&Array.isArray(n.files)}},commands:{},cmdsToAdd:"archive duplicate extract mkdir mkfile paste rm upload",parseUploadData:function(t){var i,r=this;if(!n.trim(t))return{error:["errResponse","errDataEmpty"]};try{i=JSON.parse(t)}catch(t){return{error:["errResponse","errDataNotJSON"]}}return i=r.normalize(i),r.validResponse("upload",i)?(i.removed=n.merge(i.removed||[],n.map(i.added||[],function(n){return r.file(n.hash)?n.hash:null})),i):{error:i.norError||["errResponse"]}},iframeCnt:0,uploads:{xhrUploading:!1,failSyncTm:null,chunkfailReq:{},checkExists:function(t,i,r,u){function c(){for(var n=t.length;-1<--n;)t[n]._remove=!0}function e(){v.resolve(h,y)}var l,o,f,a,s,v=n.Deferred(),h=[],y={};return 2.1<=r.api&&"object"==typeof t[0]?(o=[],f=[],a=i!==r.cwd().hash?r.path(i,!0)+r.option("separator",i):"",s=function(n){var i=n==f.length-1,o={cssClass:"elfinder-confirm-upload",title:r.i18n("cmdupload"),text:["errExists",a+f[n].name,"confirmRepl"],all:!i,accept:{label:"btnYes",callback:function(t){i||t?e():s(++n)}},reject:{label:"btnNo",callback:function(r){var u;if(r)for(u=f.length;n<u--;)t[f[u].i]._remove=!0;else t[f[n].i]._remove=!0;i||r?e():s(++n)}},cancel:{label:"btnCancel",callback:function(){c();e()}},buttons:[{label:"btnBackup",cssClass:"elfinder-confirm-btn-backup",callback:function(t){var r;if(t)for(r=f.length;n<r--;)h.push(f[r].name);else h.push(f[n].name);i||t?e():s(++n)}}]};u||o.buttons.push({label:"btnRename"+(i?"":"All"),cssClass:"elfinder-confirm-btn-rename",callback:function(){h=null;e()}});0<r.iframeCnt&&delete o.reject;r.confirm(o)},r.file(i).read?(l=n.map(t,function(n,t){return!n.name||r.UA.iOS&&"image.jpg"===n.name?null:{i:t,name:n.name}}),r.request({data:{cmd:"ls",target:i,intersect:n.map(l,function(n){return n.name})},notify:{type:"preupload",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(t){var u,h;t&&(t.error?c():r.options.overwriteUploadConfirm&&r.option("uploadOverwrite",i)&&t.list&&(Array.isArray(t.list)?o=t.list||[]:(u=[],o=n.map(t.list,function(n){return"string"==typeof n?n:(u=u.concat(n),!1)}),u.length&&(o=o.concat(u)),y=t.list),(f=n.grep(l,function(t){return-1!==n.inArray(t.name,o)})).length&&o.length&&i==r.cwd().hash&&(h=n.map(r.files(i),function(n){return n.name}),n.grep(o,function(t){return-1===n.inArray(t,h)}).length&&r.sync())));0<f.length?s(0):e()}).fail(function(n){c();e();n&&r.error(n)})):e()):e(),v},checkFile:function(t,i,r){var d,l,g,a,nt;if(t.checked||"files"==t.type)return t.files;if("data"==t.type){var v,e=n.Deferred(),o=n.Deferred(),y=[],p=[],h=0,w=[],s=!1,b=function(n){function r(){--h<1&&"pending"===o.state()&&o.resolve()}function e(n){f&&n.name.match(f)||(p.push(t.fullPath||""),y.push(n));r()}function c(n){var t=[],i=function(){n.readEntries(function(n){var u,f;if(s||!n.length){for(u=0;u<t.length;u++){if(s){o.reject();break}b([t[u]])}r()}else t=t.concat((f=n,Array.prototype.slice.call(f||[],0))),i()},r)};i()}var t,f=i.options.folderUploadExclude[i.OS]||null,l=n.length,u;for(h++,u=0;u<l;u++){if(s){o.reject();break}(t=n[u])&&(t.isFile?(h++,t.file(e,r)):t.isDirectory&&2.1<=i.api&&(h++,w.push(t.fullPath),c(t.createReader())))}return r(),o},f=n.map(t.files.items,function(n){return n.getAsEntry?n.getAsEntry():n.webkitGetAsEntry()});return n.each(f,function(n,t){if(t.isDirectory)return!(v=!0)}),0<f.length?(i.uploads.checkExists(f,r,i,v).done(function(u,o){var h=[];i.options.overwriteUploadConfirm&&i.option("uploadOverwrite",r)&&(null===u&&(t.overwrite=0,u=[]),f=n.grep(f,function(t){var e,s,f,c;return t.isDirectory&&u.length&&-1!==(e=n.inArray(t.name,u))&&(u.splice(e,1),s=i.uniqueName(t.name+i.options.backupSuffix,null,""),n.each(o,function(n,i){if(t.name==i)return f=n,!1}),f=f||i.fileByName(t.name,r).hash,i.lockfiles({files:[f]}),c=i.request({data:{cmd:"rename",target:f,name:s},notify:{type:"rename",cnt:1}}).fail(function(){t._remove=!0;i.sync()}).always(function(){i.unlockfiles({files:[f]})}),h.push(c)),!t._remove}));n.when.apply(n,h).done(function(){var n,t,r=+new Date;0<f.length?(t=i.escape(f[0].name),1<f.length&&(t+=" ... "+f.length+i.i18n("items")),n=setTimeout(function(){i.notify({type:"readdir",id:r,cnt:1,hideCnt:!0,msg:i.i18n("ntfreaddir")+" ("+t+")",cancel:function(){s=!0}})},i.options.notifyDelay),b(f).done(function(){n&&clearTimeout(n);i.notify({type:"readdir",id:r,cnt:-1});s?e.reject():e.resolve([y,p,u,o,w])}).fail(function(){e.reject()})):e.reject()})}),e.promise()):e.reject()}var u=[],c=[],k=t.files[0];if("html"==t.type)l=n("<html><\/html>").append(n.parseHTML(k.replace(/ src=/gi," _elfsrc="))),n("img[_elfsrc]",l).each(function(){var i,r,e=n(this),f=e.closest("a");f&&f.attr("href")&&f.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i)&&(r=f.attr("href"));(i=e.attr("_elfsrc"))&&(r?(-1==n.inArray(r,u)&&u.push(r),-1==n.inArray(i,c)&&c.push(i)):-1==n.inArray(i,u)&&u.push(i));1===u.length&&u[0].match(/^data:image\/png/)&&(t.clipdata=!0)}),(d=n("a[href]",l)).each(function(){var i,t,r,f;(i=n(this).text())&&(r=n(this).attr("href"),(f=document.createElement("a")).href=r,(t=f).href&&t.href.match(/^(?:ht|f)tp/i)&&(1===d.length||!t.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||n.trim(i).match(/\.[a-z0-9-]{1,10}$/i))&&-1==n.inArray(t.href,u)&&-1==n.inArray(t.href,c)&&u.push(t.href))});else for(nt=/((?:ht|f)tps?:\/\/[-_.!~*\'()a-z0-9;/?:\@&=+\$,%#\*\[\]]+)/gi;g=nt.exec(k);)a=g[1].replace(/&amp;/g,"&"),-1==n.inArray(a,u)&&u.push(a);return u},xhr:function(t,i){function ri(t){var i=n.Deferred();return t.promise?t.always(function(n){i.resolve(Array.isArray(n)&&n.length?c?n[0][0]:n[0]:{})}):i.resolve(t.length?c?t[0][0]:t[0]:{}),i}function yt(n){k.children(".elfinder-notify-cancel")[n?"show":"hide"]();ct=n}function bt(n){return n=n||y,setTimeout(function(){ht=!0;r.notify({type:"upload",cnt:l,progress:s-v,size:n,cancel:function(){it.trigger("uploadabort","userabort")}});k=ni.children(".elfinder-notify-upload");v=s;t.multiupload?ct&&yt(!0):yt(ct&&s<n)},r.options.notifyDelay)}function kt(){ht&&e.notifyWith(k,[{cnt:k.data("cnt"),progress:k.data("progress"),total:k.data("total")}])}var r=i||this,it=r.getUI(),f=new XMLHttpRequest,a=null,pt=null,dt=null,st=t.checked,c=t.isDataType||"data"==t.type,h=t.target||r.cwd().hash,et=t.dropEvt||null,ui=t.extraData||null,ei=-1!=r.option("uploadMaxConn",h),rt=Math.min(5,Math.max(1,r.option("uploadMaxConn",h))),fi=0,e=n.Deferred().fail(function(n){var t,u=r.parseError(n);"userabort"===u&&(t=!0,u=void 0);o&&(r.uploads.xhrUploading||t)?ri(o).done(function(n){t||ut(u,n);n._cid?r.uploads.chunkfailReq[n._cid]||(r.uploads.chunkfailReq[n._cid]=!0,setTimeout(function(){i.request({data:{cmd:"upload",target:h,chunk:n._chunk,cid:n._cid,upload:["chunkfail"],mimes:"chunkfail"},options:{type:"post",url:r.uploadURL},preventDefault:!0}).always(function(){delete r.uploads.chunkfailReq[n._chunk]})},1e3)):(r.uploads.failSyncTm&&clearTimeout(r.uploads.failSyncTm),r.uploads.failSyncTm=setTimeout(function(){r.sync(h)},1e3))}):ut(u);t||r.sync();r.uploads.xhrUploading=!1;o=null}).done(function(t){r.uploads.xhrUploading=!1;o=null;t&&(r.currentReqCmd="upload",t.warning&&ut(t.warning),r.updateCache(t),t.removed&&t.removed.length&&r.remove(t),t.added&&t.added.length&&r.add(t),t.changed&&t.changed.length&&r.change(t),r.trigger("upload",t,!1),r.trigger("uploaddone"),t.toasts&&Array.isArray(t.toasts)&&n.each(t.toasts,function(){this.msg&&r.toast(this)}),t.sync&&r.sync(),t.debug&&(r.responseDebug(t),i.debug("backend-debug",t)))}).always(function(){r.abortXHR(f);it.off("uploadabort",lt);n(window).off("unload",lt);a&&clearTimeout(a);pt&&clearTimeout(pt);dt&&clearTimeout(dt);st&&!t.multiupload&&tt()&&r.notify({type:"upload",cnt:-l,progress:0,size:0});pt&&ti&&r.notify({type:"chunkmerge",cnt:-l});vt&&ni.children(".elfinder-notify-chunkmerge").length&&r.notify({type:"chunkmerge",cnt:-1})}),u=new FormData,o=t.input?t.input.files:r.uploads.checkFile(t,r,h),l=t.checked&&c?o[0].length:o.length,gt=!1,s=0,v=0,y=0,ht=!1,ni=r.ui.notify,ct=!0,ti=!1,w=!1,tt=function(){return!ht&&(k=ni.children(".elfinder-notify-upload")).length&&(ht=!0),ht},lt=function(n,t){w=!0;r.abortXHR(f,{quiet:!0,abort:!0});e.reject(t);tt()&&r.notify({type:"upload",cnt:-1*k.data("cnt"),progress:0,size:0})},ut=function(n,t,i){n&&r.trigger("xhruploadfail",{error:n,file:t});i?n&&(at<r.options.maxErrorDialogs&&(Array.isArray(n)?b=b.concat(n):b.push(n)),at++):n?r.error(n):(b.length&&(at>=r.options.maxErrorDialogs&&(b=b.concat("moreErrors",at-r.options.maxErrorDialogs)),r.error(b)),b=[],at=0)},b=[],at=0,p=t.renames||null,ft=t.hashes||null,vt=!1,k=n(),d,g,ii,ot,wt,nt;return(it.one("uploadabort",lt),n(window).one("unload."+i.namespace,lt),vt||(v=s),!c&&!l)?e.reject(["errUploadNoFiles"]):(f.addEventListener("error",function(){0==f.status?w?e.reject():!c&&t.files&&n.grep(t.files,function(n){return!n.type&&n.size===(r.UA.Safari?1802:0)}).length?e.reject(["errAbort","errFolderUpload"]):t.input&&n.grep(t.input.files,function(n){return!n.type&&n.size===(r.UA.Safari?1802:0)}).length?e.reject(["errUploadNoFiles"]):fi++<=30?(tt()&&v&&r.notify({type:"upload",cnt:0,progress:0,size:v}),r.abortXHR(f,{quiet:!0}),v=s=0,setTimeout(function(){var n;w||(f.open("POST",r.uploadURL,!0),2.1029<=r.api&&(n=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),"function"==typeof u.delete&&u.delete("reqid"),u.append("reqid",n),f._requestId=n),f.send(u))},1e4)):it.trigger("uploadabort",["errAbort","errTimeout"]):it.trigger("uploadabort","errConnect")},!1),f.addEventListener("load",function(){var n,i,b=f.status,d=0,h="",p;if(r.setCustomHeaderByXhr(f),400<=b?h=500<b?"errResponse":["errResponse","errServerError"]:f.responseText||(h=["errResponse","errDataEmpty"]),h&&(it.trigger("uploadabort"),ri(o||{}).done(function(n){return e.reject(n._cid?null:h)})),s=y,tt()&&(d=s-v)&&(r.notify({type:"upload",cnt:0,progress:d,size:0}),kt()),(n=r.parseUploadData(f.responseText))._chunkmerged)return u=new FormData,p=[{_chunkmerged:n._chunkmerged,_name:n._name,_mtime:n._mtime}],vt=!0,it.off("uploadabort",lt),dt=setTimeout(function(){r.notify({type:"chunkmerge",cnt:1})},r.options.notifyDelay),void(c?nt(p,o[1]):nt(p));n._multiupload=!!t.multiupload;n.error?(i={cmd:"upload",err:n,xhr:f,rc:f.status},r.trigger("uploadfail",n),r.trigger("requestError",i),i._getEvent&&i._getEvent().isDefaultPrevented()&&(n.error=""),n._chunkfailure||n._multiupload?(w=!0,r.uploads.xhrUploading=!1,a&&clearTimeout(a),k.length?(r.notify({type:"upload",cnt:-l,progress:0,size:0}),e.reject(n)):e.reject()):e.reject(n)):e.resolve(n)},!1),f.upload.addEventListener("loadstart",function(n){!vt&&n.lengthComputable&&(s=n.loaded,fi&&(s=0),y=n.total,s=s||parseInt(.05*y),tt()&&(r.notify({type:"upload",cnt:0,progress:s-v,size:t.multiupload?0:y}),v=s,kt()))},!1),f.upload.addEventListener("progress",function(n){var i;n.lengthComputable&&!vt&&f.readyState<2&&(s=n.loaded,!t.checked&&0<s&&!a&&(a=bt(f._totalSize-s)),y||(y=n.total,s=s||parseInt(.05*y)),i=s-v,tt()&&.05<=i/n.total&&(r.notify({type:"upload",cnt:0,progress:i,size:0}),v=s,kt()),!ti&&y<=s&&!gt&&(ti=!0,pt=setTimeout(function(){r.notify({type:"chunkmerge",cnt:l})},r.options.notifyDelay)),ct&&!t.multiupload&&y<=s&&tt()&&yt(!1))},!1),nt=function(o,s){var wt,d,oi,si,ot,lt,kt,ti,y,g,dt,hi,ii,ni,ri,ht=0,at=1,v=[],k=0,it=l,vt=0,ci=[],fi=(new Date).getTime().toString().substr(-9),pt=Math.min((i.uplMaxSize?i.uplMaxSize:2097152)-8190,i.options.uploadMaxChunkSize),nt=!ei&&"",li=function(u,f){var s,b,o=[],y=0,v;if(!w){for(;u.length&&o.length<f;)o.push(u.shift());if(y=o.length)for(b=y,v=0;v<y&&!w;v++)s=c?o[v][0][0]._cid||null:o[v][0]._cid||null,ni[s]?ii--:i.exec("upload",{type:t.type,isDataType:c,files:o[v],checked:!0,target:h,dropEvt:et,renames:p,hashes:ft,multiupload:!0,overwrite:0===t.overwrite?0:void 0,clipdata:t.clipdata},void 0,h).fail(function(n){n&&"No such command"===n&&(w=!0,i.error(["errUpload","errPerm"]));s&&(ni[s]=!0)}).always(function(t){t&&t.added&&(dt=n.merge(dt,t.added));ii<=++hi&&(i.trigger("multiupload",{added:dt}),a&&clearTimeout(a),tt()&&r.notify({type:"upload",cnt:-l,progress:0,size:0}));u.length?li(u,1):(--b<=1&&ct&&yt(!1),e.resolve())})}(o.length<1||w)&&(w?(a&&clearTimeout(a),s&&(ni[s]=!0),e.reject()):(e.resolve(),r.uploads.xhrUploading=!1))},ai=function(){r.uploads.xhrUploading?setTimeout(ai,100):(r.uploads.xhrUploading=!0,li(v,rt))};if(!st&&(c||"files"==t.type)){for((wt=i.option("uploadMaxSize",h))||(wt=0),ot=0;ot<o.length;ot++){try{d=(y=o[ot]).size;!1===nt&&(nt="",2.1<=r.api&&("slice"in y?nt="slice":"mozSlice"in y?nt="mozSlice":"webkitSlice"in y&&(nt="webkitSlice")))}catch(o){l--;it--;continue}if(wt&&wt<d||!nt&&i.uplMaxSize&&d>i.uplMaxSize)ut(["errUploadFile",y.name,"errUploadFileSize"],y,!0),l--,it--;else if(!y.type||r.uploadMimeCheck(y.type,h))if(nt&&pt<d){for(lt=0,kt=pt,ti=-1,it=Math.floor((d-1)/pt),oi=y.lastModified?Math.round(y.lastModified/1e3):0,si=t.clipdata?i.date(i.nonameDateFormat)+".png":y.name,vt+=d,ci[fi]=0;lt<d;)(g=y[nt](lt,kt))._chunk=si+"."+ ++ti+"_"+it+".part",g._cid=fi,g._range=lt+","+g.size+","+d,g._mtime=oi,ci[fi]++,ht&&k++,void 0===v[k]&&(v[k]=[],c&&(v[k][0]=[],v[k][1]=[])),ht=pt,at=1,c?(v[k][0].push(g),v[k][1].push(s[ot])):v[k].push(g),kt=(lt=kt)+pt;null==g?(ut(["errUploadFile",y.name,"errUploadFileSize"],y,!0),l--,it--):(it+=ti,ht=0,at=1,k++)}else(i.uplMaxSize&&ht+d>i.uplMaxSize||at>i.uplMaxFile)&&(ht=0,at=1,k++),void 0===v[k]&&(v[k]=[],c&&(v[k][0]=[],v[k][1]=[])),c?(v[k][0].push(y),v[k][1].push(s[ot])):v[k].push(y),ht+=d,vt+=d,at++;else ut(["errUploadFile",y.name,"errUploadMime","("+y.type+")"],y,!0),l--,it--}if(b.length&&ut(),0==v.length)return!(t.checked=!0);if(1<v.length)return a=bt(vt),dt=[],hi=0,ii=v.length,ni=[],ai(),!0;c?(o=v[0][0],s=v[0][1]):o=v[0]}return st||(i.UA.Safari&&t.files?f._totalSize=vt:a=bt(vt)),st=!0,o.length||e.reject(["errUploadNoFiles"]),f.open("POST",r.uploadURL,!0),i.customHeaders&&n.each(i.customHeaders,function(n){f.setRequestHeader(n,this)}),i.xhrFields&&n.each(i.xhrFields,function(n){n in f&&(f[n]=this)}),2.1029<=r.api&&(ri=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),u.append("reqid",ri),f._requestId=ri),u.append("cmd","upload"),u.append(r.newAPI?"target":"current",h),p&&p.length&&(n.each(p,function(n,t){u.append("renames[]",t)}),u.append("suffix",i.options.backupSuffix)),ft&&n.each(ft,function(n,t){u.append("hashes["+n+"]",t)}),n.each(r.customData,function(n,t){u.append(n,t)}),n.each(r.options.onlyMimes,function(n,t){u.append("mimes[]",t)}),n.each(o,function(n,r){var f;r._chunkmerged?(u.append("chunk",r._chunkmerged),u.append("upload[]",r._name),u.append("mtime[]",r._mtime),t.clipdata&&u.append("overwrite",0),gt=!0):(r._chunkfail?(u.append("upload[]","chunkfail"),u.append("mimes","chunkfail")):(t.clipdata?r._chunk||(t.overwrite=0,f=i.date(i.nonameDateFormat)+".png"):r.name&&(f=r.name,i.UA.iOS&&(f.match(/^image\.jpe?g$/i)?(t.overwrite=0,f=i.date(i.nonameDateFormat)+".jpg"):f.match(/^capturedvideo\.mov$/i)&&(t.overwrite=0,f=i.date(i.nonameDateFormat)+".mov")),f=(r.webkitRelativePath||r.relativePath||r._relativePath||"").replace(/[^\/]+$/,"")+f),f?u.append("upload[]",r,f):u.append("upload[]",r)),r._chunk?(u.append("chunk",r._chunk),u.append("cid",r._cid),u.append("range",r._range),u.append("mtime[]",r._mtime),gt=!0):u.append("mtime[]",r.lastModified?Math.round(r.lastModified/1e3):0))}),c&&n.each(s,function(n,t){u.append("upload_path[]",t)}),0===t.overwrite&&u.append("overwrite",0),et&&u.append("dropWith",parseInt((et.altKey?"1":"0")+(et.ctrlKey?"1":"0")+(et.metaKey?"1":"0")+(et.shiftKey?"1":"0"),2)),ui&&n.each(ui,function(n,t){u.append(n,t)}),f.send(u),!0},c?st?nt(o[0],o[1]):o.done(function(t){if(p=[],l=t[0].length){if(t[4]&&t[4].length)return void i.request({data:{cmd:"mkdir",target:h,dirs:t[4]},notify:{type:"mkdir",cnt:t[4].length},preventFail:!0}).fail(function(n){"errCmdParams"===(n=n||["errUnknown"])[0]?rt=1:(rt=0,e.reject(n))}).done(function(i){var r=!1;i.hashes||(i.hashes={});t[1]=n.map(t[1],function(n,u){return t[0][u]._relativePath=n.replace(/^\//,""),""===(n=n.replace(/\/[^\/]*$/,""))?h:i.hashes[n]?i.hashes[n]:(r=!0,t[0][u]._remove=!0,null)});r&&(t[0]=n.grep(t[0],function(n){return!n._remove}))}).always(function(){rt&&(p=t[2],ft=t[3],nt(t[0],t[1]))});t[1]=n.map(t[1],function(){return h});p=t[2];ft=t[3];nt(t[0],t[1])}else e.reject(["errUploadNoFiles"])}).fail(function(){e.reject()}):0<o.length?t.clipdata||null!=p?nt(o)||e.reject():(d=[],g=[],ii=i.options.folderUploadExclude[i.OS]||null,n.each(o,function(t,i){var f,u,r=i.webkitRelativePath||i.relativePath||"";if(!r)return!1;ii&&i.name.match(ii)?(i._remove=!0,r=void 0):(r="/"+r.replace(/\/[^\/]*$/,"").replace(/^\//,""))&&-1===n.inArray(r,d)&&(d.push(r),-1!==(f=r.substr(1).indexOf("/"))&&(u=r.substr(0,f+1))&&-1===n.inArray(u,d)&&d.unshift(u));g.push(r)}),p=[],ft={},d.length?(ot=n.map(d,function(n){return-1===n.substr(1).indexOf("/")?{name:n.substr(1)}:null}),wt=[],i.uploads.checkExists(ot,h,i,!0).done(function(t,r){var s,u,f=[];i.options.overwriteUploadConfirm&&i.option("uploadOverwrite",h)&&(wt=n.map(ot,function(n){return n._remove?n.name:null}),ot=n.grep(ot,function(n){return!n._remove}));wt.length&&n.each(g.concat(),function(t,i){0===n.inArray(i,wt)&&(o[t]._remove=!0,g[t]=void 0)});o=n.grep(o,function(n){return!n._remove});g=n.grep(g,function(n){return void 0!==n});ot.length?(n.Deferred(),t.length?n.each(t,function(o,c){s=i.uniqueName(c+i.options.backupSuffix,null,"");n.each(r,function(n,i){if(t[0]==i)return u=n,!1});u=u||i.fileByName(t[0],h).hash;i.lockfiles({files:[u]});f.push(i.request({data:{cmd:"rename",target:u,name:s},notify:{type:"rename",cnt:1}}).fail(function(n){e.reject(n);i.sync()}).always(function(){i.unlockfiles({files:[u]})}))}):f.push(null),n.when.apply(n,f).done(function(){i.request({data:{cmd:"mkdir",target:h,dirs:d},notify:{type:"mkdir",cnt:d.length},preventFail:!0}).fail(function(n){"errCmdParams"===(n=n||["errUnknown"])[0]?rt=1:(rt=0,e.reject(n))}).done(function(t){var i=!1;t.hashes||(t.hashes={});g=n.map(g.concat(),function(n,r){return"/"===n?h:t.hashes[n]?t.hashes[n]:(i=!0,o[r]._remove=!0,null)});i&&(o=n.grep(o,function(n){return!n._remove}))}).always(function(){rt&&(c=!0,nt(o,g)||e.reject())})})):e.reject()})):i.uploads.checkExists(o,h,i).done(function(r,u){i.options.overwriteUploadConfirm&&i.option("uploadOverwrite",h)&&(ft=u,null===r?t.overwrite=0:p=r,o=n.grep(o,function(n){return!n._remove}));0<(l=o.length)&&nt(o)||e.reject()})):e.reject(),e)},iframe:function(t,i){function p(){l&&clearTimeout(l);c&&clearTimeout(c);w&&r.notify({type:"upload",cnt:-e});setTimeout(function(){k&&n('<iframe src="javascript:false;"><\/iframe>').appendTo(u);u.remove();v.remove()},100)}var e,w,c,l,r=i||this,f=!!t.input&&t.input,a=!f&&r.uploads.checkFile(t,r),o=n.Deferred().fail(function(n){n&&r.error(n)}),b="iframe-"+i.namespace+ ++r.iframeCnt,u=n('<form action="'+r.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+b+'" style="display:none"><input type="hidden" name="cmd" value="upload" /><\/form>'),k=this.UA.IE,v=n('<iframe src="'+(k?"javascript:false;":"about:blank")+'" name="'+b+'" style="position:absolute;left:-1000px;top:-1000px" ><\/iframe>').on("load",function(){v.off("load").on("load",function(){p();o.resolve()});c=setTimeout(function(){w=!0;r.notify({type:"upload",cnt:e})},r.options.notifyDelay);0<r.options.iframeTimeout&&(l=setTimeout(function(){p();o.reject(["errConnect","errTimeout"])},r.options.iframeTimeout));u.submit()}),y=t.target||r.cwd().hash,s=[],d=[],h=[],g={};if(a&&a.length)n.each(a,function(n,t){u.append('<input type="hidden" name="upload[]" value="'+t+'"/>')}),e=1;else{if(!(f&&n(f).is(":file")&&n(f).val()))return o.reject();i.options.overwriteUploadConfirm&&i.option("uploadOverwrite",y)&&(s=f.files?f.files:[{name:n(f).val().replace(/^(?:.+[\\\/])?([^\\\/]+)$/,"$1")}],d.push(r.uploads.checkExists(s,y,r).done(function(i,r){g=r;null===i?t.overwrite=0:(h=i,(e=n.grep(s,function(n){return!n._remove}).length)!=s.length&&(e=0))})));e=f.files?f.files.length:1;u.append(f)}return n.when.apply(n,d).done(function(){if(e<1)return o.reject();u.append('<input type="hidden" name="'+(r.newAPI?"target":"current")+'" value="'+y+'"/>').append('<input type="hidden" name="html" value="1"/>').append('<input type="hidden" name="node" value="'+r.id+'"/>').append(n(f).attr("name","upload[]"));0<h.length&&(n.each(h,function(n,t){u.append('<input type="hidden" name="renames[]" value="'+r.escape(t)+'"/>')}),u.append('<input type="hidden" name="suffix" value="'+i.options.backupSuffix+'"/>'));g&&n.each(h,function(n,t){u.append('<input type="hidden" name="['+n+']" value="'+r.escape(t)+'"/>')});0===t.overwrite&&u.append('<input type="hidden" name="overwrite" value="0"/>');n.each(r.options.onlyMimes||[],function(n,t){u.append('<input type="hidden" name="mimes[]" value="'+r.escape(t)+'"/>')});n.each(r.customData,function(n,t){u.append('<input type="hidden" name="'+n+'" value="'+r.escape(t)+'"/>')});u.appendTo("body");v.appendTo("body")}),o}},one:function(n,t,i){var f=this,r=n.toLowerCase(),u=function(){return f.toUnbindEvents[r]||(f.toUnbindEvents[r]=[]),f.toUnbindEvents[r].push({type:r,callback:u}),(t.done?t.done:t).apply(this,arguments)};return t.done&&(u={done:u}),this.bind(r,u,i)},localStorage:function(t,i){var u,o,s,h,c,r=window.localStorage,l="elfinder-"+(t||"")+this.id,f=window.location.pathname+"-elfinder-",e=this.id,a=[];if(void 0===t)return h=f.length,c=-1*e.length,n.each(r,function(n){n.substr(0,h)===f&&n.substr(c)===e&&a.push(n)}),n.each(a,function(n,t){r.removeItem(t)}),!0;if(t=f+t+e,null===i)return r.removeItem(t);if(void 0===i&&!(u=r.getItem(t))&&(o=r.getItem(l))&&(i=o,r.removeItem(l)),void 0!==i){"string"!=(s=typeof i)&&"number"!=s&&(i=JSON.stringify(i));try{r.setItem(t,i)}catch(u){try{r.clear();r.setItem(t,i)}catch(u){this.debug("error",u.toString())}}u=r.getItem(t)}if(u&&("{"===u.substr(0,1)||"["===u.substr(0,1)))try{return JSON.parse(u)}catch(u){}return u},sessionStorage:function(n,t){var i,r,u;try{i=window.sessionStorage}catch(r){}if(i){if(null===t)return i.removeItem(n);if(void 0!==t){"string"!=(u=typeof t)&&"number"!=u&&(t=JSON.stringify(t));try{i.setItem(n,t)}catch(r){try{i.clear();i.setItem(n,t)}catch(r){this.debug("error",r.toString())}}}if((r=i.getItem(n))&&("{"===r.substr(0,1)||"["===r.substr(0,1)))try{return JSON.parse(r)}catch(r){}return r}},cookie:function(t,i){var o,r,f,u,e,s;if(t="elfinder-"+t+this.id,void 0===i){if(this.cookieEnabled&&document.cookie&&""!=document.cookie)for(f=document.cookie.split(";"),t+="=",u=0;u<f.length;u++)if(f[u]=n.trim(f[u]),f[u].substring(0,t.length)==t){if("{"===(e=decodeURIComponent(f[u].substring(t.length))).substr(0,1)||"["===e.substr(0,1))try{return JSON.parse(e)}catch(t){}return e}return null}if(!this.cookieEnabled)return"";if(r=Object.assign({},this.options.cookie),null===i?(i="",r.expires=-1):"string"!=(s=typeof i)&&"number"!=s&&(i=JSON.stringify(i)),"number"==typeof r.expires&&((o=new Date).setTime(o.getTime()+864e5*r.expires),r.expires=o),document.cookie=t+"="+encodeURIComponent(i)+"; expires="+r.expires.toUTCString()+(r.path?"; path="+r.path:"")+(r.domain?"; domain="+r.domain:"")+(r.secure?"; secure":""),i&&("{"===i.substr(0,1)||"["===i.substr(0,1)))try{return JSON.parse(i)}catch(t){}return i},startDir:function(){var n=window.location.hash;return n&&n.match(/^#elf_/)?n.replace(/^#elf_/,""):this.options.startPathHash?this.options.startPathHash:this.lastDir()},lastDir:function(n){return this.options.rememberLastDir?this.storage("lastdir",n):""},_node:n("<span><\/c.length;>"),escape:function(n){return this._node.text(n).html().replace(/"/g,"&quot;").replace(/'/g,"&#039;")},normalize:function(t){function c(t){function r(n){var t=typeof n;return"object"===t&&Array.isArray(n)&&(t="array"),t}return n.each(i.optionProperties,function(n,i){void 0!==i&&t[n]&&r(t[n])!==r(i)&&(t[n]=i)}),t.disabled?(t.disabledFlip=i.arrayFlip(t.disabled,!0),n.each(i.options.disabledCmdsRels,function(i,r){var u,f;(t.disabledFlip[i]||(u=i.match(/^([^&]+)&([^=]+)=(.*)$/))&&t.disabledFlip[u[1]]&&t[u[2]]==u[3])&&(f=!0);f&&n.each(r,function(n,i){t.disabledFlip[i]||(t.disabledFlip[i]=!0,t.disabled.push(i))})})):t.disabledFlip={},t}function o(t,r,o){var l,s,a,v,h,k,d=!r||t,b=!!r&&null;if(t&&t.hash&&t.name&&t.mime){if("application/x-empty"===t.mime&&(t.mime="text/plain"),(a=i.isRoot(t))&&!t.volumeid&&i.debug("warning","The volume root statuses requires `volumeid` property."),a||"directory"===t.mime){if(t.phash){if(t.phash===t.hash)return e=e.concat(['Parent folder of "$1" is itself.',t.name]),b;if(a&&t.volumeid&&0===t.phash.indexOf(t.volumeid))return e=e.concat(['Parent folder of "$1" is inner itself.',t.name]),b}t.volumeid&&(l=t.volumeid,a&&(t.phash&&(i.leafRoots[t.phash]?-1===n.inArray(t.hash,i.leafRoots[t.phash])&&i.leafRoots[t.phash].push(t.hash):i.leafRoots[t.phash]=[t.hash]),i.hasVolOptions=!0,i.volOptions[l]||(i.volOptions[l]={dispInlineRegex:i.options.dispInlineRegex}),s=i.volOptions[l],t.options&&Object.assign(s,t.options),t.disabled&&(s.disabled=t.disabled,s.disabledFlip=i.arrayFlip(t.disabled,!0)),t.tmbUrl&&(s.tmbUrl=t.tmbUrl),s.url&&"/"!==s.url.substr(-1)&&(s.url+="/"),(h=s).uiCmdMap&&(n.isPlainObject(h.uiCmdMap)&&Object.keys(h.uiCmdMap).length?(h.disabledFlip||(h.disabledFlip={}),k=h.disabledFlip,n.each(h.uiCmdMap,function(n,t){"hidden"!==t||k[n]||(h.disabled.push(n),h.disabledFlip[n]=!0)})):delete h.uiCmdMap),s.trashHash&&(!1===i.trashes[s.trashHash]?delete s.trashHash:i.trashes[s.trashHash]=t.hash),n.each(i.optionProperties,function(n){s[n]&&(t[n]=s[n])}),"cwd"!==o&&(i.roots[l]=t.hash),t.expires&&(i.volumeExpires[l]=t.expires)),p!==l&&(p=l,y=i.option("i18nFolderName",l)));a&&!t.i18&&(u="volume_"+t.name,f=i.i18n(!1,u),u!==f&&(t.i18=f));y&&!t.i18&&(u="folder_"+t.name,f=i.i18n(!1,u),u!==f&&(t.i18=f));a&&(v=i.storage("rootNames"))&&(v[t.hash]&&(t._name=t.name,t._i18=t.i18,t.name=v[t.hash]=v[t.hash],delete t.i18),i.storage("rootNames",v));i.trashes[t.hash]&&(t.locked=!0)}else{if(w)try{if(!w(t))return b}catch(r){i.debug(r)}0==t.size&&(t.mime=i.getMimetype(t.name,t.mime))}return t.options&&(i.optionsByHashes[t.hash]=c(t.options)),delete t.options,d}return b}function h(r,u){n.each(r,function(r,f){var e,o;i.leafRoots[f.hash]&&i.applyLeafRootStats(f);"change"!==u&&f.phash&&i.isRoot(f)&&(e=i.file(f.phash))&&(i.applyLeafRootStats(e),t.changed?(n.each(t.changed,function(n,i){if(i.hash===e.hash)return t.changed[n]=e,!(o=!0)}),o||t.changed.push(e)):t.changed=[e])})}var u,f,y,p,r,l,s,a,v,i=this,w=((s=i.options.fileFilter)&&("function"==typeof s?l=function(n){return s.call(i,n)}:s instanceof RegExp&&(l=function(n){return s.test(n.name)})),l||null),e=[];if(t.customData&&(!i.prevCustomData||JSON.stringify(t.customData)!==JSON.stringify(i.prevCustomData))){i.prevCustomData=t.customData;try{r=JSON.parse(t.customData);n.isPlainObject(r)&&(i.prevCustomData=r,n.each(Object.keys(r),function(n,t){null===r[t]&&(delete r[t],delete i.optsCustomData[t])}),i.customData=Object.assign({},i.optsCustomData,r))}catch(o){}}return t.options&&c(t.options),t.cwd&&(t.cwd.volumeid&&t.options&&Object.keys(t.options).length&&i.isRoot(t.cwd)&&(i.hasVolOptions=!0,i.volOptions[t.cwd.volumeid]=t.options),t.cwd=o(t.cwd,!0,"cwd")),t.files&&(t.files=n.grep(t.files,o)),t.tree&&(t.tree=n.grep(t.tree,o)),t.added&&(t.added=n.grep(t.added,o)),t.changed&&(t.changed=n.grep(t.changed,o)),t.removed&&t.removed.length&&2===i.searchStatus.state&&(t.removed=t.removed.concat((a=t.removed,v=[],n.each(i.files(),function(t){n.each(i.parents(t),function(i,r){if(-1!==n.inArray(r,a)&&-1===n.inArray(t,a))return v.push(t),!1})}),v))),t.api&&(t.init=!0),Object.keys(i.leafRoots).length&&(t.files&&h(t.files),t.tree&&h(t.tree),t.added&&h(t.added),t.changed&&h(t.changed,"change")),t.cwd&&t.cwd.options&&t.options&&Object.assign(t.options,c(t.cwd.options)),t.options&&t.options.url&&"/"!==t.options.url.substr(-1)&&(t.options.url+="/"),e.length&&(t.norError=["errResponse"].concat(e)),t},setSort:function(n,t,i,r){this.storage("sortType",this.sortType=this.sortRules[n]?n:"name");this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc");this.storage("sortStickFolders",(this.sortStickFolders=!!i)?1:"");this.storage("sortAlsoTreeview",(this.sortAlsoTreeview=!!r)?1:"");this.trigger("sortchange")},_sortRules:{name:function(n,t){return r.prototype.naturalCompare(n.i18||n.name,t.i18||t.name)},size:function(n,t){var i=parseInt(n.size)||0,r=parseInt(t.size)||0;return i===r?0:r<i?1:-1},kind:function(n,t){return r.prototype.naturalCompare(n.mime,t.mime)},date:function(n,t){var i=n.ts||n.date||0,r=t.ts||t.date||0;return i===r?0:r<i?1:-1},perm:function(n,t){function i(n){return(n.write?2:0)+(n.read?1:0)}var r=i(n),u=i(t);return r===u?0:u<r?1:-1},mode:function(n,t){var i=n.mode||n.perm||"",u=t.mode||t.perm||"";return r.prototype.naturalCompare(i,u)},owner:function(n,t){var i=n.owner||"",u=t.owner||"";return r.prototype.naturalCompare(i,u)},group:function(n,t){var i=n.group||"",u=t.group||"";return r.prototype.naturalCompare(i,u)}},sorters:{},naturalCompare:function(n,t){var i=r.prototype.naturalCompare;return void 0===i.loc&&(i.loc=navigator.userLanguage||navigator.browserLanguage||navigator.language||"en-US"),void 0===i.sort&&(0<"11".localeCompare("2",i.loc,{numeric:!0})?i.sort=window.Intl&&window.Intl.Collator?new Intl.Collator(i.loc,{numeric:!0}).compare:function(n,t){return n.localeCompare(t,i.loc,{numeric:!0})}:(i.sort=function(n,t){function a(n){return i.sort.insensitive&&(""+n).toLowerCase()||""+n}var r,u,v=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,y=/(^[ ]*|[ ]*$)/g,p=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,w=/^0x[0-9a-f]+$/i,b=/^0/,k=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,o=a(n).replace(y,"").replace(/^_/,"\x01")||"",s=a(t).replace(y,"").replace(/^_/,"\x01")||"",e=o.replace(v,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=s.replace(v,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),c=parseInt(o.match(w))||1!=e.length&&o.match(p)&&Date.parse(o),l=parseInt(s.match(w))||c&&s.match(p)&&Date.parse(s)||null,d=0,f,g;if(l){if(c<l)return-1;if(l<c)return 1}for(f=0,g=Math.max(e.length,h.length);f<g;f++){if(r=!(e[f]||"").match(b)&&parseFloat(e[f])||e[f]||0,u=!(h[f]||"").match(b)&&parseFloat(h[f])||h[f]||0,isNaN(r)!==isNaN(u)){if(isNaN(r)&&("string"!=typeof r||!r.match(k)))return 1;if("string"!=typeof u||!u.match(k))return-1}if(0===parseInt(r,10)&&(r=0),0===parseInt(u,10)&&(u=0),typeof r!=typeof u&&(r+="",u+=""),i.sort.insensitive&&"string"==typeof r&&"string"==typeof u&&0!==(d=r.localeCompare(u,i.loc)))return d;if(r<u)return-1;if(u<r)return 1}return 0},i.sort.insensitive=!0)),i.sort(n,t)},compare:function(n,t){var i,u=this.sortType,f="asc"==this.sortOrder,h=this.sortStickFolders,r=this.sortRules,e=r[u],o="directory"==n.mime,s="directory"==t.mime;if(h){if(o&&!s)return-1;if(!o&&s)return 1}return i=f?e(n,t):e(t,n),"name"!==u&&0===i?i=f?r.name(n,t):r.name(t,n):i},sortFiles:function(n){return n.sort(this.compare)},notify:function(t){function w(){function t(){i.remove();u.children(r.data("minimized")?void 0:":visible").length||(r.data("minimized")?r.data("minimized").hide():u.elfinderdialog("close"));y()}var f=i.find(".elfinder-notify-progress");i._esc&&n(document).off("keydown",i._esc);i.data("cur")<100?f.animate({width:"100%"},50,function(){requestAnimationFrame(function(){t()})}):t()}var p,s,h,b=this,e=t.type,l=t.id?"elfinder-notify-"+t.id:"",k=this.i18n(void 0!==t.msg?t.msg:this.messages["ntf"+e]?"ntf"+e:"ntfsmth"),d=this.arrayFlip(this.options.notifyDialog.hiddens||[]),u=this.ui.notify,r=u.closest(".ui-dialog"),i=u.children(".elfinder-notify-"+e+(l?"."+l:"")),a=i.children("div.elfinder-notify-cancel").children("button"),nt='<div class="elfinder-notify elfinder-notify-{type}'+(l?" "+l:"")+'"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"><\/span><span class="elfinder-notify-msg">{msg}<\/span> <span class="elfinder-notify-cnt"><\/span><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"><\/div><\/div><div class="elfinder-notify-cancel"><\/div><\/div>',c=t.cnt+0,v=void 0!==t.size?parseInt(t.size):null,o=void 0!==t.progress&&0<=t.progress?t.progress:null,tt=t.fakeinterval||200,f=t.cancel,g=function(n){var t;i.length&&(t=i.data("cur")+1)<=98&&(i.find(".elfinder-notify-progress").width(t+"%"),i.data("cur",t),y(),setTimeout(function(){g(n*=1.05)},n))},y=function(){var t,i=0,f=0,e=u.children(".elfinder-notify");e.length?(e.each(function(){i++;f+=Math.min(n(this).data("cur"),100)}),t=i?Math.floor(f/(100*i)*100)+"%":0,b.ui.progressbar.width(t),r.data("minimized")&&(r.data("minimized").title(t),r.data("minimized").dialog().children(".ui-dialog-titlebar").children(".elfinder-ui-progressbar").width(t))):(b.ui.progressbar.width(0),r.data("minimized")&&r.data("minimized").hide())};return e&&(i.length?void 0!==t.msg&&i.children("span.elfinder-notify-msg").html(k):(i=n(nt.replace(/\{type\}/g,e).replace(/\{msg\}/g,k)),d[e]?i.hide():u.on("minimize",function(){r.data("minimized")&&y()}),i.appendTo(u).data("cnt",0),null!=o?i.data({progress:0,total:0,cur:0}):(i.data({cur:0}),g(tt)),f&&(a=n('<span class="elfinder-notify-button ui-icon ui-icon-close" title="'+this.i18n("btnCancel")+'"><\/span>').on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"===t.type)}),i.children("div.elfinder-notify-cancel").append(a)),u.trigger("resize")),0<(p=c+parseInt(i.data("cnt")))?(f&&a.length&&(n.isFunction(f)||"object"==typeof f&&f.promise)&&(i._esc=function(t){"keydown"==t.type&&t.keyCode!=n.ui.keyCode.ESCAPE||(t.preventDefault(),t.stopPropagation(),w(),f.promise?f.reject(0):f(t))},a.on("click",function(n){i._esc(n)}),n(document).on("keydown."+this.namespace,i._esc)),t.hideCnt||i.children(".elfinder-notify-cnt").text("("+p+")"),0<c&&u.is(":hidden")&&!d[e]&&(r.data("minimized")?r.data("minimized").show():u.elfinderdialog("open",this).height("auto")),i.data("cnt",p),null!=o&&0<=(s=i.data("total"))&&0<=(h=i.data("progress"))&&(s+=null!=v?v:c,h+=o,null==v&&c<0&&(h+=100*c),i.data({progress:h,total:s}),null!=v&&(h*=100,s=Math.max(1,s)),o=Math.min(parseInt(h/s),100),i.find(".elfinder-notify-progress").animate({width:(o<100?o:100)+"%"},20,function(){i.data("cur",o);y()}))):w()),this},confirm:function(t){var r,e,f=this,u=!1,i={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(t.title||"confirmReq"),buttons:{},close:function(){u||t.cancel.callback();n(this).elfinderdialog("destroy")}},o=this.i18n("apllyAll");return t.cssClass&&(i.cssClass+=" "+t.cssClass),i.buttons[this.i18n(t.accept.label)]=function(){t.accept.callback(!(!r||!r.prop("checked")));u=!0;n(this).elfinderdialog("close")},i.buttons[this.i18n(t.accept.label)]._cssClass="elfinder-confirm-accept",t.reject&&(i.buttons[this.i18n(t.reject.label)]=function(){t.reject.callback(!(!r||!r.prop("checked")));u=!0;n(this).elfinderdialog("close")},i.buttons[this.i18n(t.reject.label)]._cssClass="elfinder-confirm-reject"),t.buttons&&0<t.buttons.length&&(e=1,n.each(t.buttons,function(t,o){i.buttons[f.i18n(o.label)]=function(){o.callback(!(!r||!r.prop("checked")));u=!0;n(this).elfinderdialog("close")};i.buttons[f.i18n(o.label)]._cssClass="elfinder-confirm-extbtn"+e++;o.cssClass&&(i.buttons[f.i18n(o.label)]._cssClass+=" "+o.cssClass)})),i.buttons[this.i18n(t.cancel.label)]=function(){n(this).elfinderdialog("close")},i.buttons[this.i18n(t.cancel.label)]._cssClass="elfinder-confirm-cancel",t.all&&(i.create=function(){var t=n('<div class="elfinder-dialog-confirm-applyall"><\/div>');r=n('<input type="checkbox" />');n(this).next().find(".ui-dialog-buttonset").prepend(t.append(n("<label>"+o+"<\/label>").prepend(r)))}),t.optionsCallback&&n.isFunction(t.optionsCallback)&&t.optionsCallback(i),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"><\/span>'+this.i18n(t.text),i)},uniqueName:function(n,t,i){var f,r,e=0,u="";if(n=this.i18n(!1,n),t=t||this.cwd().hash,i=void 0===i?" ":i,(f=n.match(/^(.+)(\.[^.]+)$/))&&(u=f[2],n=f[1]),r=n+u,!this.fileByName(r,t))return r;for(;e<1e4;)if(r=n+i+ ++e+u,!this.fileByName(r,t))return r;return n+Math.random()+u},i18n:function(){function s(n){var t;return 0===n.indexOf("#")&&(t=e.file(n.substr(1)))?t.name:n}var i,u,t,f,h,e=this,c=this.messages,r=[],o=[],l=0;for(arguments.length&&!1===arguments[0]&&(f=function(n){return n},l=1),i=l;i<arguments.length;i++)if(t=arguments[i],Array.isArray(t))for(u=0;u<t.length;u++)t[u]instanceof jQuery?r.push(t[u]):void 0!==t[u]&&r.push(s(""+t[u]));else t instanceof jQuery?r.push(t[u]):void 0!==t&&r.push(s(""+t));for(i=0;i<r.length;i++)-1===n.inArray(i,o)&&(t="string"==typeof(t=r[i])?(h=!(!c[t]||!t.match(/^err/)),(t=c[t]||(f?f(t):e.escape(t))).replace(/\$(\d+)/g,function(n,t){var u;return 0<(t=i+parseInt(t))&&r[t]&&o.push(t),u=f?f(r[t]):e.escape(r[t]),h&&(u='<span class="elfinder-err-var elfinder-err-var'+t+'">'+u+"<\/span>"),u})):t.get(0).outerHTML,r[i]=t);return n.grep(r,function(t,i){return-1===n.inArray(i,o)}).join("<br>")},getIconStyle:function(t,i){var f=this,r="",u={},e=0;return t.icon&&(r='style="',n.each({background:"url('{url}') 0 0 no-repeat","background-size":"contain"},function(n,o){0==e++&&(o=o.replace("{url}",f.escape(t.icon)));i?u[n]=o:r+=n+":"+o+";"}),r+='"'),i?u:r},mime2class:function(n){var i="elfinder-cwd-icon-",t=n.toLowerCase(),r=this.textMimes[t],t=t.split("/");return r?t[0]+=" "+i+"text":t[1]&&t[1].match(/\+xml$/)&&(t[0]+=" "+i+"xml"),i+t[0]+(t[1]?" "+i+t[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(n){var i,r="object"==typeof n,t=r?n.mime:n;return r&&n.alias&&"symlink-broken"!=t?i="Alias":this.kinds[t]&&(i=!r||"directory"!==t||n.phash&&!n.isroot?this.kinds[t]:"Root"),i=i||(0===t.indexOf("text")?"Text":0===t.indexOf("image")?"Image":0===t.indexOf("audio")?"Audio":0===t.indexOf("video")?"Video":0===t.indexOf("application")?"App":t),this.messages["kind"+i]?this.i18n("kind"+i):t},mimeIsText:function(n){return!!(this.textMimes[n.toLowerCase()]||0===n.indexOf("text/")&&"rtf"!==n.substr(5,3)||n.match(/^application\/.+\+xml$/))},date:function(n,t){var f,h,u,c,r,e,o,s,i=this;return t=t||new Date,r=t[i.getHours](),e=12<r?r-12:r,o=t[i.getMinutes](),s=t[i.getSeconds](),f=t[i.getDate](),h=t[i.getDay](),u=t[i.getMonth]()+1,c=t[i.getFullYear](),n.replace(/[a-z]/gi,function(n){switch(n){case"d":return 9<f?f:"0"+f;case"j":return f;case"D":return i.i18n(i.i18.daysShort[h]);case"l":return i.i18n(i.i18.days[h]);case"m":return 9<u?u:"0"+u;case"n":return u;case"M":return i.i18n(i.i18.monthsShort[u-1]);case"F":return i.i18n(i.i18.months[u-1]);case"Y":return c;case"y":return(""+c).substr(2);case"H":return 9<r?r:"0"+r;case"G":return r;case"g":return e;case"h":return 9<e?e:"0"+e;case"a":return 12<=r?"pm":"am";case"A":return 12<=r?"PM":"AM";case"i":return 9<o?o:"0"+o;case"s":return 9<s?s:"0"+s}return n})},formatDate:function(n,t){var f,e,u,i=this,r=t||n.ts;return i.i18,i.options.clientFormatDate&&0<r?(f=new Date(1e3*r),e=r>=this.yesterday?this.fancyFormat:this.dateFormat,u=i.date(e,f),r>=this.yesterday?u.replace("$1",this.i18n(r>=this.today?"Today":"Yesterday")):u):n.date?n.date.replace(/([a-z]+)\s/i,function(n,t){return i.i18n(t)+" "}):i.i18n("dateUnknown")},toLocaleString:function(n){var t=new Number(n);return t?t.toLocaleString?t.toLocaleString():String(n).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):n},perms2class:function(n){var t="";return n.read||n.write?n.read?n.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",n.type&&(t+=" elfinder-"+this.escape(n.type)),t},formatPermissions:function(n){var t=[];return n.read&&t.push(this.i18n("read")),n.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(n){var t=1,i="b";return"unknown"==n?this.i18n("unknown"):(1073741824<n?(t=1073741824,i="GB"):1048576<n?(t=1048576,i="MB"):1024<n&&(t=1024,i="KB"),(0<(n/=t)?1048576<=t?n.toFixed(2):Math.round(n):0)+" "+i)},formatFileMode:function(t,i){var r,u,f,s,h,c,e,o;if(i=i||this.options.fileModeStyle.toLowerCase(),(t=n.trim(t)).match(/[rwxs-]{9}$/i)){if(e=t=t.substr(-9),"string"==i)return e;for(o="",r=f=0;r<7;r+=3)s=0,(u=t.substr(r,3)).match(/[r]/i)&&(s+=4),u.match(/[w]/i)&&(s+=2),u.match(/[xs]/i)&&(u.match(/[xs]/)&&(s+=1),u.match(/[s]/i)&&(0==r?f+=4:3==r&&(f+=2))),o+=s.toString(8);f&&(o=f.toString(8)+o)}else{if(o=(t=parseInt(t,8))?t.toString(8):"",!t||"octal"==i)return o;for(f=0,3<(u=t.toString(8)).length&&(u=u.substr(-4),f=parseInt(u.substr(0,1),8),u=u.substr(1)),c=2==(2&f),h=4==(4&f),e="",r=0;r<3;r++)e+=4==(4&parseInt(u.substr(r,1),8))?"r":"-",e+=2==(2&parseInt(u.substr(r,1),8))?"w":"-",e+=1==(1&parseInt(u.substr(r,1),8))?0==r&&h||1==r&&c?"s":"x":"-"}return"both"==i?e+" ("+o+")":"string"==i?e:o},registRawStringDecoder:function(t){n.isFunction(t)&&(this.decodeRawString=this.options.rawStringDecoder=t)},uploadMimeCheck:function(t,i){function o(i){var r=!1;return"string"==typeof i&&"all"===i.toLowerCase()?r=!0:Array.isArray(i)&&i.length&&n.each(i,function(n,i){if("all"===(i=i.toLowerCase())||0===t.indexOf(i))return!(r=!0)}),r}i=i||this.cwd().hash;var f,e,r=!0,u=this.option("uploadMime",i);return t&&n.isPlainObject(u)&&(t=t.toLowerCase(),f=o(u.allow),e=o(u.deny),"allow"===u.firstOrder?r=!e&&!0===f:(r=!0)!==e||f||(r=!1)),r},sequence:function(n){var i=n.length,t=function(i,r){return n[++r]?t(i.then(n[r]),r):i};return 1<i?t(n[0](),0):n[0]()},reloadContents:function(t){var r,i=n.Deferred();try{r=n('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src",t).one("load",function(){var r=n(this);try{this.contentDocument.location.reload(!0);r.one("load",function(){r.remove();i.resolve()})}catch(u){r.attr("src","").attr("src",t).one("load",function(){r.remove();i.resolve()})}}).appendTo("body")}catch(u){r&&r.remove();i.reject()}return i},makeNetmountOptionOauth:function(t,i,r,u){var e,s="boolean"==typeof u?u:null,f=Object.assign({noOffline:!1,root:"root",pathI18n:"folderId",folders:!0},null===s?u||{}:{noOffline:s}),o=function(i,u,s){var c,l=this,a=Object.keys(n.isPlainObject(s)?s:{}).length;u.next().remove();a&&(c=n('<select class="ui-corner-all elfinder-tabstop" style="max-width:200px;">').append(n(n.map(s,function(n,t){return'<option value="'+i.escape((t+"").trim())+'">'+i.escape(n)+"<\/option>"}).join(""))).on("change click",function(u){var a,s=n(this),c=s.val();l.inputs.path.val(c);f.folders&&("change"===u.type||s.data("current")!==c)&&(s.next().remove(),s.data("current",c),c!=f.root&&(a=h(),e&&"pending"===e.state()&&i.abortXHR(e,{quiet:!0,abort:!0}),s.after(a),e=i.request({data:{cmd:"netmount",protocol:t,host:r,user:"init",path:c,pass:"folders"},preventDefault:!0}).done(function(n){o.call(l,i,s,n.folders)}).always(function(){i.abortXHR(e,{quiet:!0});a.remove()}).xhr))}),u.after(n("<div><\/div>").append(c)).closest(".ui-dialog").trigger("tabstopsInit"),c.trigger("focus"))},h=function(){return n('<div class="elfinder-netmount-spinner"><\/div>').append('<span class="elfinder-spinner"><\/span>')};return{vars:{},name:i,inputs:{offline:n('<input type="checkbox"/>').on("change",function(){n(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change","reset")}),host:n('<span><span class="elfinder-spinner"><\/span><\/span><input type="hidden"/>'),path:n('<input type="text" value="'+f.root+'"/>'),user:n('<input type="hidden"/>'),pass:n('<input type="hidden"/>'),mnt2res:n('<input type="hidden"/>')},select:function(i,u,e){var o=this.inputs,s=o.offline,h=n(o.host[0]),c=e||null;this.vars.mbtn=o.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0");h.data("inrequest")||!h.find("span.elfinder-spinner").length&&"reset"!==c&&("winfocus"!==c||h.siblings("span.elfinder-button-icon-reload").length)?(s.closest("tr")[f.noOffline||o.user.val()?"hide":"show"](),h.data("funcexpup")&&h.data("funcexpup")()):(1===s.parent().children().length&&(o.path.parent().prev().html(i.i18n(f.pathI18n)),s.attr("title",i.i18n("offlineAccess")),s.uniqueId().after(n("<label><\/label>").attr("for",s.attr("id")).html(" "+i.i18n("offlineAccess")))),h.data("inrequest",!0).empty().addClass("elfinder-spinner").parent().find("span.elfinder-button-icon").remove(),i.request({data:{cmd:"netmount",protocol:t,host:r,user:"init",options:{id:i.id,offline:s.prop("checked")?1:0,pass:o.host[1].value}},preventDefault:!0}).done(function(n){h.removeClass("elfinder-spinner").html(n.body.replace(/\{msg:([^}]+)\}/g,function(n,t){return i.i18n(t,r)}))}),f.noOffline&&s.closest("tr").hide());this.vars.mbtn[n(o.host[1]).val()?"show":"hide"]()},done:function(i,u){var a,s=this.inputs,c=this.protocol,h=n(s.host[0]),l=n(s.host[1]),v="&nbsp;",e=this.vars,y=function(){e.oauthW&&!document.hasFocus()&&--e.chkCnt&&(c.trigger("change","winfocus"),e.tm=setTimeout(y,3e3))};if(f.noOffline&&s.offline.closest("tr").hide(),"makebtn"==u.mode)h.removeClass("elfinder-spinner").removeData("expires").removeData("funcexpup"),a=s.host.find("input").on("mouseenter mouseleave",function(){n(this).toggleClass("ui-state-hover")}),u.url&&a.on("click",function(){e.tm&&clearTimeout(e.tm);e.oauthW=window.open(u.url);(i.UA.iOS||i.UA.Mac)&&i.isCORS&&!e.chkdone&&(e.chkCnt=60,e.tm=setTimeout(y,5e3))}),l.val(""),s.path.val(f.root).next().remove(),s.user.val(""),s.pass.val(""),f.noOffline||s.offline.closest("tr").show(),e.mbtn.hide();else if("folders"==u.mode)u.folders&&o.call(this,i,s.path.nextAll(":last"),u.folders);else{if(e.oauthW&&(e.tm&&clearTimeout(e.tm),e.oauthW.close(),delete e.oauthW,e.chkdone=!0),u.expires&&(v="()",h.data("expires",u.expires)),h.html(r+v).removeClass("elfinder-spinner"),u.expires&&(h.data("funcexpup",function(){var n=Math.floor((h.data("expires")-new Date/1e3)/60);n<3?h.parent().children(".elfinder-button-icon-reload").click():(h.text(h.text().replace(/\(.*\)/,"("+i.i18n(["minsLeft",n])+")")),setTimeout(function(){h.is(":visible")&&h.data("funcexpup")()},6e4))}),h.data("funcexpup")()),u.reset)return void c.trigger("change","reset");h.parent().append(n('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+i.i18n("reAuth")+'">').on("click",function(){l.val("reauth");c.trigger("change","reset")}));l.val(t);e.mbtn.show();u.folders&&o.call(this,i,s.path,u.folders);u.mnt2res&&s.mnt2res.val("1");s.user.val("done");s.pass.val("done");s.offline.closest("tr").hide()}h.removeData("inrequest")},fail:function(){n(this.inputs.host[0]).removeData("inrequest");this.protocol.trigger("change","reset")},integrateInfo:f.integrate}},findCwdNodes:function(t,i){var u=this,f=(this.getUI("cwd"),this.cwd().hash),r=n();return i=i||{},n.each(t,function(n,t){if((t.phash===f||1<u.searchStatus.state)&&(r=r.add(u.cwdHash2Elm(t.hash)),i.firstOnly))return!1}),r},convAbsUrl:function(n){if(n.match(/^http/i))return n;if("//"===n.substr(0,2))return window.location.protocol+n;for(var i=window.location.protocol+"//"+window.location.host,r=/[^\/]+\/\.\.\//,t="/"===n.substr(0,1)?i+n:i+window.location.pathname.replace(/\/[^\/]+$/,"/")+n,t=t.replace("/./","/");r.test(t);)t=t.replace(r,"");return t},isSameOrigin:function(n){var t;if(n=this.convAbsUrl(n),location.origin&&window.URL)try{return t=new URL(n),location.origin===t.origin}catch(n){}return(t=document.createElement("a")).href=n,location.protocol===t.protocol&&location.host===t.host&&location.port&&t.port},navHash2Id:function(n){return this.navPrefix+n},navId2Hash:function(n){return"string"==typeof n&&n.substr(this.navPrefix.length)},cwdHash2Id:function(n){return this.cwdPrefix+n},cwdId2Hash:function(n){return"string"==typeof n&&n.substr(this.cwdPrefix.length)},navHash2Elm:function(t){return n(document.getElementById(this.navHash2Id(t)))},cwdHash2Elm:function(t){return n(document.getElementById(this.cwdHash2Id(t)))},isInWindow:function(n,t){var i,r;return!!(i=n.get(0))&&!(!t&&null===i.offsetParent)&&(r=i.getBoundingClientRect(),!!document.elementFromPoint(r.left,r.top))},zIndexCalc:function(){var i=this,r=this.getUI(),t=r.css("z-index");t&&"auto"!==t&&"inherit"!==t?i.zIndex=t:r.parents().each(function(t,r){var u=n(r).css("z-index");if("auto"!==u&&"inherit"!==u&&(u=parseInt(u)))return i.zIndex=u,!1})},loadScript:function(t,i,r,u){var o,f,s={dataType:"script",cache:!0},h={},e={};return(r=r||{}).tryRequire&&this.hasRequire?require(t,i,r.error):(o=function(){var t,f,o;n.each(e,function(n,t){if("success"!==t&&"notmodified"!==t)return!(o=!0)});o?r.error&&n.isFunction(r.error)&&r.error({loadResults:e}):n.isFunction(i)&&(u&&void 0===u.obj[u.name]?(t=u.timeout?u.timeout/10:1,f=setInterval(function(){(--t<0||void 0!==u.obj[u.name])&&(clearInterval(f),i())},10)):i())},"tag"===r.loadType?(n("head > script").each(function(){h[this.src]=this}),f=t.length,n.each(t,function(t,i){var u,s=!1;h[i]?(e[t]=h[i]._error||"success",--f<1&&o()):((u=document.createElement("script")).charset=r.charset||"UTF-8",n("head").append(u),u.onload=u.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,e[t]="success",--f<1&&o())},u.onerror=function(n){e[t]=u._error=n&&n.type?n.type:"error";--f<1&&o()},u.src=i)})):(r=n.isPlainObject(r)?Object.assign(s,r):s,f=0,function s(i,u){void 0!==i&&(e[f++]=u);t.length?n.ajax(Object.assign({},r,{url:t.shift(),success:s,error:s})):o()}())),this},loadCss:function(t,i){var u,r,f=this;return"string"==typeof t&&(t=[t]),i&&(i.className&&(u=i.className),i.dfd&&i.dfd.promise&&(r=[])),n.each(t,function(t,i){var e;i=f.convAbsUrl(i).replace(/^https?:/i,"");r&&(r[t]=n.Deferred());n('head > link[href="'+f.escape(i)+'"]').length?r&&r[t].resolve():((e=document.createElement("link")).type="text/css",e.rel="stylesheet",e.href=i,u&&(e.className=u),r&&(e.onload=function(){r[t].resolve()},e.onerror=function(){r[t].reject()}),n("head").append(e))}),r&&n.when.apply(null,r).done(function(){i.dfd.resolve()}).fail(function(){i.dfd.reject()}),this},asyncJob:function(t,i,r){var h,e,u=n.Deferred(),o=!1,c=Object.assign({interval:0,numPerOnce:1},r||{}),s=[],f=[],l=[];return u._abort=function(n){e&&clearTimeout(e);f=[];o=!0;"pending"===u.state()&&u[n?"resolve":"reject"](s)},u.fail(function(){u._abort()}).always(function(){u._abort=function(){}}),"function"==typeof t&&Array.isArray(i)?(f=i.concat(),h=function(){var n,i,r;if(!o){for(i=(l=f.splice(0,c.numPerOnce)).length,n=0;n<i&&!o;n++)null!==(r=t(l[n]))&&s.push(r);o||(f.length?e=setTimeout(h,c.interval):u.resolve(s))}},f.length?e=setTimeout(h,0):u.resolve(s)):u.reject(),u},getSize:function(t){var r,e,i=this,u=[],o=t.length,f=n.Deferred().fail(function(){n.each(u,function(n,t){t&&(t.syncOnFail&&t.syncOnFail(!1),t.reject())})});return i.autoSync("stop"),r=n.Deferred(),0<(e=Object.keys(i.leafRoots).length)?n.each(i.leafRoots,function(t){var f,u,o,s;f=t;u=n.Deferred();o=i.file(f);(s=o?o.phash:f)&&!i.file(s)?i.request({data:{cmd:"parents",target:s},preventFail:!0}).done(function(){i.one("parentsdone",function(){u.resolve()})}).fail(function(){u.resolve()}):u.resolve();u.done(function(){--e<1&&r.resolve()})}):r.resolve(),r.done(function(){var h=[],e={},r=[],c=[],s={};n.each(t,function(){var r,t;h.push.apply(h,(r=i.file(this),t=[],"directory"===r.mime&&n.each(i.leafRoots,function(n,u){var f;if(n===r.hash)t.push.apply(t,u);else for(f=(i.file(n)||{}).phash;f;)f===r.hash&&t.push.apply(t,u),f=(i.file(f)||{}).phash}),t))});t.push.apply(t,h);n.each(t,function(){var r=i.root(this),t=i.file(this);t&&(t.sizeInfo||"directory"!==t.mime)?c.push(n.Deferred().resolve(t.sizeInfo?t.sizeInfo:{size:t.size,dirCnt:0,fileCnt:1})):e[r]?e[r].push(this.toString()):e[r]=[this.toString()]});n.each(e,function(){var n=r.length;1===this.length&&(s[n]=this[0]);r.push(i.request({data:{cmd:"size",targets:this},preventDefault:!0}))});u.push.apply(u,r);r.push.apply(r,c);n.when.apply(n,r).fail(function(){f.reject()}).done(function(){function a(t,r){var u;(u=i.file(t))&&(u.sizeInfo={isCache:!0},n.each(["size","dirCnt","fileCnt"],function(){u.sizeInfo[this]=r[this]||0}),u.size=parseInt(u.sizeInfo.size),l.push(u))}for(var t,h=0,r=0,u=0,y=arguments.length,c=[],v="",l=[],e=0;e<y;e++)(t=arguments[e]).isCache||(s[e]&&i.file(s[e])?a(s[e],t):t.sizes&&n.isPlainObject(t.sizes)&&n.each(t.sizes,function(n,t){a(n,t)})),h+=parseInt(t.size),!1!==r&&(void 0===t.fileCnt?r=!1:r+=parseInt(t.fileCnt||0)),!1!==u&&(void 0===t.dirCnt?u=!1:u+=parseInt(t.dirCnt||0));l.length&&i.change({changed:l});!1!==u&&c.push(i.i18n("folders")+": "+(u-(1<o?0:1)));!1!==r&&c.push(i.i18n("files")+": "+r);c.length&&(v="<br>"+c.join(", "));f.resolve({size:h,fileCnt:r,dirCnt:u,formated:(0<=h?i.formatSize(h):i.i18n("unknown"))+v})});i.autoSync()}),f},wkObjUrl:null,getWorker:function(n){var t;try{this.wkObjUrl||(this.wkObjUrl=(window.URL||window.webkitURL).createObjectURL(new Blob([function(){self.onmessage=function(n){var t=n.data,i;try{if(self.data=t.data,t.scripts)for(i=0;i<t.scripts.length;i++)importScripts(t.scripts[i]);self.postMessage(self.res)}catch(n){self.postMessage({error:n.toString()})}}}.toString().replace(/\s+/g," ").replace(/ *([^\w]) */g,"$1").replace(/^function\b.+?\{|\}$/g,"")],{type:"text/javascript"})));t=new Worker(this.wkObjUrl,n)}catch(n){this.debug("error",n.toString())}return t},getWorkerUrl:function(n){return this.convAbsUrl(this.baseUrl+"js/worker/"+n)},getTheme:function(t){var i,e,f=this,r=n.Deferred(),u=function(t,i){return i=i||f.convAbsUrl(f.baseUrl),Array.isArray(t)?n.map(t,function(n){return u(n,i)}):t.match(/^(?:http|\/\/)/i)?t:i+t.replace(/^(?:\.\/|\/)/,"")};return t&&(i=f.options.themes[t])?"string"==typeof i?(url=u(i),(e=url.match(/^(.+\/)[^/]+\.json$/i))?n.getJSON(url).done(function(n){(i=n).id=t;i.cssurls&&(i.cssurls=u(i.cssurls,e[1]));r.resolve(i)}).fail(function(){r.reject()}):r.resolve({id:t,name:t,cssurls:[url]})):n.isPlainObject(i)&&i.cssurls?(i.id=t,i.cssurls=u(i.cssurls),Array.isArray(i.cssurls)||(i.cssurls=[i.cssurls]),i.name||(i.name=t),r.resolve(i)):r.reject():r.reject(),r},changeTheme:function(t){var i=this;return t&&(!i.options.themes[t]||i.theme&&i.theme.id===t?"default"===t&&i.theme&&"default"!==i.theme.id&&(n("head>link.elfinder-theme-ext").remove(),i.theme=null,i.trigger&&i.trigger("themechange")):i.getTheme(t).done(function(t){t.cssurls&&(n("head>link.elfinder-theme-ext").remove(),i.loadCss(t.cssurls,{className:"elfinder-theme-ext",dfd:n.Deferred().done(function(){i.theme=t;i.trigger&&i.trigger("themechange")})}))})),this},applyLeafRootStats:function(t,i){var u=this,f=!i&&u.file(t.hash)||t,e=f.ts,r=!1;return!i&&t._realStats||(t._realStats={locked:t.locked||0,dirs:t.dirs||0,ts:t.ts}),t.locked=1,f.locked||(r=!0),t.dirs=1,f.dirs||(r=!0),n.each(u.leafRoots[t.hash],function(){var n=u.file(this);n&&n.ts&&(t.ts||0)<n.ts&&(t.ts=n.ts)}),e!==t.ts&&(r=!0),r},abortXHR:function(n,t){var i=t||{};n&&(i.quiet&&(n.quiet=!0),i.abort&&n._requestId&&this.request({data:{cmd:"abort",id:n._requestId},preventDefault:!0}),n.abort(),n=void 0)},setCustomHeaderByXhr:function(t){var i=this;t.getResponseHeader&&i.parrotHeaders&&i.parrotHeaders.length&&n.each(i.parrotHeaders,function(n,r){var u=t.getResponseHeader(r);u?(i.customHeaders[r]=u,i.sessionStorage("core-ph:"+r,u)):"string"==typeof u&&(delete i.customHeaders[r],i.sessionStorage("core-ph:"+r,null))})},hasParrotHeaders:function(){var t=!1,i=this.parrotHeaders,n;if(Object.keys(this.customHeaders).length)for(n=0;n<i.length;n++)if(this.customHeaders[i[n]]){t=!0;break}return t},getRequestId:function(){return(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16)},arrayFlip:function(t,i){var r,u={},f=n.isArray(t);for(r in t)(f||t.hasOwnProperty(r))&&(u[t[r]]=i||r);return u},splitFileExtention:function(n){var t;return(t=n.match(/^(.+?)?\.((?:tar\.(?:gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(?:gz|bz2)|[a-z0-9]{1,10})$/i))?(void 0===t[1]&&(t[1]=""),[t[1],t[2]]):[n,""]},sliceArrayBuffer:function(n,t){for(var r=[],i=0;i*t<n.byteLength;)r.push(n.slice(i*t,(i+1)*t)),i++;return r},arrayBufferToBase64:function(n){if(!window.btoa)return"";var t=new Uint8Array(n),i=Array.prototype.slice.call(t).map(function(n){return String.fromCharCode(n)});return window.btoa(i.join(""))},log:function(n){return window.console&&window.console.log&&window.console.log(n),this},debug:function(t,i){var f,e,o=this,r=this.options.debug,u=this.options.toastBackendWarn;return"backend-error"===t?this.cwd().hash&&(!r||"all"!==r&&!r["backend-error"])||(i=Array.isArray(i)?i:[i],this.error(i)):"backend-warning"===t?(e=!0,u&&(f=n.isPlainObject(u)?u:{},n.each(Array.isArray(i)?i:[i],function(n,t){o.toast(Object.assign({mode:"warning",msg:t},f))}))):"backend-debug"===t&&this.trigger("backenddebug",i),(e||r&&("all"===r||r[t]))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+t+"] ["+this.id+"]",i),this},responseDebug:function(n){var i,t=n.debug;t&&((i=this.options.debug)&&"all"===i||((i=i||(this.options.debug={}))["backend-error"]=!0,i.warning=!0),t.mountErrors&&("string"==typeof t.mountErrors||Array.isArray(t.mountErrors)&&t.mountErrors.length)&&this.debug("backend-error",t.mountErrors),t.backendErrors&&("string"==typeof t.backendErrors||Array.isArray(t.backendErrors)&&t.backendErrors.length)&&this.debug("backend-warning",t.backendErrors))},time:function(n){window.console&&window.console.time&&window.console.time(n)},timeEnd:function(n){window.console&&window.console.timeEnd&&window.console.timeEnd(n)}},Object.keys||(Object.keys=(v=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),k=(y=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(n){var i,r,t;if("object"!=typeof n&&"function"!=typeof n||null===n)throw new TypeError("Object.keys called on non-object");i=[];for(r in n)v.call(n,r)&&i.push(r);if(b)for(t=0;t<k;t++)v.call(n,y[t])&&i.push(y[t]);return i})),Array.isArray||(Array.isArray=function(n){return jQuery.isArray(n)}),Object.assign||(Object.assign=function(){return jQuery.extend.apply(null,arguments)}),String.prototype.repeat||(String.prototype.repeat=function(n){"use strict";var t,i,r;if(null==this)throw new TypeError("can't convert "+this+" to object");if(t=""+this,(n=+n)!=n&&(n=0),n<0)throw new RangeError("repeat count must be non-negative");if(n==1/0)throw new RangeError("repeat count must be less than infinity");if(n=Math.floor(n),0==t.length||0==n)return"";if(268435456<=t.length*n)throw new RangeError("repeat count must not overflow maximum string size");for(i="",r=0;r<n;r++)i+=t;return i}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){try{return Array.apply(null,{})}catch(r){}var n=Object.prototype.toString,t=Function.prototype.apply,i=Array.prototype.slice;Function.prototype.apply=function(r,u){return t.call(this,r,"[object Array]"===n.call(u)?u:i.call(u))}}(),Array.from||(Array.from=function(n){return 1===n.length?[n[0]]:Array.apply(null,n)}),window.cancelAnimationFrame||function(){for(var i=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}(),r.prototype.version="2.1.57",n.ui&&n.ui.ddmanager&&(d=n.ui.ddmanager.prepareOffsets,n.ui.ddmanager.prepareOffsets=function(t,i){function e(n){if(n.is(":hidden"))return!0;var t=n[0].getBoundingClientRect();return!document.elementFromPoint(t.left,t.top)&&!document.elementFromPoint(t.left+t.width,t.top+t.height)}if("mousedown"===i.type||t.options.elfRefresh)for(var r,f=n.ui.ddmanager.droppables[t.options.scope]||[],o=f.length,u=0;u<o;u++)(r=f[u]).options.autoDisable&&(!r.options.disabled||1<r.options.autoDisable)&&(r.options.disabled=e(r.element),r.options.autoDisable=r.options.disabled?2:1);return d(t,i)}),window.jQuery.ajaxTransport("+binary",function(n){var t;if(window.FormData&&(n.dataType&&"binary"==n.dataType||n.data&&(window.ArrayBuffer&&n.data instanceof ArrayBuffer||window.Blob&&n.data instanceof Blob)))return{send:function(i,r){var f,e=n.responseType||"blob",u=n.xhr();if(u.open(n.type,n.url,n.async,n.username,n.password),n.xhrFields)for(f in n.xhrFields)u[f]=n.xhrFields[f];for(f in n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)u.setRequestHeader(f,i[f]);t=function(i){return function(){var f;t&&(t=u.onload=u.onerror=u.onabort=u.ontimeout=null,"abort"===i?u.abort():"error"===i?r(u.status,u.statusText):((f={})[n.dataType]=u.response,r(u.status,u.statusText,f,u.getAllResponseHeaders())))}};u.onload=t();u.onabort=u.onerror=u.ontimeout=t("error");t=t("abort");try{u.responseType=e;u.send(n.data||null)}catch(i){if(t)throw i;}},abort:function(){t&&t()}}}),(u=jQuery).support.touch="ontouchend"in document,u.support.touch&&(e=u.ui.mouse.prototype,g=e._mouseInit,nt=e._mouseDestroy,e._touchStart=function(n){!s&&this._mouseCapture(n.originalEvent.changedTouches[0])&&(tt=n.originalEvent.changedTouches[0].screenX.toFixed(0),it=n.originalEvent.changedTouches[0].screenY.toFixed(0),s=!0,this._touchMoved=!1,o(n,"mouseover"),o(n,"mousemove"),o(n,"mousedown"))},e._touchMove=function(n){var t,i;s&&(t=n.originalEvent.changedTouches[0].screenX.toFixed(0),i=n.originalEvent.changedTouches[0].screenY.toFixed(0),Math.abs(tt-t)<=4&&Math.abs(it-i)<=4||(this._touchMoved=!0,o(n,"mousemove")))},e._touchEnd=function(n){s&&(o(n,"mouseup"),o(n,"mouseout"),this._touchMoved||o(n,"click"),s=!1,this._touchMoved=!1)},e._mouseInit=function(){var n=this;n.element.hasClass("touch-punch")&&n.element.on({touchstart:u.proxy(n,"_touchStart"),touchmove:u.proxy(n,"_touchMove"),touchend:u.proxy(n,"_touchEnd")});g.call(n)},e._mouseDestroy=function(){var n=this;n.element.hasClass("touch-punch")&&n.element.off({touchstart:u.proxy(n,"_touchStart"),touchmove:u.proxy(n,"_touchMove"),touchend:u.proxy(n,"_touchEnd")});nt.call(n)}),n.fn.elfinder=function(t,i){return"instance"===t?this.getElFinder():this.each(function(){var e,o="string"==typeof t?t:"",f="function"==typeof i?i:void 0,u=this.elfinder;if(u)switch(o){case"close":case"hide":u.hide();break;case"open":case"show":u.show();break;case"destroy":u.destroy();break;case"reload":case"restart":u&&(e=n.extend(!0,u.options,n.isPlainObject(i)?i:{}),f=u.bootCallback,u.reloadCallback&&n.isFunction(u.reloadCallback)?u.reloadCallback(e,f):(u.destroy(),new r(this,e,f)))}else n.isPlainObject(t)&&new r(this,t,f)})},n.fn.getElFinder=function(){var n;return this.each(function(){if(this.elfinder)return n=this.elfinder,!1}),n},n.fn.elfUiWidgetInstance=function(n){try{return this[n]("instance")}catch(i){var t=this.data("ui-"+n);return t&&"object"==typeof t&&t.widgetFullName==="ui-"+n?t:null}},n.fn.scrollRight||n.fn.extend({scrollRight:function(n){var t=this.get(0);return void 0===n?Math.max(0,t.scrollWidth-(t.scrollLeft+t.clientWidth)):this.scrollLeft(t.scrollWidth-t.clientWidth-n)}}),n.fn.scrollBottom||n.fn.extend({scrollBottom:function(n){var t=this.get(0);return void 0===n?Math.max(0,t.scrollHeight-(t.scrollTop+t.clientHeight)):this.scrollTop(t.scrollHeight-t.clientHeight-n)}}),r.prototype.mimeTypes={"application/x-executable":"exe","application/x-jar":"jar","application/x-gzip":"gz","application/x-bzip2":"tbz","application/x-rar":"rar","text/x-php":"php","text/javascript":"js","application/rtfd":"rtfd","text/x-python":"py","text/x-ruby":"rb","text/x-shellscript":"sh","text/x-perl":"pl","text/xml":"xml","text/x-csrc":"c","text/x-chdr":"h","text/x-c++src":"cpp","text/x-c++hdr":"hh","text/x-markdown":"md","text/x-yaml":"yml","image/x-ms-bmp":"bmp","image/x-targa":"tga","image/xbm":"xbm","image/pxm":"pxm","audio/wav":"wav","video/x-dv":"dv","video/x-ms-wmv":"wm","video/ogg":"ogm","video/MP2T":"m2ts","application/x-mpegURL":"m3u8","application/dash+xml":"mpd","application/andrew-inset":"ez","application/applixware":"aw","application/atom+xml":"atom","application/atomcat+xml":"atomcat","application/atomsvc+xml":"atomsvc","application/ccxml+xml":"ccxml","application/cdmi-capability":"cdmia","application/cdmi-container":"cdmic","application/cdmi-domain":"cdmid","application/cdmi-object":"cdmio","application/cdmi-queue":"cdmiq","application/cu-seeme":"cu","application/davmount+xml":"davmount","application/docbook+xml":"dbk","application/dssc+der":"dssc","application/dssc+xml":"xdssc","application/ecmascript":"ecma","application/emma+xml":"emma","application/epub+zip":"epub","application/exi":"exi","application/font-tdpfr":"pfr","application/gml+xml":"gml","application/gpx+xml":"gpx","application/gxf":"gxf","application/hyperstudio":"stk","application/inkml+xml":"ink","application/ipfix":"ipfix","application/java-serialized-object":"ser","application/java-vm":"class","application/json":"json","application/jsonml+json":"jsonml","application/lost+xml":"lostxml","application/mac-binhex40":"hqx","application/mac-compactpro":"cpt","application/mads+xml":"mads","application/marc":"mrc","application/marcxml+xml":"mrcx","application/mathematica":"ma","application/mathml+xml":"mathml","application/mbox":"mbox","application/mediaservercontrol+xml":"mscml","application/metalink+xml":"metalink","application/metalink4+xml":"meta4","application/mets+xml":"mets","application/mods+xml":"mods","application/mp21":"m21","application/mp4":"mp4s","application/msword":"doc","application/mxf":"mxf","application/octet-stream":"bin","application/oda":"oda","application/oebps-package+xml":"opf","application/ogg":"ogx","application/omdoc+xml":"omdoc","application/onenote":"onetoc","application/oxps":"oxps","application/patch-ops-error+xml":"xer","application/pdf":"pdf","application/pgp-encrypted":"pgp","application/pgp-signature":"asc","application/pics-rules":"prf","application/pkcs10":"p10","application/pkcs7-mime":"p7m","application/pkcs7-signature":"p7s","application/pkcs8":"p8","application/pkix-attr-cert":"ac","application/pkix-cert":"cer","application/pkix-crl":"crl","application/pkix-pkipath":"pkipath","application/pkixcmp":"pki","application/pls+xml":"pls","application/postscript":"ai","application/prs.cww":"cww","application/pskc+xml":"pskcxml","application/rdf+xml":"rdf","application/reginfo+xml":"rif","application/relax-ng-compact-syntax":"rnc","application/resource-lists+xml":"rl","application/resource-lists-diff+xml":"rld","application/rls-services+xml":"rs","application/rpki-ghostbusters":"gbr","application/rpki-manifest":"mft","application/rpki-roa":"roa","application/rsd+xml":"rsd","application/rss+xml":"rss","application/rtf":"rtf","application/sbml+xml":"sbml","application/scvp-cv-request":"scq","application/scvp-cv-response":"scs","application/scvp-vp-request":"spq","application/scvp-vp-response":"spp","application/sdp":"sdp","application/set-payment-initiation":"setpay","application/set-registration-initiation":"setreg","application/shf+xml":"shf","application/smil+xml":"smi","application/sparql-query":"rq","application/sparql-results+xml":"srx","application/srgs":"gram","application/srgs+xml":"grxml","application/sru+xml":"sru","application/ssdl+xml":"ssdl","application/ssml+xml":"ssml","application/tei+xml":"tei","application/thraud+xml":"tfi","application/timestamped-data":"tsd","application/vnd.3gpp.pic-bw-large":"plb","application/vnd.3gpp.pic-bw-small":"psb","application/vnd.3gpp.pic-bw-var":"pvb","application/vnd.3gpp2.tcap":"tcap","application/vnd.3m.post-it-notes":"pwn","application/vnd.accpac.simply.aso":"aso","application/vnd.accpac.simply.imp":"imp","application/vnd.acucobol":"acu","application/vnd.acucorp":"atc","application/vnd.adobe.air-application-installer-package+zip":"air","application/vnd.adobe.formscentral.fcdt":"fcdt","application/vnd.adobe.fxp":"fxp","application/vnd.adobe.xdp+xml":"xdp","application/vnd.adobe.xfdf":"xfdf","application/vnd.ahead.space":"ahead","application/vnd.airzip.filesecure.azf":"azf","application/vnd.airzip.filesecure.azs":"azs","application/vnd.amazon.ebook":"azw","application/vnd.americandynamics.acc":"acc","application/vnd.amiga.ami":"ami","application/vnd.android.package-archive":"apk","application/vnd.anser-web-certificate-issue-initiation":"cii","application/vnd.anser-web-funds-transfer-initiation":"fti","application/vnd.antix.game-component":"atx","application/vnd.apple.installer+xml":"mpkg","application/vnd.aristanetworks.swi":"swi","application/vnd.astraea-software.iota":"iota","application/vnd.audiograph":"aep","application/vnd.blueice.multipass":"mpm","application/vnd.bmi":"bmi","application/vnd.businessobjects":"rep","application/vnd.chemdraw+xml":"cdxml","application/vnd.chipnuts.karaoke-mmd":"mmd","application/vnd.cinderella":"cdy","application/vnd.claymore":"cla","application/vnd.cloanto.rp9":"rp9","application/vnd.clonk.c4group":"c4g","application/vnd.cluetrust.cartomobile-config":"c11amc","application/vnd.cluetrust.cartomobile-config-pkg":"c11amz","application/vnd.commonspace":"csp","application/vnd.contact.cmsg":"cdbcmsg","application/vnd.cosmocaller":"cmc","application/vnd.crick.clicker":"clkx","application/vnd.crick.clicker.keyboard":"clkk","application/vnd.crick.clicker.palette":"clkp","application/vnd.crick.clicker.template":"clkt","application/vnd.crick.clicker.wordbank":"clkw","application/vnd.criticaltools.wbs+xml":"wbs","application/vnd.ctc-posml":"pml","application/vnd.cups-ppd":"ppd","application/vnd.curl.car":"car","application/vnd.curl.pcurl":"pcurl","application/vnd.dart":"dart","application/vnd.data-vision.rdz":"rdz","application/vnd.dece.data":"uvf","application/vnd.dece.ttml+xml":"uvt","application/vnd.dece.unspecified":"uvx","application/vnd.dece.zip":"uvz","application/vnd.denovo.fcselayout-link":"fe_launch","application/vnd.dna":"dna","application/vnd.dolby.mlp":"mlp","application/vnd.dpgraph":"dpg","application/vnd.dreamfactory":"dfac","application/vnd.ds-keypoint":"kpxx","application/vnd.dvb.ait":"ait","application/vnd.dvb.service":"svc","application/vnd.dynageo":"geo","application/vnd.ecowin.chart":"mag","application/vnd.enliven":"nml","application/vnd.epson.esf":"esf","application/vnd.epson.msf":"msf","application/vnd.epson.quickanime":"qam","application/vnd.epson.salt":"slt","application/vnd.epson.ssf":"ssf","application/vnd.eszigno3+xml":"es3","application/vnd.ezpix-album":"ez2","application/vnd.ezpix-package":"ez3","application/vnd.fdf":"fdf","application/vnd.fdsn.mseed":"mseed","application/vnd.fdsn.seed":"seed","application/vnd.flographit":"gph","application/vnd.fluxtime.clip":"ftc","application/vnd.framemaker":"fm","application/vnd.frogans.fnc":"fnc","application/vnd.frogans.ltf":"ltf","application/vnd.fsc.weblaunch":"fsc","application/vnd.fujitsu.oasys":"oas","application/vnd.fujitsu.oasys2":"oa2","application/vnd.fujitsu.oasys3":"oa3","application/vnd.fujitsu.oasysgp":"fg5","application/vnd.fujitsu.oasysprs":"bh2","application/vnd.fujixerox.ddd":"ddd","application/vnd.fujixerox.docuworks":"xdw","application/vnd.fujixerox.docuworks.binder":"xbd","application/vnd.fuzzysheet":"fzs","application/vnd.genomatix.tuxedo":"txd","application/vnd.geogebra.file":"ggb","application/vnd.geogebra.tool":"ggt","application/vnd.geometry-explorer":"gex","application/vnd.geonext":"gxt","application/vnd.geoplan":"g2w","application/vnd.geospace":"g3w","application/vnd.gmx":"gmx","application/vnd.google-earth.kml+xml":"kml","application/vnd.google-earth.kmz":"kmz","application/vnd.grafeq":"gqf","application/vnd.groove-account":"gac","application/vnd.groove-help":"ghf","application/vnd.groove-identity-message":"gim","application/vnd.groove-injector":"grv","application/vnd.groove-tool-message":"gtm","application/vnd.groove-tool-template":"tpl","application/vnd.groove-vcard":"vcg","application/vnd.hal+xml":"hal","application/vnd.handheld-entertainment+xml":"zmm","application/vnd.hbci":"hbci","application/vnd.hhe.lesson-player":"les","application/vnd.hp-hpgl":"hpgl","application/vnd.hp-hpid":"hpid","application/vnd.hp-hps":"hps","application/vnd.hp-jlyt":"jlt","application/vnd.hp-pcl":"pcl","application/vnd.hp-pclxl":"pclxl","application/vnd.hydrostatix.sof-data":"sfd-hdstx","application/vnd.ibm.minipay":"mpy","application/vnd.ibm.modcap":"afp","application/vnd.ibm.rights-management":"irm","application/vnd.ibm.secure-container":"sc","application/vnd.iccprofile":"icc","application/vnd.igloader":"igl","application/vnd.immervision-ivp":"ivp","application/vnd.immervision-ivu":"ivu","application/vnd.insors.igm":"igm","application/vnd.intercon.formnet":"xpw","application/vnd.intergeo":"i2g","application/vnd.intu.qbo":"qbo","application/vnd.intu.qfx":"qfx","application/vnd.ipunplugged.rcprofile":"rcprofile","application/vnd.irepository.package+xml":"irp","application/vnd.is-xpr":"xpr","application/vnd.isac.fcs":"fcs","application/vnd.jam":"jam","application/vnd.jcp.javame.midlet-rms":"rms","application/vnd.jisp":"jisp","application/vnd.joost.joda-archive":"joda","application/vnd.kahootz":"ktz","application/vnd.kde.karbon":"karbon","application/vnd.kde.kchart":"chrt","application/vnd.kde.kformula":"kfo","application/vnd.kde.kivio":"flw","application/vnd.kde.kontour":"kon","application/vnd.kde.kpresenter":"kpr","application/vnd.kde.kspread":"ksp","application/vnd.kde.kword":"kwd","application/vnd.kenameaapp":"htke","application/vnd.kidspiration":"kia","application/vnd.kinar":"kne","application/vnd.koan":"skp","application/vnd.kodak-descriptor":"sse","application/vnd.las.las+xml":"lasxml","application/vnd.llamagraphics.life-balance.desktop":"lbd","application/vnd.llamagraphics.life-balance.exchange+xml":"lbe","application/vnd.lotus-1-2-3":123,"application/vnd.lotus-approach":"apr","application/vnd.lotus-freelance":"pre","application/vnd.lotus-notes":"nsf","application/vnd.lotus-organizer":"org","application/vnd.lotus-screencam":"scm","application/vnd.lotus-wordpro":"lwp","application/vnd.macports.portpkg":"portpkg","application/vnd.mcd":"mcd","application/vnd.medcalcdata":"mc1","application/vnd.mediastation.cdkey":"cdkey","application/vnd.mfer":"mwf","application/vnd.mfmp":"mfm","application/vnd.micrografx.flo":"flo","application/vnd.micrografx.igx":"igx","application/vnd.mif":"mif","application/vnd.mobius.daf":"daf","application/vnd.mobius.dis":"dis","application/vnd.mobius.mbk":"mbk","application/vnd.mobius.mqy":"mqy","application/vnd.mobius.msl":"msl","application/vnd.mobius.plc":"plc","application/vnd.mobius.txf":"txf","application/vnd.mophun.application":"mpn","application/vnd.mophun.certificate":"mpc","application/vnd.mozilla.xul+xml":"xul","application/vnd.ms-artgalry":"cil","application/vnd.ms-cab-compressed":"cab","application/vnd.ms-excel":"xls","application/vnd.ms-excel.addin.macroenabled.12":"xlam","application/vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","application/vnd.ms-excel.sheet.macroenabled.12":"xlsm","application/vnd.ms-excel.template.macroenabled.12":"xltm","application/vnd.ms-fontobject":"eot","application/vnd.ms-htmlhelp":"chm","application/vnd.ms-ims":"ims","application/vnd.ms-lrm":"lrm","application/vnd.ms-officetheme":"thmx","application/vnd.ms-pki.seccat":"cat","application/vnd.ms-pki.stl":"stl","application/vnd.ms-powerpoint":"ppt","application/vnd.ms-powerpoint.addin.macroenabled.12":"ppam","application/vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","application/vnd.ms-powerpoint.slide.macroenabled.12":"sldm","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","application/vnd.ms-powerpoint.template.macroenabled.12":"potm","application/vnd.ms-project":"mpp","application/vnd.ms-word.document.macroenabled.12":"docm","application/vnd.ms-word.template.macroenabled.12":"dotm","application/vnd.ms-works":"wps","application/vnd.ms-wpl":"wpl","application/vnd.ms-xpsdocument":"xps","application/vnd.mseq":"mseq","application/vnd.musician":"mus","application/vnd.muvee.style":"msty","application/vnd.mynfc":"taglet","application/vnd.neurolanguage.nlu":"nlu","application/vnd.nitf":"ntf","application/vnd.noblenet-directory":"nnd","application/vnd.noblenet-sealer":"nns","application/vnd.noblenet-web":"nnw","application/vnd.nokia.n-gage.data":"ngdat","application/vnd.nokia.n-gage.symbian.install":"n-gage","application/vnd.nokia.radio-preset":"rpst","application/vnd.nokia.radio-presets":"rpss","application/vnd.novadigm.edm":"edm","application/vnd.novadigm.edx":"edx","application/vnd.novadigm.ext":"ext","application/vnd.oasis.opendocument.chart":"odc","application/vnd.oasis.opendocument.chart-template":"otc","application/vnd.oasis.opendocument.database":"odb","application/vnd.oasis.opendocument.formula":"odf","application/vnd.oasis.opendocument.formula-template":"odft","application/vnd.oasis.opendocument.graphics":"odg","application/vnd.oasis.opendocument.graphics-template":"otg","application/vnd.oasis.opendocument.image":"odi","application/vnd.oasis.opendocument.image-template":"oti","application/vnd.oasis.opendocument.presentation":"odp","application/vnd.oasis.opendocument.presentation-template":"otp","application/vnd.oasis.opendocument.spreadsheet":"ods","application/vnd.oasis.opendocument.spreadsheet-template":"ots","application/vnd.oasis.opendocument.text":"odt","application/vnd.oasis.opendocument.text-master":"odm","application/vnd.oasis.opendocument.text-template":"ott","application/vnd.oasis.opendocument.text-web":"oth","application/vnd.olpc-sugar":"xo","application/vnd.oma.dd2+xml":"dd2","application/vnd.openofficeorg.extension":"oxt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slide":"sldx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","application/vnd.openxmlformats-officedocument.presentationml.template":"potx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","application/vnd.osgeo.mapguide.package":"mgp","application/vnd.osgi.dp":"dp","application/vnd.osgi.subsystem":"esa","application/vnd.palm":"pdb","application/vnd.pawaafile":"paw","application/vnd.pg.format":"str","application/vnd.pg.osasli":"ei6","application/vnd.picsel":"efif","application/vnd.pmi.widget":"wg","application/vnd.pocketlearn":"plf","application/vnd.powerbuilder6":"pbd","application/vnd.previewsystems.box":"box","application/vnd.proteus.magazine":"mgz","application/vnd.publishare-delta-tree":"qps","application/vnd.pvi.ptid1":"ptid","application/vnd.quark.quarkxpress":"qxd","application/vnd.realvnc.bed":"bed","application/vnd.recordare.musicxml":"mxl","application/vnd.recordare.musicxml+xml":"musicxml","application/vnd.rig.cryptonote":"cryptonote","application/vnd.rim.cod":"cod","application/vnd.rn-realmedia":"rm","application/vnd.rn-realmedia-vbr":"rmvb","application/vnd.route66.link66+xml":"link66","application/vnd.sailingtracker.track":"st","application/vnd.seemail":"see","application/vnd.sema":"sema","application/vnd.semd":"semd","application/vnd.semf":"semf","application/vnd.shana.informed.formdata":"ifm","application/vnd.shana.informed.formtemplate":"itp","application/vnd.shana.informed.interchange":"iif","application/vnd.shana.informed.package":"ipk","application/vnd.simtech-mindmapper":"twd","application/vnd.smaf":"mmf","application/vnd.smart.teacher":"teacher","application/vnd.solent.sdkm+xml":"sdkm","application/vnd.spotfire.dxp":"dxp","application/vnd.spotfire.sfs":"sfs","application/vnd.stardivision.calc":"sdc","application/vnd.stardivision.draw":"sda","application/vnd.stardivision.impress":"sdd","application/vnd.stardivision.math":"smf","application/vnd.stardivision.writer":"sdw","application/vnd.stardivision.writer-global":"sgl","application/vnd.stepmania.package":"smzip","application/vnd.stepmania.stepchart":"sm","application/vnd.sun.xml.calc":"sxc","application/vnd.sun.xml.calc.template":"stc","application/vnd.sun.xml.draw":"sxd","application/vnd.sun.xml.draw.template":"std","application/vnd.sun.xml.impress":"sxi","application/vnd.sun.xml.impress.template":"sti","application/vnd.sun.xml.math":"sxm","application/vnd.sun.xml.writer":"sxw","application/vnd.sun.xml.writer.global":"sxg","application/vnd.sun.xml.writer.template":"stw","application/vnd.sus-calendar":"sus","application/vnd.svd":"svd","application/vnd.symbian.install":"sis","application/vnd.syncml+xml":"xsm","application/vnd.syncml.dm+wbxml":"bdm","application/vnd.syncml.dm+xml":"xdm","application/vnd.tao.intent-module-archive":"tao","application/vnd.tcpdump.pcap":"pcap","application/vnd.tmobile-livetv":"tmo","application/vnd.trid.tpt":"tpt","application/vnd.triscape.mxs":"mxs","application/vnd.trueapp":"tra","application/vnd.ufdl":"ufd","application/vnd.uiq.theme":"utz","application/vnd.umajin":"umj","application/vnd.unity":"unityweb","application/vnd.uoml+xml":"uoml","application/vnd.vcx":"vcx","application/vnd.visio":"vsd","application/vnd.visionary":"vis","application/vnd.vsf":"vsf","application/vnd.wap.wbxml":"wbxml","application/vnd.wap.wmlc":"wmlc","application/vnd.wap.wmlscriptc":"wmlsc","application/vnd.webturbo":"wtb","application/vnd.wolfram.player":"nbp","application/vnd.wordperfect":"wpd","application/vnd.wqd":"wqd","application/vnd.wt.stf":"stf","application/vnd.xara":"xar","application/vnd.xfdl":"xfdl","application/vnd.yamaha.hv-dic":"hvd","application/vnd.yamaha.hv-script":"hvs","application/vnd.yamaha.hv-voice":"hvp","application/vnd.yamaha.openscoreformat":"osf","application/vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","application/vnd.yamaha.smaf-audio":"saf","application/vnd.yamaha.smaf-phrase":"spf","application/vnd.yellowriver-custom-menu":"cmp","application/vnd.zul":"zir","application/vnd.zzazz.deck+xml":"zaz","application/voicexml+xml":"vxml","application/widget":"wgt","application/winhlp":"hlp","application/wsdl+xml":"wsdl","application/wspolicy+xml":"wspolicy","application/x-7z-compressed":"7z","application/x-abiword":"abw","application/x-ace-compressed":"ace","application/x-apple-diskimage":"dmg","application/x-authorware-bin":"aab","application/x-authorware-map":"aam","application/x-authorware-seg":"aas","application/x-bcpio":"bcpio","application/x-bittorrent":"torrent","application/x-blorb":"blb","application/x-bzip":"bz","application/x-cbr":"cbr","application/x-cdlink":"vcd","application/x-cfs-compressed":"cfs","application/x-chat":"chat","application/x-chess-pgn":"pgn","application/x-conference":"nsc","application/x-cpio":"cpio","application/x-csh":"csh","application/x-debian-package":"deb","application/x-dgc-compressed":"dgc","application/x-director":"dir","application/x-doom":"wad","application/x-dtbncx+xml":"ncx","application/x-dtbook+xml":"dtb","application/x-dtbresource+xml":"res","application/x-dvi":"dvi","application/x-envoy":"evy","application/x-eva":"eva","application/x-font-bdf":"bdf","application/x-font-ghostscript":"gsf","application/x-font-linux-psf":"psf","application/x-font-pcf":"pcf","application/x-font-snf":"snf","application/x-font-type1":"pfa","application/x-freearc":"arc","application/x-futuresplash":"spl","application/x-gca-compressed":"gca","application/x-glulx":"ulx","application/x-gnumeric":"gnumeric","application/x-gramps-xml":"gramps","application/x-gtar":"gtar","application/x-hdf":"hdf","application/x-install-instructions":"install","application/x-iso9660-image":"iso","application/x-java-jnlp-file":"jnlp","application/x-latex":"latex","application/x-lzh-compressed":"lzh","application/x-mie":"mie","application/x-mobipocket-ebook":"prc","application/x-ms-application":"application","application/x-ms-shortcut":"lnk","application/x-ms-wmd":"wmd","application/x-ms-wmz":"wmz","application/x-ms-xbap":"xbap","application/x-msaccess":"mdb","application/x-msbinder":"obd","application/x-mscardfile":"crd","application/x-msclip":"clp","application/x-msdownload":"dll","application/x-msmediaview":"mvb","application/x-msmetafile":"wmf","application/x-msmoney":"mny","application/x-mspublisher":"pub","application/x-msschedule":"scd","application/x-msterminal":"trm","application/x-mswrite":"wri","application/x-netcdf":"nc","application/x-nzb":"nzb","application/x-pkcs12":"p12","application/x-pkcs7-certificates":"p7b","application/x-pkcs7-certreqresp":"p7r","application/x-research-info-systems":"ris","application/x-shar":"shar","application/x-shockwave-flash":"swf","application/x-silverlight-app":"xap","application/x-sql":"sql","application/x-stuffit":"sit","application/x-stuffitx":"sitx","application/x-subrip":"srt","application/x-sv4cpio":"sv4cpio","application/x-sv4crc":"sv4crc","application/x-t3vm-image":"t3","application/x-tads":"gam","application/x-tar":"tar","application/x-tcl":"tcl","application/x-tex":"tex","application/x-tex-tfm":"tfm","application/x-texinfo":"texinfo","application/x-tgif":"obj","application/x-ustar":"ustar","application/x-wais-source":"src","application/x-x509-ca-cert":"der","application/x-xfig":"fig","application/x-xliff+xml":"xlf","application/x-xpinstall":"xpi","application/x-xz":"xz","application/x-zmachine":"z1","application/xaml+xml":"xaml","application/xcap-diff+xml":"xdf","application/xenc+xml":"xenc","application/xhtml+xml":"xhtml","application/xml":"xsl","application/xml-dtd":"dtd","application/xop+xml":"xop","application/xproc+xml":"xpl","application/xslt+xml":"xslt","application/xspf+xml":"xspf","application/xv+xml":"mxml","application/yang":"yang","application/yin+xml":"yin","application/zip":"zip","audio/adpcm":"adp","audio/basic":"au","audio/midi":"mid","audio/mp4":"m4a","audio/mpeg":"mpga","audio/ogg":"oga","audio/s3m":"s3m","audio/silk":"sil","audio/vnd.dece.audio":"uva","audio/vnd.digital-winds":"eol","audio/vnd.dra":"dra","audio/vnd.dts":"dts","audio/vnd.dts.hd":"dtshd","audio/vnd.lucent.voice":"lvp","audio/vnd.ms-playready.media.pya":"pya","audio/vnd.nuera.ecelp4800":"ecelp4800","audio/vnd.nuera.ecelp7470":"ecelp7470","audio/vnd.nuera.ecelp9600":"ecelp9600","audio/vnd.rip":"rip","audio/webm":"weba","audio/x-aac":"aac","audio/x-aiff":"aif","audio/x-caf":"caf","audio/x-flac":"flac","audio/x-matroska":"mka","audio/x-mpegurl":"m3u","audio/x-ms-wax":"wax","audio/x-ms-wma":"wma","audio/x-pn-realaudio":"ram","audio/x-pn-realaudio-plugin":"rmp","audio/xm":"xm","chemical/x-cdx":"cdx","chemical/x-cif":"cif","chemical/x-cmdf":"cmdf","chemical/x-cml":"cml","chemical/x-csml":"csml","chemical/x-xyz":"xyz","font/collection":"ttc","font/otf":"otf","font/ttf":"ttf","font/woff":"woff","font/woff2":"woff2","image/cgm":"cgm","image/g3fax":"g3","image/gif":"gif","image/ief":"ief","image/jpeg":"jpeg","image/ktx":"ktx","image/png":"png","image/prs.btif":"btif","image/sgi":"sgi","image/svg+xml":"svg","image/tiff":"tiff","image/vnd.adobe.photoshop":"psd","image/vnd.dece.graphic":"uvi","image/vnd.djvu":"djvu","image/vnd.dvb.subtitle":"sub","image/vnd.dwg":"dwg","image/vnd.dxf":"dxf","image/vnd.fastbidsheet":"fbs","image/vnd.fpx":"fpx","image/vnd.fst":"fst","image/vnd.fujixerox.edmics-mmr":"mmr","image/vnd.fujixerox.edmics-rlc":"rlc","image/vnd.ms-modi":"mdi","image/vnd.ms-photo":"wdp","image/vnd.net-fpx":"npx","image/vnd.wap.wbmp":"wbmp","image/vnd.xiff":"xif","image/webp":"webp","image/x-3ds":"3ds","image/x-cmu-raster":"ras","image/x-cmx":"cmx","image/x-freehand":"fh","image/x-icon":"ico","image/x-mrsid-image":"sid","image/x-pcx":"pcx","image/x-pict":"pic","image/x-portable-anymap":"pnm","image/x-portable-bitmap":"pbm","image/x-portable-graymap":"pgm","image/x-portable-pixmap":"ppm","image/x-rgb":"rgb","image/x-xpixmap":"xpm","image/x-xwindowdump":"xwd","message/rfc822":"eml","model/iges":"igs","model/mesh":"msh","model/vnd.collada+xml":"dae","model/vnd.dwf":"dwf","model/vnd.gdl":"gdl","model/vnd.gtw":"gtw","model/vnd.vtu":"vtu","model/vrml":"wrl","model/x3d+binary":"x3db","model/x3d+vrml":"x3dv","model/x3d+xml":"x3d","text/cache-manifest":"appcache","text/calendar":"ics","text/css":"css","text/csv":"csv","text/html":"html","text/n3":"n3","text/plain":"txt","text/prs.lines.tag":"dsc","text/richtext":"rtx","text/sgml":"sgml","text/tab-separated-values":"tsv","text/troff":"t","text/turtle":"ttl","text/uri-list":"uri","text/vcard":"vcard","text/vnd.curl":"curl","text/vnd.curl.dcurl":"dcurl","text/vnd.curl.mcurl":"mcurl","text/vnd.curl.scurl":"scurl","text/vnd.fly":"fly","text/vnd.fmi.flexstor":"flx","text/vnd.graphviz":"gv","text/vnd.in3d.3dml":"3dml","text/vnd.in3d.spot":"spot","text/vnd.sun.j2me.app-descriptor":"jad","text/vnd.wap.wml":"wml","text/vnd.wap.wmlscript":"wmls","text/x-asm":"s","text/x-c":"cc","text/x-fortran":"f","text/x-java-source":"java","text/x-nfo":"nfo","text/x-opml":"opml","text/x-pascal":"p","text/x-setext":"etx","text/x-sfv":"sfv","text/x-uuencode":"uu","text/x-vcalendar":"vcs","text/x-vcard":"vcf","video/3gpp":"3gp","video/3gpp2":"3g2","video/h261":"h261","video/h263":"h263","video/h264":"h264","video/jpeg":"jpgv","video/jpm":"jpm","video/mj2":"mj2","video/mp4":"mp4","video/mpeg":"mpeg","video/quicktime":"qt","video/vnd.dece.hd":"uvh","video/vnd.dece.mobile":"uvm","video/vnd.dece.pd":"uvp","video/vnd.dece.sd":"uvs","video/vnd.dece.video":"uvv","video/vnd.dvb.file":"dvb","video/vnd.fvt":"fvt","video/vnd.mpegurl":"mxu","video/vnd.ms-playready.media.pyv":"pyv","video/vnd.uvvu.mp4":"uvu","video/vnd.vivo":"viv","video/webm":"webm","video/x-f4v":"f4v","video/x-fli":"fli","video/x-flv":"flv","video/x-m4v":"m4v","video/x-matroska":"mkv","video/x-mng":"mng","video/x-ms-asf":"asf","video/x-ms-vob":"vob","video/x-ms-wmx":"wmx","video/x-ms-wvx":"wvx","video/x-msvideo":"avi","video/x-sgi-movie":"movie","video/x-smv":"smv","x-conference/x-cooltalk":"ice","text/x-sql":"sql","image/x-pixlr-data":"pxd","image/x-adobe-dng":"dng","image/x-sketch":"sketch","image/x-xcf":"xcf","audio/amr":"amr","image/vnd-ms.dds":"dds","application/plt":"plt","application/sat":"sat","application/step":"step","text/x-httpd-cgi":"cgi","text/x-asap":"asp","text/x-jsp":"jsp"},r.prototype._options={cdns:{ace:"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8",codemirror:"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2",ckeditor:"https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.12.1",ckeditor5:"https://cdn.ckeditor.com/ckeditor5/17.0.0",tinymce:"https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.2.0",simplemde:"https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2",fabric:"https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2",fabric16:"https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7",tui:"https://uicdn.toast.com",hls:"https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.13.2/hls.min.js",dash:"https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.0.3/dash.all.min.js",flv:"https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.5.0/flv.min.js",videojs:"https://cdnjs.cloudflare.com/ajax/libs/video.js/7.7.5",prettify:"https://cdn.jsdelivr.net/gh/google/code-prettify@f1c3473acd1e8ea8c8c1a60c56e89f5cdd06f915/loader/run_prettify.js",psd:"https://cdnjs.cloudflare.com/ajax/libs/psd.js/3.2.0/psd.min.js",rar:"https://cdn.jsdelivr.net/gh/nao-pon/rar.js@6cef13ec66dd67992fc7f3ea22f132d770ebaf8b/rar.min.js",zlibUnzip:"https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/unzip.min.js",zlibGunzip:"https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/gunzip.min.js",bzip2:"https://cdn.jsdelivr.net/gh/nao-pon/bzip2.js@0.8.0/bzip2.js",marked:"https://cdnjs.cloudflare.com/ajax/libs/marked/0.7.0/marked.min.js",sparkmd5:"https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js",jssha:"https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js",amr:"https://cdn.jsdelivr.net/gh/yxl/opencore-amr-js@dcf3d2b5f384a1d9ded2a54e4c137a81747b222b/js/amrnb.js",tiff:"https://cdn.jsdelivr.net/gh/seikichi/tiff.js@545ede3ee46b5a5bc5f06d65954e775aa2a64017/tiff.min.js"},url:"",requestType:"get",cors:null,parrotHeaders:[],requestMaxConn:3,transport:{},urlUpload:"",dragUploadAllow:"auto",overwriteUploadConfirm:!0,uploadMaxChunkSize:10485760,folderUploadExclude:{win:/^(?:desktop\.ini|thumbs\.db)$/i,mac:/^\.ds_store$/i},iframeTimeout:0,customData:{},handlers:{},customHeaders:{},xhrFields:{},lang:"en",baseUrl:"",i18nBaseUrl:"",cssAutoLoad:!0,themes:{},theme:null,maxErrorDialogs:5,cssClass:"",commands:["*"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:"",onerror:"",getPath:!0,getImgSize:!1},open:{method:"post",into:"window",selectAction:"open"},opennew:{url:"",useOriginQuery:!0},upload:{ui:"button"},download:{maxRequests:10,minFilesZipdl:2},quicklook:{autoplay:!0,width:450,height:300,mediaControlsList:"",pdfToolbar:!0,textInitialLines:100,prettifyMaxLines:300,contain:!1,docked:0,dockHeight:"auto",dockAutoplay:!1,googleMapsApiKey:"",googleMapsOpts:{maps:{},kml:{suppressInfoWindows:!1,preserveViewport:!1}},viewerjs:{url:"",mimes:["application/pdf","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"],pdfNative:!0},sharecadMimes:[],googleDocsMimes:[],officeOnlineMimes:[],getDimThreshold:"200K",unzipMaxSize:"50M",mimeRegexNotEmptyCheck:/^application\/vnd\.google-apps\./},edit:{dialogWidth:void 0,dialogHeight:void 0,mimes:[],mkfileHideMimes:[],makeTextMimes:["text/plain","text/css","text/html"],useStoredEditor:!1,editorMaximized:!1,editors:[],encodings:["Big5","Big5-HKSCS","Cp437","Cp737","Cp775","Cp850","Cp852","Cp855","Cp857","Cp858","Cp862","Cp866","Cp874","EUC-CN","EUC-JP","EUC-KR","GB18030","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","Shift-JIS","Windows-1250","Windows-1251","Windows-1252","Windows-1253","Windows-1254","Windows-1257"],extraOptions:{uploadOpts:{},tuiImgEditOpts:{iconsPath:void 0,theme:{}},pixo:{apikey:""},managerUrl:null,ckeditor:{},ckeditor5:{mode:"decoupled-document"},tinymce:{},onlineConvert:{maxSize:100,showLink:!0}}},fullscreen:{mode:"screen"},search:{incsearch:{enable:!0,minlen:1,wait:500},searchTypes:{SearchMime:{name:"btnMime",title:"searchMime",incsearch:"mime"}}},info:{nullUrlDirLinkSelf:!0,hideItems:[],showHashMaxsize:104857600,showHashAlgorisms:["md5","sha256"],showHashOpts:{shake128len:256,shake256len:512},custom:{}},mkdir:{intoNewFolderToolbtn:!1},resize:{grid8px:"disable",presetSize:[[320,240],[400,400],[640,480],[800,600]],getDimThreshold:204800,dimSubImgSize:307200},rm:{quickTrash:!0,infoCheckWait:10,toTrashMaxItems:1e3},paste:{moveConfirm:!1},help:{view:["about","shortcuts","help","integrations","debug"],helpSource:""},preference:{width:600,height:400,categories:null,prefs:null,langs:null,selectActions:["open","edit/download","resize/edit/download","download","quicklook"]}},disabledCmdsRels:{get:["edit"],rm:["cut","empty"],"file&url=":["download","zipdl"]},bootCallback:null,getFileCallback:null,defaultView:"icons",startPathHash:"",sound:!0,ui:["toolbar","places","tree","path","stat"],uiOptions:{toolbar:[["home","back","forward","up","reload"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["undo","redo"],["copy","cut","paste","rm","empty","hide"],["duplicate","rename","edit","resize","chmod"],["selectall","selectnone","selectinvert"],["quicklook","info"],["extract","archive"],["search"],["view","sort"],["preference","help"],["fullscreen"]],toolbarExtra:{displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"],defaultHides:["home","reload"],showPreferenceButton:"none",preferenceInContextmenu:!0},tree:{attrTitle:!0,openRootOnLoad:!0,openCwdOnOpen:!0,syncTree:!0,subTreeMax:100,subdirsMaxConn:2,subdirsAtOnce:5,durations:{slideUpDown:"fast",autoScroll:"fast"}},navbar:{minWidth:150,maxWidth:500,autoHideUA:[]},navdock:{disabled:!1,initMaxHeight:"50%",maxHeight:"90%"},cwd:{oldSchool:!1,showSelectCheckboxUA:["Touch"],metakeyDragout:!0,listView:{columns:["perm","date","size","kind"],columnsCustomName:{},fixedHeader:!0},iconsView:{size:0,sizeMax:3,sizeNames:{0:"viewSmall",1:"viewMedium",2:"viewLarge",3:"viewExtraLarge"}}},path:{toWorkzoneWithoutNavbar:!0},dialog:{focusOnMouseOver:!0},toast:{animate:{showMethod:"fadeIn",showDuration:300,showEasing:"swing",timeOut:3e3,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing"}}},dispInlineRegex:"^(?:(?:image|video|audio)|application/(?:x-mpegURL|dash+xml)|(?:text/plain|application/pdf)$)",onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,sortAlsoTreeview:!1,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",fileModeStyle:"both",width:"auto",height:400,heightBase:null,resizable:!0,notifyDelay:500,notifyDialog:{position:{},width:null,canClose:!1,hiddens:["open"]},dialogContained:!1,allowShortcuts:!0,rememberLastDir:!0,reloadClearHistory:!1,useBrowserHistory:!0,showFiles:50,showThreshold:50,validName:!1,fileFilter:!1,backupSuffix:"~",sync:0,syncStart:!0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","opennew","download","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","empty","hide","|","rename","|","archive","|","places","info","chmod","netunmount"],cwd:["undo","redo","|","back","up","reload","|","upload","mkdir","mkfile","paste","|","empty","hide","|","view","sort","selectall","colwidth","|","places","info","chmod","netunmount","|","fullscreen","|","preference"],files:["getfile","|","open","opennew","download","opendir","quicklook","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","empty","hide","|","rename","edit","resize","|","archive","extract","|","selectall","selectinvert","|","places","info","chmod","netunmount"]},enableAlways:!1,enableByMouseOver:!0,windowCloseConfirm:["hasNotifyDialog","editingFile"],rawStringDecoder:"object"==typeof Encoding&&n.isFunction(Encoding.convert)?function(n){return Encoding.convert(n,{to:"UNICODE",type:"string"})}:null,debug:["error","warning","event-destroy"],toastBackendWarn:!0},r.prototype._options.commandsOptions.netmount={ftp:{name:"FTP",inputs:{host:n('<input type="text"/>'),port:n('<input type="number" placeholder="21" class="elfinder-input-optional"/>'),path:n('<input type="text" value="/"/>'),user:n('<input type="text"/>'),pass:n('<input type="password" autocomplete="new-password"/>'),FTPS:n('<input type="checkbox" value="1" title="File Transfer Protocol over SSL/TLS"/>'),encoding:n('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>'),locale:n('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>')}},dropbox2:r.prototype.makeNetmountOptionOauth("dropbox2","Dropbox","Dropbox",{noOffline:!0,root:"/",pathI18n:"path",integrate:{title:"Dropbox.com",link:"https://www.dropbox.com"}}),googledrive:r.prototype.makeNetmountOptionOauth("googledrive","Google Drive","Google",{integrate:{title:"Google Drive",link:"https://www.google.com/drive/"}}),onedrive:r.prototype.makeNetmountOptionOauth("onedrive","One Drive","OneDrive",{integrate:{title:"Microsoft OneDrive",link:"https://onedrive.live.com"}}),box:r.prototype.makeNetmountOptionOauth("box","Box","Box",{noOffline:!0,integrate:{title:"Box.com",link:"https://www.box.com"}})},r.prototype.history=function(t){function e(){r=[t.cwd().hash];f=!(i=0)}function o(u){return u&&h.canForward()||!u&&h.canBack()?(f=!1,t.exec("open",r[u?++i:--i]).fail(e)):n.Deferred().reject()}function s(n){!u||u.state&&u.state.thash===n||u.pushState({thash:n},null,location.pathname+location.search+(n?"#elf_"+n:""))}var i,h=this,f=!0,r=[],u=t.options.useBrowserHistory&&window.history&&window.history.pushState?window.history:null;this.canBack=function(){return 0<i};this.canForward=function(){return i<r.length-1};this.back=o;this.forward=function(){return o(!0)};t.bind("init",function(){u&&!u.state&&s(t.startDir())}).open(function(){var u=r.length,n=t.cwd().hash;f&&(0<=i&&i+1<u&&r.splice(i+1),r[r.length-1]!=n&&r.push(n),i=r.length-1);f=!0;s(n)}).reload(t.options.reloadClearHistory&&e)},r.prototype.command=function(t){this.fm=t;this.name="";this.dialogClass="";this.className="";this.title="";this.linkedCmds=[];this.state=-1;this.alwaysEnabled=!1;this.noChangeDirOnRemovedCwd=!1;this._disabled=!1;this.disableOnSearch=!1;this.updateOnSelect=!0;this.syncTitleOnChange=!1;this.keepContextmenu=!1;this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load sync":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void 0,this.value);this.change()}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.listeners=[];this.setup=function(t,i){function s(t){var i=t.callback||function(){r.exec(u.name,void 0,{_userAction:!0,_currentType:"shortcut"})};t.callback=function(t){var e,f={};u.enabled()&&(r.searchStatus.state<2?e=r.isCommandEnabled(u.name):(n.each(r.selected(),function(t,i){r.optionsByHashes[i]?f[i]=!0:n.each(r.volOptions,function(n){if(!f[n]&&0===i.indexOf(n))return!(f[n]=!0)})}),n.each(f,function(n){if(!(e=r.isCommandEnabled(u.name,n)))return!1})),e&&(u.event=t,i.call(u),delete u.event))}}var f,e,o,u=this,r=this.fm;for(this.name=t,this.title=r.messages["cmd"+t]?r.i18n("cmd"+t):this.extendsCmd&&r.messages["cmd"+this.extendsCmd]?r.i18n("cmd"+this.extendsCmd):t,this.options=Object.assign({},this.options,i),this.listeners=[],this.dialogClass="elfinder-dialog-"+t,i.shortcuts&&("function"==typeof i.shortcuts?o=i.shortcuts(this.fm,this.shortcuts):Array.isArray(i.shortcuts)&&(o=i.shortcuts),this.shortcuts=o||[]),this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),n.each(Object.assign({},u._handlers,u.handlers),function(t,i){r.bind(t,n.proxy(i,u))}),f=0;f<this.shortcuts.length;f++)s(e=this.shortcuts[f]),e.description||(e.description=this.title),r.shortcut(e);this.disableOnSearch&&r.bind("search searchend",function(){u._disabled="search"===this.type||!(this.alwaysEnabled||r.isCommandEnabled(t));u.update(void 0,u.value)});this.init()};this.init=function(){};this.exec=function(){return n.Deferred().reject()};this.getUndo=function(){return!1};this.disabled=function(){return this.state<0};this.enabled=function(){return-1<this.state};this.active=function(){return 0<this.state};this.getstate=function(){return-1};this.update=function(n,t){var i=this.state,r=this.value;this.state=this._disabled&&0===this.fm.searchStatus?-1:void 0!==n?n:this.getstate();this.value=t;i==this.state&&r==this.value||this.change()};this.change=function(n){var i,t;if("function"==typeof n)this.listeners.push(n);else for(t=0;t<this.listeners.length;t++){i=this.listeners[t];try{i(this.state,this.value)}catch(n){this.fm.debug("error",n)}}return this};this.hashes=function(i){return i?n.grep(Array.isArray(i)?i:[i],function(n){return!!t.file(n)}):t.selected()};this.files=function(t){var i=this.fm;return t?n.map(Array.isArray(t)?t:[t],function(n){return i.file(n)||null}):i.selectedFiles()};this.fmDialog=function(n,t){return t.cssClass?t.cssClass+=" "+this.dialogClass:t.cssClass=this.dialogClass,this.fm.dialog(n,t)}},r.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search",editing:"elfinder-to-editing",preventback:"elfinder-prevent-back",tabstab:"ui-state-default ui-tabs-tab ui-corner-top ui-tab",tabsactive:"ui-tabs-active ui-state-active"},tpl:{perms:'<span class="elfinder-perms"><\/span>',lock:'<span class="elfinder-lock"><\/span>',symlink:'<span class="elfinder-symlink"><\/span>',navicon:'<span class="elfinder-nav-icon"><\/span>',navspinner:'<span class="elfinder-spinner elfinder-navbar-spinner"><\/span>',navdir:'<div class="elfinder-navbar-wrapper{root}"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"><\/span><span class="elfinder-navbar-icon" {style}><\/span>{symlink}{permissions}{name}<\/span><div class="elfinder-navbar-subtree" style="display:none"><\/div><\/div>',placedir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"><\/span><span class="elfinder-navbar-icon" {style}><\/span>{symlink}{permissions}{name}<\/span><div class="elfinder-navbar-subtree" style="display:none"><\/div><\/div>'},mimes:{text:["application/dash+xml","application/docbook+xml","application/javascript","application/json","application/plt","application/sat","application/sql","application/step","application/vnd.hp-hpgl","application/x-awk","application/x-config","application/x-csh","application/x-empty","application/x-mpegurl","application/x-perl","application/x-php","application/x-web-config","application/xhtml+xml","application/xml","audio/x-mp3-playlist","image/cgm","image/svg+xml","image/vnd.dxf","model/iges"]},mixin:{make:function(){function ot(){requestAnimationFrame(function(){i&&i.trigger("blur")})}function st(){v.is(":hidden")||v.elfinderoverlay("hide").off("click close",et);r&&(u.removeClass("ui-front").css("position","").off("unselect."+t.namespace,ot),g?r&&r.css("max-height",""):l||u.css("width","").parent("td").css("overflow",""))}var y,r,u,ht,o,tt,b,it,ct,lt,rt=this,t=this.fm,k=this.name,d=this.requestCmd||k,ut=t.getUI("workzone"),at=this.origin&&"navbar"===this.origin?"tree":"cwd",l="tree"==at,ft=l?"navHash2Elm":"cwdHash2Elm",g=!l&&"list"!=t.storage("view"),s=t.selected(),p=this.move||!1,vt=ut.hasClass("elfinder-cwd-wrapper-empty"),f=n.Deferred().fail(function(n){tt&&o.attr("class",tt);vt&&ut.addClass("elfinder-cwd-wrapper-empty");s&&(p&&t.trigger("unlockfiles",{files:s}),t.clipboard([]),t.trigger("selectfiles",{files:s}));n&&t.error(n)}).always(function(){st();pt();t.enable().unbind("open",bt).trigger("resMixinMake")}),w="tmp_"+parseInt(1e5*Math.random()),h=this.data&&this.data.target?this.data.target:l?t.file(s[0]).hash:t.cwd().hash,yt=new Date,a={hash:w,phash:h,name:t.uniqueName(this.prefix,h),mime:this.mime,read:!0,write:!0,date:"Today "+yt.getHours()+":"+yt.getMinutes(),move:p},kt=(t.getUI(at).trigger("create."+t.namespace,a),this.data||{}),e=t[ft](w),v=t.getUI("overlay"),pt=function(){e&&e.length&&(i.off(),e.hide(),t.unselectfiles({files:[w]}).unbind("resize",wt),requestAnimationFrame(function(){l?e.closest(".elfinder-navbar-wrapper").remove():e.remove()}))},et=function(n){v.is(":hidden")||u.css("z-index","");c||(pt(),f.reject(),n&&(n.stopPropagation(),n.preventDefault()))},i=n(g?"<textarea><\/textarea>":'<input type="text"/>').on("keyup text",function(){g?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):y&&(this.style.width=y+"px",this.scrollWidth>y&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(t){t.stopImmediatePropagation();t.keyCode==n.ui.keyCode.ESCAPE?f.reject():t.keyCode==n.ui.keyCode.ENTER&&(t.preventDefault(),i.trigger("blur"))}).on("mousedown click dblclick",function(n){n.stopPropagation();"dblclick"===n.type&&n.preventDefault()}).on("blur",function(){var o,r=n.trim(i.val()),l=i.parent(),e=!0;if(v.is(":hidden")||u.css("z-index",""),""===r)return et();if(!c&&l.length){if(t.options.validName&&t.options.validName.test)try{e=t.options.validName.test(r)}catch(o){e=!1}if(!r||"."===r||".."===r||!e)return c=!0,t.error("directory"===a.mime?"errInvDirname":"errInvName",{modal:!0,close:function(){setTimeout(nt,120)}}),!1;if(t.fileByName(r,h))return c=!0,t.error(["errExists",r],{modal:!0,close:function(){setTimeout(nt,120)}}),!1;o=s&&p?t.exec("cut",s):null;n.when(o).done(function(){var e={},u={};st();i.hide().before(n("<span>").text(r));t.lockfiles({files:[w]});t.request({data:Object.assign({cmd:d,name:r,target:h},kt||{}),notify:{type:d,cnt:1},preventFail:!0,syncOnFail:!0,navigate:{toast:e}}).fail(function(r){t.unlockfiles({files:[w]});c=!0;i.show().prev().remove();t.error(r,{modal:!0,close:function(){Array.isArray(r)&&-1!==n.inArray("errUploadMime",r)?f.notify("errUploadMime").reject():setTimeout(nt,120)}})}).done(function(i){var r,h,o,c;i&&i.added&&i.added[0]&&(r=i.added[0],h=r.hash,t[ft](h),o={directory:{cmd:"open",msg:"cmdopendir"},text:{cmd:"edit",msg:"cmdedit"},"default":{cmd:"open",msg:"cmdopen"}},s&&p&&t.one(d+"done",function(){t.exec("paste",h)}),p||(t.mimeIsText(r.mime)&&!t.mimesCanMakeEmpty[r.mime]&&t.mimeTypes[r.mime]&&(t.trigger("canMakeEmptyFile",{mimes:[r.mime],unshift:!0}),(c={})[r.mime]=t.mimeTypes[r.mime],t.storage("mkfileTextMimes",Object.assign(c,t.storage("mkfileTextMimes")||{}))),Object.assign(u,ht||o[r.mime]||o[r.mime.split("/")[0]]||o[t.mimesCanMakeEmpty[r.mime]||-1!==n.inArray(r.mime,t.resources.mimes.text)?"text":"none"]||o.default),Object.assign(e,u.cmd?{incwd:{msg:t.i18n(["complete",t.i18n("cmd"+k)]),action:u},inbuffer:{msg:t.i18n(["complete",t.i18n("cmd"+k)]),action:u}}:{inbuffer:{msg:t.i18n(["complete",t.i18n("cmd"+k)])}})));f.resolve(i)})}).fail(function(){f.reject()})}}).on("dragenter dragleave dragover drop",function(n){n.stopPropagation()}),nt=function(){var n=t.splitFileExtention(i.val())[0];c||!t.UA.Mobile||t.UA.iOS||(v.on("click close",et).elfinderoverlay("show"),u.css("z-index",v.css("z-index")+1));c=!1;t.enabled()||t.enable();i.trigger("focus").trigger("select");i[0].setSelectionRange&&i[0].setSelectionRange(0,n.length)},wt=function(){e.trigger("scrolltoview",{blink:!1})},bt=function(){f&&"pending"===f.state()&&f.reject()},c=!1;return t.isCommandEnabled(d,h)&&e.length?(n.isPlainObject(rt.nextAction)&&(ht=Object.assign({},rt.nextAction)),l?(o=t[ft](h),b=t.res("class","navcollapse"),it=t.res("class","navexpand"),ct=t.res("class","navarrow"),lt=t.res("class","navsubtree"),e.closest("."+lt).show(),o.hasClass(b)||(tt=o.attr("class"),o.addClass(b+" "+it+" elfinder-subtree-loaded")),o.is("."+b+":not(."+it+")")&&o.children("."+ct).trigger("click").data("dfrd").done(function(){i.val()===a.name&&i.val(t.uniqueName(rt.prefix,h)).trigger("select").trigger("focus")}),r=e.contents().filter(function(){return 3==this.nodeType&&n(this).parent().attr("id")===t.navHash2Id(a.hash)}),u=r.parent(),r.replaceWith(i.val(a.name))):(vt&&ut.removeClass("elfinder-cwd-wrapper-empty"),r=e.find(".elfinder-cwd-filename"),u=r.parent(),g?r.css("max-height","none"):(y=u.width(),u.width(y-15).parent("td").css("overflow","visible")),r.empty().append(i.val(a.name))),u.addClass("ui-front").css("position","relative").on("unselect."+t.namespace,ot),t.bind("resize",wt).one("open",bt),i.trigger("keyup"),nt(),f):f.reject()}},blink:function(n,t){var i={slowonce:function(){n.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500)},lookme:function(){n.show().fadeOut(500).fadeIn(750)}},r=i[t=t||"slowonce"]||i.lookme;n.stop(!0,!0);r()}},n.fn.dialogelfinder=function(t,i){var r,u,f="elfinderPosition",e="elfinderDestroyOnClose";if(n.isPlainObject(t))this.not(".elfinder").each(function(){t.handlers=t.handlers||{};var u,r=n(this),s=(n(document),n('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(t.title||"Files")+"<\/div>")),o=(n('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> <\/span><\/a>').appendTo(s).on("click",function(n){n.preventDefault();r.dialogelfinder("close")}),t.handlers.init);t.handlers.init=function(n,t){r.prepend(s);o&&o(n,t)};(u=r.addClass("elfinder dialogelfinder touch-punch").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window",stop:function(){r.trigger("resize");u.trigger("resize")}}).elfinder(t,i).elfinder("instance")).reloadCallback=function(n,t){u.destroy();n.handlers.init=o;r.dialogelfinder(n,t).dialogelfinder("open")};r.width(parseInt(r.width())||840).data(e,!!t.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top");t.position&&r.data(f,t.position);!1!==t.autoOpen&&n(this).dialogelfinder("open")});else if("open"===t)u=(r=n(this)).data(f)||{top:parseInt(n(document).scrollTop()+(n(window).height()<r.height()?2:(n(window).height()-r.height())/2)),left:parseInt(n(document).scrollLeft()+(n(window).width()<r.width()?2:(n(window).width()-r.width())/2))},r.is(":hidden")&&(r.addClass("ui-front").css(u).show().trigger("resize"),setTimeout(function(){r.trigger("resize").trigger("mousedown")},200));else if("close"===t)(r=n(this).removeClass("ui-front")).is(":visible")&&(r.data(e)?r.elfinder("destroy").remove():r.elfinder("close"));else if("instance"===t)return n(this).getElFinder();return this},"function"==typeof r&&r.prototype.i18&&(r.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;, Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;",language:"English",direction:"ltr",dateFormat:"M d, Y h:i A",fancyDateFormat:"$1 h:i A",nonameDateFormat:"ymd-His",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'Item named "$1" already exists.',errInvName:"Invalid file name.",errInvDirname:"Invalid folder name.",errFolderNotFound:"Folder not found.",errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errMkOutLink:"Unable to create a link to outside the volume root.",errUpload:"Upload error.",errUploadFile:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",errUploadTotalSize:"Data exceeds the maximum allowed size.",errUploadFileSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',errUploadTemp:"Unable to make temporary file for upload.",errNotReplace:'Object "$1" already exists at this location and can not be replaced by object with another type.',errReplace:'Unable to replace "$1".',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errTrash:"Unable into trash.",errRmSrc:"Unable remove source file(s).",errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",errCmdNoSupport:"Backend does not support this command.",errReplByChild:'The folder "$1" can\'t be replaced by an item it contains.',errArcSymlinks:"For security reason denied to unpack archives contains symlinks or files with not allowed names.",errArcMaxSize:"Archive files exceeds maximum allowed size.",errResize:'Unable to resize "$1".',errResizeDegree:"Invalid rotate degree.",errResizeRotate:"Unable to rotate image.",errResizeSize:"Invalid image size.",errResizeNoChange:"Image size not changed.",errUsupportType:"Unsupported file type.",errNotUTF8Content:'File "$1" is not in UTF-8 and cannot be edited.',errNetMount:'Unable to mount "$1".',errNetMountNoDriver:"Unsupported protocol.",errNetMountFailed:"Mount failed.",errNetMountHostReq:"Host required.",errSessionExpires:"Your session has expired due to inactivity.",errCreatingTempDir:'Unable to create temporary directory: "$1"',errFtpDownloadFile:'Unable to download file from FTP: "$1"',errFtpUploadFile:'Unable to upload file to FTP: "$1"',errFtpMkdir:'Unable to create remote directory on FTP: "$1"',errArchiveExec:'Error while archiving files: "$1"',errExtractExec:'Error while extracting files: "$1"',errNetUnMount:"Unable to unmount.",errConvUTF8:"Not convertible to UTF-8",errFolderUpload:"Try the modern browser, If you'd like to upload the folder.",errSearchTimeout:'Timed out while searching "$1". Search result is partial.',errReauthRequire:"Re-authorization is required.",errMaxTargets:"Max number of selectable items is $1.",errRestore:"Unable to restore from the trash. Can't identify the restore destination.",errEditorNotFound:"Editor not found to this file type.",errServerError:"Error occurred on the server side.",errEmpty:'Unable to empty folder "$1".',moreErrors:"There are $1 more errors.",cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Root",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkdirin:"Into New Folder",cmdmkfile:"New file",cmdopen:"Open",cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",cmdtrash:"Into trash",cmdrestore:"Restore",cmdsearch:"Find files",cmdup:"Go to parent folder",cmdupload:"Upload files",cmdview:"View",cmdresize:"Resize & Rotate",cmdsort:"Sort",cmdnetmount:"Mount network volume",cmdnetunmount:"Unmount",cmdplaces:"To Places",cmdchmod:"Change mode",cmdopendir:"Open a folder",cmdcolwidth:"Reset column width",cmdfullscreen:"Full Screen",cmdmove:"Move",cmdempty:"Empty the folder",cmdundo:"Undo",cmdredo:"Redo",cmdpreference:"Preferences",cmdselectall:"Select all",cmdselectnone:"Select none",cmdselectinvert:"Invert selection",cmdopennew:"Open in new window",cmdhide:"Hide (Preference)",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnApply:"Apply",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",btnMount:"Mount",btnApprove:"Goto $1 & approve",btnUnmount:"Unmount",btnConv:"Convert",btnCwd:"Here",btnVolume:"Volume",btnAll:"All",btnMime:"MIME Type",btnFileName:"Filename",btnSaveClose:"Save & Close",btnBackup:"Backup",btnRename:"Rename",btnRenameAll:"Rename(All)",btnPrevious:"Prev ($1/$2)",btnNext:"Next ($1/$2)",btnSaveAs:"Save As",ntfopen:"Open folder",ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating folder",ntfmkfile:"Creating files",ntfrm:"Delete items",ntfcopy:"Copy items",ntfmove:"Move items",ntfprepare:"Checking existing items",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfresize:"Resizing images",ntfsmth:"Doing something",ntfloadimg:"Loading image",ntfnetmount:"Mounting network volume",ntfnetunmount:"Unmounting network volume",ntfdim:"Acquiring image dimension",ntfreaddir:"Reading folder infomation",ntfurl:"Getting URL of link",ntfchmod:"Changing file mode",ntfpreupload:"Verifying upload file name",ntfzipdl:"Creating a file for download",ntfparents:"Getting path infomation",ntfchunkmerge:"Processing the uploaded file",ntftrash:"Doing throw in the trash",ntfrestore:"Doing restore from the trash",ntfchkdir:"Checking destination folder",ntfundo:"Undoing previous operation",ntfredo:"Redoing previous undone",ntfchkcontent:"Checking contents",volume_Trash:"Trash",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",msJan:"Jan",msFeb:"Feb",msMar:"Mar",msApr:"Apr",msMay:"May",msJun:"Jun",msJul:"Jul",msAug:"Aug",msSep:"Sep",msOct:"Oct",msNov:"Nov",msDec:"Dec",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",sortname:"by name",sortkind:"by kind",sortsize:"by size",sortdate:"by date",sortFoldersFirst:"Folders first",sortperm:"by permission",sortmode:"by mode",sortowner:"by owner",sortgroup:"by group",sortAlsoTreeview:"Also Treeview","untitled file.txt":"NewFile.txt","untitled folder":"NewFolder",Archive:"NewArchive","untitled file":"NewFile.$1",extentionfile:"$1: File",extentiontype:"$1: $2",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to permanently remove items?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one? (If it contains folders, it will be merged. To backup and replace, select Backup.)",confirmRest:"Replace existing item with the item in trash?",confirmConvUTF8:"Not in UTF-8<br/>Convert to UTF-8?<br/>Contents become UTF-8 by saving after conversion.",confirmNonUTF8:"Character encoding of this file couldn't be detected. It need to temporarily convert to UTF-8 for editting.<br/>Please select character encoding of this file.",confirmNotSave:"It has been modified.<br/>Losing work if you do not save changes.",confirmTrash:"Are you sure you want to move items to trash bin?",confirmMove:'Are you sure you want to move items to "$1"?',apllyAll:"Apply to all",name:"Name",size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all items",selectfiles:"Select item(s)",selectffile:"Select first item",selectlfile:"Select last item",viewlist:"List view",viewicons:"Icons view",viewSmall:"Small icons",viewMedium:"Medium icons",viewLarge:"Large icons",viewExtraLarge:"Extra large icons",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",link:"Link",searcresult:"Search results",selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocolver:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on GitHub",twitter:"Follow us on Twitter",facebook:"Join us on Facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",shortcutsof:"Shortcuts disabled",dropFiles:"Drop files here",or:"or",selectForUpload:"Select files",moveFiles:"Move items",copyFiles:"Copy items",restoreFiles:"Restore items",rmFromPlaces:"Remove from places",aspectRatio:"Aspect ratio",scale:"Scale",width:"Width",height:"Height",resize:"Resize",crop:"Crop",rotate:"Rotate","rotate-cw":"Rotate 90 degrees CW","rotate-ccw":"Rotate 90 degrees CCW",degree:"°",netMountDialogTitle:"Mount network volume",protocol:"Protocol",host:"Host",port:"Port",user:"User",pass:"Password",confirmUnmount:"Are you sure to unmount $1?",dropFilesBrowser:"Drop or Paste files from browser",dropPasteFiles:"Drop files, Paste URLs or images(clipboard) here",encoding:"Encoding",locale:"Locale",searchTarget:"Target: $1",searchMime:"Search by input MIME Type",owner:"Owner",group:"Group",other:"Other",execute:"Execute",perm:"Permission",mode:"Mode",emptyFolder:"Folder is empty",emptyFolderDrop:"Folder is empty\\A Drop to add items",emptyFolderLTap:"Folder is empty\\A Long tap to add items",quality:"Quality",autoSync:"Auto sync",moveUp:"Move up",getLink:"Get URL link",selectedItems:"Selected items ($1)",folderId:"Folder ID",offlineAccess:"Allow offline access",reAuth:"To re-authenticate",nowLoading:"Now loading...",openMulti:"Open multiple files",openMultiConfirm:"You are trying to open the $1 files. Are you sure you want to open in browser?",emptySearch:"Search results is empty in search target.",editingFile:"It is editing a file.",hasSelected:"You have selected $1 items.",hasClipboard:"You have $1 items in the clipboard.",incSearchOnly:"Incremental search is only from the current view.",reinstate:"Reinstate",complete:"$1 complete",contextmenu:"Context menu",pageTurning:"Page turning",volumeRoots:"Volume roots",reset:"Reset",bgcolor:"Background color",colorPicker:"Color picker","8pxgrid":"8px Grid",enabled:"Enabled",disabled:"Disabled",emptyIncSearch:"Search results is empty in current view.\\A Press [Enter] to expand search target.",emptyLetSearch:"First letter search results is empty in current view.",textLabel:"Text label",minsLeft:"$1 mins left",openAsEncoding:"Reopen with selected encoding",saveAsEncoding:"Save with the selected encoding",selectFolder:"Select folder",firstLetterSearch:"First letter search",presets:"Presets",tooManyToTrash:"It's too many items so it can't into trash.",TextArea:"TextArea",folderToEmpty:'Empty the folder "$1".',filderIsEmpty:'There are no items in a folder "$1".',preference:"Preference",language:"Language",clearBrowserData:"Initialize the settings saved in this browser",toolbarPref:"Toolbar settings",charsLeft:"... $1 chars left.",linesLeft:"... $1 lines left.",sum:"Sum",roughFileSize:"Rough file size",autoFocusDialog:"Focus on the element of dialog with mouseover",select:"Select",selectAction:"Action when select file",useStoredEditor:"Open with the editor used last time",selectinvert:"Invert selection",renameMultiple:"Are you sure you want to rename $1 selected items like $2?<br/>This cannot be undone!",batchRename:"Batch rename",plusNumber:"+ Number",asPrefix:"Add prefix",asSuffix:"Add suffix",changeExtention:"Change extention",columnPref:"Columns settings (List view)",reflectOnImmediate:"All changes will reflect immediately to the archive.",reflectOnUnmount:"Any changes will not reflect until un-mount this volume.",unmountChildren:"The following volume(s) mounted on this volume also unmounted. Are you sure to unmount it?",selectionInfo:"Selection Info",hashChecker:"Algorithms to show the file hash",infoItems:"Info Items (Selection Info Panel)",pressAgainToExit:"Press again to exit.",toolbar:"Toolbar",workspace:"Work Space",dialog:"Dialog",all:"All",iconSize:"Icon Size (Icons view)",editorMaximized:"Open the maximized editor window",editorConvNoApi:"Because conversion by API is not currently available, please convert on the website.",editorConvNeedUpload:"After conversion, you must be upload with the item URL or a downloaded file to save the converted file.",convertOn:"Convert on the site of $1",integrations:"Integrations",integrationWith:"This elFinder has the following external services integrated. Please check the terms of use, privacy policy, etc. before using it.",showHidden:"Show hidden items",hideHidden:"Hide hidden items",toggleHidden:"Show/Hide hidden items",makefileTypes:'File types to enable with "New file"',typeOfTextfile:"Type of the Text file",add:"Add",theme:"Theme","default":"Default",description:"Description",website:"Website",author:"Author",email:"Email",license:"License",exportToSave:"This item can't be saved. To avoid losing the edits you need to export to your PC.",dblclickToSelect:"Double click on the file to select it.",useFullscreen:"Use fullscreen mode",kindUnknown:"Unknown",kindRoot:"Volume Root",kindFolder:"Folder",kindSelects:"Selections",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindXZ:"XZ archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindMarkdown:"Markdown text",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}}),n.fn.elfinderbutton=function(t){return this.each(function(){function s(){i.toHide(u)}var u,h,c="class",i=t.fm,e=i.res(c,"disabled"),v=i.res(c,"active"),o=i.res(c,"hover"),l="elfinder-button-menu-item",a=n('<span class="elfinder-button-text">'+t.title+"<\/span>"),f=t.className?t.className:t.name,r=n(this).addClass("ui-state-default elfinder-button").attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+f+'"><\/span>',a).on("mouseenter mouseleave",function(n){r.hasClass(e)||r["mouseleave"==n.type?"removeClass":"addClass"](o)}).on("click",function(n){r.hasClass(e)||(u&&1<=t.variants.length?(u.is(":hidden")&&i.getUI().click(),n.stopPropagation(),u.css(p()).slideToggle({duration:100,done:function(){i[u.is(":visible")?"toFront":"toHide"](u)}})):i.exec(t.name,y(),{_userAction:!0,_currentType:"toolbar",_currentNode:r}))}),p=function(){var n=i.getUI(),t=n.offset(),u=r.offset();return{top:u.top-t.top,left:u.left-t.left,maxHeight:n.height()-40}},y=function(){var n=i.selected();return n.length||(n=i.cwd()?[i.cwd().hash]:void 0),n};a.hide();t.button=r;Array.isArray(t.variants)&&(r.addClass("elfinder-menubutton"),u=n('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-'+f+'-menu ui-corner-all"><\/div>').hide().appendTo(i.getUI()).on("mouseenter mouseleave","."+l,function(){n(this).toggleClass(o)}).on("click","."+l,function(f){var e=n(this).data("value");f.preventDefault();f.stopPropagation();r.removeClass(o);i.toHide(u);void 0===e&&(e={});"object"==typeof e&&(e._userAction=!0);i.exec(t.name,y(),e)}).on("close",s),i.bind("disable select",s).getUI().on("click",s),t.change(function(){u.html("");n.each(t.variants,function(i,r){u.append(n('<div class="'+l+'">'+r[1]+"<\/div>").data("value",r[0]).addClass(r[0]==t.value?"elfinder-button-menu-item-selected":""))})}));t.change(function(){var n;h&&cancelAnimationFrame(h);h=requestAnimationFrame(function(){t.disabled()?r.removeClass(v+" "+o).addClass(e):(r.removeClass(e),r[t.active()?"addClass":"removeClass"](v));t.syncTitleOnChange&&(n=t.className?t.className:t.name,f!==n&&(r.children(".elfinder-button-icon").removeClass("elfinder-button-icon-"+f).addClass("elfinder-button-icon-"+n),u&&u.removeClass("elfinder-button-"+f+"-menu").addClass("elfinder-button-"+n+"-menu"),f=n),a.html(t.title),r.attr("title",t.title))})}).change()})},n.fn.elfindercontextmenu=function(t){return this.each(function(){function y(i,r,u,f){var e,o,s="",h="",c="";return f&&(f.className&&(s=" "+f.className),f.iconClass&&(c=f.iconClass,r=""),f.iconImg&&(o=(e=f.iconImg.split(/ +/))[1]&&e[2]?t.escape(e[1]+"px "+e[2]+"px"):"",h=" style=\"background:url('"+t.escape(e[0])+"') "+(o||"0 0")+" no-repeat;"+(o?"":"posbackground-size:contain;")+'"')),n(ut.replace("{icon}",r?"elfinder-button-icon-"+r:c||"").replace("{label}",i).replace("{style}",h).replace("{className}",s)).on("click",function(n){n.stopPropagation();n.preventDefault();u()})}function d(i){var e=i.keyCode,p=n.ui.keyCode.ESCAPE,c=n.ui.keyCode.ENTER,w=n.ui.keyCode.LEFT,a=n.ui.keyCode.RIGHT,v=n.ui.keyCode.UP,y=n.ui.keyCode.DOWN,b="ltr"===t.direction?a:w,k=b===a?w:a;-1!==n.inArray(e,[p,c,w,a,v,y])&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),e==p||e===k?r&&u&&f?(f.trigger("mouseleave").trigger("submenuclose"),r.addClass(s),f=u=null):e==p&&h():e==v||e==y?u?(f&&f.trigger("mouseleave"),e==y&&(!f||u.length<=++u._cur)?u._cur=0:e==v&&(!f||--u._cur<0)&&(u._cur=u.length-1),f=u.eq(u._cur).trigger("mouseenter")):(u=null,r&&r.trigger("mouseleave"),e==y&&(!r||o.length<=++o._cur)?o._cur=0:e==v&&(!r||--o._cur<0)&&(o._cur=o.length-1),r=o.eq(o._cur).addClass(s)):!r||e!=c&&e!==b||(r.hasClass("elfinder-contextmenu-group")?f?e==c&&f.click():(r.trigger("mouseenter"),(u=r.find("div."+l))._cur=0,f=u.first().addClass(s)):e==c&&r.click()))}function tt(r,u){var d,f,nt=!1,p=!1,c=[],b="cwd"===r;v=r;k=u;(f=t.option("uiCmdMap",b?void 0:u[0]))||(f={});b||(c=t.getDisabledCmds(u));1<(d=t.selected().length)&&i.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>'+t.i18n("selectedItems",""+d)+"<\/span><\/div>");o=n();n.each(rt[r]||[],function(v,k){var d,rt,ft,tt,it,ut;if("|"!==k){if(f[k]?(rt=f[k],ft=!0):rt=k,!(d=t.getCommand(rt))||b||t.searchStatus.state&&d.disableOnSearch||(d.__disabled=d._disabled,d._disabled=!(d.alwaysEnabled||t._commands[rt]&&!(-1!==n.inArray(k,c)||ft&&c[rt])),n.each(d.linkedCmds,function(n,i){var r;(r=t.getCommand(i))&&(r.__disabled=r._disabled,r._disabled=!(r.alwaysEnabled||t._commands[i]&&!c[i]))})),d&&!d._disabled&&-1!=d.getstate(u)){if(d.variants){if(!d.variants.length)return;tt=y(d.title,d.className?d.className:d.name,function(){},d.contextmenuOpts);it=n('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"><\/div>').hide().css("max-height",t.getUI().height()-30).appendTo(tt.append('<span class="elfinder-contextmenu-arrow"><\/span>'));ut=function(n){var y,p,o,c,f,s,l,w,a,v,h,r,b,u;n?(y=e.attr("style"),e.width(e.width()),it.css({top:"-1000px",left:"auto",right:"auto"}),o=(p=tt.offset()).left,c=p.top,f=tt.outerWidth(),s=it.outerWidth(!0),l=it.outerHeight(!0),a=(w=e.offset()).left+e.width(),v=w.top+e.height(),r=f,(h=g)?10<(u=o+f+s-a)&&(s-5<o?(r-=5,h=!1):t.UA.Mobile||(r=f-u)):0<(u=s-o)&&(o+f+s-15<a?(r-=5,h=!0):t.UA.Mobile||(r=f-u)),b=0<(u=c+5+l-v)&&c<v?5-u:0<u?30-l:5,i.find(".elfinder-contextmenu-sub:visible").hide(),it.css({top:b,left:h?r:"auto",right:h?"auto":r,overflowY:"auto"}).show(),e.attr("style",y)):it.hide()};tt.addClass("elfinder-contextmenu-group").on("mouseleave",".elfinder-contextmenu-sub",function(){i.data("draged")||i.removeData("submenuKeep")}).on("submenuclose",".elfinder-contextmenu-sub",function(){ut(!1)}).on("click","."+l,function(f){var e,o;f.stopPropagation();i.data("draged")||(o=n(this),d.keepContextmenu?(o.removeClass(s),tt.addClass(s)):i.hide(),void 0===(e=o.data("exec"))&&(e={}),"object"==typeof e&&(e._userAction=!0,e._currentType=r,e._currentNode=o),d.keepContextmenu||h(),t.exec(d.name,u,e))}).on("touchend",function(){i.data("drag")||(ut(!0),i.data("submenuKeep",!0))}).on("mouseenter mouseleave",function(t){i.data("touching")||(tt.data("timer")&&(clearTimeout(tt.data("timer")),tt.removeData("timer")),n(t.target).closest(".elfinder-contextmenu-sub",i).length||("mouseleave"===t.type?i.data("submenuKeep")||tt.data("timer",setTimeout(function(){tt.removeData("timer");ut(!1)},250)):tt.data("timer",setTimeout(function(){tt.removeData("timer");ut(!0)},o.find("div.elfinder-contextmenu-sub:visible").length?250:0))))});n.each(d.variants,function(t,i){var u,e,r,f,o="|"===i?'<div class="elfinder-contextmenu-separator"><\/div>':n('<div class="'+a+" "+l+'"><span>'+i[1]+"<\/span><\/div>").data("exec",i[0]);void 0!==i[2]&&(u=n("<span><\/span>").addClass("elfinder-button-icon elfinder-contextmenu-icon"),/\//.test(i[2])?u.css((e=i[2],r=e.split(/ +/),f=r[1]&&r[2]?r[1]+"px "+r[2]+"px":"",{backgroundImage:'url("'+r[0]+'")',backgroundRepeat:"no-repeat",backgroundPosition:f||"",backgroundSize:f?"":"contain"})):u.addClass("elfinder-button-icon-"+i[2]),o.prepend(u).addClass(l+"-icon"));it.append(o)})}else tt=y(d.title,d.className?d.className:d.name,function(){i.data("draged")||(d.keepContextmenu||h(),t.exec(d.name,u,{_userAction:!0,_currentType:r,_currentNode:tt}))},d.contextmenuOpts),d.extra&&d.extra.node?(n('<span class="elfinder-button-icon elfinder-button-icon-'+(d.extra.icon||"")+" "+w+'"><\/span>').append(d.extra.node).appendTo(tt),n(d.extra.node).trigger("ready",{targets:u})):tt.remove("."+w);d.extendsCmd&&tt.children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+d.extendsCmd);p&&i.append('<div class="elfinder-contextmenu-separator"><\/div>');i.append(tt);p=!(nt=!0)}d&&void 0!==d.__disabled&&(d._disabled=d.__disabled,delete d.__disabled,n.each(d.linkedCmds,function(n,i){var r;(r=t.getCommand(i))&&(r._disabled=r.__disabled,delete r.__disabled)}))}else nt&&(p=!0)});o=i.children("div."+a)}n(this);var e,c,o,r,u,f,p,a="elfinder-contextmenu-item",l="elfinder-contextsubmenu-item",w="elfinder-contextmenu-extra-icon",s=t.res("class","hover"),b={distance:8,start:function(){i.data("drag",!0).data("touching")&&i.find("."+s).removeClass(s)},stop:function(){i.data("draged",!0).removeData("drag")}},i=n(this).addClass("touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+t.direction).hide().on("touchstart",function(){i.data("touching",!0).children().removeClass(s)}).on("touchend",function(){i.removeData("touching")}).on("mouseenter mouseleave","."+a,function(t){n(this).toggleClass(s,!("mouseenter"!==t.type&&(i.data("draged")||!i.data("submenuKeep"))));i.data("draged")&&i.data("submenuKeep")&&i.find(".elfinder-contextmenu-sub:visible").parent().addClass(s)}).on("mouseenter mouseleave","."+w,function(t){n(this).parent().toggleClass(s,"mouseleave"===t.type)}).on("mouseenter mouseleave","."+a+",."+l,function(t){function h(t,i){n.each(i?u:o,function(n,e){if(t[0]===e)return(i?u:o)._cur=n,i?f=t:r=t,!1})}var i,e,c;t.originalEvent&&(i=n(this),e=function(){r&&!r.children("div.elfinder-contextmenu-sub:visible").length&&r.removeClass(s)},"mouseenter"===t.type?i.hasClass(l)?(f&&f.removeClass(s),r&&(u=r.find("div."+l)),h(i,!0)):(e(),h(i)):i.hasClass(l)?u=f=null:(e(),c=r,setTimeout(function(){c===r&&(r=null)},250)))}).on("contextmenu",function(){return!1}).on("mouseup",function(){setTimeout(function(){i.removeData("draged")},100)}).draggable(b),g="ltr"===t.direction,it=g?"left":"right",rt=Object.assign({},t.options.contextmenu),ut='<div class="'+a+'{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}><\/span><span>{label}<\/span><\/div>',nt=function(o,s,l){var v,a,b=i.outerWidth(),k=i.outerHeight(),ut=e.attr("style"),y=e.offset(),g=e.width(),tt=e.height(),w=t.UA.Mobile?40:2,rt=t.UA.Mobile?20:2,o=o-(y?y.left:0),s=s-(y?y.top:0),l=Object.assign(l||{},{top:Math.max(0,s+rt+k<tt?s+rt:s-(s+k-tt)),left:Math.max(0,o<b+w||o+w+b<g?o+w:o-w-b),opacity:"1"});p=!0;t.autoSync("stop");e.width(g);i.stop().removeAttr("style").css(l);t.toFront(i);i.show();e.attr("style",ut);l[it]=parseInt(i.width());i.find(".elfinder-contextmenu-sub").css(l);t.UA.iOS&&n("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","auto");f=u=r=null;n(document).on("keydown."+t.namespace,d);(v=n._data(document).events)&&v.keydown&&v.keydown.unshift(v.keydown.pop());t.UA.Mobile&&(a="touchstart.contextmenuAutoToggle",i.data("hideTm")&&clearTimeout(i.data("hideTm")),i.is(":visible")&&i.on("touchstart",function(n){1<n.originalEvent.touches.length||(i.stop(),t.toFront(i),i.data("hideTm")&&clearTimeout(i.data("hideTm")))}).data("hideTm",setTimeout(function(){i.is(":visible")&&(c.find(".elfinder-cwd-file").off(a),c.find(".elfinder-cwd-file.ui-selected").one(a,function(t){if(!(1<t.originalEvent.touches.length)){var r=n(t.target);if(i.first().length&&!r.is("input:checkbox")&&!r.hasClass("elfinder-cwd-select"))return t.stopPropagation(),nt(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY),c.data("longtap",!0),void r.one("touchend",function(){setTimeout(function(){c.removeData("longtap")},80)});c.find(".elfinder-cwd-file").off(a)}}).one("unselect."+t.namespace,function(){c.find(".elfinder-cwd-file").off(a)}),i.fadeOut({duration:300,fail:function(){i.css("opacity","1").show()},done:function(){t.toHide(i)}}))},4500)));requestAnimationFrame(function(){t.getUI().one("click."+t.namespace,h)})},h=function(){if(t.getUI().off("click."+t.namespace,h),n(document).off("keydown."+t.namespace,d),v=k=null,i.is(":visible")||i.children().length){t.toHide(i.removeAttr("style").empty().removeData("submenuKeep"));try{i.draggable("instance")||i.draggable(b)}catch(r){i.hasClass("ui-draggable")||i.draggable(b)}i.data("prevNode")&&(i.data("prevNode").after(i),i.removeData("prevNode"));t.trigger("closecontextmenu");t.UA.iOS&&n("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","touch")}p&&t.searchStatus.state<1&&!t.searchStatus.ininc&&t.autoSync();p=!1},v=null,k=null;t.one("load",function(){e=t.getUI();c=t.getUI("cwd");t.bind("contextmenu",function(r){var f,e,u=r.data,s={};u.type&&"files"!==u.type&&c.trigger("unselectall");h();u.type&&u.targets?(t.trigger("contextmenucreate",u),tt(u.type,u.targets),t.trigger("contextmenucreatedone",u)):u.raw&&(e=u.raw,v="raw",n.each(e,function(n,t){var r;"|"===t?i.append('<div class="elfinder-contextmenu-separator"><\/div>'):t.label&&"function"==typeof t.callback&&(r=y(t.label,t.icon,function(){i.data("draged")||(t.remain||h(),t.callback())},t.options||null),i.append(r))}),o=i.children("div."+a));i.children().length&&((f=u.prevNode||null)&&(i.data("prevNode",i.prev()),f.after(i)),u.fitHeight&&(s={maxHeight:Math.min(t.getUI().height(),n(window).height()),overflowY:"auto"},i.draggable("destroy").removeClass("ui-draggable")),nt(u.x,u.y,s),u.opened&&"function"==typeof u.opened&&u.opened.call(i))}).one("destroy",function(){i.remove()}).bind("disable",h).bind("select",function(n){"files"!==v||n.data&&n.data.selected.toString()===k.toString()||h()})}).shortcut({pattern:"mac"===t.OS?"ctrl+m":"contextmenu shift+f10",description:"contextmenu",callback:function(i){i.stopPropagation();i.preventDefault();n(document).one("contextmenu."+t.namespace,function(n){n.preventDefault();n.stopPropagation()});var f,e,u,r,o=t.selected();o.length?(f="files",e=o,r=t.cwdHash2Elm(o[0])):(f="cwd",e=[t.cwd().hash],u=t.getUI("workzone").offset());r&&r.length||(r=t.getUI("workzone"));(u=r.offset()).top+=r.height()/2;u.left+=r.width()/2;t.trigger("contextmenu",{type:f,targets:e,x:u.left,y:u.top})}})})},n.fn.elfindercwd=function(t,i){return this.not(".elfinder-cwd").each(function(){function yr(){return'<tr id="{id}" class="'+yt+' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}><\/span>{marker}<span class="elfinder-cwd-filename">{name}<\/span><\/div>'+k+"<\/td>"+function(){for(var t="",n=0;n<y.length;n++)t+='<td class="elfinder-col-'+y[n]+'">{'+y[n]+"}<\/td>";return t}()+"<\/tr>"}function si(i){return i.mime&&"directory"!==i.mime&&!sr[i.mime]&&function(i,r){var f,e,u;if(i&&!sr[i]&&(void 0===hi&&(n("#elfinderAddBadgeStyle"+t.namespace).length&&n("#elfinderAddBadgeStyle"+t.namespace).remove(),hi=n('<style id="addBadgeStyle'+t.namespace+'"><\/style>').insertBefore(n("head").children(":first")).get(0).sheet||null),hi)){if(u=(i=i.toLowerCase()).split("/"),e=t.escape(t.mimeTypes[i]||(r.replace(/.bac?k$/i,"").match(/\.([^.]+)$/)||["",""])[1])){f=".elfinder-cwd-icon-"+u[0].replace(/(\.|\+)/g,"-");void 0!==u[1]&&(f+=".elfinder-cwd-icon-"+u[1].replace(/(\.|\+)/g,"-"));try{hi.insertRule(f+':before{content:"'+e.toLowerCase()+'"}',0)}catch(i){}}sr[i]=!0}}(i.mime,i.name),or[e?"row":"icon"].replace(/\{([a-z0-9_]+)\}/g,function(n,r){return li[r]?li[r](i,t):i[r]?i[r]:""})}function wi(n){t.cwdHash2Elm(n).trigger(s)}function bi(){t.cwd().hash;k&&g.find("input").prop("checked",!0);t.lazy(function(){var i;t.maxTargets&&(v||l).length>t.maxTargets?(w({notrigger:!0}),i=(i=n.map(v||l,function(n){return t.file(n)||null})).slice(0,t.maxTargets),o={},n.each(i,function(n,i){o[i.hash]=!0;t.cwdHash2Elm(i.hash).trigger(s)}),t.toast({mode:"warning",msg:t.i18n(["errMaxTargets",t.maxTargets])})):(r.find("[id]:not(."+c+"):not(.elfinder-cwd-parent)").trigger(s),o=t.arrayFlip(v||l,!0));h();k&&g.data("pending",!1)},0,{repaint:!0})}function iu(n){for(var t=a.length;t--;)if(a[t].hash==n)return t;return-1}function ru(){function f(u){u&&(et=n(si(n.extend(!0,{},u,{name:"..",i18:"..",mime:"directory"}))).addClass("elfinder-cwd-parent").on("dblclick",function(){t.trigger("select",{selected:[i]}).exec("open",i)}),(e?et.children("td:first"):et).children(".elfinder-cwd-select").remove(),t.cwdHash2Elm(i).length?t.cwdHash2Elm(i).replaceWith(et):(e?r.find("tbody"):r).prepend(et),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1))}var i=t.cwd().phash,o=t.file(i)||null;o?f(o):(f({hash:i,read:!0,write:!0}),t.getUI("tree").length?t.one("parents",function(){f(t.file(i)||null);u.trigger(d)}):t.request({data:{cmd:"parents",target:t.cwd().hash},preventFail:!0}).done(function(){f(t.file(i)||null);u.trigger(d)}))}function ki(i){function g(n){for(var u,i=r.find("[id]:first");i.length;){if(u=t.file(t.cwdId2Hash(i.attr("id"))),!i.hasClass("elfinder-cwd-parent")&&u&&t.compare(n,u)<0)return i;i=i.next("[id]")}}function tt(n){for(var r=a.length,i=0;i<r;i++)if(t.compare(n,a[i])<0)return i;return r||-1}var u,c,s,y,w,b,k=e?r.find("tbody"):r,l=i.length,p={},d=!!n.htmlPrefilter,v=n(d?document.createDocumentFragment():"<div><\/div>");if(cr<l)st(),o=t.arrayFlip(n.map(i,function(n){return n.hash}),!0),h();else{for(l&&ft.removeClass("elfinder-cwd-wrapper-empty"),b="self"===t.option("tmbUrl");l--;)c=(u=i[l]).hash,t.cwdHash2Elm(c).length||((s=g(u))&&!s.length&&(s=null),!s&&0<=(w=tt(u))?a.splice(w,0,u):(v.empty().append(si(u)),"directory"!==u.mime||vt||dr(v),y=d?v:v.children(),s?s.before(y):k.append(y),++f.renderd),t.cwdHash2Elm(c).length&&(u.tmb&&(1!=u.tmb||0<u.size)||b&&0===u.mime.indexOf("image/"))&&(p[c]=u.tmb||"self"));e&&(fi(),ot({fitWidth:!nt}));ei(k);Object.keys(p).length&&(Object.assign(f.attachTmbs,p),a.length<1&&gt())}}function di(i){var r,s,u,h,c=i.length,v=1<t.searchStatus.state,y=t.getCommand(t.currentReqCmd)||{};if(!t.cwd().hash&&!y.noChangeDirOnRemovedCwd)return n.each(fr.reverse(),function(n,i){if(t.file(i))return h=!0,t.one(t.currentReqCmd+"done",function(){t.cwd().hash||t.exec("open",i)}),!1}),void(h||t.cwd().hash||t.exec("open",t.roots[Object.keys(t.roots)[0]]));for(;c--;){if(r=i[c],(s=t.cwdHash2Elm(r)).length)try{s.remove();--f.renderd}catch(i){t.debug("error",i)}else-1!==(u=iu(r))&&a.splice(u,1);o[r]&&delete o[r];v&&-1!==(u=n.inArray(r,l))&&l.splice(u,1)}v&&t.trigger("cwdhasheschange",l);e&&(fi(),ot({fitWidth:!nt}))}var gi,hi,nr,tr,tt,ct,ir,vt=t.UA.Mobile,e="list"==t.viewType,s="select."+t.namespace,it="unselect."+t.namespace,pr="disable."+t.namespace,wr="enable."+t.namespace,lt="class",yt=t.res(lt,"cwdfile"),b="."+yt,c="ui-selected",rt=t.res(lt,"disabled"),rr=t.res(lt,"draggable"),ni=t.res(lt,"droppable"),pt=t.res(lt,"hover"),uu=t.res(lt,"active"),at=t.res(lt,"adroppable"),br=yt+"-tmp",wt="elfinder-cwd-selectchk",ci=0<t.options.loadTmbs?t.options.loadTmbs:5,ut="",ur={},fr=[],l=[],v=void 0,y=[],bt="",k=n.map(i.showSelectCheckboxUA,function(n){return!(!t.UA[n]&&!n.match(/^all$/i))||null}).length?'<div class="elfinder-cwd-select"><input type="checkbox" class="'+wt+'"><\/div>':"",er=!1,nt=null,or={icon:'<div id="{id}" class="'+yt+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}><\/div>{marker}<\/div><div class="elfinder-cwd-filename" title="{nametitle}">{name}<\/div>'+k+"<\/div>",row:""},fu=t.res("tpl","perms"),eu=t.res("tpl","lock"),ou=t.res("tpl","symlink"),li={id:function(n){return t.cwdHash2Id(n.hash)},name:function(n){var i=t.escape(n.i18||n.name);return e||(i=i.replace(/([_.])/g,"&#8203;$1")),i},nametitle:function(n){return t.escape(n.i18||n.name)},permsclass:function(n){return t.perms2class(n)},perm:function(n){return t.formatPermissions(n)},dirclass:function(n){var r="directory"==n.mime?"directory":"";return n.isroot&&(r+=" isroot"),n.csscls&&(r+=" "+t.escape(n.csscls)),i.getClass&&(r+=" "+i.getClass(n)),r},style:function(n){return n.icon?t.getIconStyle(n):""},mime:function(n){var i=t.mime2class(n.mime);return n.icon&&(i+=" elfinder-cwd-bgurl"),i},size:function(n){return"directory"!==n.mime||n.size?t.formatSize(n.size):"-"},date:function(n){return t.formatDate(n)},kind:function(n){return t.mime2kind(n)},mode:function(n){return n.perm?t.formatFileMode(n.perm):""},modestr:function(n){return n.perm?t.formatFileMode(n.perm,"string"):""},modeoct:function(n){return n.perm?t.formatFileMode(n.perm,"octal"):""},modeboth:function(n){return n.perm?t.formatFileMode(n.perm,"both"):""},marker:function(n){return(n.alias||"symlink-broken"==n.mime?ou:"")+(n.read&&n.write?"":fu)+(n.locked?eu:"")},tooltip:function(n){var r=t.formatDate(n)+(0<n.size?" ("+t.formatSize(n.size)+")":""),i="",i=ut&&n.path?t.escape(n.path.replace(/\/[^\/]*$/,"")):n.tooltip?t.escape(n.tooltip).replace(/\r/g,"&#13;"):"";return e&&(i+=(i?"&#13;":"")+t.escape(n.i18||n.name)),i?i+"&#13;"+r:r}},sr={},ti=n(),ii=!1,o={},ri=!1,w=function(n){var t=n||{};k&&g.find("input").prop("checked",!1);Object.keys(o).length&&(ii=!1,o={},r.find("[id]."+c).trigger(it),k&&r.find("input:checkbox."+wt).prop("checked",!1));t.notrigger||h();k&&g.data("pending",!1);r.removeClass("elfinder-cwd-allselected")},hr=void 0,h=function(){var n=Object.keys(o),i={selected:n,origin:"cwd"};et&&(1<n.length||n[0]!==t.cwdId2Hash(et.attr("id")))&&et.hasClass(c)&&et.trigger(it);ri=n.length&&n.length===(v||l).length&&(!t.maxTargets||n.length<=t.maxTargets);k&&(g.find("input").prop("checked",ri),r[ri?"addClass":"removeClass"]("elfinder-cwd-allselected"));ri?i.selectall=!0:n.length||(i.unselectall=!0);t.trigger("select",i)},ai=function(n,i){var r,f,o,s,h;n.length&&(r=n.position().top,f=n.outerHeight(!0),(o=u.scrollTop())+(s=u.get(0).clientHeight)<r+(h=p?p.outerHeight(!0):0)+f?u.scrollTop(parseInt(r+h+f-s)):r<o&&u.scrollTop(r),e&&u.scrollLeft(0),i&&t.resources.blink(n,"lookme"))},a=[],f={},d="elfscrstop",kt=!1,dt={disabled:!0,filter:"[id]:first",stop:h,delay:250,appendTo:"body",autoRefresh:!1,selected:function(t,i){n(i.selected).trigger(s)},unselected:function(t,i){n(i.unselected).trigger(it)}},vi={},ui=function(s,h){var v,tt;if(f.renderd&&(v=(e?r.find("tbody:first"):r).children("[id]"+(i.oldSchool?":not(.elfinder-cwd-parent)":"")+":first"),v.length)){function it(){for(var i,n,r=0;r<5&&((i=c.attr("id"))&&(f.getTmbs=[],n=t.cwdId2Hash(i),vi[n]=i,f.attachTmbs[n]&&(nt[n]=f.attachTmbs[n]),st&&(g[i]=!0)),(c=c.next()).length);r++);}function p(){var n;r.data("selectable")&&(Object.assign(g,o),(n=Object.keys(g)).length&&(dt.filter="#"+n.join(", #"),r.selectable("enable").selectable("option",{filter:dt.filter}).selectable("refresh")));Object.keys(nt).length&&(f.getTmbs=[],pi(nt))}function rt(){c.hasClass(yt)||(c=c.closest(b))}var ut,l,y,w,k,d,et,ot,st=r.data("selectable"),a=(y=u.offset(),w=u.width(),k=n(window),d=v.width()/2,et=Math.min(y.left-k.scrollLeft()+("ltr"===t.direction?d:w-d),y.left+w-10),ot=y.top-k.scrollTop()+10+(e?gi:0),{left:Math.max(0,Math.round(et)),top:Math.max(0,Math.round(ot))}),c=s?v:n(document.elementFromPoint(a.left,a.top)),g={},nt={},ht=Math.ceil((f.hpi?Math.ceil(ft.data("rectangle").height/f.hpi*1.5):cr)/5);if(vi={},st&&r.selectable("option","disabled"),c.length&&(c.hasClass(yt)||c.closest(b).length||((l=t.getUI().find(".ui-dialog:visible,.ui-widget:visible")).length?(l.hide(),c=n(document.elementFromPoint(a.left,a.top)),l.show()):l=null),rt(),c.length||(l&&l.hide(),c=n(document.elementFromPoint(a.left,a.top+5)),l&&l.show(),rt())),c.length){if(c.attr("id"))if(s){for(tt=0;tt<ht&&(it(),c.length);tt++);p()}else f.repaintJob&&"pending"===f.repaintJob.state()&&f.repaintJob.reject(),ut=new Array(ht),f.repaintJob=t.asyncJob(function(){it();c.length||(p(),f.repaintJob&&"pending"===f.repaintJob.state()&&f.repaintJob.reject())},ut).done(p)}else s&&f.renderd&&(h=h||0)<10&&requestAnimationFrame(function(){ui(s,++h)})}},et=null,cr=t.options.showFiles,yi=function(){var v,w,b,y,l,p;f.rendering||f.renderd&&!a.length||(v=e?r.children("table").children("tbody"):r,y=!!n.htmlPrefilter,l=n(y?document.createDocumentFragment():"<div><\/div>"),p=function(i){var p,w,it=i||null,g=[],tt=!1,b={},rt="self"===t.option("tmbUrl"),ut=!f.renderd,k=a.splice(0,cr+(it||0)/(f.hpi||1));f.renderd+=k.length;a.length||(oi.hide(),u.off(d,yi));p=[];g=n.map(k,function(n){return n.hash&&n.name?("directory"==n.mime&&(tt=!0),(n.tmb&&(1!=n.tmb||0<n.size)||rt&&0===n.mime.indexOf("image/"))&&(b[n.hash]=n.tmb||"self"),ur[n.hash]&&p.push(n.hash),si(n)):null});l.empty().append(g.join(""));tt&&!vt&&dr(l);w=[];Object.keys(o).length&&l.find("[id]:not(."+c+"):not(.elfinder-cwd-parent)").each(function(){o[t.cwdId2Hash(this.id)]&&w.push(n(this))});v.append(y?l:l.children());w.length&&(n.each(w,function(n,t){t.trigger(s)}),h());p.length&&t.trigger("lockfiles",{files:p});f.hpi||ei(v,k.length);e&&(r.find("thead").show(),ot({fitWidth:!nt}));Object.keys(b).length&&Object.assign(f.attachTmbs,b);ut&&(vt||r.data("selectable")||r.selectable(dt).data("selectable",!0));kt||u.trigger(d)},f.renderd||(f.rendering=!0,u.scrollTop(0),w=t.cwd().phash,p(),i.oldSchool&&(w&&!ut?ru():et=n()),e&&(nt&&fi(),ot({fitWidth:!0})),f.itemH=(e?v.find("tr:first"):v.find("[id]:first")).outerHeight(!0),t.trigger("cwdrender"),f.rendering=!1,ui(!0)),!f.rendering&&a.length?0<(b=u.height()+u.scrollTop()+t.options.showThreshold+f.row-f.renderd*f.hpi)?(f.rendering=!0,t.lazy(function(){p(b);f.rendering=!1})):t.enabled()||ht():ht())},p=null,kr=t.UA.CSS.positionSticky&&t.UA.CSS.widthMaxContent,ot=function(f){var h;if(gi=0,i.listView.fixedHeader){function nt(){var n="ltr"===t.direction?"left":"right",i=-1*("ltr"===t.direction?u.scrollLeft():v.outerWidth(!0)-u.width()-u.scrollLeft());c.css(n)!==i&&c.css(n,i)}var tt,c,v,o,w,l,e,b,k,s,d,it=f||{},g=r.find("tbody"),a=g.children("tr:first");if(a.length&&a.is(":visible")){if(v=g.parent(),p?l=(o=n("#"+t.namespace+"-cwd-thead")).children("tr:first"):(d=!0,g.addClass("elfinder-cwd-fixheader"),w=(l=(o=r.find("thead").attr("id",t.namespace+"-cwd-thead")).children("tr:first")).outerHeight(!0),r.css("margin-top",w-parseInt(v.css("padding-top"))),kr?(p=n('<div class="elfinder-table-header-sticky"><\/div>').addClass(r.attr("class")).append(n("<table><\/table>").append(o)),r.after(p),u.on("resize.fixheader",function(n){n.stopPropagation();ot({fitWidth:!0})})):(c=n("<div><\/div>").addClass(r.attr("class")).append(n("<table><\/table>").append(o)),p=n("<div><\/div>").addClass(u.attr("class")+" elfinder-cwd-fixheader").removeClass("ui-droppable native-droppable").css(u.position()).css({height:w,width:r.outerWidth()}).append(c),"rtl"===t.direction&&p.css("left",u.data("width")-u.width()+"px"),nt(),u.after(p).on("scroll.fixheader resize.fixheader",function(n){nt();"resize"===n.type&&(n.stopPropagation(),p.css(u.position()),u.data("width",u.css("overflow","hidden").width()),u.css("overflow","auto"),ot())}))),d||it.fitWidth||2<Math.abs(a.outerWidth()-l.outerWidth()))for(tt=y.length+1,h=0;h<tt&&(e=l.children("td:eq("+h+")"),b=a.children("td:eq("+h+")"),k=e.width(),s=b.width(),void 0===e.data("delta")&&e.data("delta",e.outerWidth()-k-(b.outerWidth()-s)),s-=e.data("delta"),d||it.fitWidth||k!==s);h++)e.css("width",s+"px");kr||(p.data("widthTimer")&&cancelAnimationFrame(p.data("widthTimer")),p.data("widthTimer",requestAnimationFrame(function(){p&&(p.css("width",gr.width()+"px"),"rtl"===t.direction&&p.css("left",u.data("width")-u.width()+"px"))})));gi=o.height()}}},fi=function(){var t,i;e&&nt&&(t="elfinder-cwd-colwidth",(i=r.find("tr[id]:first")).hasClass(t)||(r.find("tr."+t).removeClass(t).find("td").css("width",""),i.addClass(t),r.find("table:first").css("table-layout","fixed"),n.each(n.merge(["name"],y),function(n,t){var r=nt[t]||i.find("td.elfinder-col-"+t).width();i.find("td.elfinder-col-"+t).width(r)})))},lr=Object.assign({},t.droppable,{over:function(i,r){var e,o,s,u=n(this),f=r.helper,h=i.shiftKey||i.ctrlKey||i.metaKey;i.stopPropagation();f.data("dropover",f.data("dropover")+1);u.data("dropover",!0);f.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");f.data("namespace")===t.namespace&&t.insideWorkzone(i.pageX,i.pageY)?(u.hasClass(t.res(lt,"cwdfile"))?(e=t.cwdId2Hash(u.attr("id")),u.data("dropover",e)):(e=t.cwd().hash,t.cwd().write&&u.data("dropover",e)),s=t.file(f.data("files")[0]).phash===e,u.data("dropover")===e?n.each(f.data("files"),function(n,t){if(t===e||s&&!h&&!f.hasClass("elfinder-drag-helper-plus"))return u.removeClass(at),!1}):u.removeClass(at),f.data("locked")||s?o="elfinder-drag-helper-plus":(o="elfinder-drag-helper-move",h&&(o+=" elfinder-drag-helper-plus")),u.hasClass(at)&&f.addClass(o),requestAnimationFrame(function(){u.hasClass(at)&&f.addClass(o)})):u.removeClass(at)},out:function(t,i){var r=i.helper;t.stopPropagation();r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(r.data("dropover")-1,0));n(this).removeData("dropover").removeClass(at)},deactivate:function(){n(this).removeData("dropover").removeClass(at)},drop:function(n,i){w({notrigger:!0});t.droppable.drop.call(this,n,i)}}),dr=function(i){var u=(i=i||(e?r.find("tbody"):r)).children(".directory:not(."+ni+",.elfinder-na,.elfinder-ro)");t.isCommandEnabled("paste")&&u.droppable(lr);t.isCommandEnabled("upload")&&u.addClass("native-droppable");i.children(".isroot").each(function(i,r){var u=n(r),f=t.cwdId2Hash(r.id);t.isCommandEnabled("paste",f)?u.hasClass(ni+",elfinder-na,elfinder-ro")||u.droppable(lr):u.hasClass(ni)&&u.droppable("destroy");t.isCommandEnabled("upload",f)?u.hasClass("native-droppable,elfinder-na,elfinder-ro")||u.addClass("native-droppable"):u.hasClass("native-droppable")&&u.removeClass("native-droppable")})},pi=function(i,r){n.isPlainObject(i)&&Object.keys(i).length&&(Object.assign(f.attachTmbs,i),n.each(i,function(i,u){var s,e,c,o,h=t.cwdHash2Elm(i);h.length&&("1"!=u?((s=t.file(i)).tmb!==u&&(s.tmb=u),e=t.tmb(s),r?h.find(".elfinder-cwd-icon").addClass(e.className).css("background-image","url('"+e.url+"')"):(c=h,o=e,n("<img/>").on("load",function(){c.find(".elfinder-cwd-icon").addClass(o.className).css("background-image","url('"+o.url+"')")}).attr("src",o.url)),delete f.attachTmbs[i]):r?gt([i]):f.tmbLoading[i]||f.getTmbs.push(i))}),r||!f.getTmbs.length||Object.keys(f.tmbLoading).length||gt())},gt=function(i){var r=[],u=!1;t.oldAPI?t.request({data:{cmd:"tmb",current:t.cwd().hash},preventFail:!0}).done(function(n){n.images&&Object.keys(n.images).length&&pi(n.images);n.tmb&&gt()}):(r=i?(u=!0,i.splice(0,ci)):f.getTmbs.splice(0,ci)).length&&(u||vi[r[0]]||vi[r[r.length-1]])&&(n.each(r,function(n,t){f.tmbLoading[t]=!0}),t.request({data:{cmd:"tmb",targets:r},preventFail:!0}).done(function(t){var o,e=[];t.images&&((o=Object.keys(t.images).length)?(o<r.length&&n.each(r,function(n,i){t.images[i]||e.push(i)}),pi(t.images,u)):e=r,e.length&&n.each(e,function(n,t){delete f.attachTmbs[t]}));u&&i.length&&gt(i)}).always(function(){f.tmbLoading={};!u&&f.getTmbs.length&&gt()}))},ei=function(n,i){var s,h,c,l=n||(e?r.find("tbody"):r),u=tu[t.viewType],o=1;0<a.length&&(f.hpi?e||(o=Math.floor(l.width()/u.width)):((h=u).height||(c=(e?r.find("tbody"):r).find(e?"tr:first":"[id]:first"),h.height=c.outerHeight(!0),e||(h.width=c.outerWidth(!0))),e?f.row=f.hpi=u.height:(o=Math.floor(l.width()/u.width),f.row=u.height,f.hpi=f.row/o)),s=Math.ceil((a.length+(i||0))/o),e&&p&&++s,oi.css({top:f.row*s+"px"}).show())},su=function(n){n.preventDefault();void 0===r.data("longtap")?t.trigger("contextmenu",{type:"cwd",targets:[t.cwd().hash],x:n.pageX,y:n.pageY}):n.stopPropagation()},hu=function(n){1<n.originalEvent.touches.length||(!1!==r.data("longtap")&&(u.data("touching",{x:n.originalEvent.touches[0].pageX,y:n.originalEvent.touches[0].pageY}),r.data("tmlongtap",setTimeout(function(){r.data("longtap",!0);t.trigger("contextmenu",{type:"cwd",targets:[t.cwd().hash],x:u.data("touching").x,y:u.data("touching").y})},500))),r.data("longtap",null))},cu=function(n){"touchmove"===n.type?(!u.data("touching")||4<Math.abs(u.data("touching").x-n.originalEvent.touches[0].pageX)+Math.abs(u.data("touching").y-n.originalEvent.touches[0].pageY))&&u.data("touching",null):setTimeout(function(){r.removeData("longtap")},80);clearTimeout(r.data("tmlongtap"))},lu=function(n){r.data("longtap")&&(n.preventDefault(),n.stopPropagation())},st=function(){t.lazy(function(){var i;ft.append(g).removeClass("elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result");(1<t.searchStatus.state||t.searchStatus.ininc)&&ft.addClass("elfinder-search-result"+(t.searchStatus.ininc?" elfinder-"+("/"===ut.substr(0,1)?"let":"inc")+"search-result":""));f.attachThumbJob&&f.attachThumbJob._abort();r.data("selectable")&&r.selectable("disable").selectable("destroy").removeData("selectable");t.trigger("cwdinit");ti=n();try{r.empty()}catch(i){r.html("")}p&&(u.off("scroll.fixheader resize.fixheader"),p.remove(),p=null);r.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(e?"list":"icons")).attr("style","").css("height","auto");oi.hide();u[e?"addClass":"removeClass"]("elfinder-cwd-wrapper-list")._padding=parseInt(u.css("padding-top"))+parseInt(u.css("padding-bottom"));t.UA.iOS&&u.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch");e&&(r.html("<table><thead><\/thead><tbody><\/tbody><\/table>"),i=n('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">'+t.getColumnName("name")+"<\/td>"+function(){for(var i="",r="",n=0;n<y.length;n++)i=t.getColumnName(y[n]),r+='<td class="elfinder-cwd-view-th-'+y[n]+' sortable-item">'+i+"<\/td>";return r}()+"<\/tr>"),r.find("thead").hide().append(i).find("td:first").append(g),n.fn.sortable&&i.addClass("touch-punch touch-punch-keep-default").sortable({axis:"x",distance:8,items:"> .sortable-item",start:function(t,i){n(i.item[0]).data("dragging",!0);i.placeholder.width(i.helper.removeClass("ui-state-hover").width()).removeClass("ui-state-active").addClass("ui-state-hover").css("visibility","visible")},update:function(i,u){var f,o,e=n(u.item[0]).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");y=n.map(n(this).children(),function(t){var i=n(t).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");return o||(e===i?o=!0:f=i),"name"===i?null:i});or.row=yr();t.storage("cwdCols",y);f=".elfinder-col-"+f+":first";e=".elfinder-col-"+e+":first";t.lazy(function(){r.find("tbody tr").each(function(){var t=n(this);t.children(f).after(t.children(e))})})},stop:function(t,i){setTimeout(function(){n(i.item[0]).removeData("dragging")},100)}}),i.find("td").addClass("touch-punch").resizable({handles:"ltr"===t.direction?"e":"w",start:function(t,i){var u=r.find("td.elfinder-col-"+i.element.attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","")+":first");i.element.data("dragging",!0).data("resizeTarget",u).data("targetWidth",u.width());er=!0;"fixed"!==r.find("table").css("table-layout")&&(r.find("tbody tr:first td").each(function(){n(this).width(n(this).width())}),r.find("table").css("table-layout","fixed"))},resize:function(n,t){t.element.data("resizeTarget").width(t.element.data("targetWidth")-(t.originalSize.width-t.size.width))},stop:function(i,u){ot({fitWidth:!(er=!1)});nt={};r.find("tbody tr:first td").each(function(){var t=n(this).attr("class").split(" ")[0].replace("elfinder-col-","");nt[t]=n(this).width()});t.storage("cwdColWidth",nt);setTimeout(function(){u.element.removeData("dragging")},100)}}).find(".ui-resizable-handle").addClass("ui-icon ui-icon-grip-dotted-vertical"));a=n.map(v||l,function(n){return t.file(n)||null});a=t.sortFiles(a);v?v=n.map(a,function(n){return n.hash}):l=n.map(a,function(n){return n.hash});f={renderd:0,attachTmbs:{},getTmbs:[],tmbLoading:{},lazyOpts:{tm:0}};ft[a.length<1?"addClass":"removeClass"]("elfinder-cwd-wrapper-empty");u.off(d,yi).on(d,yi).trigger(d);t.cwd().write?(u[t.isCommandEnabled("upload")?"addClass":"removeClass"]("native-droppable"),u.droppable(t.isCommandEnabled("paste")?"enable":"disable")):u.removeClass("native-droppable").droppable("disable").removeClass("ui-state-disabled")})},r=n(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").on("click."+t.namespace,b,function(i){var a,v,o,y,e,f=this.id?n(this):n(this).parents("[id]:first"),l=n(i.target);if(k&&(l.is("input:checkbox."+wt)||l.hasClass("elfinder-cwd-select")))return i.stopPropagation(),i.preventDefault(),f.trigger(f.hasClass(c)?it:s),h(),void requestAnimationFrame(function(){l.prop("checked",f.hasClass(c))});if(r.data("longtap")||l.hasClass("elfinder-cwd-nonselect"))i.stopPropagation();else{if(bt||(bt=f.attr("id"),setTimeout(function(){bt=""},500)),i.shiftKey&&(a=f.prevAll(hr||"."+c+":first"),v=f.nextAll(hr||"."+c+":first"),o=a.length,y=v.length),i.shiftKey&&(o||y))e=(e=o?f.prevUntil("#"+a.attr("id")):f.nextUntil("#"+v.attr("id"))).add(f),o||(e=n(e.get().reverse())),e.trigger(s);else if(i.ctrlKey||i.metaKey)f.trigger(f.hasClass(c)?it:s);else{if(u.data("touching")&&f.hasClass(c))return u.data("touching",null),void t.dblclick({file:t.cwdId2Hash(this.id)});w({notrigger:!0});f.trigger(s)}h()}}).on("dblclick."+t.namespace,b,function(i){var r;bt&&(r=t.cwdId2Hash(bt),i.stopPropagation(),this.id!==bt&&(n(this).trigger(it),n("#"+bt).trigger(s),h()),t.dblclick({file:r}))}).on("touchstart."+t.namespace,b,function(i){if(!(1<i.originalEvent.touches.length)){var f=this.id?n(this):n(this).parents("[id]:first"),l=n(i.target),a=i.target.nodeName;if("INPUT"===a&&"text"===i.target.type||"TEXTAREA"===a||l.hasClass("elfinder-cwd-nonselect"))i.stopPropagation();else{if(f.find("input:text,textarea").length)return i.stopPropagation(),void i.preventDefault();u.data("touching",{x:i.originalEvent.touches[0].pageX,y:i.originalEvent.touches[0].pageY});k&&(l.is("input:checkbox."+wt)||l.hasClass("elfinder-cwd-select"))||(f.prevAll("."+c+":first").length,f.nextAll("."+c+":first").length,r.data("longtap",null),(Object.keys(o).length||e&&"TD"!==i.target.nodeName||!e&&this!==i.target)&&(r.data("longtap",!1),f.addClass(pt),f.data("tmlongtap",setTimeout(function(){r.data("longtap",!0);f.trigger(s);h();t.trigger("contextmenu",{type:"files",targets:t.selected(),x:i.originalEvent.touches[0].pageX,y:i.originalEvent.touches[0].pageY})},500))))}}}).on("touchmove."+t.namespace+" touchend."+t.namespace,b,function(i){var f,e=n(i.target);k&&(e.is("input:checkbox."+wt)||e.hasClass("elfinder-cwd-select"))||("INPUT"!=i.target.nodeName&&"TEXTAREA"!=i.target.nodeName?(f=this.id?n(this):n(this).parents("[id]:first"),clearTimeout(f.data("tmlongtap")),"touchmove"===i.type?(u.data("touching",null),f.removeClass(pt)):(u.data("touching")&&!r.data("longtap")&&f.hasClass(c)&&(i.preventDefault(),u.data("touching",null),t.dblclick({file:t.cwdId2Hash(this.id)})),setTimeout(function(){r.removeData("longtap")},80))):i.stopPropagation())}).on("mouseenter."+t.namespace,b,function(){if(!kt){var u=n(this),f=null;if(!(vt||u.data("dragRegisted")||u.hasClass(br)||u.hasClass(rr)||u.hasClass(rt))){if(u.data("dragRegisted",!0),!t.isCommandEnabled("copy",1<t.searchStatus.state||u.hasClass("isroot")?t.cwdId2Hash(u.attr("id")):void 0))return;u.on("mousedown",function(f){var o=i.metakeyDragout&&!t.UA.IE&&(f.shiftKey||f.altKey),s=!1;o&&r.data("selectable")&&(r.selectable("disable").selectable("destroy").removeData("selectable"),requestAnimationFrame(function(){r.selectable(dt).selectable("option",{disabled:!1}).selectable("refresh").data("selectable",!0)}));u.removeClass("ui-state-disabled");o?u.draggable("option","disabled",!0).attr("draggable","true"):(u.hasClass(c)||(s=e?n(f.target).closest("span,tr").is("tr"):n(f.target).hasClass("elfinder-cwd-file")),s?u.draggable("option","disabled",!0).removeClass("ui-state-disabled"):u.draggable("option","disabled",!1).removeAttr("draggable").draggable("option","cursorAt",{left:50-parseInt(n(f.currentTarget).css("margin-left")),top:47}))}).on("dragstart",function(i){var r=i.dataTransfer||i.originalEvent.dataTransfer||null;if(f=null,r&&!t.UA.IE){function y(i){var f=i.mime,r=t.tmb(i),u='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+t.mime2class(f)+' ui-corner-all"><\/div>';return r&&(u=n(u).addClass(r.className).css("background-image","url('"+r.url+"')").get(0).outerHTML),u}var c,w=this.id?n(this):n(this).parents("[id]:first"),p=n("<span>"),u="",l=null,a=null,e=[],v=[];if(w.trigger(s),h(),n.each(o,function(i){var f=t.file(i),r=f.url;if(f&&"directory"!==f.mime){if(r){if("1"==r)return v.push(i),!0}else r=t.url(f.hash);r&&(r=t.convAbsUrl(r),e.push(i),n("<a>").attr("href",r).text(r).appendTo(p),u+=r+"\n",l=l||f.mime+":"+f.name+":"+r,a=a||r+"\n"+f.name)}}),v.length)return n.each(v,function(n,i){var r=t.file(i);r.url="";t.request({data:{cmd:"url",target:i},notify:{type:"url",cnt:1},preventDefault:!0}).always(function(n){r.url=n.url?n.url:"1"})}),!1;if(!u)return!1;r.setDragImage&&(f=n('<div class="elfinder-drag-helper html5-native"><\/div>').append(y(t.file(e[0]))).appendTo(n(document.body)),1<(c=e.length)&&f.append(y(t.file(e[c-1]))+'<span class="elfinder-drag-num">'+c+"<\/span>"),r.setDragImage(f.get(0),50,47));r.effectAllowed="copyLink";r.setData("DownloadURL",l);r.setData("text/x-moz-url",a);r.setData("text/uri-list",u);r.setData("text/plain",u);r.setData("text/html",p.html());r.setData("elfinderfrom",window.location.href+t.cwd().hash);r.setData("elfinderfrom:"+r.getData("elfinderfrom"),"")}}).on("dragend",function(){w({notrigger:!0});f&&f.remove()}).draggable(t.draggable)}}}).on(s,b,function(){var i=n(this),u=t.cwdId2Hash(i.attr("id"));ii||i.hasClass(rt)||(hr="#"+this.id,i.addClass(c).children().addClass(pt).find("input:checkbox."+wt).prop("checked",!0),o[u]||(o[u]=!0),ti=r.find("[id]."+c+":last").next())}).on(it,b,function(){var i=n(this),u=t.cwdId2Hash(i.attr("id"));ii||(i.removeClass(c).children().removeClass(pt).find("input:checkbox."+wt).prop("checked",!1),r.hasClass("elfinder-cwd-allselected")&&(k&&g.children("input").prop("checked",!1),r.removeClass("elfinder-cwd-allselected")),o[u]&&delete o[u])}).on(pr,b,function(){var t=n(this).removeClass(pt+" "+c).addClass(rt),i=t.children(),r=e?t:i.find("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");i.removeClass(pt+" "+c);t.hasClass(ni)&&t.droppable("disable");r.hasClass(rr)&&r.draggable("disable")}).on(wr,b,function(){var t=n(this).removeClass(rt),i=e?t:t.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");t.hasClass(ni)&&t.droppable("enable");i.hasClass(rr)&&i.draggable("enable")}).on("scrolltoview",b,function(t,i){ai(n(this),!i||void 0===i.blink||i.blink)}).on("mouseenter."+t.namespace+" mouseleave."+t.namespace,b,function(i){"mouseenter"===i.type&&(kt||t.UA.Mobile)||(t.trigger("hover",{hash:t.cwdId2Hash(n(this).attr("id")),type:i.type}),n(this).toggleClass(pt,"mouseenter"==i.type))}).on("mouseenter."+t.namespace+" mouseleave."+t.namespace,".elfinder-cwd-file-wrapper,.elfinder-cwd-filename",function(t){"mouseenter"===t.type&&kt||n(this).closest(b).children(".elfinder-cwd-file-wrapper,.elfinder-cwd-filename").toggleClass(uu,"mouseenter"==t.type)}).on("contextmenu."+t.namespace,function(i){var r=n(i.target).closest(b);(r.get(0)!==i.target||o[t.cwdId2Hash(r.get(0).id)])&&(r.find("input:text,textarea").length?i.stopPropagation():r.length&&("TD"!=i.target.nodeName||o[t.cwdId2Hash(r.get(0).id)])&&(i.stopPropagation(),i.preventDefault(),r.hasClass(rt)||u.data("touching")||(r.hasClass(c)||(w({notrigger:!0}),r.trigger(s),h()),t.trigger("contextmenu",{type:"files",targets:t.selected(),x:i.pageX,y:i.pageY}))))}).on("click."+t.namespace,function(n){n.target!==this||r.data("longtap")||n.shiftKey||n.ctrlKey||n.metaKey||w()}).on("create."+t.namespace,function(i,f){var o=e?r.find("tbody"):r,s=o.find(".elfinder-cwd-parent"),l=f.move||!1,h=n(si(f)).addClass(br),c=t.selected();c.length?l&&t.trigger("lockfiles",{files:c}):w();s.length?s.after(h):o.prepend(h);fi();u.scrollTop(0).scrollLeft(0)}).on("unselectall",w).on("selectfile",function(n,i){t.cwdHash2Elm(i).trigger(s);h()}).on("colwidth",function(){e&&(r.find("table").css("table-layout","").find("td").css("width",""),ot({fitWidth:!0}),t.storage("cwdColWidth",nt=null))}).on("iconpref",function(n,t){r.removeClass(function(n,t){return(t.match(/\belfinder-cwd-size\S+/g)||[]).join(" ")});tt=t&&parseInt(t.size)||0;e||(0<tt&&r.addClass("elfinder-cwd-size"+tt),f.renderd&&requestAnimationFrame(function(){tu.icons={};f.hpi=null;ei(r,f.renderd);ui()}))}).on("onwheel"in document?"wheel":"mousewheel",function(n){var f,u;e||(!n.ctrlKey||n.metaKey)&&(n.ctrlKey||!n.metaKey)||(n.stopPropagation(),n.preventDefault(),void 0!==(f=r.data("wheelTm"))?(clearTimeout(f),r.data("wheelTm",setTimeout(function(){r.removeData("wheelTm")},200))):(r.data("wheelTm",!1),u=tt||0,0<(n.originalEvent.deltaY?n.originalEvent.deltaY:-n.originalEvent.wheelDelta)?0<tt&&(u=tt-1):tt<i.iconsView.sizeMax&&(u=tt+1),u!==tt&&(t.storage("iconsize",u),r.trigger("iconpref",{size:u}))))}),u=n('<div class="elfinder-cwd-wrapper"><\/div>').droppable(Object.assign({},lr,{autoDisable:!1})).on("contextmenu."+t.namespace,su).on("touchstart."+t.namespace,hu).on("touchmove."+t.namespace+" touchend."+t.namespace,cu).on("click."+t.namespace,lu).on("scroll."+t.namespace,function(){kt||(r.data("selectable")&&r.selectable("disable"),u.trigger("elfscrstart"));kt=!0;f.scrtm&&cancelAnimationFrame(f.scrtm);f.scrtm&&Math.abs((f.scrolltop||0)-(f.scrolltop=this.scrollTop||n(this).scrollTop()))<5&&(f.scrtm=0,u.trigger(d));f.scrtm=requestAnimationFrame(function(){f.scrtm=0;u.trigger(d)})}).on(d,function(){kt=!1;ui()}),oi=n("<div>&nbsp;<\/div>").css({position:"absolute",width:"1px",height:"1px"}).hide(),g=k?n('<div class="elfinder-cwd-selectall"><input type="checkbox"/><\/div>').attr("title",t.i18n("selectall")).on("click",function(t){if(t.stopPropagation(),t.preventDefault(),n(this).data("pending"))return!1;g.data("pending",!0);r.hasClass("elfinder-cwd-allselected")?(g.find("input").prop("checked",!1),requestAnimationFrame(function(){w()})):bi()}):n(),ar=null,ht=function(t){function i(){var t;void 0!==f.renderd&&(t=0,u.siblings("div.elfinder-panel:visible").each(function(){t+=n(this).outerHeight(!0)}),u.height(ft.height()-t-u._padding))}t&&i();ar&&cancelAnimationFrame(ar);ar=requestAnimationFrame(function(){var n;t||i();r.css("height","auto");n=u[0].clientHeight-parseInt(u.css("padding-top"))-parseInt(u.css("padding-bottom"))-parseInt(r.css("margin-top"));r.outerHeight(!0)<n&&r.height(n)});e&&!er&&(t?u.trigger("resize.fixheader"):ot());ui()},ft=n(this).parent().on("resize",ht).children(".elfinder-workzone").append(u.append(this).append(oi)),gr=n('<div class="elfinder-cwd-message-board"><\/div>').insertAfter(r),vr=n('<div class="elfinder-cwd-expires" ><\/div>'),nu=function(){var n,i,r;nr&&clearTimeout(nr);ct&&t.volumeExpires[ct]&&(r=(i=t.volumeExpires[ct]-new Date/1e3)%60+.1,n=Math.floor(i/60),vr.html(t.i18n(["minsLeft",n])).show(),n&&(nr=setTimeout(nu,1e3*r)))},tu={icons:{},list:{}};t.UA.ltIE10||gr.append(n('<div class="elfinder-cwd-trash" ><\/div>').html(t.i18n("volume_Trash"))).append(vr);li=Object.assign(li,i.replacement||{});try{nt=t.storage("cwdColWidth")?t.storage("cwdColWidth"):null}catch(ir){nt=null}t.bind("columnpref",function(r){var f=r.data||{},u;(y=t.storage("cwdCols"))?(y=n.grep(y,function(n){return-1!==i.listView.columns.indexOf(n)}),i.listView.columns.length>y.length&&n.each(i.listView.columns,function(n,t){-1===y.indexOf(t)&&y.push(t)})):y=i.listView.columns;u=t.storage("columnhides")||null;u&&Object.keys(u).length&&(y=n.grep(y,function(n){return!u[n]}));or.row=yr();e&&f.repaint&&st()}).trigger("columnpref");vt&&n("body").on("touchstart touchmove touchend",function(){});k&&r.addClass("elfinder-has-checkbox");n(window).on("scroll."+t.namespace,function(){ir&&cancelAnimationFrame(ir);ir=requestAnimationFrame(function(){u.trigger(d)})});n(document).on("keydown."+t.namespace,function(i){i.keyCode==n.ui.keyCode.ESCAPE&&(t.getUI().find(".ui-widget:visible").length||w())});t.one("init",function(){var u,s,e,o,h=document.createElement("style"),f=0;document.head&&(document.head.appendChild(h),(u=h.sheet).insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder")+'" }',f++),u.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder"+(vt?"LTap":"Drop"))+'" }',f++),u.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder")+'" }',f++),u.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptySearch")+'" }',f++),u.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyIncSearch")+'" }',f++),u.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyLetSearch")+'" }',f++));(o=t.storage("iconsize")||i.iconsView.size||0)&&(o=Math.min(o,i.iconsView.sizeMax),r.trigger("iconpref",{size:o}));vt||(t.one("open",function(){u&&t.zIndex&&u.insertRule(".ui-selectable-helper{z-index:"+t.zIndex+";}",f++)}),e=n('<div style="position:absolute"><\/div>'),(s=t.getUI()).on("resize",function(n,t){var i;n.preventDefault();n.stopPropagation();t&&t.fullscreen&&(i=s.offset(),"on"===t.fullscreen?(e.css({top:-1*i.top,left:-1*i.left}).appendTo(s),dt.appendTo=e):(e.detach(),dt.appendTo="body"),r.data("selectable")&&r.selectable("option",{appendTo:dt.appendTo}))}));tr=t.getUI("tree").length}).bind("enable",function(){ht()}).bind("request.open",function(){f.getTmbs=[]}).one("open",function(){t.maxTargets&&(ci=Math.min(t.maxTargets,ci))}).bind("open add remove searchend",function(){var o,i,r,f=t.cwd().hash,e=this.type;("open"===e||"searchend"===e||t.searchStatus.state<2)&&(l=n.map(t.files(f),function(n){return n.hash}),t.trigger("cwdhasheschange",l));"open"===e&&(o=f&&(!t.file(f)||tr)?tr?(r=n.Deferred(),t.one("treesync",function(n){n.data.always(function(){r.resolve()})}),r):t.request({data:{cmd:"parents",target:t.cwd().hash},preventFail:!0}):null,(i=t.cwd()).volumeid!==ct&&(vr.empty().hide(),ct&&u.removeClass("elfinder-cwd-wrapper-"+ct),ct=i.volumeid,nu(),u.addClass("elfinder-cwd-wrapper-"+ct)),n.when(o).done(function(){var r;fr=t.parents(i.hash);u[(r=!1,n.each(fr,function(n,i){if(t.trashes[i])return!(r=!0)}),r?"addClass":"removeClass")]("elfinder-cwd-wrapper-trash")}),w({notrigger:!(v=void 0)}),st())}).bind("search",function(i){l=n.map(i.data.files,function(n){return n.hash});t.trigger("cwdhasheschange",l);v=void 0;t.searchStatus.ininc=!1;st();t.autoSync("stop")}).bind("searchend",function(n){(ut||v)&&(ut="",v?t.trigger("incsearchend",n.data):n.data&&n.data.noupdate||st());t.autoSync()}).bind("searchstart",function(n){w();ut=n.data.query}).bind("incsearchstart",function(i){var r=i.data.query||"",u=i.data.type||"SearchName",f=t.options.commandsOptions.search.searchTypes||{};(f[u]&&f[u].incsearch||"SearchName"===u)&&(o={},t.lazy(function(){var i,e,o="";if(ut=r){if("/"===r.substr(0,1)&&(r=r.substr(1),o="^"),i=new RegExp(o+r.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"),"SearchName"===u)v=n.grep(l,function(n){var r=t.file(n);return!(!r||!(r.name.match(i)||r.i18&&r.i18.match(i)))});else if("string"==typeof(e=f[u].incsearch))v=n.grep(l,function(n){var r=t.file(n);return!!(r&&r[e]&&(r[e]+"").match(i))});else if("function"==typeof e)try{v=n.grep(e({val:r,regex:i},l,t),function(n){return!!t.file(n)})}catch(o){v=[]}t.trigger("incsearch",{hashes:v,query:r}).searchStatus.ininc=!0;st();t.autoSync("stop")}else t.trigger("incsearchend")}))}).bind("incsearchend",function(n){ut="";t.searchStatus.ininc=!1;v=void 0;n.data&&n.data.noupdate||st();t.autoSync()}).bind("sortchange",function(){var i=u.scrollLeft(),n=r.hasClass("elfinder-cwd-allselected");st();t.one("cwdrender",function(){u.scrollLeft(i);n&&(o=t.arrayFlip(v||l,!0));(n||Object.keys(o).length)&&h()})}).bind("viewchange",function(){var n="list"!=t.viewType,i=r.hasClass("elfinder-cwd-allselected");n!=e&&(e=n,t.viewType=e?"list":"icons",tt&&t.one("cwdinit",function(){r.trigger("iconpref",{size:tt})}),st(),ht(),i&&(r.addClass("elfinder-cwd-allselected"),g.find("input").prop("checked",!0)),Object.keys(o).length&&h())}).bind("wzresize",function(){var i,n=e?r.find("tbody"):r;ht(!0);f.hpi&&ei(n,n.find("[id]").length);i=r.offset();ft.data("rectangle",Object.assign({width:ft.width(),height:ft.height(),cwdEdge:"ltr"===t.direction?i.left:i.left+r.width()},ft.offset()));f.itemH=(e?n.find("tr:first"):n.find("[id]:first")).outerHeight(!0)}).bind("changeclipboard",function(t){ur={};t.data&&t.data.clipboard&&t.data.clipboard.length&&n.each(t.data.clipboard,function(n,t){t.cut&&(ur[t.hash]=!0)})}).bind("resMixinMake",function(){fi()}).bind("tmbreload",function(t){var i={},r=t.data&&t.data.files?t.data.files:null;n.each(r,function(n,t){t.tmb&&"1"!=t.tmb&&(i[t.hash]=t.tmb)});Object.keys(i).length&&pi(i,!0)}).add(function(i){var f=ut?new RegExp(ut.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"):null,o=t.searchStatus.mime,r=1<t.searchStatus.state,s=r&&t.searchStatus.target?t.searchStatus.target:t.cwd().hash,h=t.path(s),c=n.grep(i.data.added||[],function(i){return!(e=(u=i).phash===s)&&r&&(c=u.path||t.path(u.hash),!(e=h&&0===c.indexOf(h))&&t.searchStatus.mixed&&(e=!!n.grep(t.searchStatus.mixed,function(n){return 0===u.hash.indexOf(n)}).length)),e&&r&&(e=o?0===u.mime.indexOf(o):!!(u.name.match(f)||u.i18&&u.i18.match(f))),!!e;var u,c,e});ki(c);2===t.searchStatus.state&&(n.each(c,function(t,i){-1===n.inArray(i.hash,l)&&l.push(i.hash)}),t.trigger("cwdhasheschange",l));e&&ht();u.trigger(d)}).change(function(i){var r,o=t.cwd().hash,f=t.selected();ut?n.each(i.data.changed||[],function(i,u){t.cwdHash2Elm(u.hash).length&&(di([u.hash]),ki([u]),-1!==n.inArray(u.hash,f)&&wi(u.hash),r=!0)}):n.each(n.grep(i.data.changed||[],function(n){return n.phash==o}),function(i,u){t.cwdHash2Elm(u.hash).length&&(di([u.hash]),ki([u]),-1!==n.inArray(u.hash,f)&&wi(u.hash),r=!0)});r&&(t.trigger("cwdhasheschange",l),e&&ht(),u.trigger(d));h()}).remove(function(n){var t=e?r.find("tbody"):r;di(n.data.removed||[]);h();a.length<1&&t.children(b+(i.oldSchool?":not(.elfinder-cwd-parent)":"")).length<1?(ft.addClass("elfinder-cwd-wrapper-empty"),k&&g.find("input").prop("checked",!1),oi.hide(),u.off(d,yi),ht()):(ei(t),u.trigger(d))}).dragstart(function(t){var i=n(t.data.target),u=t.data.originalEvent;i.hasClass(yt)&&(i.hasClass(c)||(u.ctrlKey||u.metaKey||u.shiftKey||w({notrigger:!0}),i.trigger(s),h()));r.removeClass(rt).data("selectable")&&r.selectable("disable");ii=!0}).dragstop(function(){r.data("selectable")&&r.selectable("enable");ii=!1}).bind("lockfiles unlockfiles selectfiles unselectfiles",function(i){var v,c,l,f={lockfiles:pr,unlockfiles:wr,selectfiles:s,unselectfiles:it}[i.type],e=i.data.files||[],a=e.length,y=i.data.helper||n();if(0<a&&(v=t.parents(e[0])),f!==s&&f!==it||(l=f===s,n.each(e,function(n,t){var i=r.hasClass("elfinder-cwd-allselected");o[t]?(i&&(k&&g.children("input").prop("checked",!1),r.removeClass("elfinder-cwd-allselected"),i=!1),l||delete o[t]):l&&(o[t]=!0)})),!y.data("locked")){for(;a--;)try{t.cwdHash2Elm(e[a]).trigger(f)}catch(i){}i.data.inselect||h()}u.data("dropover")&&-1!==v.indexOf(u.data("dropover"))&&(c="lockfiles"!==i.type,y.toggleClass("elfinder-drag-helper-plus",c),u.toggleClass(at,c))}).bind("mkdir mkfile duplicate upload rename archive extract paste multiupload",function(i){var r;"upload"==i.type&&i.data._multiupload||(r=t.cwd().hash,w({notrigger:!0}),n.each((i.data.added||[]).concat(i.data.changed||[]),function(n,t){t&&t.phash==r&&wi(t.hash)}),h())}).shortcut({pattern:"ctrl+a",description:"selectall",callback:bi}).shortcut({pattern:"ctrl+shift+i",description:"selectinvert",callback:function(){var i={};ri?w():Object.keys(o).length?(n.each(v||l,function(n,r){var u=t.cwdHash2Elm(r);o[r]?u.length&&u.trigger(it):(i[r]=!0,u.length&&u.trigger(s))}),o=i,h()):bi()}}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(t){!function(t,i){function w(n,t){return n[t+"All"]("[id]:not(."+rt+"):not(.elfinder-cwd-parent):first")}var f,u,l,a,y,v=n.ui.keyCode,o=t==v.LEFT||t==v.UP,p=r.find("[id]."+c);if(p.length)if((l=w(f=p.filter(o?":first":":last"),o?"prev":"next")).length)if(e||t==v.LEFT||t==v.RIGHT)u=l;else if(a=f.position().top,y=f.position().left,u=f,o){for(;(u=u.prev("[id]")).length&&!(u.position().top<a&&u.position().left<=y););u.hasClass(rt)&&(u=w(u,"next"))}else{for(;(u=u.next("[id]")).length&&!(u.position().top>a&&u.position().left>=y););u.hasClass(rt)&&(u=w(u,"prev"));u.length||(l=r.find("[id]:not(."+rt+"):last")).position().top>a&&(u=l)}else u=f;else u=ti.length?o?ti.prev():ti:r.find("[id]:not(."+rt+"):not(.elfinder-cwd-parent):"+(o?"last":"first"));u&&u.length&&!u.hasClass("elfinder-cwd-parent")&&(f&&i?u=f.add(f[o?"prevUntil":"nextUntil"]("#"+u.attr("id"))).add(u):p.trigger(it),u.trigger(s),ai(u.filter(o?":first":":last")),h())}(t.keyCode,t.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(){w({notrigger:!0});ai(r.find("[id]:first").trigger(s));h()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(){w({notrigger:!0});ai(r.find("[id]:last").trigger(s));h()}}).shortcut({pattern:"page_up",description:"pageTurning",callback:function(){f.itemH&&u.scrollTop(Math.round(u.scrollTop()-Math.floor((u.height()+(e?-1*f.itemH:16))/f.itemH)*f.itemH))}}).shortcut({pattern:"page_down",description:"pageTurning",callback:function(){f.itemH&&u.scrollTop(Math.round(u.scrollTop()+Math.floor((u.height()+(e?-1*f.itemH:16))/f.itemH)*f.itemH))}})}),this},n.fn.elfinderdialog=function(t,i){function a(t){var u,o;r.enabled&&(o=i.options.dialogContained?f:n(window),u={maxWidth:r.width?o.width()-e.width:null,maxHeight:r.height?o.height()-e.height:null},Object.assign(l,u),t.css(u).trigger("resize"),t.data("hasResizable")&&(t.resizable("option","maxWidth")<u.maxWidth||t.resizable("option","maxHeight")<u.maxHeight)&&t.resizable("option",u))}function v(n){var t=n.data;c&&cancelAnimationFrame(c);c=requestAnimationFrame(function(){r.enabled&&a(t)})}function o(){var n=f.children(".elfinder-dialog."+i.res("class","editing")+":visible");i[n.length?"disable":"enable"]()}var h,c,u,f,l,s=-1!=window.navigator.platform.indexOf("Win"),e={},r={enabled:!1,width:!1,height:!1,defaultSize:null};return i&&i.ui?f=i.getUI():(f=this.closest(".elfinder"),i=i||f.elfinder("instance")),"string"==typeof t?(u=this.closest(".ui-dialog")).length&&("open"===t?"none"===u.css("display")&&(u.trigger("posinit").show().trigger("open").hide(),u.fadeIn(120,function(){i.trigger("dialogopened",{dialog:u})})):"close"===t||"destroy"===t?(u.stop(!0),(u.is(":visible")||f.is(":hidden"))&&(u.trigger("close"),i.trigger("dialogclosed",{dialog:u})),"destroy"===t?(u.remove(),i.trigger("dialogremoved",{dialog:u})):u.data("minimized")&&u.data("minimized").close()):"toTop"===t?(u.trigger("totop"),i.trigger("dialogtotoped",{dialog:u})):"posInit"===t?(u.trigger("posinit"),i.trigger("dialogposinited",{dialog:u})):"tabstopsInit"===t?(u.trigger("tabstopsInit"),i.trigger("dialogtabstopsinited",{dialog:u})):"checkEditing"===t&&o()):((t=Object.assign({},n.fn.elfinderdialog.defaults,t)).allowMinimize&&"auto"===t.allowMinimize&&(t.allowMinimize=!!this.find("textarea,input").length),t.openMaximized=t.allowMinimize&&t.openMaximized,t.headerBtnPos&&"auto"===t.headerBtnPos&&(t.headerBtnPos=s?"right":"left"),t.headerBtnOrder&&"auto"===t.headerBtnOrder&&(t.headerBtnOrder=s?"close:maximize:minimize":"close:minimize:maximize"),t.modal&&t.allowMinimize&&(t.allowMinimize=!1),i.options.dialogContained?r.width=r.height=r.enabled=!0:(r.width="window"===t.maxWidth,r.height="window"===t.maxHeight,(r.width||r.height)&&(r.enabled=!0)),h=i.arrayFlip(t.propagationEvents,!0),this.filter(":not(.ui-dialog-content)").each(function(){function et(){(d=u.find("."+y)).length&&(d.attr("tabindex","-1"),d.filter("."+rt).length||k.children("."+y+":"+(s?"first":"last")).addClass(rt))}function ot(t){var i=d.filter(":visible:enabled"),r=t?null:i.filter("."+rt+":first");return r&&r.length||(r=i.first()),t&&n.each(i,function(n,u){if(u===t&&i[n+1])return r=i.eq(n+1),!1}),r}var b,nt,c=n(this).addClass("ui-dialog-content ui-widget-content"),st="elfinder-dialog-active",tt="elfinder-dialog",ht="elfinder-dialog-notify",p="ui-state-hover",y="elfinder-tabstop",rt="elfinder-focus",ct="elfinder-dialog-modal",lt=parseInt(1e6*Math.random()),w=n('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"><span class="elfinder-dialog-title">'+t.title+"<\/span><\/div>"),k=n('<div class="ui-dialog-buttonset"><\/div>'),ut=n('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"><\/div>').append(k),it=0,vt=0,d=n(),g=n('<div style="width:100%;height:100%;position:absolute;top:0px;left:0px;"><\/div>').hide(),at={close:function(){w.prepend(n('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"><\/span><\/span>').on("mousedown touchstart",function(n){n.preventDefault();n.stopPropagation();c.elfinderdialog("close")}))},maximize:function(){t.allowMaximize&&(u.on("resize",function(n,t){var i,r;if(n.preventDefault(),n.stopPropagation(),t&&t.maximize){if(r=w.find(".elfinder-titlebar-full"),i="on"===t.maximize,r.children("span.ui-icon").toggleClass("ui-icon-plusthick",!i).toggleClass("ui-icon-arrowreturnthick-1-s",i),i){try{u.hasClass("ui-draggable")&&u.draggable("disable");u.hasClass("ui-resizable")&&u.resizable("disable")}catch(n){}c.css("width","100%").css("height",u.height()-u.children(".ui-dialog-titlebar").outerHeight(!0)-ut.outerHeight(!0))}else{c.attr("style",r.data("style"));r.removeData("style");ft();try{u.hasClass("ui-draggable")&&u.draggable("enable");u.hasClass("ui-resizable")&&u.resizable("enable")}catch(n){}}u.trigger("resize",{init:!0})}}),w.prepend(n('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"><\/span><\/span>').on("mousedown touchstart",function(r){var f=n(this);r.preventDefault();r.stopPropagation();u.hasClass("elfinder-maximized")||void 0!==f.data("style")||(c.height(c.height()),f.data("style",c.attr("style")||""));i.toggleMaximize(u);"function"==typeof t.maximize&&t.maximize.call(c[0])})))},minimize:function(){var f,r,e;t.allowMinimize&&(f=n('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"><\/span><\/span>').on("mousedown touchstart",function(f){function h(){r.remove();u.removeData("minimized").show();c.elfinderdialog("close")}var y=n(this),l=i.getUI("bottomtray"),a={width:70,height:24},s=n("<div><\/div>").css(a).addClass(u.get(0).className+" elfinder-dialog-minimized"),v={};f.preventDefault();f.stopPropagation();u.data("minimized")?(u.removeData("minimized").before(r.css(Object.assign({position:"absolute"},r.offset()))),i.toFront(r),r.animate(Object.assign({width:u.width(),height:u.height()},e),function(){u.show();i.toFront(u);r.remove();ft();o();u.trigger("resize",{init:!0});"function"==typeof t.minimize&&t.minimize.call(c[0])})):(e=u.data("minimized",{dialog:function(){return r},show:function(){r.show()},hide:function(){r.hide()},close:h,title:function(n){r.children(".ui-dialog-titlebar").children(".elfinder-dialog-title").text(n)}}).position(),r=u.clone().on("mousedown",function(){y.trigger("mousedown")}).removeClass("ui-draggable ui-resizable elfinder-frontmost"),l.append(s),Object.assign(v,s.offset(),a),s.remove(),r.height(u.height()).children(".ui-dialog-content:first").empty(),i.toHide(u.before(r)),r.children(".ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle").remove(),r.find(".elfinder-titlebar-minimize,.elfinder-titlebar-full").remove(),r.find(".ui-dialog-titlebar-close").on("mousedown",function(n){n.stopPropagation();n.preventDefault();h()}),r.animate(v,function(){r.attr("style","").css({maxWidth:u.width()}).addClass("elfinder-dialog-minimized").appendTo(l);o();"function"==typeof t.minimize&&t.minimize.call(c[0])}))}),w.on("dblclick",function(){n(this).children(".elfinder-titlebar-minimize").trigger("mousedown")}).prepend(f),u.on("togleminimize",function(){f.trigger("mousedown")}))}},u=n('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+tt+" "+t.cssClass+'"><\/div>').hide().append(c).appendTo(f).draggable({containment:i.options.dialogContained?f:null,handle:".ui-dialog-titlebar",start:function(){g.show()},drag:function(n,t){var r=t.offset.top,u=t.offset.left;r<0&&(t.position.top=t.position.top-r);u<0&&(t.position.left=t.position.left-u);i.options.dialogContained&&(t.position.top<0&&(t.position.top=0),t.position.left<0&&(t.position.left=0))},stop:function(){g.hide();u.css({height:t.height});c.data("draged",!0)}}).css({width:t.width,height:t.height,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight}).on("touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove",function(n){h[n.type]||n.stopPropagation()}).on("mousedown",function(t){h[t.type]||t.stopPropagation();requestAnimationFrame(function(){u.is(":visible")&&!u.hasClass("elfinder-frontmost")&&((nt=n(":focus")).length||(nt=void 0),u.trigger("totop"))})}).on("open",function(){u.data("margin-y",c.outerHeight(!0)-c.height());r.enabled&&(t.height&&"auto"!==t.height&&u.trigger("resize",{init:!0}),r.defaultSize||(r.defaultSize={width:c.width(),height:c.height()}),a(u),u.trigger("resize").trigger("posinit"),f.on("resize."+i.namespace,u,v));u.hasClass(ht)||f.children("."+tt+":visible:not(."+ht+")").each(function(){var t=n(this),i=parseInt(t.css("top")),r=parseInt(t.css("left")),f=parseInt(u.css("top")),e=parseInt(u.css("left")),o=Math.abs(i-f)<10,s=Math.abs(r-e)<10;t[0]!=u[0]&&(o||s)&&u.css({top:o?i+10:f,left:s?r+10:e})});u.data("modal")&&(u.addClass(ct),i.getUI("overlay").elfinderoverlay("show"));u.trigger("totop");t.openMaximized&&i.toggleMaximize(u);i.trigger("dialogopen",{dialog:u});"function"==typeof t.open&&n.proxy(t.open,c[0])();t.closeOnEscape&&n(document).on("keydown."+lt,function(t){t.keyCode==n.ui.keyCode.ESCAPE&&u.hasClass("elfinder-frontmost")&&c.elfinderdialog("close")});u.hasClass(i.res("class","editing"))&&o()}).on("close",function(){var e;t.beforeclose&&"function"==typeof t.beforeclose?(e=t.beforeclose())&&e.promise||(e=e?n.Deferred().resolve():n.Deferred().reject()):e=n.Deferred().resolve();e.done(function(){r.enabled&&f.off("resize."+i.namespace,v);t.closeOnEscape&&n(document).off("keyup."+lt);t.allowMaximize&&i.toggleMaximize(u,!1);i.toHide(u);u.data("modal")&&i.getUI("overlay").elfinderoverlay("hide");"function"==typeof t.close&&n.proxy(t.close,c[0])();t.destroyOnClose&&u.parent().length&&u.hide().remove();f.children("."+tt+":visible");u.hasClass(i.res("class","editing"))&&o()})}).on("totop frontmost",function(){var n=i.storage("autoFocusDialog");u.data("focusOnMouseOver",n?0<n:i.options.uiOptions.dialog.focusOnMouseOver);u.data("minimized")&&w.children(".elfinder-titlebar-minimize").trigger("mousedown");!u.data("modal")&&i.getUI("overlay").is(":visible")?i.getUI("overlay").before(u):i.toFront(u);f.children("."+tt+":not(."+ct+")").removeClass(st);u.addClass(st);i.UA.Mobile||(nt||ot()).trigger("focus");nt=void 0}).on("posinit",function(){var s,h,a,e,c,r,v,o=t.position;if(!u.hasClass("elfinder-maximized")){if(!o&&!u.data("resizing")){if(v=f.hasClass("elfinder-fullscreen")||i.options.enableAlways,u.css(v?{maxWidth:"100%",maxHeight:"100%",overflow:"auto"}:l),i.UA.Mobile&&!v&&u.data("rotated")===i.UA.Rotated)return;u.data("rotated",i.UA.Rotated);c=n(window);s=f.offset();(e={width:u.outerWidth(!0),height:u.outerHeight(!0)}).right=s.left+e.width;e.bottom=s.top+e.height;(r={scrLeft:c.scrollLeft(),scrTop:c.scrollTop(),width:c.width(),height:c.height()}).right=r.scrLeft+r.width;r.bottom=r.scrTop+r.height;a=i.options.dialogContained||v?h=0:(h=-1*s.top+r.scrTop,-1*s.left+r.scrLeft);o={top:e.height>=r.height?h:Math.max(h,parseInt((f.height()-e.height)/2-42)),left:e.width>=r.width?a:Math.max(a,parseInt((f.width()-e.width)/2))};e.right+o.left>r.right&&(o.left=Math.max(a,r.right-e.right));e.bottom+o.top>r.bottom&&(o.top=Math.max(h,r.bottom-e.bottom))}t.absolute&&(o.position="absolute");o&&u.css(o)}}).on("resize",function(i,f){var o,e,s,l,h=0,a=f&&f.init;f&&(f.minimize||f.maxmize)||u.data("minimized")||(i.stopPropagation(),i.preventDefault(),u.children(".ui-widget-header,.ui-dialog-buttonpane").each(function(){h+=n(this).outerHeight(!0)}),(l="auto"===t.height)&&c.css({"max-height":"",height:"auto"}),o=a||!r.enabled||i.originalEvent||u.hasClass("elfinder-maximized")?u.height()-h-u.data("margin-y"):(o=u.height(),e=u.css("min-height")||o,s=u.css("max-height")||o,e=e.match(/%/)?Math.floor(parseInt(e)/100*u.parent().height()):parseInt(e),s=s.match(/%/)?Math.floor(parseInt(s)/100*u.parent().height()):parseInt(s),Math.min(l?u.height():r.defaultSize.height,Math.max(s,e)-h-u.data("margin-y"))),c.css(l?"max-height":"height",o),a||(ft(),e=o<(e=c.height())?e+h+u.data("margin-y"):t.minHeight,u.css("min-height",e),u.data("hasResizable")&&u.resizable("option",{minHeight:e}),"function"==typeof t.resize&&n.proxy(t.resize,c[0])(i,f)))}).on("tabstopsInit",et).on("focus","."+y,function(){n(this).addClass(p).parent("label").addClass(p);this.id&&n(this).parent().find("label[for="+this.id+"]").addClass(p)}).on("click","select."+y,function(){var t=n(this);t.data("keepFocus")?t.removeData("keepFocus"):t.data("keepFocus",!0)}).on("blur","."+y,function(){n(this).removeClass(p).removeData("keepFocus").parent("label").removeClass(p);this.id&&n(this).parent().find("label[for="+this.id+"]").removeClass(p)}).on("mouseenter mouseleave","."+y+",label",function(i){var f,r=n(this);("LABEL"!==this.nodeName||r.children("."+y).length||(f=r.attr("for"))&&n("#"+f).hasClass(y))&&(t.btnHoverFocus&&u.data("focusOnMouseOver")?"mouseenter"!==i.type||n(":focus").data("keepFocus")||r.trigger("focus"):r.toggleClass(p,"mouseenter"==i.type))}).on("keydown","."+y,function(t){var u,r,i=n(this);if(i.is(":focus")){if(u=t.keyCode===n.ui.keyCode.ESCAPE,t.keyCode===n.ui.keyCode.ENTER?(t.preventDefault(),i.trigger("click")):t.keyCode===n.ui.keyCode.TAB&&t.shiftKey||t.keyCode===n.ui.keyCode.LEFT||t.keyCode==n.ui.keyCode.UP?r="prev":t.keyCode!==n.ui.keyCode.TAB&&t.keyCode!=n.ui.keyCode.RIGHT&&t.keyCode!=n.ui.keyCode.DOWN||(r="next"),r&&(i.is("textarea")&&!t.ctrlKey&&!t.metaKey||i.is("select,span.ui-slider-handle")&&t.keyCode!==n.ui.keyCode.TAB||i.is("input:not(:checkbox,:radio)")&&!t.ctrlKey&&!t.metaKey&&t.keyCode===n.ui.keyCode["prev"===r?"LEFT":"RIGHT"]))return void t.stopPropagation();u?i.is("input:not(:checkbox,:radio),textarea")&&""!==i.val()&&(i.val(""),t.stopPropagation()):t.stopPropagation();r&&(t.preventDefault(),("prev"===r?function(t){var i=d.filter(":visible:enabled"),r=i.last();return n.each(i,function(n,u){if(u===t&&i[n-1])return r=i.eq(n-1),!1}),r}:ot)(this).trigger("focus"))}}).data({modal:t.modal}),ft=function(){var n,t=i.getUI();t.hasClass("elfinder-fullscreen")&&(n=u.position(),u.css("top",Math.max(Math.min(Math.max(n.top,0),t.height()-100),0)),u.css("left",Math.max(Math.min(Math.max(n.left,0),t.width()-200),0)))};u.prepend(w);n.each(t.headerBtnOrder.split(":").reverse(),function(n,t){at[t]&&at[t]()});s&&w.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right");n.each(t.buttons,function(t,i){var r=n('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-'+vt+++" "+y+'"><span class="ui-button-text">'+t+"<\/span><\/button>").on("click",n.proxy(i,c[0]));i._cssClass&&r.addClass(i._cssClass);s?k.append(r):k.prepend(r)});k.children().length&&(u.append(ut),u.show(),ut.find("button").each(function(t,i){it+=n(i).outerWidth(!0)}),u.hide(),it+=20,u.width()<it&&u.width(it));u.append(g);r.enabled&&(e.width=u.outerWidth(!0)-u.width()+(u.outerWidth()-u.width())/2,e.height=u.outerHeight(!0)-u.height()+(u.outerHeight()-u.height())/2);i.options.dialogContained&&(b={maxWidth:f.width()-e.width,maxHeight:f.height()-e.height},t.maxWidth=t.maxWidth?Math.min(b.maxWidth,t.maxWidth):b.maxWidth,t.maxHeight=t.maxHeight?Math.min(b.maxHeight,t.maxHeight):b.maxHeight,u.css(b));l={maxWidth:u.css("max-width"),maxHeight:u.css("max-height"),overflow:u.css("overflow")};t.resizable&&u.resizable({minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,start:function(){g.show();!0!==u.data("resizing")&&u.data("resizing")&&clearTimeout(u.data("resizing"));u.data("resizing",!0)},stop:function(){g.hide();u.data("resizing",setTimeout(function(){u.data("resizing",!1)},200));r.enabled&&(r.defaultSize={width:c.width(),height:c.height()})}}).data("hasResizable",!0);t.optimizeNumber&&u.find("input[type=number]").each(function(){n(this).attr("inputmode","numeric");n(this).attr("pattern","[0-9]*")});et();"function"==typeof t.create&&n.proxy(t.create,this)();t.autoOpen&&(t.open?requestAnimationFrame(function(){c.elfinderdialog("open")}):c.elfinderdialog("open"));t.resize&&i.bind("themechange",function(){setTimeout(function(){u.data("margin-y",c.outerHeight(!0)-c.height());u.trigger("resize",{init:!0})},300)})})),this},n.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},btnHoverFocus:!0,position:null,absolute:!1,width:320,height:"auto",minWidth:200,minHeight:70,maxWidth:null,maxHeight:null,allowMinimize:"auto",allowMaximize:!1,openMaximized:!1,headerBtnPos:"auto",headerBtnOrder:"auto",optimizeNumber:!0,propagationEvents:["mousemove","mouseup"]},n.fn.elfinderfullscreenbutton=function(t){return this.each(function(){var i,r=n(this).elfinderbutton(t).children(".elfinder-button-icon");t.change(function(){i&&cancelAnimationFrame(i);i=requestAnimationFrame(function(){var n=t.value;r.addClass("elfinder-button-icon-fullscreen").toggleClass("elfinder-button-icon-unfullscreen",n);t.className=n?"unfullscreen":""})})})},n.fn.elfindernavbar=function(t,i){return this.not(".elfinder-navbar").each(function(){function c(){var n=t.getUI("cwd"),i=t.getUI("workzone"),u=i.data("rectangle"),r=n.offset();i.data("rectangle",Object.assign(u,{cwdEdge:"ltr"===t.direction?r.left:r.left+n.width()}))}function l(){r.css("overflow","hidden");a=Math.round(r.outerHeight()-r.height());v=Math.round(e.outerWidth()-e.innerWidth());r.css("overflow","auto")}var a,v,s,u,f,o,e,r=n(this).hide().addClass("ui-state-default elfinder-navbar"),y=r.css("overflow","hidden").parent().children(".elfinder-workzone").append(r),h="ltr"==t.direction;t.one("init",function(){function n(){l();t.bind("wzresize",function(){var n=0;e.width(r.outerWidth()-v);1<e.children().length&&(n=e.outerHeight(!0));r.height(y.height()-n-a)}).trigger("wzresize")}e=t.getUI("navdock");t.cssloaded?n():t.one("cssloaded",n)}).one("opendone",function(){s&&s.trigger("resize");r.css("overflow","auto")}).bind("themechange",l);t.UA.Touch&&(void 0===(f=t.storage("autoHide")||{}).navbar&&(f.navbar=i.autoHideUA&&0<i.autoHideUA.length&&n.grep(i.autoHideUA,function(n){return!!t.UA[n]}).length,t.storage("autoHide",f)),f.navbar&&t.one("init",function(){r.children().length&&t.uiAutoHide.push(function(){r.stop(!0,!0).trigger("navhide",{duration:"slow",init:!0})})}),t.bind("load",function(){r.children().length&&"none"!==(u=n('<div class="elfinder-navbar-swipe-handle"><\/div>').hide().appendTo(y)).css("pointer-events")&&(u.remove(),u=null)}),r.on("navshow navhide",function(n,i){var e="navshow"===n.type?"show":"hide",o=i&&i.duration?i.duration:"fast",s=i&&i.handleW?i.handleW:Math.max(50,t.getUI().width()/10);r.stop(!0,!0)[e]({duration:o,step:function(){t.trigger("wzresize")},complete:function(){u&&("show"==e?u.stop(!0,!0).hide():(u.width(s||""),t.resources.blink(u,"slowonce")));t.trigger("navbar"+e);i.init&&t.trigger("uiautohide");c()}});f.navbar="show"!=e;t.storage("autoHide",Object.assign(t.storage("autoHide"),{navbar:f.navbar}))}).on("touchstart",function(i){5<n(this)["scroll"+("ltr"===t.direction?"Right":"Left")]()&&(i.originalEvent._preventSwipeX=!0)}));t.UA.Mobile||(s=r.resizable({handles:h?"e":"w",minWidth:i.minWidth||150,maxWidth:i.maxWidth||500,resize:function(){t.trigger("wzresize")},stop:function(n,i){t.storage("navbarWidth",i.size.width);c()}}).on("resize scroll",function(i){var u=n(this),f=u.data("posinit");i.preventDefault();i.stopPropagation();h||"resize"!==i.type||r.css("left",0);f&&cancelAnimationFrame(f);u.data("posinit",requestAnimationFrame(function(){var n=t.UA.Opera&&r.scrollLeft()?20:2;s.css("top",0).css({top:parseInt(r.scrollTop())+"px",left:h?"auto":-1*parseInt(r.scrollRight()-n),right:h?-1*parseInt(r.scrollLeft()-n):"auto"});"resize"===i.type&&t.getUI("cwd").trigger("resize")}))}).children(".ui-resizable-handle").addClass("ui-front"));(o=t.storage("navbarWidth"))?r.width(o):t.UA.Mobile&&t.one(t.cssloaded?"init":"cssloaded",function(){function i(){o=r.parent().width()/2;r.data("defWidth")>o?r.width(o):r.width(r.data("defWidth"));r.data("width",r.width());t.trigger("wzresize")}r.data("defWidth",r.width());n(window).on("resize."+t.namespace,i);i()})}),this},n.fn.elfindernavdock=function(t,i){return this.not(".elfinder-navdock").each(function(){function f(i,u){var f,o=i-(u||r.height()),s=Object.keys(e).length,h=s?o/s:0;o&&(f=r.css("overflow"),r.css("overflow","hidden"),r.height(i),n.each(e,function(n,i){i.height(i.height()+h).trigger("resize."+t.namespace)}),t.trigger("wzresize"),r.css("overflow",f))}var u,o,r=n(this).hide().addClass("ui-state-default elfinder-navdock touch-punch"),h=(r.parent().children(".elfinder-workzone").append(r),n('<div class="ui-front ui-resizable-handle ui-resizable-n"><\/div>').appendTo(r)),e={},c=(parseInt(i.initMaxHeight)||50)/100,s=(parseInt(i.maxHeight)||90)/100;r.data("addNode",function(n,i){var l,a,v=t.getUI("workzone").height(),y=v*c;return i=Object.assign({first:!1,sizeSync:!0,init:!1},i),n.attr("id")||n.attr("id",t.namespace+"-navdock-"+ +new Date),i.sizeSync&&(e[n.attr("id")]=n),l=r.height()+n.outerHeight(!0),i.first?h.after(n):r.append(n),o=!0,r.resizable("enable").height(l).show(),t.trigger("wzresize"),i.init&&(a=t.storage("navdockHeight"),u=l=a||(y<l?y:l)),f(Math.min(l,v*s)),r}).data("removeNode",function(i,u){var f=n("#"+i);return delete e[i],r.height(r.height()-n("#"+i).outerHeight(!0)),u?"detach"===u?f=f.detach():u.append(f):f.remove(),r.children().length<=1&&(o=!1,r.resizable("disable").height(0).hide()),t.trigger("wzresize"),f});i.disabled||t.one("init",function(){var n;t.getUI("navbar").children().not(".ui-resizable-handle").length&&(r.data("dockEnabled",!0),r.resizable({maxHeight:t.getUI("workzone").height()*s,handles:{n:h},start:function(i,u){n=r.css("overflow");r.css("overflow","hidden");t.trigger("navdockresizestart",{event:i,ui:u},!0)},resize:function(){r.css("top","");t.trigger("wzresize",{inNavdockResize:!0})},stop:function(i,e){t.trigger("navdockresizestop",{event:i,ui:e},!0);r.css("top","");u=e.size.height;t.storage("navdockHeight",u);f(u,e.originalSize.height);r.css("overflow",n)}}),t.bind("wzresize",function(n){var i,e;r.is(":visible")&&(i=t.getUI("workzone").height()*s,n.data&&n.data.inNavdockResize||(e=r.height(),i<u?1<Math.abs(e-i)&&f(i):1<Math.abs(e-u)&&f(u)),r.resizable("option","maxHeight",i))}).bind("themechange",function(){var n=Math.round(r.height());requestAnimationFrame(function(){var t=Math.round(r.height()),i=n-t;0!=i&&f(r.height(),t-i)})}));t.bind("navbarshow navbarhide",function(n){r[o&&"navbarshow"===n.type?"show":"hide"]()})})}),this},n.fn.elfinderoverlay=function(t){var i,r,u,f,e=this.parent().elfinder("instance");return this.filter(":not(.elfinder-overlay)").each(function(){t=Object.assign({},t);n(this).addClass("ui-front ui-widget-overlay elfinder-overlay").hide().on("mousedown",function(n){n.preventDefault();n.stopPropagation()}).data({cnt:0,show:"function"==typeof t.show?t.show:function(){},hide:"function"==typeof t.hide?t.hide:function(){}})}),"show"==t&&(r=(i=this.eq(0)).data("cnt")+1,u=i.data("show"),e.toFront(i),i.data("cnt",r),i.is(":hidden")&&(i.show(),u())),"hide"==t&&(r=(i=this.eq(0)).data("cnt")-1,f=i.data("hide"),i.data("cnt",r),r<=0&&(i.hide(),f())),this},n.fn.elfinderpanel=function(t){return this.each(function(){var i=n(this).addClass("elfinder-panel ui-state-default ui-corner-all"),r="margin-"+("ltr"==t.direction?"left":"right");t.one("load",function(){var n=t.getUI("navbar");i.css(r,parseInt(n.outerWidth(!0)));n.on("resize",function(t){t.preventDefault();t.stopPropagation();i.is(":visible")&&i.css(r,parseInt(n.outerWidth(!0)))})})})},n.fn.elfinderpath=function(t,i){return this.each(function(){function v(i){var r=[],u=[];return n.each(t.parents(i),function(n,f){var s=i===f?"elfinder-path-dir elfinder-path-cwd":"elfinder-path-dir",e=t.file(f),o=t.escape(e.i18||e.name);u.push(o);r.push('<span id="'+a+f+'" class="'+s+'" title="'+u.join(t.option("separator"))+'">'+o+"<\/span>")}),r.join('<span class="elfinder-path-other">'+t.option("separator")+"<\/span>")}function f(){var i;u.children("span.elfinder-path-dir").attr("style","");i="ltr"===t.direction?n("#"+a+t.cwd().hash).prevAll("span.elfinder-path-dir:first"):n();u.scrollLeft(i.length?i.position().left:0)}function c(){var i,e,r,f;t.UA.CSS.flex||(e=(i=u.children("span.elfinder-path-dir")).length,"workzone"===s||e<2?i.attr("style",""):(u.width(u.css("max-width")),i.css({maxWidth:100/e+"%",display:"inline-block"}),r=u.width()-9,u.children("span.elfinder-path-other").each(function(){r-=n(this).width()}),f=[],i.each(function(t){var i=n(this).width();r-=i;i<this.scrollWidth&&f.push(t)}),u.width(""),f.length?(0<r&&(r/=f.length,n.each(f,function(t,u){var f=n(i[u]);f.css("max-width",f.width()+r)})),i.last().attr("style","")):i.attr("style","")))}var y,p,e="",o="",l=[],s="statusbar",b=t.res("class","hover"),a="path"+(r.prototype.uniqueid?r.prototype.uniqueid:"")+"-",h=n('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"><\/div>'),u=n(this).addClass("elfinder-path").html("&nbsp;").on("mousedown","span.elfinder-path-dir",function(i){var r=n(this).attr("id").substr(a.length);i.preventDefault();r!=t.cwd().hash&&(n(this).addClass(b),e?t.exec("search",e,{target:r,mime:l.join(" ")}):t.trigger("select",{selected:[r]}).exec("open",r))}).prependTo(t.getUI("statusbar").show()),w=n('<div class="elfinder-path-roots"><\/div>').on("click",function(i){i.stopPropagation();i.preventDefault();var u=n.map(t.roots,function(n){return t.file(n)}),r=[];n.each(u,function(n,i){i.phash||t.root(t.cwd().hash,!0)===i.hash||r.push({label:t.escape(i.i18||i.name),icon:"home",callback:function(){t.exec("open",i.hash)},options:{iconClass:i.csscls||"",iconImg:i.icon||""}})});t.trigger("contextmenu",{raw:r,x:i.pageX,y:i.pageY})}).append('<span class="elfinder-button-icon elfinder-button-icon-menu" ><\/span>').appendTo(h);t.one("init",function(){y=t.getUI("tree").length;p=t.getUI("stat").length;!y&&i.toWorkzoneWithoutNavbar&&(h.append(u).insertBefore(t.getUI("workzone")),s="workzone",t.bind("open",f).one("opendone",function(){t.getUI().trigger("resize")}))}).bind("open searchend parents",function(){o=e="";l=[];u.html(v(t.cwd().hash));1<Object.keys(t.roots).length?(u.css("margin",""),w.show()):(u.css("margin",0),w.hide());p||c()}).bind("searchstart",function(n){n.data&&(e=n.data.query||"",o=n.data.target||"",l=n.data.mimes||[])}).bind("search",function(){var n="",n=o?v(o):t.i18n("btnAll");u.html('<span class="elfinder-path-other">'+t.i18n("searcresult")+": <\/span>"+n);c()}).bind("navbarshow navbarhide",function(){var n=t.getUI("workzone");"navbarshow"===this.type?(t.unbind("open",f),u.prependTo(t.getUI("statusbar")),h.detach(),s="statusbar"):(h.append(u).insertBefore(n),s="workzone",f(),t.bind("open",f));t.trigger("uiresize")}).bind("resize uistatchange",c)})},n.fn.elfinderplaces=function(t,i){return this.each(function(){function rt(n){return n.substr(6)}function ut(n){return"place-"+n}function l(t){return n(document.getElementById(ut(t)))}function f(){var f=[],i={};(f=n.map(u.children().find("[id]"),function(n){return rt(n.id)})).length?n.each(f.reverse(),function(n,t){i[t]=r[t]}):i=null;t.storage(k,i)}function ft(){var u,f;k="places"+(i.suffix?i.suffix:"");r={};"string"==typeof(u=t.storage(k))?(u=n.grep(u.split(","),function(n){return!!n}),n.each(u,function(n,t){var i=t.split("#");r[i[0]]=i[1]?i[1]:i[0]})):n.isPlainObject(u)&&(r=u);t.trigger("placesload",{dirs:r,storageKey:k},!0);(f=Object.keys(r)).length&&(h.prepend(b),t.request({data:{cmd:"info",targets:f},preventDefault:!0}).done(function(i){var u={};i.files&&i.files.length&&t.cache(i.files);n.each(i.files,function(n,t){var i=t.hash;u[i]=t});n.each(r,function(n,t){d(u[n]||Object.assign({notfound:!0},t))});0<t.storage("placesState")&&h.trigger("click")}).always(function(){b.remove()}))}function a(i,r){return n(st.replace(/\{id\}/,ut(i?i.hash:r)).replace(/\{name\}/,t.escape(i?i.i18||i.name:r)).replace(/\{cssclass\}/,i?t.perms2class(i)+(i.notfound?" elfinder-na":"")+(i.csscls?" "+i.csscls:""):"").replace(/\{permissions\}/,!i||i.read&&i.write&&!i.notfound?"":ht).replace(/\{title\}/,i?' title="'+t.escape(t.path(i.hash,!0)||i.i18||i.name)+'"':"").replace(/\{symlink\}/,"").replace(/\{style\}/,i&&i.icon?t.getIconStyle(i):""))}function c(n){var t,i,f=null;return r[n]&&(delete r[n],(t=l(n)).length&&(f=t.text(),t.parent().remove(),i=u.children().length,tt.toggle(1<i),i||(h.removeClass(y),e.removeClass(p),u.slideToggle(!1)))),f}function v(n,t){var i=n.hash,u=l(t||i),f=a(n,i);return 0<u.length&&(u.parent().replaceWith(f),r[i]=n,!0)}var r={},o="class",s=t.res(o,"navdir"),y=t.res(o,"navcollapse"),p=t.res(o,"navexpand"),et=t.res(o,"hover"),w=t.res(o,"treeroot"),ot=t.res(o,"adroppable"),st=t.res("tpl","placedir"),ht=t.res("tpl","perms"),b=n(t.res("tpl","navspinner")),g=i.suffix?i.suffix:"",k="places"+g,nt=null,d=function(n){var f,i;return"directory"===n.mime&&(i=n.hash,t.files().hasOwnProperty(i)||t.trigger("tree",{tree:[n]}),f=a(n,i),r[i]=n,u.prepend(f),h.addClass(y),tt.toggle(1<u.children().length),!0)},tt=n('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="'+t.i18n("cmdsort")+'"><\/span>').hide().on("click",function(i){i.stopPropagation();u.empty();n.each(r,function(i,r){var f=t.file(i)||r,e=a(f,i),o=null;if(f||e.hide(),u.children().length&&(n.each(u.children(),function(){var t=n(this);if((f.i18||f.name).localeCompare(t.children("."+s).text())<0)return o=!e.insertBefore(t)}),null!==o))return!0;l(i).length||u.append(e)});f()}),it=a({hash:"root-"+t.namespace,name:t.i18n(i.name,"places"),read:!0,write:!0}),h=it.children("."+s).addClass(w).on("click",function(n){n.stopPropagation();h.hasClass(y)&&(e.toggleClass(p),u.slideToggle(),t.storage("placesState",e.hasClass(p)?1:0))}).append(tt),u=it.children("."+t.res(o,"navsubtree")),e=n(this).addClass(t.res(o,"tree")+" elfinder-places ui-corner-all").hide().append(it).appendTo(t.getUI("navbar")).on("mouseenter mouseleave","."+s,function(t){n(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click","."+s,function(i){var r=n(this);r.data("longtap")?i.stopPropagation():r.hasClass("elfinder-na")||t.exec("open",r.attr("id").substr(6))}).on("contextmenu","."+s+":not(."+w+")",function(i){var r=n(this),u=r.attr("id").substr(6);i.preventDefault();t.trigger("contextmenu",{raw:[{label:t.i18n("moveUp"),icon:"up",remain:!0,callback:function(){var s,n,e,i,o,r;n=l(s=u);e=n.parent();i=e.prev("div");o="ui-state-hover";r=t.getUI("contextmenu");nt&&clearTimeout(nt);i.length&&(r.find(":first").data("placesHash",s),n.addClass(o),e.insertBefore(i),i=e.prev("div"),nt=setTimeout(function(){n.removeClass(o);r.find(":first").data("placesHash")===s&&r.hide().empty()},1500));i.length||(n.removeClass(o),r.hide().empty());f()}},"|",{label:t.i18n("rmFromPlaces"),icon:"rm",callback:function(){c(u);f()}}],x:i.pageX,y:i.pageY});r.addClass("ui-state-hover");t.getUI("contextmenu").children().on("mouseenter",function(){r.addClass("ui-state-hover")});t.bind("closecontextmenu",function(){r.removeClass("ui-state-hover")})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:t.res("class","adroppable"),classes:{"ui-droppable-hover":t.res("class","adroppable")},over:function(i,u){var f=u.helper,e=n.grep(f.data("files"),function(n){return"directory"===t.file(n).mime&&!r[n]});i.stopPropagation();f.data("dropover",f.data("dropover")+1);t.insideWorkzone(i.pageX,i.pageY)&&(0<e.length?(f.addClass("elfinder-drag-helper-plus"),t.trigger("unlockfiles",{files:f.data("files"),helper:f})):n(this).removeClass(ot))},out:function(t,i){var r=i.helper;t.stopPropagation();r.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(r.data("dropover")-1,0));n(this).removeData("dropover").removeClass(ot)},drop:function(i,u){var e=u.helper,o=!0;n.each(e.data("files"),function(n,i){var u=t.file(i);u&&"directory"==u.mime&&!r[u.hash]?d(u):o=!1});f();o&&e.hide()}}).on("touchstart","."+s+":not(."+w+")",function(i){var r,u;1<i.originalEvent.touches.length||(r=n(this).attr("id").substr(6),u=n(this).addClass(et).data("longtap",null).data("tmlongtap",setTimeout(function(){u.data("longtap",!0);t.trigger("contextmenu",{raw:[{label:t.i18n("rmFromPlaces"),icon:"rm",callback:function(){c(r);f()}}],x:i.originalEvent.touches[0].pageX,y:i.originalEvent.touches[0].pageY})},500)))}).on("touchmove touchend","."+s+":not(."+w+")",function(t){clearTimeout(n(this).data("tmlongtap"));"touchmove"==t.type&&n(this).removeClass(et)});n.fn.sortable&&u.addClass("touch-punch").sortable({appendTo:t.getUI(),revert:!1,helper:function(i){var r=n(i.target).parent();return r.children().removeClass("ui-state-hover"),n('<div class="ui-widget elfinder-place-drag elfinder-'+t.direction+'"><\/div>').append(n('<div class="elfinder-navbar"><\/div>').show().append(r.clone()))},stop:function(t,i){var s=n(i.item[0]),h=e.offset().top,u=e.offset().left,l=e.width(),a=e.height(),o=t.pageX,r=t.pageY;u<o&&o<u+l&&h<r&&r<r+a||(c(rt(s.children(":first").attr("id"))),f())},update:function(){f()}});n(this).on("regist",function(t,i){var u=!1;n.each(i,function(n,t){t&&"directory"==t.mime&&!r[t.hash]&&d(t)&&(u=!0)});u&&f()});t.one("load",function(){t.oldAPI||(e.show().parent().show(),ft(),t.change(function(t){var i=!1;n.each(t.data.changed,function(n,t){r[t.hash]&&("directory"!==t.mime?c(t.hash)&&(i=!0):v(t)&&(i=!0))});i&&f()}).bind("rename",function(t){var i=!1;t.data.removed&&n.each(t.data.removed,function(n,r){t.data.added[n]&&v(t.data.added[n],r)&&(i=!0)});i&&f()}).bind("rm paste",function(t){var i=[],r=!1;t.data.removed&&n.each(t.data.removed,function(n,t){var r=c(t);r&&i.push(r)});i.length&&(r=!0);t.data.added&&i.length&&n.each(t.data.added,function(t,r){1!==n.inArray(r.name,i)&&"directory"==r.mime&&d(r)});r&&f()}).bind("sync netmount",function(){var o,s=this,l=i.suffix?i.suffix:"";if("sync"===s.type&&g!==l)return g=l,u.empty(),h.removeClass(y),e.removeClass(p),u.slideToggle(!1),void ft();(o=Object.keys(r)).length&&(h.prepend(b),t.request({data:{cmd:"info",targets:o},preventDefault:!0}).done(function(i){var u={},e=!1,o=t.cwd().hash;n.each(i.files||[],function(n,i){var r=i.hash;u[r]=i;t.files().hasOwnProperty(i.hash)||t.updateCache({tree:[i]})});n.each(r,function(n,t){Boolean(t.notfound)===Boolean(u[n])?t.phash===o&&"netmount"!==s.type||u[n]&&"directory"!==u[n].mime?c(n)&&(e=!0):v(u[n]||Object.assign({notfound:!0},t))&&(e=!0):u[n]&&u[n].phash!=o&&v(u[n])});e&&f()}).always(function(){b.remove()}))}))})})},n.fn.elfindersearchbutton=function(t){return this.each(function(){function u(n){return i.namespace+i.escape(n)}function l(){r.data("inctm")&&clearTimeout(r.data("inctm"));var f=n.trim(r.val()),o=!n("#"+u("SearchFromAll")).prop("checked"),e=n("#"+u("SearchMime")).prop("checked"),s="",o=o&&(n("#"+u("SearchFromVol")).prop("checked")?i.root(i.cwd().hash):i.cwd().hash);e&&(e=f,f=".");h&&(s=h.children("input:checked").val());f?(r.trigger("focus"),t.exec(f,o,e,s).done(function(){y=!0}).fail(function(){c()})):i.trigger("searchend")}var e,h,a,v,y=!1,i=t.fm,s=(i.res("class","disabled"),t.options.incsearch||{enable:!1}),p=t.options.searchTypes,w=i.getUI("toolbar"),b=i.res("class","searchbtn"),f=n(this).hide().addClass("ui-widget-content elfinder-button "+b).on("click",function(n){n.stopPropagation()}),c=function(){r.data("inctm")&&clearTimeout(r.data("inctm"));r.val("").trigger("blur");(y||o)&&(y=!1,o="",i.lazy(function(){i.trigger("searchend")}))},o="",r=n('<input type="text" size="42"/>').on("focus",function(){var n,t;f.hasClass("ui-state-active")||i.getUI().click();v=!0;o="";f.addClass("ui-state-active");i.trigger("uiresize");e&&e.css((n=i.getUI(),t=n.offset(),{top:f.offset().top-t.top,maxHeight:n.height()-40})).slideDown(function(){f.addClass("ui-state-active");i.toFront(e)})}).on("blur",function(){v=!1;e?e.data("infocus")?e.data("infocus",!1):e.slideUp(function(){f.removeClass("ui-state-active");i.trigger("uiresize");i.toHide(e)}):f.removeClass("ui-state-active")}).appendTo(f).on("keypress",function(n){n.stopPropagation()}).on("keydown",function(t){t.stopPropagation();t.keyCode===n.ui.keyCode.ENTER?l():t.keyCode===n.ui.keyCode.ESCAPE&&(t.preventDefault(),c())});s.enable&&(s.minlen=s.minlen||2,s.wait=s.wait||500,r.attr("title",i.i18n("incSearchOnly")).on("compositionstart",function(){r.data("composing",!0)}).on("compositionend",function(){r.removeData("composing");r.trigger("input")}).on("input",function(){r.data("composing")||(r.data("inctm")&&clearTimeout(r.data("inctm")),r.data("inctm",setTimeout(function(){var n=r.val();(0===n.length||n.length>=s.minlen)&&(o!==n&&i.trigger("incsearchstart",{query:n,type:h?h.children("input:checked").val():"searchName"}),""===(o=n)&&1<i.searchStatus.state&&i.searchStatus.query&&r.val(i.searchStatus.query).trigger("select"))},s.wait)))}),i.UA.ltIE8&&r.on("keydown",function(n){229===n.keyCode&&(r.data("imetm")&&clearTimeout(r.data("imetm")),r.data("composing",!0),r.data("imetm",setTimeout(function(){r.removeData("composing")},100)))}).on("keyup",function(t){r.data("imetm")&&clearTimeout(r.data("imetm"));r.data("composing")?t.keyCode===n.ui.keyCode.ENTER&&r.trigger("compositionend"):r.trigger("input")}));n('<span class="ui-icon ui-icon-search" title="'+t.title+'"><\/span>').appendTo(f).on("mousedown",function(n){n.stopPropagation();n.preventDefault();f.hasClass("ui-state-active")?l():r.trigger("focus")});n('<span class="ui-icon ui-icon-close"><\/span>').appendTo(f).on("mousedown",function(n){n.stopPropagation();n.preventDefault();""!==r.val()||f.hasClass("ui-state-active")?c():r.trigger("focus")});i.bind("toolbarload",function(){var n,t=f.parent();t.length&&(w.prepend(f.show()),t.remove(),i.UA.ltIE7&&(n=f.children("ltr"==i.direction?".ui-icon-close":".ui-icon-search")).css({right:"",left:parseInt(f.width())-n.outerWidth(!0)}))});i.one("init",function(){i.getUI("cwd").on("touchstart click",function(){v&&r.trigger("blur")})}).one("open",function(){(e=i.api<2.1?null:n('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all"><\/div>').append(n('<div class="buttonset"><\/div>').append(n('<input id="'+u("SearchFromCwd")+'" name="serchfrom" type="radio" checked="checked"/><label for="'+u("SearchFromCwd")+'">'+i.i18n("btnCwd")+"<\/label>"),n('<input id="'+u("SearchFromVol")+'" name="serchfrom" type="radio"/><label for="'+u("SearchFromVol")+'">'+i.i18n("btnVolume")+"<\/label>"),n('<input id="'+u("SearchFromAll")+'" name="serchfrom" type="radio"/><label for="'+u("SearchFromAll")+'">'+i.i18n("btnAll")+"<\/label>")),n('<div class="buttonset elfinder-search-type"><\/div>').append(n('<input id="'+u("SearchName")+'" name="serchcol" type="radio" checked="checked" value="SearchName"/><label for="'+u("SearchName")+'">'+i.i18n("btnFileName")+"<\/label>"))).hide().appendTo(i.getUI()))&&(p&&(h=e.find(".elfinder-search-type"),n.each(t.options.searchTypes,function(t,r){h.append(n('<input id="'+u(t)+'" name="serchcol" type="radio" value="'+i.escape(t)+'"/><label for="'+u(t)+'">'+i.i18n(r.name)+"<\/label>"))})),e.find("div.buttonset").buttonset(),n("#"+u("SearchFromAll")).next("label").attr("title",i.i18n("searchTarget",i.i18n("btnAll"))),p&&n.each(p,function(t,r){r.title&&n("#"+u(t)).next("label").attr("title",i.i18n(r.title))}),e.on("mousedown","div.buttonset",function(n){n.stopPropagation();e.data("infocus",!0)}).on("click","input",function(t){t.stopPropagation();n.trim(r.val())?l():r.trigger("focus")}).on("close",function(){r.trigger("blur")}))}).bind("searchend",function(){r.val("")}).bind("open parents",function(){var t=[],r=i.file(i.root(i.cwd().hash));r&&(n.each(i.parents(i.cwd().hash),function(n,r){t.push(i.file(r).name)}),n("#"+u("SearchFromCwd")).next("label").attr("title",i.i18n("searchTarget",t.join(i.option("separator")))),n("#"+u("SearchFromVol")).next("label").attr("title",i.i18n("searchTarget",r.name)))}).bind("open",function(){o&&c()}).bind("cwdinit",function(){a=!1}).bind("cwdrender",function(){a=!0}).bind("keydownEsc",function(){o&&"/"===o.substr(0,1)&&(o="",r.val(""),i.trigger("searchend"))}).shortcut({pattern:"ctrl+f f3",description:t.title,callback:function(){r.trigger("select").trigger("focus")}}).shortcut({pattern:"a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9",description:i.i18n("firstLetterSearch"),callback:function(t){var f,e,u;a&&(e=function(){var t=i.selected(),r=n.ui.keyCode[!t.length||i.cwdHash2Elm(t[0]).next("[id]").length?"RIGHT":"HOME"];n(document).trigger(n.Event("keydown",{keyCode:r,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},96<=(f=t.originalEvent.keyCode)&&f<=105&&(f-=48),u="/"+String.fromCharCode(f),o!==u?(r.val(u),o=u,i.trigger("incsearchstart",{query:u}).one("cwdrender",e)):e())}})})},n.fn.elfindersortbutton=function(t){return this.each(function(){function s(){i.toHide(r)}function l(){r.children("[rel]").removeClass(f+" "+v+" "+y).filter('[rel="'+i.sortType+'"]').addClass(f+" "+("asc"==i.sortOrder?v:y));r.children(".elfinder-sort-stick").toggleClass(f,i.sortStickFolders);r.children(".elfinder-sort-tree").toggleClass(f,i.sortAlsoTreeview)}var h,i=t.fm,a=t.name,o=i.res("class","disabled"),c=i.res("class","hover"),u="elfinder-button-menu-item",f=u+"-selected",v=f+"-asc",y=f+"-desc",p=n('<span class="elfinder-button-text">'+t.title+"<\/span>"),e=n(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+a).attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+a+'"><\/span>',p).on("mouseenter mouseleave",function(n){e.hasClass(o)||e.toggleClass(c,"mouseenter"===n.type)}).on("click",function(n){e.hasClass(o)||(n.stopPropagation(),r.is(":hidden")&&i.getUI().click(),r.css(w()).slideToggle({duration:100,done:function(){i[r.is(":visible")?"toFront":"toHide"](r)}}))}),r=n('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-sort-menu ui-corner-all"><\/div>').hide().appendTo(i.getUI()).on("mouseenter mouseleave","."+u,function(t){n(this).toggleClass(c,"mouseenter"===t.type)}).on("click",function(n){n.preventDefault();n.stopPropagation()}).on("close",s),w=function(){var n=i.getUI().offset(),t=e.offset();return{top:t.top-n.top,left:t.left-n.left}};p.hide();n.each(i.sortRules,function(t){r.append(n('<div class="'+u+'" rel="'+t+'"><span class="ui-icon ui-icon-arrowthick-1-n"><\/span><span class="ui-icon ui-icon-arrowthick-1-s"><\/span>'+i.i18n("sort"+t)+"<\/div>").data("type",t))});r.children().on("click",function(){t.exec([],n(this).removeClass(c).attr("rel"))});n('<div class="'+u+" "+u+'-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"><\/span>'+i.i18n("sortFoldersFirst")+"<\/div>").appendTo(r).on("click",function(){t.exec([],"stick")});i.one("init",function(){i.ui.tree&&null!==i.options.sortAlsoTreeview&&n('<div class="'+u+" "+u+'-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"><\/span>'+i.i18n("sortAlsoTreeview")+"<\/div>").appendTo(r).on("click",function(){t.exec([],"tree")})}).bind("disable select",s).bind("sortchange",l).getUI().on("click",s);1<r.children().length?t.change(function(){h&&cancelAnimationFrame(h);h=requestAnimationFrame(function(){e.toggleClass(o,t.disabled());l()})}).change():e.addClass(o)})},n.fn.elfinderstat=function(t){return this.each(function(){function u(n){i.find("span.elfinder-stat-incsearch").html(n?n.hashes.length+" / ":"");i.attr("title",i.text());t.trigger("uistatchange")}function f(i){var e,u,f=0,h=0,c=[];1===i.length?(u=i[0],f=u.size,2===t.searchStatus.state&&(e=t.escape(u.path?u.path.replace(/\/[^\/]*$/,""):".."),c.push('<a href="#elf_'+u.phash+'" data-hash="'+u.hash+'" title="'+e+'">'+e+"<\/a>")),c.push(t.escape(u.i18||u.name)),r.html(c.join("/")+(0<f?", "+t.formatSize(f):""))):i.length?(n.each(i,function(n,t){h++;f+=parseInt(t.size)||0}),r.html(h?o+": "+h+", "+s+": "+t.formatSize(f):"&nbsp;")):r.html("");r.attr("title",r.text());t.trigger("uistatchange")}var i=n(this).addClass("elfinder-stat-size"),r=n('<div class="elfinder-stat-selected"><\/div>').on("click","a",function(i){var r=n(this).data("hash");i.preventDefault();t.exec("opendir",[r])}),e=t.i18n("items"),o=t.i18n("selected"),s=t.i18n("size");t.getUI("statusbar").prepend(i).append(r).show();t.UA.Mobile&&n.fn.tooltip&&t.getUI("statusbar").tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0});t.bind("cwdhasheschange",function(r){var c,s,f,o,h,u;c=n.map(r.data,function(n){return t.file(n)});f=s=0;o=t.cwd();u=h=!0;(o.sizeInfo||o.size)&&(f=o.size,h=!1);n.each(c,function(n,t){s++;h&&(f+=parseInt(t.size)||0,!0!==u||"directory"!==t.mime||t.sizeInfo||(u=!1))});i.html(e+': <span class="elfinder-stat-incsearch"><\/span>'+s+',&nbsp;<span class="elfinder-stat-size'+(u?" elfinder-stat-size-recursive":"")+'">'+t.i18n(u?"sum":"size")+": "+t.formatSize(f)+"<\/span>").attr("title",i.text());t.trigger("uistatchange")}).change(function(r){var u=r.data.changed||[],f=t.cwd().hash;n.each(u,function(){if(this.hash===f)return this.size&&(i.children(".elfinder-stat-size").addClass("elfinder-stat-size-recursive").html(t.i18n("sum")+": "+t.formatSize(this.size)),i.attr("title",i.text())),!1})}).select(function(){f(t.selectedFiles())}).bind("open",function(){f([])}).bind("incsearch",function(n){u(n.data)}).bind("incsearchend",function(){u()})})},n.fn.elfindertoast=function(t,i){var r=Object.assign({mode:"success",msg:"",showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing",onHidden:void 0,timeOut:3e3,extNode:void 0,button:void 0,width:void 0},n.isPlainObject(i.options.uiOptions.toast.defaults)?i.options.uiOptions.toast.defaults:{});return this.each(function(){function e(n){u.stop();i.toFront(u);u[t.showMethod]({duration:t.showDuration,easing:t.showEasing,complete:function(){t.onShown&&t.onShown();!n&&t.timeOut&&(f=setTimeout(o,t.timeOut))}})}t=Object.assign({},r,t||{});var f,u=n(this),o=function(){u[t.hideMethod]({duration:t.hideDuration,easing:t.hideEasing,complete:function(){t.onHidden&&t.onHidden();u.remove()}})};u.on("click",function(n){n.stopPropagation();n.preventDefault();f&&clearTimeout(f);t.onHidden&&t.onHidden();u.stop().remove()}).on("mouseenter mouseleave",function(n){t.timeOut&&(f&&clearTimeout(f),f=null,"mouseenter"===n.type?e(!0):f=setTimeout(o,t.timeOut))}).hide().addClass("toast-"+t.mode).append(n('<div class="elfinder-toast-msg"><\/div>').html(t.msg.replace(/%([a-zA-Z0-9]+)%/g,function(n,t){return i.i18n(t)})));t.extNode&&u.append(t.extNode);t.button&&u.append(n('<button class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><\/button>').append(n('<span class="ui-button-text"><\/span>').text(i.i18n(t.button.text))).on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click",t.button.click||function(){}));t.width&&u.css("max-width",t.width);e()})},n.fn.elfindertoolbar=function(t,i){return this.not(".elfinder-toolbar").each(function(){function g(i){var s,h;for(n.each(u,function(n,t){t.detach()}),r.empty(),c=v.length;c--;)if(v[c]){for(o=n('<div class="ui-widget-content ui-corner-all elfinder-buttonset"><\/div>'),p=v[c].length;p--;)s=v[c][p],(!i||!i[s])&&(a=b[s])&&(l="elfinder"+a.options.ui,!u[s]&&n.fn[l]&&(u[s]=n("<div><\/div>")[l](a)),u[s]&&(u[s].children(".elfinder-button-text")[e?"show":"hide"](),o.prepend(u[s])));o.children().length&&r.prepend(o);o.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"><\/span>')}(h=b.preference)&&("always"!==f.showPreferenceButton&&(r.children().length||"auto"!==f.showPreferenceButton)||(o=n('<div class="ui-widget-content ui-corner-all elfinder-buttonset"><\/div>'),s="preference",l="elfinder"+a.options.ui,u[s]=n("<div><\/div>")[l](h),u[s].children(".elfinder-button-text")[e?"show":"hide"](),o.prepend(u[s]),r.append(o)));!r.data("swipeClose")&&r.children().length?r.show():r.hide();d=r[0].clientHeight;t.trigger("toolbarload").trigger("uiresize")}var c,p,a,o,l,s,h,e,w,nt,b=t._commands,r=n(this).addClass("ui-helper-clearfix ui-widget-header elfinder-toolbar"),f={displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"],showPreferenceButton:"none"},u={},v=(nt=i||[],n.grep(nt,function(t){return!n.isPlainObject(t)||(f=Object.assign(f,t),!1)})),k=null,tt="",d=0,y=[];f.showPreferenceButton=f.showPreferenceButton.toLowerCase();"none"!==f.displayTextLabel&&(e=null===(e=t.storage("toolbarTextLabel"))?f.displayTextLabel&&(!f.labelExcludeUA||!f.labelExcludeUA.length||!n.grep(f.labelExcludeUA,function(n){return!!t.UA[n]}).length):1==e,y.push({label:t.i18n("textLabel"),icon:"text",callback:function(){e=!e;r.css("height","").find(".elfinder-button-text")[e?"show":"hide"]();t.trigger("uiresize").storage("toolbarTextLabel",e?"1":"0")}}));f.preferenceInContextmenu&&b.preference&&y.push({label:t.i18n("toolbarPref"),icon:"preference",callback:function(){t.exec("preference",void 0,{tab:"toolbar"})}});y.length&&r.on("contextmenu",function(n){n.stopPropagation();n.preventDefault();t.trigger("contextmenu",{raw:y,x:n.pageX,y:n.pageY})}).on("touchstart",function(n){1<n.originalEvent.touches.length||(r.data("tmlongtap")&&clearTimeout(r.data("tmlongtap")),r.removeData("longtap").data("longtap",{x:n.originalEvent.touches[0].pageX,y:n.originalEvent.touches[0].pageY}).data("tmlongtap",setTimeout(function(){r.removeData("longtapTm").trigger({type:"contextmenu",pageX:r.data("longtap").x,pageY:r.data("longtap").y}).data("longtap",{longtap:!0})},500)))}).on("touchmove touchend",function(n){r.data("tmlongtap")&&(("touchend"===n.type||4<Math.abs(r.data("longtap").x-n.originalEvent.touches[0].pageX)+Math.abs(r.data("longtap").y-n.originalEvent.touches[0].pageY))&&clearTimeout(r.data("tmlongtap")),r.removeData("longtapTm"))}).on("click",function(n){r.data("longtap")&&r.data("longtap").longtap&&(n.stopImmediatePropagation(),n.preventDefault())}).on("touchend click",".elfinder-button",function(n){r.data("longtap")&&r.data("longtap").longtap&&(n.stopImmediatePropagation(),n.preventDefault())});r.prev().length&&r.parent().prepend(this);g();t.bind("open sync select toolbarpref",function(){var s,h,o,i=Object.assign({},t.option("disabledFlip")),r=t.storage("toolbarhides");if(!r&&Array.isArray(f.defaultHides)&&(r={},n.each(f.defaultHides,function(){r[this]=!0}),t.storage("toolbarhides",r)),"select"===this.type){if(t.searchStatus.state<2)return;(h=t.selected()).length&&(i=t.getDisabledCmds(h,!0))}n.each(r,function(n){i[n]||(i[n]=!0)});Object.keys(t.commandMap).length&&n.each(t.commandMap,function(n,t){"hidden"===t&&(i[n]=!0)});o=Object.keys(i);k&&k.toString()===o.sort().toString()||(g(o.length?i:null),s=!0);k=o.sort();!s&&tt===JSON.stringify(t.commandMap)||(tt=JSON.stringify(t.commandMap),s||n.each(n("div.elfinder-button"),function(){var t=n(this).data("origin");t&&n(this).after(t).detach()}),Object.keys(t.commandMap).length&&n.each(t.commandMap,function(i,r){var s,f=t._commands[r],o=f?"elfinder"+f.options.ui:null;o&&n.fn[o]&&(s=u[i])&&(!u[r]&&n.fn[o]&&(u[r]=n("<div><\/div>")[o](f),u[r]&&(u[r].children(".elfinder-button-text")[e?"show":"hide"](),f.extendsCmd&&u[r].children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+f.extendsCmd))),u[r]&&(s.after(u[r]),u[r].data("origin",s.detach())))}))}).bind("resize",function(){w&&cancelAnimationFrame(w);w=requestAnimationFrame(function(){var n=r[0].clientHeight;d!==n&&(d=n,t.trigger("uiresize"))})});t.UA.Touch&&(void 0===(h=t.storage("autoHide")||{}).toolbar&&(h.toolbar=f.autoHideUA&&0<f.autoHideUA.length&&n.grep(f.autoHideUA,function(n){return!!t.UA[n]}).length,t.storage("autoHide",h)),h.toolbar&&t.one("init",function(){t.uiAutoHide.push(function(){r.stop(!0,!0).trigger("toggle",{duration:500,init:!0})})}),t.bind("load",function(){"none"!==(s=n('<div class="elfinder-toolbar-swipe-handle"><\/div>').hide().appendTo(t.getUI())).css("pointer-events")&&(s.remove(),s=null)}),r.on("toggle",function(n,i){var f=t.getUI("workzone"),u=r.is(":hidden"),o=f.height(),e=r.height(),c=r.outerHeight(!0)-e,l=Object.assign({step:function(n){f.height(o+(u?-1*(n+c):e-n));t.trigger("resize")},always:function(){requestAnimationFrame(function(){r.css("height","");t.trigger("uiresize");s&&(u?s.stop(!0,!0).hide():(s.height(i.handleH?i.handleH:""),t.resources.blink(s,"slowonce")));u&&r.scrollTop("0px");i.init&&t.trigger("uiautohide")})}},i);r.data("swipeClose",!u).stop(!0,!0).animate({height:"toggle"},l);h.toolbar=!u;t.storage("autoHide",Object.assign(t.storage("autoHide"),{toolbar:h.toolbar}))}).on("touchstart",function(n){5<r.scrollBottom()&&(n.originalEvent._preventSwipeY=!0)}))}),this},n.fn.elfindertree=function(t,i){var r=t.res("class","tree");return this.not("."+r).each(function(){function at(n){var t=ri.offset().left;return t<=n&&n<=t+ri.width()}function yi(i){var r=[];if(n.each(i,function(n,i){ct[i]&&r.push(t.navId2Hash(i));delete ct[i]}),r.length)return t.request({data:{cmd:"subdirs",targets:r,preventDefault:!0}}).done(function(i){i&&i.subdirs&&n.each(i.subdirs,function(n,i){var r=t.navHash2Elm(n);r.removeClass(si);r[i?"addClass":"removeClass"](e)})})}function v(){var i=Object.keys(ct);i.length&&(dt&&dt._abort(),rt&&clearTimeout(rt),g=[],dt=t.asyncJob(function(i){return t.isInWindow(n("#"+i))?i:null},i,{numPerOnce:200}).done(function(n){n.length&&(g=n,ni())}))}function tt(n){return ki.replace(/(?:\{([a-z]+)\})/gi,function(t,i){var r=ai[i]?ai[i](n):n[i]||"";return"id"===i&&-1==n.dirs&&(ct[r]=r),r})}function b(i,r){return n.map(i||[],function(n){return"directory"!==n.mime||r&&!t.navHash2Elm(n.hash).length?null:n})}function it(n){return n?t.navHash2Elm(n).next("."+p):a}function ui(n,i){for(var u,r=n.children(":first");r.length;){if(t.file(t.navId2Hash(r.children("[id]").attr("id"))),(u=t.file(t.navId2Hash(r.children("[id]").attr("id"))))&&ti(i,u)<0)return r;r=r.next()}return n.children("button.elfinder-navbar-pager-next")}function fi(n){for(var r,f=n||t.cwd(),o=f.hash?[f.hash]:[],e=t.root(f.hash),i=t.file(e);i&&(r=i.phash)&&(o.unshift(r),e=t.root(r),i=t.file(e),!t.navHash2Elm(i.hash).hasClass(u)););return o}function k(n){var i=n||t.cwd(),u=i.hash,r=t.navHash2Elm(u);if(!r.length){for(;i&&i.phash;)l[i.phash]&&!t.navHash2Elm(i.hash).length&&l[i.phash].trigger("update."+t.namespace,{select:i.hash}),i=t.file(i.phash);r=t.navHash2Elm(u)}return r}function et(i,r){function g(r,e){function l(){ei&&o&&(it(o.hash).show().prev(f).addClass(s),ei=!1);ot?lt().done(v):v()}var h;r&&n.each(r,function(n,i){i&&c(i);k(t.file(n));i&&nt(i,u)});i&&(t.api<2.1&&i.push(et),c(i));(h=k()).hasClass(y)||(a.find(f+"."+y).removeClass(y),h.addClass(y));h.parents(".elfinder-navbar-wrapper").children("."+bt).addClass(u);r?t.lazy(l).done(function(){e.resolve()}):(l(),e.resolve())}function tt(n){o&&(rt.remove(),o.addClass(e+(n?"":" "+u)))}var o,rt,st,p,w,ft,h,d,et=t.cwd(),ht=et.hash,ot=void 0===r?pi:r,l=n.Deferred();return t.navHash2Elm(ht).length?g(void 0,l):(yt=!0,h=n.Deferred(),d=fi(st),((ft=n.map(d,function(n){var r,f,c,o,e=t.file(n),s=!!e&&t.isRoot(e),l=t.navHash2Elm(n),i=function(n,r){var f,e=r||1,u=!!(f=t.file(n))&&f.phash;return u&&1<e?i(u,--e):u},h=function(){var f=i(n);for(r=f;f&&!t.navHash2Elm(f).hasClass(u);)f=i(r=f);return f||(r=void 0,f=t.root(n)),f}();return l.hasClass(u)||!s&&e&&t.navHash2Elm(e.phash).hasClass(u)?null:(s||h===i(n)||h===i(n,2)?(r=void 0,f="tree",s||(n=i(n))):f="parents",p=p||("tree"===f?n:h),o={cmd:f,target:n},(c=r)&&(o.until=c),t.request({data:o,preventFail:!0}))})).length?(k(t.file(p)),w=t.navHash2Id(p),ot&&lt(w),o=n("#"+w),rt=n(t.res("tpl","navspinner")).insertBefore(o.children("."+ut)),o.removeClass(e),n.when.apply(n,ft).done(function(){var t,n,i={},r=arguments.length;if(0<r)for(n=0;n<r;n++)t=arguments[n].tree||[],i[d[n]]=Object.assign([],b(t));h.resolve(i)}).fail(function(){h.reject()}),h):h.resolve()).done(function(n){g(n,l);tt()}).fail(function(){tt(!0);l.reject()}).always(function(){yt=!1})),t.trigger("treesync",l),l}var rt,vt,yt,pt,o="class",d=t.UA.Mobile,wt=t.res(o,"treeroot"),ei=i.openRootOnLoad,oi=i.openCwdOnOpen,pi=oi||i.syncTree,p=t.res(o,"navsubtree"),bt=t.res(o,"treedir"),f="span."+bt,e=t.res(o,"navcollapse"),s=t.res(o,"navexpand"),u="elfinder-subtree-loaded",si="elfinder-subtree-chksubdir",ut=t.res(o,"navarrow"),y=t.res(o,"active"),w=t.res(o,"adroppable"),h=t.res(o,"hover"),kt=t.res(o,"disabled"),hi=t.res(o,"draggable"),ci=t.res(o,"droppable"),ot="elfinder-navbar-wrapper-root",st="elfinder-navbar-wrapper-pastable",ht="elfinder-navbar-wrapper-uploadable",ct={},g=[],dt=null,gt=0,ni=function(){var n,r=i.subdirsMaxConn-gt,u=t.maxTargets?Math.min(t.maxTargets,i.subdirsAtOnce):i.subdirsAtOnce;if(rt&&cancelAnimationFrame(rt),g.length)if(0<r)for(n=0;n<r;n++)g.length&&(gt++,yi(g.splice(0,u)).always(function(){gt--;ni()}));else rt=requestAnimationFrame(function(){g.length&&ni()})},wi=t.droppable.drop,bi=n.extend(!0,{},t.droppable,{over:function(i,r){var c,o,u=n(this),f=r.helper,l=h+" "+w;if(i.stopPropagation(),f.data("dropover",f.data("dropover")+1),u.data("dropover",!0),r.helper.data("namespace")!==t.namespace||!t.insideWorkzone(i.pageX,i.pageY))return u.removeClass(l),void f.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");at(i.clientX)?(f.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"),u.addClass(h),u.is("."+e+":not(."+s+")")&&u.data("expandTimer",setTimeout(function(){u.is("."+e+"."+h)&&u.children("."+ut).trigger("click")},500)),u.is(".elfinder-ro,.elfinder-na")?u.removeClass(w):(c=t.navId2Hash(u.attr("id")),u.data("dropover",c),n.each(r.helper.data("files"),function(n,i){if(i===c||t.file(i).phash===c&&!r.helper.hasClass("elfinder-drag-helper-plus"))return u.removeClass(l),!1}),f.data("locked")?o="elfinder-drag-helper-plus":(o="elfinder-drag-helper-move",(i.shiftKey||i.ctrlKey||i.metaKey)&&(o+=" elfinder-drag-helper-plus")),u.hasClass(w)&&f.addClass(o),requestAnimationFrame(function(){u.hasClass(w)&&f.addClass(o)}))):u.removeClass(l)},out:function(t,i){var r=n(this),u=i.helper;t.stopPropagation();at(t.clientX)&&u.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");u.data("dropover",Math.max(u.data("dropover")-1,0));r.data("expandTimer")&&clearTimeout(r.data("expandTimer"));r.removeData("dropover").removeClass(h+" "+w)},deactivate:function(){n(this).removeData("dropover").removeClass(h+" "+w)},drop:function(n,t){at(n.clientX)&&wi.call(this,n,t)}}),li=n(t.res("tpl","navspinner")),ki=t.res("tpl","navdir"),di=t.res("tpl","perms"),gi=(t.res("tpl","lock"),t.res("tpl","symlink")),l={},ai={id:function(n){return t.navHash2Id(n.hash)},name:function(n){return t.escape(n.i18||n.name)},cssclass:function(n){var r=(n.phash&&!n.isroot?"":wt)+" "+bt+" "+t.perms2class(n);return n.dirs&&!n.link&&(r+=" "+e)&&-1==n.dirs&&(r+=" "+si),i.getClass&&(r+=" "+i.getClass(n)),n.csscls&&(r+=" "+t.escape(n.csscls)),r},title:function(n){return i.attrTitle?' title="'+t.escape(t.path(n.hash,!0)||n.i18||n.name)+'"':""},root:function(t){var i="";return!t.phash||t.isroot?(i+=" "+ot,!t.disabled||t.disabled.length<1?i+=" "+st+" "+ht:(-1===n.inArray("paste",t.disabled)&&(i+=" "+st),-1===n.inArray("upload",t.disabled)&&(i+=" "+ht)),i):""},permissions:function(n){return n.read&&n.write?"":di},symlink:function(n){return n.alias?gi:""},style:function(n){return n.icon?t.getIconStyle(n):""}},c=function(r){function ut(r,f){function h(){o={};n.each(f,function(n,t){o[t.hash]=n})}function c(t,i){var u,e;t.stopPropagation();i.select?s(v(i.select)):i.change?"prepare"===(e=i.change)?n.each(f,function(n,t){t.node&&r.append(t.node.hide())}):"done"===e&&n.each(f,function(n,t){t.node&&t.node.detach().show()}):(i.removed&&i.removed.length&&(f=n.grep(f,function(n){return-1===i.removed.indexOf(n.hash)||(u=u||!0,!1)})),i.added&&i.added.length&&(f=f.concat(n.grep(i.added,function(n){return void 0===o[n.hash]&&(u=u||!0,!0)}))),u&&(f.sort(ti),h(),s(a)))}var o={},a=0,e=t.newAPI?Math.min(1e4,Math.max(10,i.subTreeMax)):1e4,v=function(n){if(void 0!==o[n])return Math.floor(o[n]/e)*e},y=t.navId2Hash(r.prev("[id]").attr("id")),s=function(i,u){var w,b,o,k,g,nt,it,rt=[],ut={};delete l[y];a=i;r.off("update."+t.namespace,c);f.length>e&&(r.on("update."+t.namespace,c),void 0===i&&(h(),void 0===(i=v(et.hash))&&(i=0)),o=f.slice(i,i+e),l[y]=r,k=i?Math.max(-1,i-e):-1,g=i+e>=f.length?0:i+e,w=Math.ceil(f.length/e),b=Math.ceil(i/e));n.each(o||f,function(n,t){rt.push(tt(t));t.node&&(ut[t.hash]=t.node)});nt=-1<k?n('<button class="elfinder-navbar-pager elfinder-navbar-pager-prev"><\/button>').text(t.i18n("btnPrevious",b,w)).button({icons:{primary:"ui-icon-caret-1-n"}}).on("click",function(n){n.preventDefault();n.stopPropagation();s(k,"up")}):n();it=g?n('<button class="elfinder-navbar-pager elfinder-navbar-pager-next"><\/button>').text(t.i18n("btnNext",b+2,w)).button({icons:{primary:"ui-icon-caret-1-s"}}).on("click",function(n){n.preventDefault();n.stopPropagation();s(g,"down")}):n();p();r.empty()[o?"addClass":"removeClass"]("elfinder-navbar-hasmore").append(nt,rt.join(""),it);n.each(ut,function(n,i){t.navHash2Elm(n).parent().replaceWith(i)});u&&lt(t.navHash2Id(o["up"===u?o.length-1:0].hash));d||t.lazy(function(){ft(null,r)})},p=function(){n.each(r.children(".elfinder-navbar-wrapper"),function(i,r){var e,s,h=n(r),c=h.children("[id]:first");c.hasClass(u)&&(e=t.navId2Hash(c.attr("id")))&&void 0!==(s=o[e])&&(f[s].node=h.detach())})};s()}for(var f,e,w,h,k,o,a,g=r.length,v=[],nt=g,y=n(),rt={},et=t.cwd(),s={},b=[],p={};nt--;)rt[(f=r[nt]).hash]||t.navHash2Elm(f.hash).length||(rt[f.hash]=!0,(e=it(f.phash)).length?(void 0===p[a=f.phash||"treeroot"]&&(p[a]=e.children(":last")),h=!p[a].length,f.phash&&(h||e.hasClass("elfinder-navbar-hasmore")||(w=ui(e,f)).length)?h?(s[f.phash]||(s[f.phash]=[]),s[f.phash].push(f)):w?(o=tt(f),w.before(o),d||(y=y.add(o))):b.push(f):(o=tt(f),h?e.prepend(o):p[a].after(o),f.phash&&!f.isroot||(k=t.navHash2Elm(f.hash).parent()),d||ft(null,k))):v.push(f));Object.keys(s).length&&n.each(s,function(n,t){var i=it(n);t.sort(ti);ut(i,t)});b.length&&e.trigger("update."+t.namespace,{added:b});v.length&&v.length<g?c(v):!d&&y.length&&t.lazy(function(){ft(y)})},ti=function(n,i){if(t.sortAlsoTreeview){var f="asc"==t.sortOrder,e=t.sortType,r=t.sortRules,u=f?r[t.sortType](n,i):r[t.sortType](i,n);return"name"!==e&&0===u?u=f?r.name(n,i):r.name(i,n):u}return t.sortRules.name(n,i)},lt=function(r){var f,e,o,c,v,l,h=n.Deferred();return vt&&clearTimeout(vt),vt=setTimeout(function(){(f=n(document.getElementById(r||t.navHash2Id(t.cwd().hash)))).length?((oi?f:f.parent()).parents(".elfinder-navbar-wrapper").children("."+u).addClass(s).next("."+p).show(),e=a.parent().stop(!1,!0),o=e.offset().top,c=e.height(),v=o+c-f.outerHeight(),(l=f.offset().top)<o||v<l?e.animate({scrollTop:e.scrollTop()+l-o-c/3},{duration:i.durations.autoScroll,complete:function(){h.resolve()}}):h.resolve()):h.reject()},100),h},ft=function(i,r){i||(r&&!r.closest("div."+ot).hasClass(ht)||(r||a.find("div."+ht)).find(f+":not(.elfinder-ro,.elfinder-na)").addClass("native-droppable"),i=!r||r.closest("div."+ot).hasClass(st)?(r||a.find("div."+st)).find(f+":not(."+ci+")"):n(),r&&r.children("div."+ot).each(function(){ft(null,n(this))}));i.length&&t.asyncJob(function(t){n(t).droppable(bi)},n.makeArray(i),{interval:20,numPerOnce:100})},nt=function(i,r){var f=r==u?"."+e+":not(."+u+")":":not(."+e+")";n.each(i,function(i,u){t.navHash2Elm(u.phash).filter(f).filter(function(){return 0<n.grep(n(this).next("."+p).children(),function(t){return!n(t).children().hasClass(wt)}).length}).addClass(r)})},a=n(this).addClass(r).on("mouseenter mouseleave",f,function(r){var u,e,o,f="mouseenter"===r.type;f&&ii||((u=n(this)).hasClass(w+" "+kt)||(d||!f||u.data("dragRegisted")||u.hasClass(wt+" "+hi+" elfinder-na elfinder-wo")||(u.data("dragRegisted",!0),t.isCommandEnabled("copy",e=t.navId2Hash(u.attr("id")))&&u.draggable(t.draggable)),u.toggleClass(h,f)),f&&i.attrTitle&&((o=t.file(e||t.navId2Hash(u.attr("id")))).isroot||u.attr("title")!==(o.i18||o.name)||u.attr("title",t.path(e,!0))))}).on("dragenter",f,function(t){var i;t.originalEvent.dataTransfer&&((i=n(this)).addClass(h),i.is("."+e+":not(."+s+")")&&i.data("expandTimer",setTimeout(function(){i.is("."+e+"."+h)&&i.children("."+ut).trigger("click")},500)))}).on("dragleave",f,function(t){var i;t.originalEvent.dataTransfer&&((i=n(this)).data("expandTimer")&&clearTimeout(i.data("expandTimer")),i.removeClass(h))}).on("click",f,function(i){var r=n(this),u=t.navId2Hash(r.attr("id"));if(t.file(u),r.data("longtap"))return r.removeData("longtap"),void i.stopPropagation();r.hasClass(y)||(a.find(f+"."+y).removeClass(y),r.addClass(y));u==t.cwd().hash||r.hasClass(kt)?(r.hasClass(e)&&r.children("."+ut).trigger("click"),t.select({selected:[u],origin:"navbar"})):t.exec("open",u).done(function(){t.one("opendone",function(){t.select({selected:[u],origin:"navbar"})})})}).on("touchstart",f,function(i){var r,u;1<i.originalEvent.touches.length||(r=i.originalEvent,"INPUT"!==i.target.nodeName?u=n(this).addClass(h).removeData("longtap").data("tmlongtap",setTimeout(function(){u.data("longtap",!0);t.trigger("contextmenu",{type:"navbar",targets:[t.navId2Hash(u.attr("id"))],x:r.touches[0].pageX,y:r.touches[0].pageY})},500)):i.stopPropagation())}).on("touchmove touchend",f,function(t){"INPUT"!==t.target.nodeName?(clearTimeout(n(this).data("tmlongtap")),n(this).removeData("tmlongtap"),"touchmove"==t.type&&n(this).removeClass(h)):t.stopPropagation()}).on("click",f+"."+e+" ."+ut,function(r){var l=n(this),o=l.parent(f),h=o.next("."+p),a=n.Deferred();r.stopPropagation();o.hasClass(u)?(o.toggleClass(s),t.lazy(function(){30<(o.hasClass(s)?h.children().length+h.find("div.elfinder-navbar-subtree[style*=block]").children().length:h.find("div:visible").length)?(h.toggle(),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),v()):h.stop(!0,!0)[o.hasClass(s)?"slideDown":"slideUp"](i.durations.slideUpDown,function(){t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1);v()})}).always(function(){a.resolve()})):(li.insertBefore(l),o.removeClass(e),t.request({cmd:"tree",target:t.navId2Hash(o.attr("id"))}).done(function(n){c(Object.assign([],b(n.tree)));h.children().length&&(o.addClass(e+" "+s),30<h.children().length?(h.show(),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),v()):h.stop(!0,!0).slideDown(i.durations.slideUpDown,function(){t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1);v()}))}).always(function(){li.remove();o.addClass(u);t.one("treedone",function(){a.resolve()})}));l.data("dfrd",a)}).on("contextmenu",f,function(i){var r=n(this);r.find("input:text").length?i.stopPropagation():(i.preventDefault(),r.data("tmlongtap")||t.trigger("contextmenu",{type:"navbar",targets:[t.navId2Hash(n(this).attr("id"))],x:i.pageX,y:i.pageY}),r.addClass("ui-state-hover"),t.getUI("contextmenu").children().on("mouseenter",function(){r.addClass("ui-state-hover")}),t.bind("closecontextmenu",function(){r.removeClass("ui-state-hover")}))}).on("scrolltoview",f,function(i,r){var u=n(this);lt(u.attr("id")).done(function(){r&&"undefined"!==r.blink&&!r.blink||t.resources.blink(u,"lookme")})}).on("create."+t.namespace,function(i,r){var f=it(r.phash),e=r.move||!1,o=n(tt(r)).addClass("elfinder-navbar-wrapper-tmp"),u=t.selected();e&&u.length&&t.trigger("lockfiles",{files:u});f.prepend(o)}),ii=!1,ri=t.getUI("navbar").append(a).show().on("scroll",function(){ii=!0;pt&&cancelAnimationFrame(pt);pt=requestAnimationFrame(function(){ii=!1;v()})}),vi=t.sortAlsoTreeview;t.open(function(n){var r=n.data,i=b(r.files),f=t.getUI("contextmenu");r.init&&a.empty();t.UA.iOS&&ri.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch");i.length?t.lazy(function(){f.data("cmdMaps")||f.data("cmdMaps",{});c(i);nt(i,u);et(i)}):et()}).add(function(n){var t=b(n.data.added);t.length&&(c(t),nt(t,e))}).change(function(i){if(!yt){var e,a,r,k,g,o,nt,h,y,w,c,rt,ut=b(i.data.changed,!0),ot=ut.length,st=ot;for(n(),n.each(l,function(n,i){i.trigger("update."+t.namespace,{change:"prepare"})});st--;)if(a=(e=ut[st]).phash,(r=t.navHash2Elm(e.hash)).length){if(c=r.parent(),a){if(g=r.closest("."+p),o=it(a),nt=r.parent().next(),h=ui(o,e),!o.length)continue;o[0]===g[0]&&nt.get(0)===h.get(0)||(h.length?h.before(c):o.append(c))}y=r.hasClass(s);w=r.hasClass(u);k=n(tt(e));r.replaceWith(k.children(f));d||ft(null,c);e.dirs&&(y||w)&&(r=t.navHash2Elm(e.hash))&&r.next("."+p).children().length&&(y&&r.addClass(s),w&&r.addClass(u));rt|=-1==e.dirs}rt&&v();n.each(l,function(n,i){i.trigger("update."+t.namespace,{change:"done"})});ot&&et(void 0,!1)}}).remove(function(i){var r,o,c,h=i.data.removed,a=h.length;for(n.each(l,function(n,i){i.trigger("update."+t.namespace,{removed:h});i.trigger("update."+t.namespace,{change:"prepare"})});a--;)(r=t.navHash2Elm(h[a])).length&&(c=!0,o=r.closest("."+p),r.parent().detach(),o.children().length||o.hide().prev(f).removeClass(e+" "+s+" "+u));c&&t.getUI("navbar").children(".ui-resizable-handle").trigger("resize");n.each(l,function(n,i){i.trigger("update."+t.namespace,{change:"done"})})}).bind("lockfiles unlockfiles",function(i){var r="lockfiles"==i.type,u=!!i.data.helper&&i.data.helper.data("locked"),f=r&&!u?"disable":"enable",e=n.grep(i.data.files||[],function(n){var i=t.file(n);return!(!i||"directory"!=i.mime)});n.each(e,function(n,i){var e=t.navHash2Elm(i);e.length&&!u&&(e.hasClass(hi)&&e.draggable(f),e.hasClass(ci)&&e.droppable(f),e[r?"addClass":"removeClass"](kt))})}).bind("sortchange",function(){var i,r,f,e,s,o;(t.sortAlsoTreeview||vi!==t.sortAlsoTreeview)&&(r=[],f={},s="",o=!(e={}),t.lazy(function(){i=b(t.files());vi=t.sortAlsoTreeview;a.empty();c(n.map(t.roots,function(n){var i=t.file(n);return i&&!i.phash?i:null}));Object.keys(l).length?(1<(r=fi()).length?(n.each(r,function(n,i){var r=t.file(t.root(i)).volumeid;0===n&&(s=r);e[r]=i;f[i]=[]}),n.each(i,function(n,t){if(!t.volumeid)return!(o=!0);f[e[t.volumeid]||e[s]].push(t)})):o=!0,o?n.each(r,function(n,r){c(i);k(t.file(r));nt(i,u)}):n.each(f,function(n,i){c(i);k(t.file(n));nt(i,u)})):(c(i),k(),nt(i,u));et()},100))})}),this},n.fn.elfinderuploadbutton=function(t){return this.each(function(){var r,u=t.fm,e=n(this).elfinderbutton(t).off("click"),i=n("<form><\/form>").appendTo(e),f=n('<input type="file" multiple="true" title="'+t.fm.i18n("selectForUpload")+'"/>').on("change",function(){var t=n(this);t.val()&&(u.exec("upload",{input:t.remove()[0]},void 0,u.cwd().hash),f.clone(!0).appendTo(i))}).on("dragover",function(n){n.originalEvent.dataTransfer.dropEffect="copy"});i.append(f.clone(!0));t.change(function(){r&&cancelAnimationFrame(r);r=requestAnimationFrame(function(){var n=t.disabled();i.is("visible")?n||i.hide():n&&i.show()})}).change()})},n.fn.elfinderviewbutton=function(t){return this.each(function(){var i,r=n(this).elfinderbutton(t),u=r.children(".elfinder-button-icon"),f=r.children(".elfinder-button-text");t.change(function(){i&&cancelAnimationFrame(i);i=requestAnimationFrame(function(){var n="icons"==t.value;u.toggleClass("elfinder-button-icon-view-list",n);t.className=n?"view-list":"";t.title=t.fm.i18n(n?"viewlist":"viewicons");r.attr("title",t.title);f.html(t.title)})})})},n.fn.elfinderworkzone=function(t){var i="elfinder-workzone";return this.not("."+i).each(function(){function o(){e=r.outerHeight(!0)-r.height()}function f(f){var o=u.height()-e,h=u.attr("style"),c=Math.round(r.height());f&&(f.preventDefault(),f.stopPropagation());u.css("overflow","hidden").children(":visible:not(."+i+")").each(function(){var t=n(this);"absolute"!=t.css("position")&&"fixed"!=t.css("position")&&(o-=t.outerHeight(!0))});u.attr("style",h||"");o=Math.max(0,Math.round(o));s===o&&c===o||(s=Math.round(r.height()),r.height(o),t.trigger("wzresize"))}var e,r=n(this).addClass(i),s=Math.round(r.height()),u=r.parent();o();u.on("resize."+t.namespace,f);t.one("cssloaded",function(){e=r.outerHeight(!0)-r.height();f()}).bind("uiresize",f).bind("themechange",o)}),this},r.prototype.commands.archive=function(){var r,i=this,t=i.fm,u=[];this.variants=[];this.disableOnSearch=!1;this.nextAction={};t.bind("open reload",function(){i.variants=[];n.each(u=t.option("archivers").create||[],function(n,r){i.variants.push([r,t.mime2kind(r)])});i.change()});this.getstate=function(i){var s,f=this.files(i),e=f.length,o=e&&!t.isRoot(f[0])&&(t.file(f[0].phash)||{}).write&&!n.grep(f,function(n){return!n.read}).length;return o&&1<t.searchStatus.state&&(s=t.cwd().volumeid,o=e===n.grep(f,function(n){return!(!n.read||0!==n.hash.indexOf(s))}).length),o&&!this._disabled&&u.length&&(e||r&&"pending"==r.state())?0:-1};this.exec=function(f,e){var o,s=this.files(f),c=s.length,h=e||u[0],l=t.file(s[0].phash)||null,a=["errArchive","errPerm","errCreatingTempDir","errFtpDownloadFile","errFtpUploadFile","errFtpMkdir","errArchiveExec","errExtractExec","errRm"];if(r=n.Deferred().fail(function(n){n&&t.error(n)}),!c||!u.length||-1===n.inArray(h,u))return r.reject();if(!l.write)return r.reject(a);for(o=0;o<c;o++)if(!s[o].read)return r.reject(a);return i.mime=h,i.prefix=(1<c?"Archive":s[0].name)+(t.option("archivers").createext?"."+t.option("archivers").createext[h]:""),i.data={targets:i.hashes(f),type:h},t.cwd().hash!==l.hash?t.exec("open",l.hash).done(function(){t.one("cwdrender",function(){t.selectfiles({files:f});r=n.proxy(t.res("mixin","make"),i)()})}):(t.selectfiles({files:f}),r=n.proxy(t.res("mixin","make"),i)()),r}},(r.prototype.commands.back=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1};this.exec=function(){return this.fm.history.back()}}).prototype={forceLoad:!0},r.prototype.commands.chmod=function(){function u(n){return!isNaN(parseInt(n,8)&&parseInt(n,8)<=511)||n.match(/^([r-][w-][x-]){3}$/i)}this.updateOnSelect=!1;var i=this.fm,t={0:"owner",1:"group",2:"other"},r={read:i.i18n("read"),write:i.i18n("write"),execute:i.i18n("execute"),perm:i.i18n("perm"),kind:i.i18n("kind"),files:i.i18n("files")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"><\/span>{title}<\/div>{dataTable}',itemTitle:'<strong>{name}<\/strong><span id="elfinder-info-kind">{kind}<\/span>',groupTitle:"<strong>{items}: {num}<\/strong>",dataTable:'<table id="{id}-table-perm"><tr><td>{0}<\/td><td>{1}<\/td><td>{2}<\/td><\/tr><\/table><div class="">'+r.perm+': <input class="elfinder-tabstop elfinder-focus" id="{id}-perm" type="text" size="4" maxlength="3" value="{value}"><\/div>',fieldset:'<fieldset id="{id}-fieldset-{level}"><legend>{f_title}{name}<\/legend><input type="checkbox" value="4" class="elfinder-tabstop" id="{id}-read-{level}-perm"{checked-r}> <label for="{id}-read-{level}-perm">'+r.read+'<\/label><br><input type="checkbox" value="6" class="elfinder-tabstop" id="{id}-write-{level}-perm"{checked-w}> <label for="{id}-write-{level}-perm">'+r.write+'<\/label><br><input type="checkbox" value="5" class="elfinder-tabstop" id="{id}-execute-{level}-perm"{checked-x}> <label for="{id}-execute-{level}-perm">'+r.execute+"<\/label><br>"};this.shortcuts=[{}];this.getstate=function(n){var t=this.fm;return 0==(n=n||t.selected()).length&&(n=[t.cwd().hash]),this.checkstate(this.files(n))?0:-1};this.checkstate=function(t){var i=t.length,r;return i?(r=n.grep(t,function(n){return!(!(n.isowner&&n.perm&&u(n.perm))||1!=i&&"directory"==n.mime)}).length,i==r):!1};this.exec=function(i){function g(){for(var i,u="",r=0;r<3;r++)i=0,n("#"+f+"-read-"+t[r]+"-perm").is(":checked")&&(i|=4),n("#"+f+"-write-"+t[r]+"-perm").is(":checked")&&(i|=2),n("#"+f+"-execute-"+t[r]+"-perm").is(":checked")&&(i|=1),u+=i.toString(8);n("#"+f+"-perm").val(u)}var h=this.hashes(i),o=this.files(h);o.length||(h=[this.fm.cwd().hash],o=this.files(h));var w,nt,b,e=this.fm,k=n.Deferred().always(function(){e.enable()}),c=this.tpl,y=o.length,l=o[0],f=e.namespace+"-perm-"+l.hash,a=c.main,d=' checked="checked"',tt=function(){var t,i=n.trim(n("#"+f+"-perm").val());if(!u(i))return!1;s.elfinderdialog("close");t={cmd:"chmod",targets:h,mode:i};e.request({data:t,notify:{type:"chmod",cnt:y}}).fail(function(n){k.reject(n)}).done(function(i){i.changed&&i.changed.length&&(i.undo={cmd:"chmod",callback:function(){var t=[];return n.each(p,function(n,i){t.push(e.request({data:{cmd:"chmod",targets:i,mode:n},notify:{type:"undo",cnt:i.length}}))}),n.when.apply(null,t)}},i.redo={cmd:"chmod",callback:function(){return e.request({data:t,notify:{type:"redo",cnt:h.length}})}});k.resolve(i)})},it=function(n){var o;if(isNaN(parseInt(n,8))){for(var r=n.split(""),i=[],t=0,s=r.length;t<s;t++)0===t||3===t||6===t?r[t].match(/[r]/i)?i.push(1):r[t].match(/[-]/)&&i.push(0):1===t||4===t||7===t?r[t].match(/[w]/i)?i.push(1):r[t].match(/[-]/)&&i.push(0):r[t].match(/[x]/i)?i.push(1):r[t].match(/[-]/)&&i.push(0);i.splice(3,0,",");i.splice(7,0,",");for(var f=i.join("").split(","),e=[],u=0,h=f.length;u<h;u++)o=parseInt(f[u],2).toString(8),e.push(o);n=e.join("")}else n=parseInt(n,8).toString(8);return n},rt={title:this.title,width:"auto",buttons:((b={})[e.i18n("btnApply")]=tt,b[e.i18n("btnCancel")]=function(){s.elfinderdialog("close")},b),close:function(){n(this).elfinderdialog("destroy")}},s=e.getUI().find("#"+f),p={},v="";return s.length?(s.elfinderdialog("toTop"),n.Deferred().resolve()):(a=a.replace("{class}",1<y?"elfinder-cwd-icon-group":e.mime2class(l.mime)),1<y?w=c.groupTitle.replace("{items}",e.i18n("items")).replace("{num}",y):(w=c.itemTitle.replace("{name}",l.name).replace("{kind}",e.mime2kind(l)),v=e.tmb(l)),nt=function(n,i){for(var f,s,h,l="",o=c.dataTable,u=0;u<3;u++)l+=(f=parseInt(n.slice(u,u+1),8)).toString(8),s=c.fieldset.replace("{f_title}",e.i18n(t[u])).replace("{name}",(h=i[t[u]])?":"+h:"").replace(/\{level\}/g,t[u]),o=o.replace("{"+u+"}",s).replace("{checked-r}",4==(4&f)?d:"").replace("{checked-w}",2==(2&f)?d:"").replace("{checked-x}",1==(1&f)?d:"");return o.replace("{value}",l).replace("{valueCaption}",r.perm)}(function(n){for(var i,r,u,t,e="777",o="",s=n.length,f=0;f<s;f++){for(r=it(n[f].perm),p[r]||(p[r]=[]),p[r].push(n[f].hash),o="",i=0;i<3;i++)u=parseInt(r.slice(i,i+1),8),t=parseInt(e.slice(i,i+1),8),4!=(4&u)&&4==(4&t)&&(t-=4),2!=(2&u)&&2==(2&t)&&(t-=2),1!=(1&u)&&1==(1&t)&&--t,o+=t.toString(8);e=o}return e}(o),1==o.length?o[0]:{}),a=a.replace("{title}",w).replace("{dataTable}",nt).replace(/{id}/g,f),(s=this.fmDialog(a,rt)).attr("id",f),v&&n("<img/>").on("load",function(){s.find(".elfinder-cwd-icon").addClass(v.className).css("background-image","url('"+v.url+"')")}).attr("src",v.url),n("#"+f+"-table-perm :checkbox").on("click",function(){g()}),n("#"+f+"-perm").on("keydown",function(t){if(t.keyCode==n.ui.keyCode.ENTER)return t.stopPropagation(),void tt()}).on("focus",function(){n(this).trigger("select")}).on("keyup",function(){3==n(this).val().length&&(n(this).trigger("select"),function(i){for(var u,r=0;r<3;r++)u=parseInt(i.slice(r,r+1),8),n("#"+f+"-read-"+t[r]+"-perm").prop("checked",!1),n("#"+f+"-write-"+t[r]+"-perm").prop("checked",!1),n("#"+f+"-execute-"+t[r]+"-perm").prop("checked",!1),4==(4&u)&&n("#"+f+"-read-"+t[r]+"-perm").prop("checked",!0),2==(2&u)&&n("#"+f+"-write-"+t[r]+"-perm").prop("checked",!0),1==(1&u)&&n("#"+f+"-execute-"+t[r]+"-perm").prop("checked",!0);g()}(n(this).val()))}),k)}},r.prototype.commands.colwidth=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.getstate=function(){return"fixed"===this.fm.getUI("cwd").find("table").css("table-layout")?0:-1};this.exec=function(){return this.fm.getUI("cwd").trigger("colwidth"),n.Deferred().resolve()}},r.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(t){var i=this.files(t),r=i.length;return r&&n.grep(i,function(n){return!!n.read}).length==r?0:-1};this.exec=function(t){var r=this.fm,i=n.Deferred().fail(function(n){r.error(n)});return n.each(this.files(t),function(n,t){if(!t.read)return!i.reject(["errCopy",t.name,"errPerm"])}),"rejected"==i.state()?i:i.resolve(r.clipboard(this.hashes(t)))}},r.prototype.commands.cut=function(){var t=this.fm;this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(i){var r=this.files(i),u=r.length;return u&&n.grep(r,function(n){return!(!n.read||n.locked||t.isRoot(n))}).length==u?0:-1};this.exec=function(i){var r=n.Deferred().fail(function(n){t.error(n)});return n.each(this.files(i),function(n,i){return!i.read||i.locked||t.isRoot(i)?!r.reject(["errCopy",i.name,"errPerm"]):i.locked?!r.reject(["errLocked",i.name]):void 0}),"rejected"==r.state()?r:r.resolve(t.clipboard(this.hashes(i),!0))}},r.prototype.commands.zipdl=function(){},r.prototype.commands.download=function(){function e(e,o){var s,h;if(null!==r&&(1<t.searchStatus.state?f=t.searchStatus.mixed:t.leafRoots[t.cwd().hash]&&(s=t.cwd().volumeid,n.each(e,function(n,t){if(0!==t.indexOf(s))return!(f=!0)})),u=t.isCommandEnabled("zipdl",e[0])),f){if(h=r?"zipdl":"download",!(e=n.grep(e,function(n){var i=t.file(n),u=!(!i||!r&&"directory"===i.mime||!t.isCommandEnabled(h,n));return i&&o&&!u&&t.cwdHash2Elm(i.hash).trigger("unselect"),u})).length)return[]}else if(!t.isCommandEnabled("download",e[0]))return[];return n.grep(i.files(e),function(n){var i=!(!n.read||!u&&"directory"==n.mime);return o&&!i&&t.cwdHash2Elm(n.hash).trigger("unselect"),i})}var i=this,t=this.fm,r=null,u=!1,f=!1,o=!1,s=window.location.pathname||"/";this.linkedCmds=["zipdl"];this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(n){var r=this.hashes(n),i=r.length,f=this.options.maxRequests||10;return!(i<1)&&(i=e(r).length)&&(u||i<=f&&(!t.UA.IE&&!t.UA.Mobile||1==i))?0:-1};t.bind("contextmenu",function(t){function o(t){var i=t.url||r.url(t.hash);return{icon:"link",node:n("<a><\/a>").attr({href:i,target:"_blank",title:r.i18n("link")}).text(t.name).on("mousedown click touchstart touchmove touchend contextmenu",function(n){n.stopPropagation()}).on("dragstart",function(i){var s,h,e,o,u=i.dataTransfer||i.originalEvent.dataTransfer||null;f=null;u&&(u.effectAllowed="copyLink",u.setDragImage&&(f=n('<div class="elfinder-drag-helper html5-native">').append((h=(s=t).mime,e=r.tmb(s),o='<div class="elfinder-cwd-icon '+r.mime2class(h)+' ui-corner-all"><\/div>',e&&(o=n(o).addClass(e.className).css("background-image","url('"+e.url+"')").get(0).outerHTML),o)).appendTo(n(document.body)),u.setDragImage(f.get(0),50,47)),r.UA.IE||(u.setData("elfinderfrom",window.location.href+t.phash),u.setData("elfinderfrom:"+u.getData("elfinderfrom"),"")))}).on("dragend",function(){f&&f.remove()})}}var u,e,s,r=i.fm,f=null;i.extra=null;t.data&&1===(s=t.data.targets||[]).length&&(u=r.file(s[0]))&&"directory"!==u.mime&&("1"!=u.url?i.extra=o(u):(i.extra={icon:"link",node:n("<a><\/a>").attr({href:"#",title:r.i18n("getLink"),draggable:"false"}).text(u.name).on("click touchstart",function(n){var t;"touchstart"===n.type&&1<n.originalEvent.touches.length||(t=e.parent(),n.stopPropagation(),n.preventDefault(),t.removeClass("ui-state-disabled").addClass("elfinder-button-icon-spinner"),r.request({data:{cmd:"url",target:u.hash},preventDefault:!0}).always(function(n){t.removeClass("elfinder-button-icon-spinner");n.url?(r.file(u.hash).url=n.url,e.replaceWith(o(u).node)):t.addClass("ui-state-disabled")}))})},(e=i.extra.node).ready(function(){requestAnimationFrame(function(){e.parent().addClass("ui-state-disabled").css("pointer-events","auto")})})))}).one("open",function(){2.1012<=t.api&&(r=t.getCommand("zipdl"));o=t.cookieEnabled&&2.1038<t.api&&!t.isCORS});this.exec=function(t){function et(t){return function(){var e,u,o,f=n.Deferred(),c=r.file(r.root(t[0])),l=1===t.length,s=c?c.i18||c.name:null;return l?(e=r.file(t[0]))&&(u=e.i18||e.name):(n.each(t,function(){var n=r.file(this);if(!n||o&&o!==n.phash)return o=null,!1;o=n.phash}),o&&(e=r.file(o))&&(u=(e.i18||e.name)+"-"+t.length)),u&&(s=u),s=s&&" ("+s+")",r.request({data:{cmd:"zipdl",targets:t},notify:{type:"zipdl",cnt:1,hideCnt:!0,msg:r.i18n("ntfzipdl")+s},cancel:!0,eachCancel:!0,preventDefault:!0}).done(function(e){function y(t){s=n("<a><\/a>").attr("href",t).attr("download",r.escape(u)).on("click",function(){f.resolve();l&&l.elfinderdialog("destroy")});w?(s.attr("target","_blank").append('<span class="elfinder-button-icon elfinder-button-icon-download"><\/span>'+r.escape(u)),b[r.i18n("btnCancel")]=function(){l.elfinderdialog("destroy")},l=i.fmDialog(s,{title:r.i18n("link"),buttons:b,width:"200px",destroyOnClose:!0,close:function(){"resolved"!==f.state()&&f.resolve()}})):(rt(s.hide().appendTo("body").get(0)),s.remove())}var o,l,s,c,p,a,b={},v="dlw"+ +new Date;e.error?(r.error(e.error),f.resolve()):e.zipdl&&(o=e.zipdl,u?(a=r.splitFileExtention(o.name||""),u+=a[1]?"."+a[1]:".zip"):u=o.name,k||w?(h=r.options.url+(-1===r.options.url.indexOf("?")?"?":"&")+"cmd=zipdl&download=1",n.each([t[0],o.file,u,o.mime],function(n,t){h+="&targets%5B%5D="+encodeURIComponent(t)}),n.each(r.customData,function(n,t){h+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t)}),h+="&"+encodeURIComponent(u),r.hasParrotHeaders()?r.getBinaryByUrl({url:h},function(n){n instanceof Blob?(h=(window.URL||window.webkitURL).createObjectURL(n),y(h)):r.error(["errUploadTransfer",r.i18n("kindZIP")])}):y(h)):(c=n('<form action="'+r.options.url+'" method="post" target="'+v+'" style="display:none"><\/form>').append('<input type="hidden" name="cmd" value="zipdl"/>').append('<input type="hidden" name="download" value="1"/>'),n.each([t[0],o.file,u,o.mime],function(n,t){c.append('<input type="hidden" name="targets[]" value="'+r.escape(t)+'"/>')}),n.each(r.customData,function(n,t){c.append('<input type="hidden" name="'+n+'" value="'+r.escape(t)+'"/>')}),c.attr("target",v).appendTo("body"),p=n('<iframe style="display:none" name="'+v+'">').appendTo("body").ready(function(){c.submit().remove();f.resolve();setTimeout(function(){p.remove()},2e4)})))}).fail(function(n){n&&r.error(n);f.resolve()}),f.promise()}}var l,h,v,k,y,p,d,it,nt,ot=this.hashes(t),r=this.fm,c=(r.options.url,e(ot,!0)),g=n.Deferred(),tt="",a={},w=!1,rt=function(n){var t;"function"==typeof MouseEvent?t=new MouseEvent("click"):(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);r.pauseUnloadCheck(!0);n.dispatchEvent(t)},ut=function(n){var t="elfdl"+n;2===document.cookie.split(t+"=").length?(p&&clearTimeout(p),document.cookie=t+"=; path="+s+"; max-age=0",ft()):setTimeout(function(){ut(n)},200)},ft=function(){r.ui.notify.children(".elfinder-notify-download").length&&r.notify({type:"download",cnt:-1})},b=[];if(!c.length)return g.reject();if(y=n.grep(c,function(n){return"directory"!==n.mime}).length,v=n("<a>").hide().appendTo("body"),k="string"==typeof v.get(0).download,u&&(y!==c.length||y>=(this.options.minFilesZipdl||1)))return v.remove(),w=!k&&r.UA.Mobile,f?(a={},n.each(c,function(n,t){var i=t.hash.split("_",2);a[i[0]]?a[i[0]].push(t.hash):a[i[0]]=[t.hash]}),!w&&r.UA.Mobile&&1<Object.keys(a).length&&(w=!0)):a=[n.map(c,function(n){return n.hash})],g=r.sequence(n.map(a,et)).always(function(){r.trigger("download",{files:c})});for(b=[],it=n.Deferred().done(function(t){for(l=0;l<t.length;l++)h=t[l],o&&h.substr(0,r.options.url.length)===r.options.url&&(d=r.getRequestId(),b.push(d),h+="&cpath="+s+"&reqid="+d,p=setTimeout(function(){r.notify({type:"download",cnt:1,cancel:r.UA.IE||r.UA.Edge?void 0:function(){b.length&&n.each(b,function(){r.request({data:{cmd:"abort",id:this},preventDefault:!0})});b=[]}})},r.notifyDelay),ut(d)),k?rt(v.attr("href",h).attr("download",r.escape(c[l].name)).get(0)):r.UA.Mobile?setTimeout(function(){window.open(h)||(r.error("errPopup"),p&&cleaerTimeout(p),ft())},100):tt+='<iframe class="downloader" id="downloader-'+c[l].hash+'" style="display:none" src="'+h+'"><\/iframe>';v.remove();n(tt).appendTo("body").ready(function(){setTimeout(function(){n(tt).each(function(){n("#"+n(this).attr("id")).remove()})},2e4+1e4*l)});r.trigger("download",{files:c});g.resolve()}),y=c.length,nt=[],l=0;l<c.length;l++)r.openUrl(c[l].hash,!0,function(n){n&&nt.push(n);--y<1&&it.resolve(nt)});return g}},r.prototype.commands.duplicate=function(){var t=this.fm;this.getstate=function(i){var r=this.files(i),u=r.length;return u&&t.cwd().write&&n.grep(r,function(n){return!(!n.read||n.phash!==t.cwd().hash||t.isRoot(n))}).length==u?0:-1};this.exec=function(t){var i=this.fm,u=this.files(t),f=u.length,r=n.Deferred().fail(function(n){n&&i.error(n)});return f?(n.each(u,function(n,t){if(!t.read||!i.file(t.phash).write)return!r.reject(["errCopy",t.name,"errPerm"])}),"rejected"==r.state()?r:i.request({data:{cmd:"duplicate",targets:this.hashes(t)},notify:{type:"copy",cnt:f},navigate:{toast:{inbuffer:{msg:i.i18n(["complete",i.i18n("cmdduplicate")])}}}})):r.reject()}},r.prototype.commands.edit=function(){function o(r){var u,f=n('<select class="ui-corner-all"><\/select>');return r&&n.each(r,function(n,i){u=t.escape(i.value);f.append('<option value="'+u+'">'+(i.caption?t.escape(i.caption):u)+"<\/option>")}),n.each(i.options.encodings,function(n,t){f.append('<option value="'+t+'">'+t+"<\/option>")}),f}function v(u){var h,s,l,o=u.length;return 1<o&&(h=u[0].mime,s=u[0].name.replace(/^.*(\.[^.]+)$/,"$1")),n.grep(u,function(u){var v;return!l&&"directory"!==u.mime&&((v=u.read&&(c||t.mimeIsText(u.mime)||-1!==n.inArray(u.mime,1===o?f:e))&&(!i.onlyMimes.length||-1!==n.inArray(u.mime,i.onlyMimes))&&(1===o||u.mime===h&&u.name.substr(-1*s.length)===s)&&!!t.uploadMimeCheck(u.mime,u.phash)&&a(u,o)&&Object.keys(r).length)||(l=!0),v)})}function s(n){var i,r=t.file(n);t.request({cmd:"info",targets:[n],preventDefault:!0}).done(function(n){var u;n&&n.files&&n.files.length&&(i=n.files[0],r.ts==i.ts&&r.size==i.size||(u={changed:[i]},t.updateCache(u),t.change(u)))})}function k(r,u,f,e,c,a){function ut(){return!!k||(t.toast({mode:"warning",msg:t.i18n("nowLoading")}),!1)}function at(){a&&Array.isArray(a)&&n.each(a,function(){this.msg&&t.toast(this)})}function ft(){var u,i,f,e=p?p.val():void 0,r=n.Deferred().fail(function(){y.show().find("button.elfinder-btncnt-0,button.elfinder-btncnt-1").hide()});return ut()?(v.editor&&(v.editor.save(v[0],v.editor.instance),(u=v.editor.confObj).info&&(u.info.schemeContent||u.info.arrayBufferContent)&&(e="scheme")),i=tt(),et(i),i.promise?(f=setTimeout(function(){t.notify({type:"chkcontent",cnt:1,hideCnt:!0,cancel:function(){i.reject()}})},100),i.always(function(){f&&clearTimeout(f);t.notify({type:"chkcontent",cnt:-1})}).done(function(){it.notifyWith(v,[e,v.data("hash"),w,r])}).fail(function(n){r.reject(n)})):it.notifyWith(v,[e,v.data("hash"),w,r]),r):r.resolve()}function ot(){ut()&&ft().fail(function(n){n&&t.error(n)})}function nt(){v.elfinderdialog("close")}function vt(){ut()&&(y.hide(),ft().done(function(){k=!1;y.show();nt()}).fail(function(n){y.show();n&&t.error(n)}))}function st(){var l,r,f,o,s,c,e;ut()&&(l=w,r=u.phash,f=function(n){e.addClass(h).fadeIn(function(){n&&t.error(n)});w=l;t.disable()},o=function(){i.mime=rt.mime||u.mime;i.prefix=(rt.name||u.name).replace(/ \d+(\.[^.]+)?$/,"$1");i.requestCmd="mkfile";i.nextAction={};i.data={target:r};n.proxy(t.res("mixin","make"),i)().done(function(n){var i;n.added&&n.added.length?(i=v.data("hash"),v.data("hash",n.added[0].hash),ft().done(function(){k=!1;y.show();nt();e.fadeIn()}).fail(function(){t.exec("rm",[n.added[0].hash],{forceRm:!0,quiet:!0});v.data("hash",i);y.find("button.elfinder-btncnt-2").hide();f()})):f()}).progress(function(n){n&&"errUploadMime"===n&&v.trigger("saveAsFail")}).fail(f).always(function(){delete i.mime;delete i.prefix;delete i.nextAction;delete i.data});t.trigger("unselectfiles",{files:[u.hash]})},c=s=null,e=t.getUI().children("."+i.dialogClass+":visible"),y.is(":hidden")&&(e=e.add(y)),e.removeClass(h).fadeOut(),t.enable(),t.searchStatus.state<2&&r!==t.cwd().hash?s=t.exec("open",[r],{thash:r}):t.file(r)||(c=t.request({cmd:"info",targets:[r]})),n.when([s,c]).done(function(){c?t.one("infodone",function(){t.file(r)?o():f("errFolderNotFound")}):s?t.one("cwdrender",o):o()}).fail(f))}function ht(){var i,u,r=n.Deferred();return k?(v.editor&&v.editor.save(v[0],v.editor.instance),(i=tt())&&i.promise?(u=setTimeout(function(){t.notify({type:"chkcontent",cnt:1,hideCnt:!0,cancel:function(){i.reject()}})},100),i.always(function(){u&&clearTimeout(u);t.notify({type:"chkcontent",cnt:-1})}).done(function(n){r.resolve(w!==n)}).fail(function(n){r.resolve(n||void 0!==w)})):r.resolve(w!==i),r):r.resolve(!1)}function yt(){p&&ht().done(function(n){n?p.attr("title",t.i18n("saveAsEncoding")).addClass("elfinder-edit-changed"):p.attr("title",t.i18n("openAsEncoding")).removeClass("elfinder-edit-changed")})}var v,w,y,p,b,ct,pt,lt,wt,it=n.Deferred(),k=!1,d={title:t.escape(u.name),width:(lt=t.options.dialogContained?t.getUI():n(window),wt="string"==typeof i.options.dialogWidth&&(pt=i.options.dialogWidth.match(/(\d+)%/))?parseInt(lt.width()*(pt[1]/100)):parseInt(i.options.dialogWidth||650),Math.min(wt,lt.width())),height:function(){if(i.options.dialogHeight){var u,r=t.options.dialogContained?t.getUI():n(window),f="string"==typeof i.options.dialogHeight&&(u=i.options.dialogHeight.match(/(\d+)%/))?parseInt(r.height()*(u[1]/100)):parseInt(i.options.dialogHeight||r.height());return Math.min(f,r.height())}}(),buttons:{},cssClass:h,maxWidth:"window",maxHeight:"window",allowMinimize:!0,allowMaximize:!0,openMaximized:g()||c&&c.info&&c.info.openMaximized,btnHoverFocus:!1,closeOnEscape:!1,propagationEvents:["mousemove","mouseup","click"],minimize:function(){var n;v.editor&&y.closest(".ui-dialog").is(":hidden")&&(n=v.editor.confObj).info&&n.info.syncInterval&&s(u.hash)},close:function(){function n(){var n;it.resolve();v.editor&&(v.editor.close(v[0],v.editor.instance),(n=v.editor.confObj).info&&n.info.syncInterval&&s(u.hash));v.elfinderdialog("destroy")}var r=void 0!==rt.name,f=r?{label:"btnSaveAs",callback:function(){requestAnimationFrame(st)}}:{label:"btnSaveClose",callback:function(){ft().done(function(){n()})}};ht().done(function(u){var e=["confirmNotSave"];u?("string"==typeof u&&e.unshift(u),t.confirm({title:i.title,text:e,accept:f,cancel:{label:"btnClose",callback:n},buttons:r?null:[{label:"btnSaveAs",callback:function(){requestAnimationFrame(st)}}]})):n()})},open:function(){var n,i,e;if(v.initEditArea.call(v,r,u,f,t),v.editor){if((n=v.editor.load(v[0])||null)&&n.done)n.always(function(){k=!0}).done(function(n){v.editor.instance=n;v.editor.focus(v[0],v.editor.instance);et(tt());requestAnimationFrame(function(){y.trigger("resize")})}).fail(function(n){n&&t.error(n);v.elfinderdialog("destroy")}).always(at);else{if(k=!0,n&&("string"==typeof n||Array.isArray(n)))return t.error(n),void v.elfinderdialog("destroy");v.editor.instance=n;v.editor.focus(v[0],v.editor.instance);et(tt());requestAnimationFrame(function(){y.trigger("resize")});at()}(i=v.editor.confObj).info&&i.info.syncInterval&&(e=parseInt(i.info.syncInterval))&&setTimeout(function(){bt(e)},e)}else k=!0,et(tt())},resize:function(n,t){v.editor&&v.editor.resize(v[0],v.editor.instance,n,t||{})}},tt=function(){var t=v.getContent.call(v,v[0]);return void 0!==t&&!1!==t&&null!==t||(t=n.Deferred().reject()),t},et=function(n){n&&n.promise?n.done(function(n){w=n}):w=n},bt=function(n){y.is(":visible")&&(s(u.hash),setTimeout(function(){bt(n)},n))},rt={};if(c&&(c.html&&(v=n(c.html)),b={init:c.init||null,load:c.load,getContent:c.getContent||null,save:c.save,beforeclose:"function"==typeof c.beforeclose?c.beforeclose:void 0,close:"function"==typeof c.close?c.close:function(){},focus:"function"==typeof c.focus?c.focus:function(){},resize:"function"==typeof c.resize?c.resize:function(){},instance:null,doSave:ot,doCancel:nt,doClose:vt,file:u,fm:t,confObj:c,trigger:function(n,i){t.trigger("editEditor"+n,Object.assign({},c.info||{},i))}}),!v){if(!t.mimeIsText(u.mime))return it.reject("errEditorNotFound");v=n('<textarea class="elfinder-file-edit" rows="20" id="'+r+'-ta"><\/textarea>').on("input propertychange",yt);c&&c.info&&!c.info.useTextAreaEvent||v.on("keydown",function(t){var u,i,r=t.keyCode;t.stopPropagation();r==n.ui.keyCode.TAB&&(t.preventDefault(),this.setSelectionRange&&(u=this.value,i=this.selectionStart,this.value=u.substr(0,i)+"\t"+u.substr(this.selectionEnd),i+=1,this.setSelectionRange(i,i)));(t.ctrlKey||t.metaKey)&&(r!="Q".charCodeAt(0)&&r!="W".charCodeAt(0)||(t.preventDefault(),nt()),r=="S".charCodeAt(0)&&(t.preventDefault(),ot()))}).on("mouseenter",function(){this.focus()});v.initEditArea=function(n,t,i){v.hide().val(i);this._setupSelEncoding(i)}}return v._setupSelEncoding=function(i){function f(t){t&&r.appendTo(p.parent());r.empty().append(n("<option><\/option>").text(p.val()));p.width(r.width())}var s=e&&"unknown"!==e?[{value:e}]:[],r=n("<select><\/select>").hide();""!==i&&e&&"UTF-8"===e||s.push({value:"UTF-8"});p=o(s).on("touchstart",function(n){n.stopPropagation()}).on("change",function(){ht().done(function(n){n||""===tt()||(nt(),l(u,p.val(),c).fail(function(n){n&&t.error(n)}))});f()}).on("mouseover",yt);v.parent().next().prepend(n('<div class="ui-dialog-buttonset elfinder-edit-extras"><\/div>').append(p));f(!0)},v.data("hash",u.hash),b&&("function"==typeof(v.editor=b).beforeclose&&(d.beforeclose=function(){return b.beforeclose(v[0],b.instance)}),"function"==typeof b.init&&(v.initEditArea=b.init),"function"==typeof b.getContent&&(v.getContent=b.getContent)),v.initEditArea||(v.initEditArea=function(){}),v.getContent||(v.getContent=function(){return v.val().replace(/\s+$/,"")}),c&&c.info&&c.info.preventGet||(d.buttons[t.i18n("btnSave")]=ot,d.buttons[t.i18n("btnSaveClose")]=vt,d.buttons[t.i18n("btnSaveAs")]=st,d.buttons[t.i18n("btnCancel")]=nt),c&&"function"==typeof c.prepare&&c.prepare(v,d,u),y=i.fmDialog(v,d).attr("id",r).on("keydown keyup keypress",function(n){n.stopPropagation()}).css({overflow:"hidden",minHeight:"7em"}).addClass("elfinder-edit-editor").closest(".ui-dialog").on("changeType",function(i,r){var f;r.extention&&r.mime&&(r.extention,r.mime,(f=n(this).children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset")).children(".elfinder-btncnt-0,.elfinder-btncnt-1").hide(),rt.name=t.splitFileExtention(u.name)[0]+"."+r.extention,rt.mime=r.mime,r.keepEditor||f.children(".elfinder-btncnt-2").trigger("click"))}),ct=(t.options.dialogContained?t.getUI():n(window)).width(),y.width()>ct&&y.width(ct),it.promise()}function y(i,r){i&&r&&(n.isPlainObject(u)||(u={}),u[i]=r.id,t.storage("storedEditors",u),t.trigger("selectfiles",{files:t.selected()}))}function p(){var n=t.storage("useStoredEditor");return n?0<n:i.options.useStoredEditor}function w(i,u){var f=[];return n.each(r,function(n,r){f.push({label:t.escape(r.i18n),icon:r.info&&r.info.icon?r.info.icon:"edit",options:{iconImg:r.info&&r.info.iconImg?t.baseUrl+r.info.iconImg:void 0},callback:function(){y(i[0].mime,r);u&&u.call(r)}})}),f}function b(n){var t=u[n];if(t&&Object.keys(r).length)return r[t.toLowerCase().replace(/ +/g,"")]}var u,i=this,t=this.fm,h=t.res("class","editing"),f=[],e=[],c=!1,l=function(r,u,f){var s,y,c,h=r.hash,e=(t.options,n.Deferred()),p="edit-"+t.namespace+"-"+r.hash,w=t.getUI().find("#"+p),a=u||0,v=!1;if(w.length)return w.elfinderdialog("toTop"),e.resolve();if(!(r.read&&(r.write||f.info&&f.info.converter)))return y=["errOpen",r.name,"errPerm"],e.reject(y);if(f&&f.info){if("function"==typeof f.info.edit)return(c=f.info.edit.call(t,r,f)).promise?c.done(function(){e.resolve()}).fail(function(n){e.reject(n)}):c?e.resolve():e.reject(),e;v=f.info.preventGet||f.info.noContent;f.info.urlAsContent||v?(s=n.Deferred(),f.info.urlAsContent?t.url(h,{async:!0,onetime:!0,temporary:!0}).done(function(n){s.resolve({content:n})}):s.resolve({})):(a&&(r.encoding=a,t.cache(r,"change")),s=t.request({data:{cmd:"get",target:h,conv:a,_t:r.ts},options:{type:"get",cache:!0},notify:{type:"file",cnt:1},preventDefault:!0}));s.done(function(u){var s,c,a;u.doconv?t.confirm({title:i.title,text:"unknown"===u.doconv?"confirmNonUTF8":"confirmConvUTF8",accept:{label:"btnConv",callback:function(){e=l(r,s.val(),f)}},cancel:{label:"btnCancel",callback:function(){e.reject()}},optionsCallback:function(i){i.create=function(){var r=n('<div class="elfinder-dialog-confirm-encoding"><\/div>'),i={value:u.doconv};"unknown"===u.doconv&&(i.caption="-");s=o([i]);n(this).next().find(".ui-dialog-buttonset").prepend(r.append(n("<label>"+t.i18n("encoding")+" <\/label>").append(s)))}}}):(!v&&t.mimeIsText(r.mime)&&(c=new RegExp("^(data:"+r.mime.replace(/([.+])/g,"\\$1")+";base64,)","i"),f.info.dataScheme?window.btoa&&!u.content.match(c)&&(u.content="data:"+r.mime+";base64,"+btoa(u.content)):window.atob&&(a=u.content.match(c))&&(u.content=atob(u.content.substr(a[1].length)))),k(p,r,u.content,u.encoding,f,u.toasts).done(function(n){e.resolve(n)}).progress(function(n,i,r,u){var f=this;i&&(h=i);t.request({options:{type:"post"},data:{cmd:"put",target:h,encoding:n||r.encoding,content:r},notify:{type:"save",cnt:1},syncOnFail:!0,preventFail:!0,navigate:{target:"changed",toast:{inbuffer:{msg:t.i18n(["complete",t.i18n("btnSave")])}}}}).fail(function(n){e.reject(n);u.reject()}).done(function(){requestAnimationFrame(function(){f.trigger("focus");f.editor&&f.editor.focus(f[0],f.editor.instance)});u.resolve()})}).fail(function(n){e.reject(n)}))}).fail(function(n){var i=t.parseError(n),i=Array.isArray(i)?i[0]:i;r.encoding&&(r.encoding="",t.cache(r,"change"));"errConvUTF8"!==i&&t.sync();e.reject(n)})}return e.promise()},r={},d={info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(t){this.trigger("Prepare",{node:t,editorObj:void 0,instance:void 0,opts:{}});t.setSelectionRange&&t.setSelectionRange(0,0);n(t).trigger("focus").show()},save:function(){}},a=function(f,e){var o=i.options.editors||[],s=t.cwd().write;return u=t.storage("storedEditors")||{},r={},o.length||(o=[d]),n.each(o,function(i,u){var o;(1===e||!u.info.single)&&(u.info&&u.info.converter?s:f.write)&&(0<f.size||!u.info.converter&&!1!==u.info.canMakeEmpty&&t.mimesCanMakeEmpty[f.mime])&&(!u.info.maxSize||f.size<=u.info.maxSize)&&function(i,r){if(r){if("*"===r[0]||-1!==n.inArray(i,r))return!0;for(var f=r.length,u=0;u<f;u++)if(0===i.indexOf(r[u]))return!0;return!1}return t.mimeIsText(i)}(f.mime,u.mimes||null)&&function(n,t){if(!t||!t.length)return!0;for(var r=n.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),u=t.length,i=0;i<u;i++)if(r===t[i].toLowerCase())return!0;return!1}(f.name,u.exts||null)&&"function"==typeof u.load&&"function"==typeof u.save&&(o=u.info.name?u.info.name:"Editor "+i,u.id=u.info.id?u.info.id:"editor"+i,u.name=o,u.i18n=t.i18n(o),r[u.id]=u)}),!!Object.keys(r).length},g=function(){var n=t.storage("editorMaximized");return n?0<n:i.options.editorMaximized};this.getEncSelect=o;this.shortcuts=[{pattern:"ctrl+e"}];this.init=function(){var o,i=this,t=this.fm,u=this.options,s=[];this.onlyMimes=this.options.mimes||[];t.one("open",function(){u.editors&&Array.isArray(u.editors)&&(t.trigger("canMakeEmptyFile",{mimes:Object.keys(t.storage("mkfileTextMimes")||{}).concat(u.makeTextMimes||["text/plain"])}),n.each(u.editors,function(n,t){t.info&&t.info.cmdCheck&&s.push(t.info.cmdCheck)}),(s.length?2.103<=t.api?t.request({data:{cmd:"editor",name:s,method:"enabled"},preventDefault:!0}).done(function(n){o=n}).fail(function(){o={}}):(o={},n.Deferred().resolve()):n.Deferred().resolve()).always(function(){o&&(u.editors=n.grep(u.editors,function(n){return!n.info||!n.info.cmdCheck||!!o[n.info.cmdCheck]}));n.each(u.editors,function(n,i){i.setup&&"function"==typeof i.setup&&i.setup.call(i,u,t);i.disabled||(i.mimes&&Array.isArray(i.mimes)&&(f=f.concat(i.mimes),i.info&&i.info.single||(e=e.concat(i.mimes))),!c&&i.mimes&&"*"===i.mimes[0]&&(c=!0),i.info||(i.info={}),i.info.integrate&&t.trigger("helpIntegration",Object.assign({cmd:"edit"},i.info.integrate)),i.info.canMakeEmpty&&t.trigger("canMakeEmptyFile",{mimes:Array.isArray(i.info.canMakeEmpty)?i.info.canMakeEmpty:i.mimes}))});f=(n.uniqueSort||n.unique)(f);e=(n.uniqueSort||n.unique)(e);u.editors=n.grep(u.editors,function(n){return!n.disabled})}))}).bind("select",function(){r=null}).bind("contextmenucreate",function(u){function e(n){var r=i.title;t.one("contextmenucreatedone",function(){i.title=r});i.title=t.escape(n.i18n);n.info&&n.info.iconImg&&(i.contextmenuOpts={iconImg:t.baseUrl+n.info.iconImg});delete i.variants}var f,o;i.contextmenuOpts=void 0;"files"===u.data.type&&i.enabled()&&(f=t.file(u.data.targets[0]),a(f,u.data.targets.length)&&(1<Object.keys(r).length?p()&&(o=b(f.mime))?(e(o),i.extra={icon:"menu",node:n("<span><\/span>").attr({title:t.i18n("select")}).on("click touchstart",function(i){var r;"touchstart"===i.type&&1<i.originalEvent.touches.length||(r=n(this),i.stopPropagation(),i.preventDefault(),t.trigger("contextmenu",{raw:w(t.selectedFiles(),function(){var n=t.selected();t.exec("edit",n,{editor:this});t.trigger("selectfiles",{files:n})}),x:r.offset().left,y:r.offset().top}))})}):(delete i.extra,i.variants=[],n.each(r,function(n,r){i.variants.push([{editor:r},r.i18n,r.info&&r.info.iconImg?t.baseUrl+r.info.iconImg:"edit"])})):(e(r[Object.keys(r)[0]]),delete i.extra)))}).bind("canMakeEmptyFile",function(r){var f,u;r.data&&r.data.resetTexts&&(f=t.arrayFlip(i.options.makeTextMimes||["text/plain"]),u=i.getMkfileHides(),n.each(t.storage("mkfileTextMimes")||{},function(n){f[n]||(delete t.mimesCanMakeEmpty[n],delete u[n])}),t.storage("mkfileTextMimes",null),Object.keys(u).length?t.storage("mkfileHides",u):t.storage("mkfileHides",null))})};this.getstate=function(n){var t=this.files(n),i=t.length;return i&&v(t).length==i?0:-1};this.exec=function(t,i){var c,u,f=this.fm,e=v(this.files(t)),k=n.map(e,function(n){return n.hash}),d=[],o=i&&i.editor?i.editor:null,h=n(i&&i._currentNode?i._currentNode:f.cwdHash2Elm(k[0])),s=n.Deferred();return null===r&&a(e[0],k.length),h.length||(h=f.getUI("cwd")),u=n.Deferred(),(!o&&1<Object.keys(r).length?p()&&(o=b(e[0].mime))?u.resolve(o):(f.trigger("contextmenu",{raw:w(e,function(){u.resolve(this)}),x:h.offset().left,y:h.offset().top+22,opened:function(){f.one("closecontextmenu",function(){requestAnimationFrame(function(){"pending"===u.state()&&u.reject()})})}}),f.trigger("selectfiles",{files:k}),u):(1<Object.keys(r).length&&o&&y(e[0].mime,o),u.resolve(o||(Object.keys(r).length?r[Object.keys(r)[0]]:null)))).done(function(t){for(;c=e.shift();)d.push(l(c,c.encoding||void 0,t).fail(function(n){n&&f.error(n)}));d.length?n.when.apply(null,d).done(function(){s.resolve()}).fail(function(){s.reject()}):s.reject()}).fail(function(){s.reject()}),s};this.getMkfileHides=function(){return t.storage("mkfileHides")||t.arrayFlip(i.options.mkfileHideMimes||[])}},r.prototype.commands.empty=function(){function i(n){var i=r.files(n);return i.length||(i=[t.cwd()]),i}var r,t;this.linkedCmds=["rm"];this.init=function(){t=(r=this).fm};this.getstate=function(t){var r=i(t),u=r.length;return n.grep(r,function(n){return!(!n.read||!n.write||"directory"!==n.mime)}).length==u?0:-1};this.exec=function(r){function u(n){"number"==typeof n?(o.push(f[n].name),delete f[n].dirs):n&&t.error(n);--e<1&&s[o.length?"resolve":"reject"]()}var f=i(r),e=f.length,s=n.Deferred().done(function(){var i={changed:{}};t.toast({msg:t.i18n(['"'+o.join('", ')+'"',"complete",t.i18n("cmdempty")])});n.each(f,function(n,t){i.changed[t.hash]=t});t.change(i)}).always(function(){var i=t.cwd().hash;t.trigger("selectfiles",{files:n.map(f,function(n){return i===n.phash?n.hash:null})})}),o=[];return n.each(f,function(i,r){var f;return r.write&&"directory"===r.mime?t.isCommandEnabled("rm",r.hash)?(f=setTimeout(function(){t.notify({type:"search",cnt:1,hideCnt:!(1<e)})},t.notifyDelay),void t.request({data:{cmd:"open",target:r.hash},preventDefault:!0,asNotOpen:!0}).done(function(o){var s=[];f&&clearTimeout(f);t.ui.notify.children(".elfinder-notify-search").length&&t.notify({type:"search",cnt:-1,hideCnt:!(1<e)});o&&o.files&&o.files.length?o.files.length>t.maxTargets?u(["errEmpty",r.name,"errMaxTargets",t.maxTargets]):(t.updateCache(o),n.each(o.files,function(n,t){if(!t.write||t.locked)return u(["errEmpty",r.name,"errRm",t.name,"errPerm"]),!(s=[]);s.push(t.hash)}),s.length&&t.exec("rm",s,{_userAction:!0,addTexts:[t.i18n("folderToEmpty",r.name)]}).fail(function(n){t.trigger("unselectfiles",{files:t.selected()});u(t.parseError(n)||"")}).done(function(){u(i)})):(t.toast({mode:"warning",msg:t.i18n("filderIsEmpty",r.name)}),u(""))}).fail(function(n){u(t.parseError(n)||"")})):(u(["errCmdNoSupport",'"rm"']),null):(u(["errEmpty",r.name,"errPerm"]),null)}),s}},r.prototype.commands.extract=function(){var i=this,t=i.fm,r=[];this.variants=[];this.disableOnSearch=!0;t.bind("open reload",function(){r=t.option("archivers").extract||[];i.variants=2<t.api?[[{makedir:!0},t.i18n("cmdmkdir")],[{},t.i18n("btnCwd")]]:[[{},t.i18n("btnCwd")]];i.change()});this.getstate=function(t){var i,u=this.files(t),f=u.length;return f&&this.fm.cwd().write&&(i=u,n.grep(i,function(t){return!(!t.read||-1===n.inArray(t.mime,r))}).length==f)?0:-1};this.exec=function(i,u){function k(n){switch(n){case"overwrite_all":a=!0;break;case"omit_all":v=!0}}function s(i){i.read&&t.file(i.phash).write?-1===n.inArray(i.mime,r)?(o=["errExtract",i.name,"errNoArchive"],t.error(o),f.reject(o)):t.request({data:{cmd:"extract",target:i.hash,makedir:l},notify:{type:"extract",cnt:1},syncOnFail:!0,navigate:{toast:l?{incwd:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}},inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}}}:{inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")])}}}}).fail(function(n){"rejected"!=f.state()&&f.reject(n)}).done(function(){}):(o=["errExtract",i.name,"errPerm"],t.error(o),f.reject(o))}var c,o,p,w=this.files(i),f=n.Deferred(),e=w.length,l=u&&u.makedir?1:0,a=!1,v=!1,y=0,d=n.map(t.files(i),function(n){return n.name}),b={},h;return n.grep(t.files(i),function(n){return b[n.name]=n,!1}),h=function(i,r){function o(){r+1<e?h(i,r+1):f.resolve()}var u=i[r],w=t.splitFileExtention(u.name)[0],g=0<=n.inArray(w,d);!l&&g&&"directory"!=b[w].mime?t.confirm({title:t.i18n("ntfextract"),text:["errExists",w,"confirmRepl"],accept:{label:"btnYes",callback:function(n){if(k(p=n?"overwrite_all":"overwrite"),a||v){if(a){for(c=r;c<e;c++)s(i[c]);f.resolve()}}else"overwrite"==p&&s(u),r+1<e?h(i,r+1):f.resolve()}},reject:{label:"btnNo",callback:function(n){k(p=n?"omit_all":"omit");!a&&!v&&r+1<e?h(i,r+1):v&&f.resolve()}},cancel:{label:"btnCancel",callback:function(){f.resolve()}},all:r+1<e}):l?(s(u),o()):0==y?t.confirm({title:t.i18n("cmdextract"),text:[t.i18n("cmdextract")+' "'+u.name+'"',"confirmRepl"],accept:{label:"btnYes",callback:function(n){n&&(y=1);s(u);o()}},reject:{label:"btnNo",callback:function(n){n&&(y=-1);o()}},cancel:{label:"btnCancel",callback:function(){f.resolve()}},all:r+1<e}):(0<y&&s(u),o())},this.enabled()&&e&&r.length?(0<e&&h(w,0),f):f.reject()}},(r.prototype.commands.forward=function(){this.alwaysEnabled=!0;this.updateOnSelect=!0;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1};this.exec=function(){return this.fm.history.forward()}}).prototype={forceLoad:!0},r.prototype.commands.fullscreen=function(){function r(n,t){n.preventDefault();n.stopPropagation();t&&t.fullscreen&&i.update(void 0,"on"===t.fullscreen)}var i=this,t=this.fm;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.syncTitleOnChange=!0;this.value=!1;this.options={ui:"fullscreenbutton"};this.getstate=function(){return 0};this.exec=function(){var r=t.getUI().get(0),u=r===t.toggleFullscreen(r);return i.title=t.i18n(u?"reinstate":"cmdfullscreen"),i.update(void 0,u),n.Deferred().resolve()};t.bind("init",function(){t.getUI().off("resize."+t.namespace,r).on("resize."+t.namespace,r)})},(r.prototype.commands.getfile=function(){var t=this,i=this.fm;this.alwaysEnabled=!0;this.callback=i.options.getFileCallback;this._disabled="function"==typeof this.callback;this.getstate=function(i){var r,u,f=this.files(i),e=f.length;return this.callback&&e&&(r=f,u=t.options,r=n.grep(r,function(n){return!("directory"==n.mime&&!u.folders||!n.read)}),(u.multiple||1==r.length?r:[]).length==e)?0:-1};this.exec=function(i){function l(){return f.onlyURL?f.multiple?n.map(e,function(n){return n.url}):e[0].url:f.multiple?e:e[0]}for(var r,h,u=this.fm,f=this.options,e=this.files(i),a=e.length,v=u.option("url"),y=u.option("tmbUrl"),s=n.Deferred().done(function(n){function r(){"close"==f.oncomplete?u.hide():"destroy"==f.oncomplete&&u.destroy()}function e(n){"close"==f.onerror?u.hide():"destroy"==f.onerror?u.destroy():n&&u.error(n)}var i;u.trigger("getfile",{files:n});try{i=t.callback(n,u)}catch(n){return void e(["Error in `getFileCallback`.",n.message])}"object"==typeof i&&"function"==typeof i.done?i.done(r).fail(e):r()}),o=[],c=0;c<a;c++){if("directory"==(r=e[c]).mime&&!f.folders)return s.reject();r.baseUrl=v;"1"==r.url?o.push(u.request({data:{cmd:"url",target:r.hash},notify:{type:"url",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(n){n.url&&(u.file(this.hash).url=this.url=n.url)}.bind(r))):r.url=u.url(r.hash);f.onlyURL||(f.getPath&&(r.path=u.path(r.hash),""===r.path&&r.phash&&function(){var t=n.Deferred();o.push(t);u.path(r.hash,!1,{}).done(function(n){r.path=n}).fail(function(){r.path=""}).always(function(){t.resolve()})}()),r.tmb&&1!=r.tmb&&(r.tmb=y+r.tmb),r.width||r.height||(r.dim?(h=r.dim.split("x"),r.width=h[0],r.height=h[1]):f.getImgSize&&-1!==r.mime.indexOf("image")&&o.push(u.request({data:{cmd:"dim",target:r.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(n){var t,i;n.dim&&(t=n.dim.split("x"),(i=u.file(this.hash)).width=this.width=t[0],i.height=this.height=t[1])}.bind(r)))))}return o.length?(n.when.apply(null,o).always(function(){s.resolve(l())}),s):s.resolve(l())}}).prototype={forceLoad:!0},(r.prototype.commands.help=function(){function nt(){return t.theme&&t.theme.author?h[u]("elfinder-help-team","elfinder-help-team elfinder-help-term-theme")[u](c,t.i18n(t.theme.author)+(t.theme.email?" &lt;"+t.theme.email+"&gt;":""))[u](l,t.i18n("theme")+" ("+t.i18n(t.theme.name)+")"):'<div class="elfinder-help-team elfinder-help-term-theme" style="display:none"><\/div>'}var p,tt,w,a,e,o,t=this.fm,r=this,b='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}<\/a><\/div>',h='<div class="elfinder-help-team"><div>{author}<\/div>{work}<\/div>',k=/\{url\}/,d=/\{link\}/,c=/\{author\}/,l=/\{work\}/,u="replace",it="ui-priority-primary",g="ui-priority-secondary",v="elfinder-help-license",ft='<li class="'+t.res("class","tabstab")+' elfinder-help-tab-{id}"><a href="#'+t.namespace+'-help-{id}" class="ui-tabs-anchor">{title}<\/a><\/li>',i=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'],y='<div class="elfinder-help-separator"><\/div>',et=n("base").length?document.location.href.replace(/#.*$/,""):"",rt=t.res("class","tabsactive"),ut=!1,s=!1,f="";this.alwaysEnabled=!0;this.updateOnSelect=!1;this.state=-1;this.shortcuts=[{pattern:"f1",description:this.title}];t.bind("load",function(){var st,ht,ct,at,vt,yt,lt,ot=r.options.view||["about","shortcuts","help","integrations","debug"];-1!==(st=n.inArray("preference",ot))&&ot.splice(st,1);n.fn.tabs||-1!==(st=n.inArray(ot,"debug"))&&ot.splice(st,1);n.each(ot,function(n,r){i.push(ft[u](/\{id\}/g,r)[u](/\{title\}/,t.i18n(r)))});i.push("<\/ul>");-1!==n.inArray("about",ot)&&(i.push('<div id="'+t.namespace+'-help-about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"><\/div>'),i.push("<h3>elFinder<\/h3>"),i.push('<div class="'+it+'">'+t.i18n("webfm")+"<\/div>"),i.push('<div class="'+g+'">'+t.i18n("ver")+": "+t.version+"<\/div>"),i.push('<div class="'+g+'">'+t.i18n("protocolver")+': <span class="apiver"><\/span><\/div>'),i.push('<div class="'+g+'">jQuery/jQuery UI: '+n().jquery+"/"+n.ui.version+"<\/div>"),i.push(y),i.push(b[u](k,"https://studio-42.github.io/elFinder/")[u](d,t.i18n("homepage"))),i.push(b[u](k,"https://github.com/Studio-42/elFinder/wiki")[u](d,t.i18n("docs"))),i.push(b[u](k,"https://github.com/Studio-42/elFinder")[u](d,t.i18n("github"))),i.push(y),i.push('<div class="'+it+'">'+t.i18n("team")+"<\/div>"),i.push(h[u](c,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[u](l,t.i18n("chiefdev"))),i.push(h[u](c,"Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;")[u](l,t.i18n("developer"))),i.push(h[u](c,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[u](l,t.i18n("maintainer"))),i.push(h[u](c,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[u](l,t.i18n("contributor"))),t.i18[t.lang].translator&&n.each(t.i18[t.lang].translator.split(", "),function(){i.push(h[u](c,n.trim(this))[u](l,t.i18n("translator")+" ("+t.i18[t.lang].language+")"))}),i.push(nt()),i.push(y),i.push('<div class="'+v+'">'+t.i18n("icons")+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue<\/a>, <a href="https://icons8.com" target="_blank">Icons8<\/a><\/div>'),i.push(y),i.push('<div class="'+v+'">Licence: 3-clauses BSD Licence<\/div>'),i.push('<div class="'+v+'">Copyright © 2009-2020, Studio 42<\/div>'),i.push('<div class="'+v+'">„ …'+t.i18n("dontforget")+" ”<\/div>"),i.push("<\/div>"));-1!==n.inArray("shortcuts",ot)&&(lt=t.shortcuts(),i.push('<div id="'+t.namespace+'-help-shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),lt.length?(i.push('<div class="ui-widget-content elfinder-help-shortcuts">'),n.each(lt,function(n,t){i.push('<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}<\/div> {descrip}<\/div>'.replace(/\{pattern\}/,t[0]).replace(/\{descrip\}/,t[1]))}),i.push("<\/div>")):i.push('<div class="elfinder-help-disabled">'+t.i18n("shortcutsof")+"<\/div>"),i.push("<\/div>"));-1!==n.inArray("help",ot)&&(ht=t.i18nBaseUrl+"help/%s.html.js",i.push('<div id="'+t.namespace+'-help-help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),i.push('<a href="https://github.com/Studio-42/elFinder/wiki" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC<\/span><\/a>'),i.push("<\/div>"));-1!==n.inArray("integrations",ot)&&(ut=!0,i.push('<div id="'+t.namespace+'-help-integrations" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><\/div>'));-1!==n.inArray("debug",ot)&&(s=!0,i.push('<div id="'+t.namespace+'-help-debug" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),i.push('<div class="ui-widget-content elfinder-help-debug"><ul><\/ul><\/div>'),i.push("<\/div>"));i.push("<\/div>");(f=n(i.join(""))).find(".ui-tabs-nav li").on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"===t.type)}).on("focus blur","a",function(t){n(t.delegateTarget).toggleClass("ui-state-focus","focusin"===t.type)}).children().on("click",function(t){var i=n(this);t.preventDefault();t.stopPropagation();i.parent().addClass(rt).siblings().removeClass(rt);f.children(".ui-tabs-panel").hide().filter(i.attr("href")).show()}).filter(":first").trigger("click");ut&&(tt=f.find(".elfinder-help-tab-integrations").hide(),w=f.find("#"+t.namespace+"-help-integrations").hide().append(n('<div class="elfinder-help-integrations-desc"><\/div>').html(t.i18n("integrationWith"))),t.bind("helpIntegration",function(i){var r,u,e,o,f=w.children("ul:first");i.data&&(n.isPlainObject(i.data)?((r=Object.assign({link:"",title:"",banner:""},i.data)).title||r.link)&&(r.title||(r.title=r.link),u=r.link?n("<a><\/a>").attr("href",r.link).attr("target","_blank").text(r.title):n("<span><\/span>").text(r.title),r.banner&&(u=n("<span><\/span>").append(n("<img/>").attr(r.banner),u))):(u=n(i.data)).filter("a").each(function(){var t=n(this);t.attr("target")||t.attr("target","_blank")}),u&&(tt.show(),f.length||(f=n('<ul class="elfinder-help-integrations"><\/ul>').appendTo(w)),r&&r.cmd?(o="elfinder-help-integration-"+r.cmd,(e=f.find("ul."+o)).length||(e=n('<ul class="'+o+'"><\/ul>'),f.append(n("<li><\/li>").append(n("<span><\/span>").html(t.i18n("cmd"+r.cmd))).append(e))),u=e.append(n("<li><\/li>").append(u))):f.append(n("<li><\/li>").append(u))))}).bind("themechange",function(){f.find("div.elfinder-help-term-theme").replaceWith(nt())}));s&&(a=f.find(".elfinder-help-tab-debug").hide(),e=f.find("#"+t.namespace+"-help-debug").children("div:first"),o=e.children("ul:first").on("click",function(n){n.preventDefault();n.stopPropagation()}),r.debug={},t.bind("backenddebug",function(i){var c,u,l,f,a,v,h,y;s&&i.data&&i.data.debug&&(r.debug={options:i.data.options,debug:Object.assign({cmd:t.currentReqCmd},i.data.debug)},r.dialog&&(h=function(t,i){return n.each(i,function(i,r){t.append(n("<dt><\/dt>").text(i));void 0===r?t.append(n("<dd><\/dd>").append(n("<span><\/span>").text("undfined"))):"object"!=typeof r||r?"object"==typeof r&&(n.isPlainObject(r)||r.length)?t.append(n("<dd><\/dd>").append(h(n("<dl><\/dl>"),r))):t.append(n("<dd><\/dd>").append(n("<span><\/span>").text(r&&"object"==typeof r?"[]":r||'""'))):t.append(n("<dd><\/dd>").append(n("<span><\/span>").text("null")))}),t},y=o.children("li").length,(r.debug.options||r.debug.debug)&&(5<=y&&(a=o.children("li:last"),(v=e.children("div:last")).is(":hidden")?(a.remove(),v.remove()):(a.prev().remove(),v.prev().remove())),l=t.namespace+"-help-debug-"+ +new Date,c=n("<li><\/li>").html('<a href="'+et+"#"+l+'">'+r.debug.debug.cmd+"<\/a>").prependTo(o),u=n('<div id="'+l+'"><\/div>').data("debug",r.debug),c.on("click.debugrender",function(){var t=u.data("debug");u.removeData("debug");t&&(u.hide(),t.debug&&(f=n("<fieldset>").append(n("<legend><\/legend>").text("debug"),h(n("<dl><\/dl>"),t.debug)),u.append(f)),t.options&&(f=n("<fieldset>").append(n("<legend><\/legend>").text("options"),h(n("<dl><\/dl>"),t.options)),u.append(f)),u.show());c.off("click.debugrender")}),o.after(u),p&&e.tabs("refresh"))))}));f.find("#"+t.namespace+"-help-about").find(".apiver").text(t.api);r.dialog=r.fmDialog(f,{title:r.title,width:530,maxWidth:"window",maxHeight:"window",autoOpen:!1,destroyOnClose:!1,close:function(){s&&(a.hide(),e.tabs("destroy"));p=!1}}).on("click",function(n){n.stopPropagation()}).css({overflow:"hidden"});ct=r.dialog.children(".ui-tabs");at=ct.children(".ui-tabs-nav:first");vt=ct.children(".ui-tabs-panel");yt=r.dialog.outerHeight(!0)-r.dialog.height();r.dialog.closest(".ui-dialog").on("resize",function(){vt.height(r.dialog.height()-yt-at.outerHeight(!0)-20)});ht&&r.dialog.one("initContents",function(){n.ajax({url:r.options.helpSource?r.options.helpSource:ht.replace("%s",t.lang),dataType:"html"}).done(function(i){n("#"+t.namespace+"-help-help").html(i)}).fail(function(){n.ajax({url:ht.replace("%s","en"),dataType:"html"}).done(function(i){n("#"+t.namespace+"-help-help").html(i)})})});r.state=0;t.trigger("helpBuilded",r.dialog)}).one("open",function(){var n=!1;t.one("backenddebug",function(){n=!0}).one("opendone",function(){requestAnimationFrame(function(){!n&&s&&(s=!1,a.hide(),e.hide(),o.hide())})})});this.getstate=function(){return 0};this.exec=function(t,i){var r=i?i.tab:void 0;return s&&(e.tabs(),o.find("a:first").trigger("click"),a.show(),p=!0),this.dialog.trigger("initContents").elfinderdialog("open").find((r?".elfinder-help-tab-"+r:".ui-tabs-nav li")+" a:first").trigger("click"),n.Deferred().resolve()}}).prototype={forceLoad:!0},r.prototype.commands.hidden=function(){this.hidden=!0;this.updateOnSelect=!1;this.getstate=function(){return-1}},r.prototype.commands.hide=function(){var t,r,u,f,i=this,e={};this.syncTitleOnChange=!0;this.shortcuts=[{pattern:"ctrl+shift+dot",description:this.fm.i18n("toggleHidden")}];this.init=function(){var n=this.fm;t=n.storage("hide")||{items:{}};r=Object.keys(t.items).length;this.title=n.i18n(t.show?"hideHidden":"showHidden");i.update(void 0,i.title)};this.fm.bind("select contextmenucreate closecontextmenu",function(n,e){var o=(n.data?n.data.selected||n.data.targets:null)||e.selected();"select"===n.type&&n.data?f=n.data.origin:"contextmenucreate"===n.type&&(u=n.data.type);i.title=!o.length||("contextmenucreate"!==n.type&&"navbar"!==f||"cwd"===u)&&o[0]===e.cwd().hash?e.i18n(t.show?"hideHidden":"showHidden"):e.i18n("cmdhide");"closecontextmenu"!==n.type?i.update("cwd"===u?r?0:-1:void 0,i.title):(u="",requestAnimationFrame(function(){i.update(void 0,i.title)}))});this.getstate=function(n){return this.fm.cookieEnabled&&"cwd"!==u&&(n||this.fm.selected()).length||r?0:-1};this.exec=function(u,o){var v,y,s=this.fm,l=n.Deferred().done(function(){s.trigger("hide",{items:c,opts:o})}).fail(function(n){s.error(n)}),h=o||{},c=h.targets?h.targets:u||s.selected(),a=[];if(t=s.storage("hide")||{},n.isPlainObject(t)||(t={}),n.isPlainObject(t.items)||(t.items={}),"shortcut"!==o._currentType&&c.length&&("navbar"===o._currentType||"navbar"===f||c[0]!==s.cwd().hash)||(t.show?h.hide=!0:Object.keys(t.items).length&&(h.show=!0)),h.reset&&(h.show=!0,r=0),h.show||h.hide){if(h.show?t.show=!0:delete t.show,h.show)return s.storage("hide",h.reset?null:t),i.title=s.i18n("hideHidden"),i.update(h.reset?-1:void 0,i.title),n.each(t.items,function(n){var t=s.file(n,!0);t&&(s.searchStatus.state||!t.phash||s.file(t.phash))&&a.push(t)}),a.length&&(s.updateCache({added:a}),s.add({added:a})),h.reset&&(t={items:{}}),l.resolve();c=Object.keys(t.items)}return c.length&&(n.each(c,function(n,i){var r;t.items[i]||((r=s.file(i))&&(e[i]=r.i18||r.name),t.items[i]=e[i]?e[i]:i)}),r=Object.keys(t.items).length,v=this.files(c),s.storage("hide",t),s.remove({removed:c}),t.show&&this.exec(void 0,{hide:!0}),h.hide||((y={}).undo={cmd:"hide",callback:function(){var t=s.storage("hide");t&&(n.each(c,function(n,i){delete t.items[i]}),r=Object.keys(t.items).length,s.storage("hide",t),s.trigger("hide",{items:c,opts:{}}),i.update(r?0:-1));s.updateCache({added:v});s.add({added:v})}},y.redo={cmd:"hide",callback:function(){return s.exec("hide",void 0,{targets:c})}})),"rejected"==l.state()?l:l.resolve(y)}},(r.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];this.getstate=function(){var n=this.fm.root(),t=this.fm.cwd().hash;return n&&t&&n!=t?0:-1};this.exec=function(){return this.fm.exec("open",this.fm.root())}}).prototype={forceLoad:!0},(r.prototype.commands.info=function(){function u(n,t){return t?n.replace(/\u200B/g,""):n.replace(/(\/|\\)/g,"$1​")}var i=this.fm,r="elfinder-spinner",t={calc:i.i18n("calc"),size:i.i18n("size"),unknown:i.i18n("unknown"),path:i.i18n("path"),aliasfor:i.i18n("aliasfor"),modify:i.i18n("modify"),perms:i.i18n("perms"),locked:i.i18n("locked"),dim:i.i18n("dim"),kind:i.i18n("kind"),files:i.i18n("files"),folders:i.i18n("folders"),roots:i.i18n("volumeRoots"),items:i.i18n("items"),yes:i.i18n("yes"),no:i.i18n("no"),link:i.i18n("link"),owner:i.i18n("owner"),group:i.i18n("group"),perm:i.i18n("perm"),getlink:i.i18n("getLink")};this.items=["size","aliasfor","path","link","dim","modify","perms","locked","owner","group","perm"];this.options.custom&&Object.keys(this.options.custom).length&&n.each(this.options.custom,function(n,t){t.label&&this.items.push(t.label)});this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"{style}><\/span>{title}<\/div><table class="elfinder-info-tb">{content}<\/table>',itemTitle:'<strong>{name}<\/strong><span class="elfinder-info-kind">{kind}<\/span>',groupTitle:"<strong>{items}: {num}<\/strong>",row:'<tr><td class="elfinder-info-label">{label} : <\/td><td class="{class}">{value}<\/td><\/tr>',spinner:'<span>{text}<\/span> <span class="'+r+" "+r+'-{name}"><\/span>'};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){n.each(t,function(n,r){t[n]=i.i18n(r)})};this.getstate=function(){return 0};this.exec=function(i){function a(n,t,i){w.find("."+r+"-"+t).parent().html(n).addClass(i||"")}var y=this.files(i);y.length||(y=this.files([this.fm.cwd().hash]));var p,it,st,rt,ut,vt,l,ht,g,yt,nt,f,e=this.fm,b=this.options,v=this.tpl,s=v.row,tt=y.length,o=[],d=v.main,h="{label}",c="{value}",ft=[],et=null,bt={title:e.i18n("selectionInfo"),width:"auto",close:function(){n(this).elfinderdialog("destroy");et&&"pending"===et.state()&&et.reject();n.grep(ft,function(n){n&&"pending"===n.state()&&n.reject()})}},ot=[],ct=e.namespace+"-info-"+n.map(y,function(n){return n.hash}).join("-"),w=e.getUI().find("#"+ct),lt=[],pt="",wt="elfinder-font-mono elfinder-info-hash",k=[],at=e.ui.notify;return at.is(":hidden")&&at.children(".elfinder-notify").length&&at.elfinderdialog("open").height("auto"),tt?(w.length?w.elfinderdialog("toTop"):(l=e.storage("infohides")||e.arrayFlip(b.hideItems,!0),1===tt?((f=y[0]).icon&&(pt=" "+e.getIconStyle(f)),d=d.replace("{dirclass}",f.csscls?e.escape(f.csscls):"").replace("{class}",e.mime2class(f.mime)).replace("{style}",pt),st=v.itemTitle.replace("{name}",e.escape(f.i18||f.name)).replace("{kind}",'<span title="'+e.escape(f.mime)+'">'+e.mime2kind(f)+"<\/span>"),it=e.tmb(f),f.read?"directory"!=f.mime||f.alias?p=e.formatSize(f.size):(p=v.spinner.replace("{text}",t.calc).replace("{name}","size"),ot.push(f.hash)):p=t.unknown,l.size||o.push(s.replace(h,t.size).replace(c,p)),!l.aleasfor&&f.alias&&o.push(s.replace(h,t.aliasfor).replace(c,f.alias)),l.path||((vt=e.path(f.hash,!0))?o.push(s.replace(h,t.path).replace(c,u(e.escape(vt))).replace("{class}","elfinder-info-path")):(o.push(s.replace(h,t.path).replace(c,v.spinner.replace("{text}",t.calc).replace("{name}","path")).replace("{class}","elfinder-info-path")),ft.push(e.path(f.hash,!0,{notify:null}).fail(function(){a(t.unknown,"path")}).done(function(n){a(u(n),"path")})))),!l.link&&f.read&&(g=e.escape(f.name),"1"==f.url?o.push(s.replace(h,t.link).replace(c,'<button class="elfinder-info-button '+r+'-url">'+t.getlink+"<\/button>")):(f.url?nt=f.url:"directory"===f.mime?b.nullUrlDirLinkSelf&&null===f.url?nt=(yt=window.location).pathname+yt.search+"#elf_"+f.hash:""!==f.url&&e.option("url",!e.isRoot(f)&&f.phash||f.hash)&&(nt=e.url(f.hash)):nt=e.url(f.hash),nt&&o.push(s.replace(h,t.link).replace(c,'<a href="'+nt+'" target="_blank">'+g+"<\/a>")))),l.dim||(f.dim?o.push(s.replace(h,t.dim).replace(c,f.dim)):-1!==f.mime.indexOf("image")&&(f.width&&f.height?o.push(s.replace(h,t.dim).replace(c,f.width+"x"+f.height)):f.size&&"0"!==f.size&&(o.push(s.replace(h,t.dim).replace(c,v.spinner.replace("{text}",t.calc).replace("{name}","dim"))),ft.push(e.request({data:{cmd:"dim",target:f.hash},preventDefault:!0}).fail(function(){a(t.unknown,"dim")}).done(function(n){var i,r;a(n.dim||t.unknown,"dim");n.dim&&(i=n.dim.split("x"),(r=e.file(f.hash)).width=i[0],r.height=i[1])}))))),l.modify||o.push(s.replace(h,t.modify).replace(c,e.formatDate(f))),l.perms||o.push(s.replace(h,t.perms).replace(c,e.formatPermissions(f))),l.locked||o.push(s.replace(h,t.locked).replace(c,f.locked?t.yes:t.no)),!l.owner&&f.owner&&o.push(s.replace(h,t.owner).replace(c,f.owner)),!l.group&&f.group&&o.push(s.replace(h,t.group).replace(c,f.group)),!l.perm&&f.perm&&o.push(s.replace(h,t.perm).replace(c,e.formatFileMode(f.perm))),window.ArrayBuffer&&(e.options.cdns.sparkmd5||e.options.cdns.jssha)&&"directory"!==f.mime&&0<f.size&&(!b.showHashMaxsize||f.size<=b.showHashMaxsize)&&(k=[],n.each(e.storage("hashchekcer")||b.showHashAlgorisms,function(n,i){f[i]?o.push(s.replace(h,e.i18n(i)).replace(c,f[i]).replace("{class}",wt)):(o.push(s.replace(h,e.i18n(i)).replace(c,v.spinner.replace("{text}",t.calc).replace("{name}",i))),k.push(i))}),k.length&&(ht=n('<div class="elfinder-quicklook-info-progress"><\/div>'),ft.push(e.getContentsHashes(f.hash,k,b.showHashOpts,{progressBar:ht}).progress(function(t){n.each(k,function(n,i){t[i]&&a(t[i],i,wt)})}).always(function(){n.each(k,function(n,i){a(t.unknown,i)})})))),b.custom&&n.each(b.custom,function(t,i){l[i.label]||i.mimes&&!n.grep(i.mimes,function(n){return f.mime===n||0===f.mime.indexOf(n+"/")}).length||i.hashRegex&&!f.hash.match(i.hashRegex)||(o.push(s.replace(h,e.i18n(i.label)).replace(c,i.tpl.replace("{id}",ct))),i.action&&"function"==typeof i.action&&lt.push(i.action))})):(d=d.replace("{class}","elfinder-cwd-icon-group"),st=v.groupTitle.replace("{items}",t.items).replace("{num}",tt),(rt=n.grep(y,function(n){return"directory"==n.mime}).length)?(rt-=ut=n.grep(y,function(n){return!("directory"!==n.mime||n.phash&&!n.isroot)}).length,o.push(s.replace(h,t.kind).replace(c,ut===tt||rt===tt?t[ut?"roots":"folders"]:n.map({roots:ut,folders:rt,files:tt-ut-rt},function(n,i){return n?t[i]+" "+n:null}).join(", "))),l.size||o.push(s.replace(h,t.size).replace(c,v.spinner.replace("{text}",t.calc).replace("{name}","size"))),ot=n.map(y,function(n){return n.hash})):(p=0,n.each(y,function(n,t){var i=parseInt(t.size);0<=i&&0<=p?p+=i:p="unknown"}),o.push(s.replace(h,t.kind).replace(c,t.files)),l.size||o.push(s.replace(h,t.size).replace(c,e.formatSize(p))))),d=d.replace("{title}",st).replace("{content}",o.join("").replace(/{class}/g,"")),(w=this.fmDialog(d,bt)).attr("id",ct).one("mousedown",".elfinder-info-path",function(){n(this).html(u(n(this).html(),!0))}),k.length&&ht.appendTo(w.find("."+r+"-"+k[0]).parent()),e.UA.Mobile&&n.fn.tooltip&&w.children(".ui-dialog-content .elfinder-info-title").tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}),f&&"1"==f.url&&w.on("click","."+r+"-url",function(){n(this).parent().html(v.spinner.replace("{text}",e.i18n("ntfurl")).replace("{name}","url"));e.request({data:{cmd:"url",target:f.hash},preventDefault:!0}).fail(function(){a(g,"url")}).done(function(n){n.url?(a('<a href="'+n.url+'" target="_blank">'+g+"<\/a>"||g,"url"),e.file(f.hash).url=n.url):a(g,"url")})}),it&&n("<img/>").on("load",function(){w.find(".elfinder-cwd-icon").addClass(it.className).css("background-image","url('"+it.url+"')")}).attr("src",it.url),ot.length&&(et=e.getSize(ot).done(function(n){a(n.formated,"size")}).fail(function(){a(t.unknown,"size")})),lt.length&&n.each(lt,function(n,t){try{t(f,e,w)}catch(n){e.debug("error",n)}})),n.Deferred().resolve()):n.Deferred().reject()}}).prototype={forceLoad:!0},r.prototype.commands.mkdir=function(){var r,t=this.fm,i=this;this.value="";this.disableOnSearch=!0;this.updateOnSelect=!1;this.syncTitleOnChange=!0;this.mime="directory";this.prefix="untitled folder";this.exec=function(u,f){var e;return u&&u.length&&f&&f._currentType&&"navbar"===f._currentType?(this.origin=f._currentType,this.data={target:u[0]}):(e=t.cwd().hash===u[0],this.origin=r&&!e?r:"cwd",delete this.data),u||this.options.intoNewFolderToolbtn||t.getUI("cwd").trigger("unselectall"),this.move=this.value===t.i18n("cmdmkdirin"),n.proxy(t.res("mixin","make"),i)()};this.shortcuts=[{pattern:"ctrl+shift+n"}];this.init=function(){this.options.intoNewFolderToolbtn&&(this.syncTitleOnChange=!0)};t.bind("select contextmenucreate closecontextmenu",function(n){var u=(n.data?n.data.selected||n.data.targets:null)||t.selected();i.className="mkdir";r=n.data&&u.length&&(n.data.origin||n.data.type)||"";i.options.intoNewFolderToolbtn||""!==r||(r="cwd");u.length&&"navbar"!==r&&"cwd"!==r&&t.cwd().hash!==u[0]?(i.title=t.i18n("cmdmkdirin"),i.className+=" elfinder-button-icon-mkdirin"):i.title=t.i18n("cmdmkdir");"closecontextmenu"!==n.type?i.update(void 0,i.title):requestAnimationFrame(function(){i.update(void 0,i.title)})});this.getstate=function(i){var e=t.cwd(),u="navbar"===r||i&&i[0]!==e.hash?this.files(i||t.selected()):[],f=u.length;return"navbar"===r?f&&u[0].write&&u[0].read?0:-1:!e.write||f&&n.grep(u,function(n){return!(!n.read||n.locked)}).length!=f?-1:0}},r.prototype.commands.mkfile=function(){var t=this;this.disableOnSearch=!0;this.updateOnSelect=!1;this.mime="text/plain";this.prefix="untitled file.txt";this.variants=[];this.getTypeName=function(n,i){var r=t.fm,u=(u=r.messages["kind"+r.kinds[n]])?r.i18n(["extentiontype",i.toUpperCase(),u]):r.i18n(["extentionfile",i.toUpperCase()]);return u};this.fm.bind("open reload canMakeEmptyFile",function(){var i=t.fm,r=i.getCommand("edit").getMkfileHides();t.variants=[];i.mimesCanMakeEmpty&&n.each(i.mimesCanMakeEmpty,function(n,u){u&&!r[n]&&i.uploadMimeCheck(n)&&t.variants.push([n,t.getTypeName(n,u)])});t.change()});this.getstate=function(){return this.fm.cwd().write?0:-1};this.exec=function(i,r){var f,e,u=t.fm;if(f=u.mimesCanMakeEmpty[r]){if(u.uploadMimeCheck(r))return this.mime=r,this.prefix=u.i18n(["untitled file",f]),n.proxy(u.res("mixin","make"),t)();e=["errMkfile",t.getTypeName(r,f)]}return n.Deferred().reject(e)}},r.prototype.commands.netmount=function(){var i,t=this,r=!1;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.drivers=[];this.handlers={load:function(){var i=t.fm;i.cookieEnabled&&i.one("open",function(){t.drivers=i.netDrivers;t.drivers.length&&n.each(t.drivers,function(){var n=t.options[this];n&&(r=!0,n.integrateInfo&&i.trigger("helpIntegration",Object.assign({cmd:"netmount"},n.integrateInfo)))})})}};this.getstate=function(){return r?0:-1};this.exec=function(){function a(){u.protocol.trigger("change","winfocus")}function v(){var c,s=u.protocol.val(),o={cmd:"netmount",protocol:s},h=f[s];if(n.each(i.find("input.elfinder-netmount-inputs-"+s),function(t,i){var r,u=n(i);u.is(":radio,:checkbox")&&!u.is(":checked")||(r=n.trim(u.val()));r&&(o[i.name]=r)}),!o.host)return r.trigger("error",{error:"errNetMountHostReq",opts:{modal:!0}});o.mnt2res&&(c=!0);r.request({data:o,notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(n){var t;n.added&&n.added.length&&(c&&u.protocol.trigger("change","reset"),n.added[0].phash&&(t=r.file(n.added[0].phash))&&(t.dirs||(t.dirs=1,r.change({changed:[t]}))),r.one("netmountdone",function(){r.exec("open",n.added[0].hash)}));e.resolve()}).fail(function(n){h.fail&&"function"==typeof h.fail&&h.fail(r,r.parseError(n));e.reject(n)});t.dialog.elfinderdialog("close")}var h,o,u,s,c,l,r=t.fm,e=n.Deferred(),f=t.options;return t.dialog?t.dialog.elfinderdialog("open"):t.dialog=(u={protocol:n("<select><\/select>").on("change",function(n,t){var u=this.value;i.find(".elfinder-netmount-tr").hide();i.find(".elfinder-netmount-tr-"+u).show();h&&h.children(".ui-dialog-buttonpane:first").find("button").show();"function"==typeof f[u].select&&f[u].select(r,n,t)}).addClass("ui-corner-all")},s={title:r.i18n("netMountDialogTitle"),resizable:!0,modal:!0,destroyOnClose:!1,open:function(){n(window).on("focus."+r.namespace,a);u.protocol.trigger("change")},close:function(){"pending"==e.state()&&e.reject();n(window).off("focus."+r.namespace,a)},buttons:{}},c=n('<form autocomplete="off"><\/form>').on("keydown","input",function(t){var i,r=!0;t.keyCode===n.ui.keyCode.ENTER&&(n.each(c.find("input:visible:not(.elfinder-input-optional)"),function(){if(""===n(this).val())return r=!1,i=n(this),!1}),r?v():i.trigger("focus"))}),l=n("<div><\/div>"),i=n('<table class="elfinder-info-tb elfinder-netmount-tb"><\/table>').append(n("<tr><\/tr>").append(n("<td>"+r.i18n("protocol")+"<\/td>")).append(n("<td><\/td>").append(u.protocol))),n.each(t.drivers,function(t,e){f[e]&&(u.protocol.append('<option value="'+e+'">'+r.i18n(f[e].name||e)+"<\/option>"),n.each(f[e].inputs,function(t,u){u.attr("name",t);"hidden"!=u.attr("type")?(u.addClass("ui-corner-all elfinder-netmount-inputs-"+e),i.append(n("<tr><\/tr>").addClass("elfinder-netmount-tr elfinder-netmount-tr-"+e).append(n("<td>"+r.i18n(t)+"<\/td>")).append(n("<td><\/td>").append(u)))):(u.addClass("elfinder-netmount-inputs-"+e),l.append(u))}),f[e].protocol=u.protocol)}),i.append(l),i.find(".elfinder-netmount-tr").hide(),i.find(".elfinder-netmount-tr-"+t.drivers[0]).show(),s.buttons[r.i18n("btnMount")]=v,s.buttons[r.i18n("btnCancel")]=function(){t.dialog.elfinderdialog("close")},i.find("select,input").addClass("elfinder-tabstop"),o=t.fmDialog(c.append(i),s).ready(function(){u.protocol.trigger("change");o.elfinderdialog("posInit")}),h=o.closest(".ui-dialog"),o),e.promise()};t.fm.bind("netmount",function(n){function f(){u[r.protocol]&&"function"==typeof u[r.protocol].done&&(u[r.protocol].done(t.fm,r),i.find("select,input").addClass("elfinder-tabstop"),t.dialog.elfinderdialog("tabstopsInit"))}var r=n.data||null,u=t.options;r&&r.protocol&&(r.mode&&"redirect"===r.mode?t.fm.request({data:{cmd:"netmount",protocol:r.protocol,host:r.host,user:"init",pass:"return",options:r.options},preventDefault:!0}).done(function(n){r=JSON.parse(n.body);f()}):f())})},r.prototype.commands.netunmount=function(){this.alwaysEnabled=!0;this.updateOnSelect=!1;this.drivers=[];this.handlers={load:function(){this.drivers=this.fm.netDrivers}};this.getstate=function(n){var t,i=this.fm;return n&&this.drivers.length&&!this._disabled&&(t=i.file(n[0]))&&t.netkey?0:-1};this.exec=function(t){var f=this,i=this.fm,r=n.Deferred().fail(function(n){n&&i.error(n)}),u=i.file(t[0]);return this._disabled?r.reject():("pending"==r.state()&&i.confirm({title:f.title,text:i.i18n("confirmUnmount",u.name),accept:{label:"btnUnmount",callback:function(){function l(){n.when(c).done(function(){i.request({data:{cmd:"netmount",protocol:"netunmount",host:u.netkey,user:v,pass:"dum"},notify:{type:"netunmount",cnt:1,hideCnt:!0},preventFail:!0}).fail(function(n){r.reject(n)}).done(function(){u.volumeid&&delete i.volumeExpires[u.volumeid];r.resolve()})}).fail(function(n){e.length&&i.remove({removed:e});r.reject(n)})}var a,t,o,s,v=u.hash,h=(a=v,o=[],i.leafRoots&&(t=[],n.each(i.leafRoots,function(r,u){var f,e=i.parents(r);-1!==(f=n.inArray(a,e))&&(f=e.length-f,n.each(u,function(n,i){t.push({i:f,hash:i})}))}),t.length&&(t.sort(function(n,t){return n.i<t.i}),n.each(t,function(n,t){o.push(t.hash)}))),o),c=[],e=[];h.length?i.confirm({title:f.title,text:(s=["unmountChildren"],n.each(h,function(n,t){s.push([i.file(t).name])}),s),accept:{label:"btnUnmount",callback:function(){n.each(h,function(n,t){var r=i.file(t);r.netkey&&c.push(i.request({data:{cmd:"netmount",protocol:"netunmount",host:r.netkey,user:r.hash,pass:"dum"},notify:{type:"netunmount",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(n){n.removed&&(r.volumeid&&delete i.volumeExpires[r.volumeid],e=e.concat(n.removed))}))});l()}},cancel:{label:"btnCancel",callback:function(){r.reject()}}}):(c=null,l())}},cancel:{label:"btnCancel",callback:function(){r.reject()}}}),r)}},(r.prototype.commands.open=function(){var t=this.fm,i=this;this.alwaysEnabled=!0;this.noChangeDirOnRemovedCwd=!0;this._handlers={dblclick:function(n){var r=n.data&&n.data.file?[n.data.file]:void 0;0===i.getstate(r)&&(n.preventDefault(),t.exec("open",r))},"select enable disable reload":function(n){this.update("disable"==n.type?-1:void 0)}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=t.OS&&" enter")}];this.getstate=function(i){var r=this.files(i),u=r.length;return 1==u?r[0].read?0:-1:u&&!t.UA.Mobile&&n.grep(r,function(n){return!("directory"==n.mime||!n.read)}).length==u?0:-1};this.exec=function(i,r){function tt(){function v(i){var s,v,l=n("<a>").hide().appendTo(n("body"));if(t.UA.Mobile||!p){if(g)p?l.attr("target","_blank"):l.attr("download",u.name),l.attr("href",i).get(0).click();else if(!(a=window.open(i)))return f.reject("errPopup")}else{if(!("string"==typeof w.method&&"get"===w.method.toLowerCase())&&0===i.indexOf(t.options.url)&&t.customData&&Object.keys(t.customData).length&&!u.mime.match(/^(?:video|audio)/)&&(i=""),!(a="window"===k?(e=h=Math.round(2*screen.availWidth/3),o=c=Math.round(2*screen.availHeight/3),parseInt(u.width)&&parseInt(u.height)?(e=parseInt(u.width),o=parseInt(u.height)):u.dim&&(b=u.dim.split("x"),e=parseInt(b[0]),o=parseInt(b[1])),e<=h&&o<=c?(h=e,c=o):o-c<e-h?c=Math.round(o*(h/e)):h=Math.round(e*(c/o)),d="width="+h+",height="+c,window.open(i,r,d+",top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no")):("tabs"===k&&(r=u.hash),window.open("about:blank",r))))return f.reject("errPopup");""===i?((s=document.createElement("form")).action=t.options.url,s.method="POST",s.target=r,s.style.display="none",v=Object.assign({},t.customData,{cmd:"file",target:u.hash,_t:u.ts||parseInt(new Date/1e3)}),n.each(v,function(n,t){var i=document.createElement("input");i.name=n;i.value=t;s.appendChild(i)}),document.body.appendChild(s),s.submit()):"window"!==k&&(a.location=i);n(a).trigger("focus")}l.remove()}var a,r;try{y=new RegExp(t.option("dispInlineRegex"),"i")}catch(v){y=!1}for(g="string"==typeof n("<a>").get(0).download,s=l.length;s--;){if(r="elf_open_window",!(u=l[s]).read)return f.reject(["errOpen",u.name,"errPerm"]);p=y&&u.mime.match(y);t.openUrl(u.hash,!p,v)}return f.resolve(i)}var u,b,d,e,o,h,c,y,g,p,nt,a,f=n.Deferred().fail(function(n){n&&t.error(n)}),l=this.files(i),s=l.length,v="object"==typeof r&&r.thash,w=this.options,k=w.into||"window";if(!s&&!v)return f.reject();if(v||1==s&&(u=l[0])&&"directory"==u.mime)return v||!u||u.read?t.keyState.ctrlKey&&(t.keyState.shiftKey||"function"!=typeof t.options.getFileCallback)&&t.getCommand("opennew")?t.exec("opennew",[v||u.hash]):t.request({data:{cmd:"open",target:v||u.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0,lazy:!1}):f.reject(["errOpen",u.name,"errPerm"]);if(l=n.grep(l,function(n){return"directory"!=n.mime}),s!=l.length)return f.reject();if(1<s)t.confirm({title:"openMulti",text:["openMultiConfirm",s+""],accept:{label:"cmdopen",callback:function(){tt()}},cancel:{label:"btnCancel",callback:function(){f.reject()}},buttons:t.getCommand("zipdl")&&t.isCommandEnabled("zipdl",t.cwd().hash)?[{label:"cmddownload",callback:function(){t.exec("download",i);f.reject()}}]:[]});else{if((nt=t.storage("selectAction")||w.selectAction)&&(n.each(nt.split("/"),function(){var n=this.valueOf();if("open"!==n&&(a=t.getCommand(n))&&a.enabled())return!1;a=null}),a))return t.exec(a.name);tt()}return f}}).prototype={forceLoad:!0},r.prototype.commands.opendir=function(){this.alwaysEnabled=!0;this.getstate=function(){return 1===this.fm.selected().length&&this.fm.getUI("workzone").hasClass("elfinder-search-result")?0:-1};this.exec=function(t){var r,u=this.fm,f=n.Deferred(),i=this.files(t);return i.length&&i[0].phash?(r=i[0].phash,u.trigger("searchend",{noupdate:!0}),u.request({data:{cmd:"open",target:r},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!1}),f):f.reject()}},r.prototype.commands.opennew=function(){var t=this.fm;this.shortcuts=[{pattern:("function"==typeof t.options.getFileCallback?"shift+":"")+"ctrl+enter"}];this.getstate=function(n){var t=this.files(n);return 1===t.length&&"directory"===t[0].mime&&t[0].read?0:-1};this.exec=function(t){var u,r,i,e,o=n.Deferred(),s=this.files(t),h=s.length,f=this.options;return 1===h&&(u=s[0])&&"directory"===u.mime?(r=window.location,i=f.url?f.url:r.pathname,f.useOriginQuery&&(i.match(/\?/)?r.search&&(i+="&"+r.search.substr(1)):i+=r.search),i+="#elf_"+u.hash,e=window.open(i,"_blank"),setTimeout(function(){e.focus()},1e3),o.resolve()):o.reject()}},r.prototype.commands.paste=function(){this.updateOnSelect=!1;this.handlers={changeclipboard:function(){this.update()}};this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(n){if(this._disabled)return-1;if(n){if(Array.isArray(n)){if(1!=n.length)return-1;n=this.fm.file(n[0])}}else n=this.fm.cwd();return this.fm.clipboard().length&&"directory"==n.mime&&n.write?0:-1};this.exec=function(t,i){function k(t){function c(t,i){for(var u=[],r=t.length;r--;)-1!==n.inArray(t[r].name,i)&&u.unshift(r);return u}function y(r){var u,f={};r&&(Array.isArray(r)?r.length&&("string"==typeof r[0]?i=c(t,r):(n.each(r,function(n,t){f[t.name]=t.hash}),i=c(t,n.map(f,function(n,t){return t})),n.each(t,function(n,t){f[t.name]&&(v[f[t.name]]=t.name)}))):(u=[],i=n.map(r,function(n){return"string"==typeof n?n:(u=u.concat(n),!1)}),u.length&&(i=i.concat(u)),i=c(t,i),v=r));i.length?h(0):s(t)}var p,f=n.Deferred(),i=[],v={},h=function(n){var c=i[n],e=t[c],u=n==i.length-1;e&&r.confirm({title:r.i18n(o+"Files"),text:["errExists",e.name,"restore"===o?"confirmRest":"confirmRepl"],all:!u,accept:{label:"btnYes",callback:function(i){u||i?s(t):h(++n)}},reject:{label:"btnNo",callback:function(r){var f;if(r)for(f=i.length;n<f--;)t[i[f]].remove=!0;else t[i[n]].remove=!0;u||r?s(t):h(++n)}},cancel:{label:"btnCancel",callback:function(){f.resolve()}},buttons:[{label:"btnBackup",callback:function(r){var f;if(r)for(f=i.length;n<f--;)t[i[f]].rename=!0;else t[i[n]].rename=!0;u||r?s(t):h(++n)}}]})},s=function(t){var c,s,l=[],i=n.grep(t,function(n){return n.rename&&l.push(n.name),!n.remove}),h=i.length;if(!h)return f.resolve();c=n.map(i,function(n){return n.hash});s={cmd:"paste",dst:u.hash,targets:c,cut:e?1:0,renames:l,hashes:v,suffix:r.options.backupSuffix};r.api<2.1&&(s.src=i[0].phash);r.request({data:s,notify:{type:o,cnt:h},cancel:!0,navigate:{toast:a.noToast?{}:{inbuffer:{msg:r.i18n(["complete",r.i18n("cmd"+o)]),action:{cmd:"open",msg:"cmdopendir",data:[u.hash],done:"select",cwdNot:u.hash}}}}}).done(function(t){var u={},o=t.added&&t.added.length?t.added:null;e&&o&&(n.each(i,function(t,i){var e,s,r=i.phash,f=(e=i.name,n.each(o,function(n,t){if(t.name===e)return s=t.hash,!1}),s);f&&(u[r]?u[r].push(f):u[r]=[f])}),Object.keys(u).length&&(t.undo={cmd:"move",callback:function(){var t=[];return n.each(u,function(n,i){t.push(r.request({data:{cmd:"paste",dst:n,targets:i,cut:1},notify:{type:"undo",cnt:i.length}}))}),n.when.apply(null,t)}},t.redo={cmd:"move",callback:function(){return r.request({data:s,notify:{type:"redo",cnt:h}})}}));f.resolve(t)}).fail(function(n){f.reject();0===n&&r.sync()}).always(function(){r.unlockfiles({files:i})})};return r.isCommandEnabled(l.name,u.hash)&&t.length?(!r.oldAPI&&r.option("copyOverwrite",u.hash)?(p=n.map(t,function(n){return n.name}),u.hash==r.cwd().hash?y(n.map(r.files(),function(n){return n.phash==u.hash?{hash:n.hash,name:n.name}:null})):r.request({data:{cmd:"ls",target:u.hash,intersect:p},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(n){y(n.list)})):s(t),f):f.resolve()}var y,c,s,l=this,r=l.fm,a=i||{},u=t?this.files(t)[0]:r.cwd(),h=r.clipboard(),p=h.length,e=!!p&&h[0].cut,o=a._cmd?a._cmd:e?"move":"copy",v="err"+o.charAt(0).toUpperCase()+o.substr(1),w=[],b=[],f=n.Deferred().fail(function(n){n&&r.error(n)}).always(function(){r.unlockfiles({files:n.map(h,function(n){return n.hash})})});return p&&u&&"directory"==u.mime?u.write?(y=r.parents(u.hash),n.each(h,function(t,i){return i.read?e&&i.locked?!f.reject(["errLocked",i.name]):-1!==n.inArray(i.hash,y)?!f.reject(["errCopyInItself",i.name]):i.mime&&"directory"!==i.mime&&!r.uploadMimeCheck(i.mime,u.hash)?!f.reject([v,i.name,"errUploadMime"]):((c=r.parents(i.hash)).pop(),-1!==n.inArray(u.hash,c)&&n.grep(c,function(n){var t=r.file(n);return t.phash==u.hash&&t.name==i.name}).length?!f.reject(["errReplByChild",i.name]):void(i.phash==u.hash?b.push(i.hash):w.push({hash:i.hash,phash:i.phash,name:i.name}))):!f.reject([v,i.name,"errPerm"])}),"rejected"===f.state()||(s=n.Deferred(),e&&l.options.moveConfirm?r.confirm({title:"moveFiles",text:r.i18n("confirmMove",u.i18||u.name),accept:{label:"btnYes",callback:function(){s.resolve()}},cancel:{label:"btnCancel",callback:function(){s.reject()}}}):s.resolve(),s.done(function(){var t;n.when((t=b).length&&r._commands.duplicate?r.exec("duplicate",t):n.Deferred().resolve(),k(w)).done(function(n,t){f.resolve(t&&t.undo?t:void 0)}).fail(function(){f.reject()}).always(function(){e&&r.clipboard([])})}).fail(function(){f.reject()})),f):f.reject([v,h[0].name,"errPerm"]):f.reject()}},r.prototype.commands.places=function(){var r=this,i=this.fm,t=null;this.getstate=function(i){var u,f=this.hashes(i),e=f.length;return t&&e&&e==(u=f,n.grep(r.files(u),function(n){return"directory"==n.mime}).length)?0:-1};this.exec=function(i){var r=this.files(i);return t.trigger("regist",[r]),n.Deferred().resolve()};i.one("load",function(){t=i.ui.places})},r.prototype.commands.preference=function(){function o(i){n("#"+t.namespace+"-preference-tab-"+i).trigger("mouseover").trigger("click");u=i}function l(){function ht(){var i=[];return v=t.getCommand("edit").getMkfileHides(),n.each(t.mimesCanMakeEmpty,function(n,r){var u=t.getCommand("mkfile").getTypeName(n,r);i.push('<span class="elfinder-preference-column-item" title="'+t.escape(u)+'"><label><input type="checkbox" value="'+n+'" '+(v[n]?"":"checked")+"/>"+r+"<\/label><\/span>")}),i.join(" ")}function ct(){var r,u=t.storage("hide"),i=[];u&&u.items&&n.each(u.items,function(n,r){i.push(t.escape(r))});ri.prop("disabled",!i.length)[i.length?"removeClass":"addClass"]("ui-state-disabled");r=i.length?i.join("\n"):"";l.showHidden.attr("title",r);ti&&l.showHidden.tooltip("option","content",r.replace(/\n/g,"<br>")).tooltip("close")}var lt,tt,at,vt,it,y,yt,pt,rt,wt,ut,p,bt,ft,k,d,v,g,kt,dt,gt,ni,ti,ii,et,nt,ri,ui,ot,w,st,b,fi,ei=i.options.categories||{language:["language"],theme:["theme"],toolbar:["toolbarPref"],workspace:["iconSize","columnPref","selectAction","makefileTypes","useStoredEditor","editorMaximized","useFullscreen","showHidden"],dialog:["autoFocusDialog"],selectionInfo:["infoItems","hashChecker"],reset:["clearBrowserData"],all:!0},l=i.options.prefs||["language","theme","toolbarPref","iconSize","columnPref","selectAction","makefileTypes","useStoredEditor","editorMaximized","useFullscreen","showHidden","infoItems","hashChecker","autoFocusDialog","clearBrowserData"];t.cookieEnabled||delete ei.language;l=t.arrayFlip(l,!0);t.options.getFileCallback&&delete l.selectAction;t.UA.Fullscreen||delete l.useFullscreen;l.language&&(l.language=(lt=n("<select><\/select>").on("change",function(){var i=n(this).val();t.storage("lang",i);n("#"+t.id).elfinder("reload")}),tt=[],at=i.options.langs||{ar:"العربية",bg:"Български",ca:"Català",cs:"Čeština",da:"Dansk",de:"Deutsch",el:"Ελληνικά",en:"English",es:"Español",fa:"فارسی",fo:"Føroyskt",fr:"Français",fr_CA:"Français (Canada)",he:"עברית",hr:"Hrvatski",hu:"Magyar",id:"Bahasa Indonesia",it:"Italiano",ja:"日本語",ko:"한국어",nl:"Nederlands",no:"Norsk",pl:"Polski",pt_BR:"Português",ro:"Română",ru:"Pусский",si:"සිංහල",sk:"Slovenčina",sl:"Slovenščina",sr:"Srpski",sv:"Svenska",tr:"Türkçe",ug_CN:"ئۇيغۇرچە",uk:"Український",vi:"Tiếng Việt",zh_CN:"简体中文",zh_TW:"正體中文"},t.cookieEnabled?(n.each(at,function(n,t){tt.push('<option value="'+n+'">'+t+"<\/option>")}),lt.append(tt.join("")).val(t.lang)):n()));l.theme&&(l.theme=function(){var u=t.options.themes?Object.keys(t.options.themes).length:0;if(0===u||1===u&&t.options.themes.default)return null;var i=n("<select><\/select>").on("change",function(){var i=n(this).val();t.changeTheme(i).storage("theme",i)}),r={image:'<img class="elfinder-preference-theme elfinder-preference-theme-image" src="$2" />',link:'<a href="$1" target="_blank" title="$3">$2<\/a>',data:'<dt>$1<\/dt><dd><span class="elfinder-preference-theme elfinder-preference-theme-$0">$2<\/span><\/dd>'},e=["image","description","author","email","license"],o=n('<button class="ui-button ui-corner-all ui-widget elfinder-preference-theme-default"><\/button>').text(t.i18n("default")).on("click",function(){i.val("default").trigger("change")}),f=n('<div class="elfinder-reference-hide-taball"><\/div>').on("click","button",function(){var t=n(this).data("themeid");i.val(t).trigger("change")});return t.options.themes.default||i.append('<option value="default">'+t.i18n("default")+"<\/option>"),n.each(t.options.themes,function(u){var s,h=n('<option class="elfinder-theme-option-'+u+'" value="'+u+'">'+t.i18n(u)+"<\/option>"),o=n('<fieldset class="ui-widget ui-widget-content ui-corner-all elfinder-theme-list-'+u+'"><legend>'+t.i18n(u)+'<\/legend><div><span class="elfinder-spinner"><\/span><\/div><\/fieldset>');i.append(h);f.append(o);s=setTimeout(function(){o.find("span.elfinder-spinner").replaceWith(t.i18n(["errRead",u]))},1e4);t.getTheme(u).always(function(){s&&clearTimeout(s)}).done(function(f){var s=n(),c=n("<dl><\/dl>"),l=f.link?r.link.replace(/\$1/g,f.link).replace(/\$3/g,t.i18n("website")):"$2";f.name&&h.html(t.i18n(f.name));o.children("legend").html(l.replace(/\$2/g,t.i18n(f.name)||u));n.each(e,function(e,o){var s,h=r[o]||r.data;f[o]&&(s=h.replace(/\$0/g,t.escape(o)).replace(/\$1/g,t.i18n(o)).replace(/\$2/g,t.i18n(f[o])),"image"===o&&f.link&&(s=n(s).on("click",function(){i.val(u).trigger("change")}).attr("title",t.i18n("select"))),c.append(s))});s=(s=s.add(c)).add(n('<div class="elfinder-preference-theme-btn"><\/div>').append(n('<button class="ui-button ui-corner-all ui-widget"><\/button>').data("themeid",u).html(t.i18n("select"))));o.find("span.elfinder-spinner").replaceWith(s)}).fail(function(){o.find("span.elfinder-spinner").replaceWith(t.i18n(["errRead",u]))})}),n("<div><\/div>").append(i.val(t.theme&&t.theme.id?t.theme.id:"default"),o,f)}());l.toolbarPref&&(l.toolbarPref=(vt=n.map(t.options.uiOptions.toolbar,function(t){return n.isArray(t)?t:null}),it=[],y=t.storage("toolbarhides")||{},n.each(vt,function(){var n=t.i18n("cmd"+this);n==="cmd"+this&&(n=t.i18n(this));it.push('<span class="elfinder-preference-toolbar-item"><label><input type="checkbox" value="'+this+'" '+(y[this]?"":"checked")+"/>"+n+"<\/label><\/span>")}),n(it.join(" ")).on("change","input",function(){var i=n(this).val(),r=n(this).is(":checked");r||y[i]?r&&y[i]&&delete y[i]:y[i]=!0;t.storage("toolbarhides",y);t.trigger("toolbarpref")})));l.iconSize&&(l.iconSize=(yt=t.options.uiOptions.cwd.iconsView.sizeMax||3,pt=t.storage("iconsize")||t.options.uiOptions.cwd.iconsView.size||0,rt=n('<div class="touch-punch"><\/div>').slider({classes:{"ui-slider-handle":"elfinder-tabstop"},value:pt,max:yt,slide:function(n,i){t.getUI("cwd").trigger("iconpref",{size:i.value})},change:function(n,i){t.storage("iconsize",i.value)}}),t.getUI("cwd").on("iconpref",function(n,t){rt.slider("option","value",t.size)}),rt));l.columnPref&&(l.columnPref=(wt=t.options.uiOptions.cwd.listView.columns,ut=[],p=t.storage("columnhides")||{},n.each(wt,function(){var n=t.getColumnName(this);ut.push('<span class="elfinder-preference-column-item"><label><input type="checkbox" value="'+this+'" '+(p[this]?"":"checked")+"/>"+n+"<\/label><\/span>")}),n(ut.join(" ")).on("change","input",function(){var i=n(this).val(),r=n(this).is(":checked");r||p[i]?r&&p[i]&&delete p[i]:p[i]=!0;t.storage("columnhides",p);t.trigger("columnpref",{repaint:!0})})));l.selectAction&&(l.selectAction=(bt=n("<select><\/select>").on("change",function(){var i=n(this).val();t.storage("selectAction","default"===i?null:i)}),ft=[],k=i.options.selectActions,d=t.getCommand("open").options.selectAction||"open",-1===n.inArray(d,k)&&k.unshift(d),n.each(k,function(i,r){var u=n.map(r.split("/"),function(n){var i=t.i18n("cmd"+n);return i==="cmd"+n&&(i=t.i18n(n)),i});ft.push('<option value="'+r+'">'+u.join("/")+"<\/option>")}),bt.append(ft.join("")).val(t.storage("selectAction")||d)));l.makefileTypes&&(l.makefileTypes=(v=t.getCommand("edit").getMkfileHides(),g=n("<div><\/div>").on("change","input",function(){var i=n(this).val(),r=n(this).is(":checked");r||v[i]?r&&v[i]&&delete v[i]:v[i]=!0;t.storage("mkfileHides",v);t.trigger("canMakeEmptyFile")}).append(ht()),kt=n("<div><\/div>").append(n('<input type="text" placeholder="'+t.i18n("typeOfTextfile")+'"/>').on("keydown",function(t){t.keyCode===n.ui.keyCode.ENTER&&n(this).next().trigger("click")}),n('<button class="ui-button"><\/button>').html(t.i18n("add")).on("click",function(){function e(){return u.appendTo(r.closest(".ui-dialog")),t.toast({msg:t.i18n("errUsupportType"),mode:"warning",onHidden:function(){1===u.children().length&&u.appendTo(t.getUI())}}),r.trigger("focus"),!1}var f,r=n(this).prev(),i=r.val(),u=t.getUI("toast");if(!i.match(/\//)){if(!(i=t.arrayFlip(t.mimeTypes)[i]))return e();r.val(i)}if(!t.mimeIsText(i)||!t.mimeTypes[i])return e();t.trigger("canMakeEmptyFile",{mimes:[i],unshift:!0});(f={})[i]=t.mimeTypes[i];t.storage("mkfileTextMimes",Object.assign(f,t.storage("mkfileTextMimes")||{}));r.val("");u.appendTo(r.closest(".ui-dialog"));t.toast({msg:t.i18n(["complete",i+" ("+f[i]+")"]),onHidden:function(){1===u.children().length&&u.appendTo(t.getUI())}})}),n('<button class="ui-button"><\/button>').html(t.i18n("reset")).on("click",function(){t.one("canMakeEmptyFile",{done:function(){g.empty().append(ht())}});t.trigger("canMakeEmptyFile",{resetTexts:!0})})),t.bind("canMakeEmptyFile",{done:function(n){n.data&&n.data.mimes&&n.data.mimes.length&&g.empty().append(ht())}}),n("<div><\/div>").append(g,kt)));l.useStoredEditor&&(l.useStoredEditor=n('<input type="checkbox"/>').prop("checked",(dt=t.storage("useStoredEditor"))?0<dt:t.options.commandsOptions.edit.useStoredEditor).on("change",function(){t.storage("useStoredEditor",n(this).is(":checked")?1:-1)}));l.editorMaximized&&(l.editorMaximized=n('<input type="checkbox"/>').prop("checked",(gt=t.storage("editorMaximized"))?0<gt:t.options.commandsOptions.edit.editorMaximized).on("change",function(){t.storage("editorMaximized",n(this).is(":checked")?1:-1)}));l.useFullscreen&&(l.useFullscreen=n('<input type="checkbox"/>').prop("checked",(ni=t.storage("useFullscreen"))?0<ni:"screen"===t.options.commandsOptions.fullscreen.mode).on("change",function(){t.storage("useFullscreen",n(this).is(":checked")?1:-1)}));l.showHidden&&(et=n('<input type="checkbox"/>').prop("checked",(ii=t.storage("hide"))&&ii.show).on("change",function(){var i={};i[n(this).is(":checked")?"show":"hide"]=!0;t.exec("hide",void 0,i)}),nt=n('<button class="ui-button ui-corner-all ui-widget"><\/button>').append(t.i18n("reset")).on("click",function(){t.exec("hide",void 0,{reset:!0});n(this).parent().find("input:first").prop("checked",!1);ct()}),ri=n().add(et).add(nt),l.showHidden=n("<div><\/div>").append(et,nt),t.bind("hide",function(n){var t=n.data;t.opts&&(t.opts.show||t.opts.hide)||ct()}),t.UA.Mobile&&n.fn.tooltip&&(ti=!0,l.showHidden.tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}).css("user-select","none"),nt.css("user-select","none")),ct());l.infoItems&&(l.infoItems=(ui=t.getCommand("info").items,ot=[],w=t.storage("infohides")||t.arrayFlip(t.options.commandsOptions.info.hideItems,!0),n.each(ui,function(){var n=t.i18n(this);ot.push('<span class="elfinder-preference-info-item"><label><input type="checkbox" value="'+this+'" '+(w[this]?"":"checked")+"/>"+n+"<\/label><\/span>")}),n(ot.join(" ")).on("change","input",function(){var i=n(this).val(),r=n(this).is(":checked");r||w[i]?r&&w[i]&&delete w[i]:w[i]=!0;t.storage("infohides",w);t.trigger("infopref",{repaint:!0})})));l.hashChecker&&t.hashCheckers.length&&(l.hashChecker=(st=[],b=t.arrayFlip(t.storage("hashchekcer")||t.options.commandsOptions.info.showHashAlgorisms,!0),n.each(t.hashCheckers,function(){var n=t.i18n(this);st.push('<span class="elfinder-preference-hashchecker-item"><label><input type="checkbox" value="'+this+'" '+(b[this]?"checked":"")+"/>"+n+"<\/label><\/span>")}),n(st.join(" ")).on("change","input",function(){var i=n(this).val();n(this).is(":checked")?b[i]=!0:b[i]&&delete b[i];t.storage("hashchekcer",n.grep(t.hashCheckers,function(n){return b[n]}))})));l.autoFocusDialog&&(l.autoFocusDialog=n('<input type="checkbox"/>').prop("checked",(fi=t.storage("autoFocusDialog"))?0<fi:t.options.uiOptions.dialog.focusOnMouseOver).on("change",function(){t.storage("autoFocusDialog",n(this).is(":checked")?1:-1)}));l.clearBrowserData&&(l.clearBrowserData=n("<button><\/button>").text(t.i18n("reset")).button().on("click",function(i){i.preventDefault();t.storage();n("#"+t.id).elfinder("reload")}));n.each(ei,function(i,e){var o,h;!0===e?h=1:e&&(o=n(),n.each(e,function(i,r){var f,e,u,s="";(f=l[r])&&(h=2,e=t.i18n(r),(u=n(f).filter('input[type="checkbox"]')).length||(u=n(f).find('input[type="checkbox"]')),1===u.length?(u.attr("id")||u.attr("id","elfinder-preference-"+r+"-checkbox"),e='<label for="'+u.attr("id")+'">'+e+"<\/label>"):1<u.length&&(s=" elfinder-preference-checkboxes"),o=o.add(n('<dt class="elfinder-preference-'+r+s+'">'+e+"<\/dt>")).add(n('<dd class="elfinder-preference-'+r+s+'"><\/dd>').append(f)))}));h&&(f.append(a[s](/\{id\}/g,i)[s](/\{title\}/,t.i18n(i))[s](/\{class\}/,u===i?"elfinder-focus":"")),2===h&&r.append(n('<div id="'+t.namespace+"-preference-"+i+'" class="elfinder-preference-content"><\/div>').hide().append(n("<dl><\/dl>").append(o))))});f.on("click","a",function(t){var i=n(t.target),u=i.attr("href");t.preventDefault();t.stopPropagation();f.children().removeClass(c);i.removeClass("ui-state-hover").parent().addClass(c);u.match(/all$/)?r.addClass("elfinder-preference-taball").children().show():(r.removeClass("elfinder-preference-taball").children().hide(),n(u).show())}).on("focus blur","a",function(t){n(this).parent().toggleClass("ui-state-focus","focusin"===t.type)}).on("mouseenter mouseleave","li",function(t){n(this).toggleClass("ui-state-hover","mouseenter"===t.type)});r.find("a,input,select,button").addClass("elfinder-tabstop");h.append(f,r);(e=i.fmDialog(h,{title:i.title,width:i.options.width||600,height:i.options.height||400,maxWidth:"window",maxHeight:"window",autoOpen:!1,destroyOnClose:!1,allowMinimize:!1,open:function(){u&&o(u);u=null},resize:function(){r.height(e.height()-f.outerHeight(!0)-(r.outerHeight(!0)-r.height())-5)}}).on("click",function(n){n.stopPropagation()}).css({overflow:"hidden"})).closest(".ui-dialog").css({overflow:"hidden"}).addClass("elfinder-bg-translucent");u="all"}var e,u,i=this,t=this.fm,s="replace",a='<li class="'+t.res("class","tabstab")+' elfinder-preference-tab-{id}"><a href="#'+t.namespace+'-preference-{id}" id="'+t.namespace+'-preference-tab-{id}" class="ui-tabs-anchor {class}">{title}<\/a><\/li>',h=n('<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-preference">'),f=n('<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'),r=n('<div class="elfinder-preference-tabs ui-tabs-panel ui-widget-content ui-corner-bottom"><\/div>'),c=(n("base").length&&document.location.href.replace(/#.*$/,""),t.res("class","tabsactive"));this.shortcuts=[{pattern:"ctrl+comma",description:this.title}];this.alwaysEnabled=!0;this.getstate=function(){return 0};this.exec=function(t,i){return e||l(),i&&(i.tab?o(i.tab):"cwd"===i._currentType&&o("workspace")),e.elfinderdialog("open"),n.Deferred().resolve()}},(r.prototype.commands.quicklook=function(){function ht(t){n(document).trigger(n.Event("keydown",{keyCode:t,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))}function it(n){var r,u=i.getUI().offset(),t=(r=n.find(".elfinder-cwd-file-wrapper")).length?r:n,f=t.offset()||{top:0,left:0};return{opacity:0,width:t.width(),height:t.height()-30,top:f.top-u.top,left:f.left-u.left}}function r(n,t){var i=t||n.substr(0,n.indexOf("/")),u=d[i]?d[i]:d[i]=document.createElement(i),r=!1;try{r=u.canPlayType&&u.canPlayType(n)}catch(n){}return!(!r||""===r||"no"==r)}function rt(){t.update(void 0,function(){var i,f=t.fm,r=f.selectedFiles(),u=r.length;return t.docked(),u||(u=1,r=[f.cwd()]),1===u?r[0]:(i=0,n.each(r,function(n,t){var r=parseInt(t.ts);0<=i?i<r&&(i=r):i="unknown"}),{hash:r[0].hash+"/"+ +new Date,name:f.i18n("items")+": "+u,mime:"group",size:gt,ts:i,files:n.map(r,function(n){return n.hash}),getSize:!0})}())}var ct,lt,at,w,b,vt,k,o,yt,ut,t=this,i=t.fm,f=0,v=Element.update?"quicklookupdate":"update",s="elfinder-quicklook-navbar-icon",c="elfinder-quicklook-fullscreen",pt="elfinder-quicklook-info-wrapper",d={},ni=-1!=window.navigator.platform.indexOf("Win"),wt=!1,g=!1,l=!1,nt=null,ti=n.ui.keyCode.LEFT,ii=n.ui.keyCode.RIGHT,bt="mousemove touchstart "+("onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll"),kt=n('<span class="elfinder-dialog-title elfinder-quicklook-title"><\/span>'),y=n("<div><\/div>"),p=n('<div class="elfinder-quicklook-info"><\/div>'),u=n('<div class="ui-front elfinder-quicklook-cover"><\/div>'),dt=n('<div class="'+s+" "+s+'-fullscreen"><\/div>').on("click touchstart",function(r){var f,o,p,y,v;l||(o=(f=t.window).hasClass(c),p=n(window),y=function(){t.preview.trigger("changesize")},r.stopPropagation(),r.preventDefault(),o?(a="",h(),f.toggleClass(c).css(f.data("position")),p.trigger(t.resize).off(t.resize,y),e.off("mouseenter mouseleave"),u.off(bt)):(f.toggleClass(c).data("position",{left:f.css("left"),top:f.css("top"),width:f.width(),height:f.height(),display:"block"}).removeAttr("style"),n(window).on(t.resize,y).trigger(t.resize),u.on(bt,function(n){g||("mousemove"!==n.type&&"touchstart"!==n.type||(h(),nt=setTimeout(function(){(i.UA.Mobile||e.parent().find(".elfinder-quicklook-navbar:hover").length<1)&&e.fadeOut("slow",function(){u.show()})},3e3)),u.is(":visible")&&(ft(),u.data("tm",setTimeout(function(){u.show()},3e3))))}).show().trigger("mousemove"),e.on("mouseenter mouseleave",function(n){g||("mouseenter"===n.type?h():u.trigger("mousemove"))})),i.zIndex&&f.css("z-index",i.zIndex+1),i.UA.Mobile?e.attr("style",a):e.attr("style",a).draggable(o?"destroy":{start:function(){l=g=!0;u.show();h()},stop:function(){g=!1;a=t.navbar.attr("style");requestAnimationFrame(function(){l=!1})}}),n(this).toggleClass(s+"-fullscreen-off"),v=f,w.is(".ui-resizable")&&(v=v.add(w)),v.resizable(o?"enable":"disable").removeClass("ui-state-disabled"),f.trigger("viewchange"))}),h=function(){t.window.hasClass(c)&&(nt&&clearTimeout(nt),nt=null,e.stop(!0,!0).css("display","block"),ft())},ft=function(){u.data("tm")&&clearTimeout(u.data("tm"));u.removeData("tm");u.hide()},et=n('<div class="'+s+" "+s+'-prev"><\/div>').on("click touchstart",function(){return l||ht(ti),!1}),ot=n('<div class="'+s+" "+s+'-next"><\/div>').on("click touchstart",function(){return l||ht(ii),!1}),e=n('<div class="elfinder-quicklook-navbar"><\/div>').append(et).append(dt).append(ot).append('<div class="elfinder-quicklook-navbar-separator"><\/div>').append(n('<div class="'+s+" "+s+'-close"><\/div>').on("click touchstart",function(){return l||t.window.trigger("close"),!1})),ri=n('<span class="ui-front ui-icon elfinder-icon-close ui-icon-closethick"><\/span>').on("mousedown",function(n){n.stopPropagation();t.window.trigger("close")}),tt=n('<span class="ui-front ui-icon elfinder-icon-minimize ui-icon-minusthick"><\/span>').on("mousedown",function(n){n.stopPropagation();t.docked()?t.window.trigger("navdockout"):t.window.trigger("navdockin")}),gt='<span class="elfinder-spinner-text">'+i.i18n("calc")+'<\/span><span class="elfinder-spinner"><\/span>',a="",st=!0;this.flags={};this.cover=u;this.evUpdate=v;(this.navbar=e)._show=h;this.resize="resize."+i.namespace;this.info=n("<div><\/div>").addClass(pt).append(y).append(p);this.autoPlay=function(){return!!t.opened()&&!!t.options[t.docked()?"dockAutoplay":"autoplay"]};this.preview=n('<div class="elfinder-quicklook-preview ui-helper-clearfix"><\/div>').on("change",function(){h();e.attr("style",a);t.docked()&&e.hide();t.preview.attr("style","").removeClass("elfinder-overflow-auto");t.info.attr("style","").hide();t.cover.removeClass("elfinder-quicklook-coverbg");y.removeAttr("class").attr("style","");p.html("")}).on(v,function(r){t.preview;var s,l,a,f=r.file,h='<div class="elfinder-quicklook-info-data">{value}<\/div>',e=[];f&&!Object.keys(f).length&&(f=i.cwd());f&&o&&"pending"===o.state()&&o._hash!==f.hash&&o.reject();f&&(r.forceUpdate||t.window.data("hash")!==f.hash)?(a=t.window.css("overflow","hidden"),l=i.escape(f.i18||f.name),f.read||r.stopImmediatePropagation(),t.window.data("hash",f.hash),t.preview.off("changesize").trigger("change").children().remove(),kt.html(l),et.css("visibility",""),ot.css("visibility",""),f.hash===i.cwdId2Hash(b.find("[id]:not(.elfinder-cwd-parent):first").attr("id"))&&et.css("visibility","hidden"),f.hash===i.cwdId2Hash(b.find("[id]:last").attr("id"))&&ot.css("visibility","hidden"),"directory"===f.mime?e=[f.hash]:"group"===f.mime&&f.getSize&&(e=f.files),p.html(h.replace(/\{value\}/,l)+h.replace(/\{value\}/,i.mime2kind(f))+h.replace(/\{value\}/,e.length?gt:i.formatSize(f.size))+h.replace(/\{value\}/,i.i18n("modify")+": "+i.formatDate(f))),e.length&&((o=i.getSize(e).done(function(n){p.find("span.elfinder-spinner").parent().html(n.formated)}).fail(function(){p.find("span.elfinder-spinner").parent().html(i.i18n("unknown"))}).always(function(){o=null}))._hash=f.hash),y.addClass("elfinder-cwd-icon ui-corner-all "+i.mime2class(f.mime)),f.icon&&y.css(i.getIconStyle(f,!0)),t.info.attr("class",pt),f.csscls&&t.info.addClass(f.csscls),f.read&&(s=i.tmb(f))&&n("<img/>").hide().appendTo(t.preview).on("load",function(){y.addClass(s.className).css("background-image","url('"+s.url+"')");n(this).remove()}).attr("src",s.url),t.info.delay(100).fadeIn(10),t.window.hasClass(c)&&u.trigger("mousemove"),a.css("overflow","")):r.stopImmediatePropagation()});this.window=n('<div class="ui-front ui-helper-reset ui-widget elfinder-quicklook touch-punch" style="position:absolute"><\/div>').hide().addClass(i.UA.Touch?"elfinder-touch":"").on("click",function(n){var t=this;n.stopPropagation();2===f&&requestAnimationFrame(function(){2===f&&i.toFront(t)})}).append(n('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix elfinder-quicklook-titlebar"><\/div>').append(n('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button elfinder-quicklook-titlebar-icon'+(ni?" elfinder-titlebar-button-right":"")+'"><\/span>').append(ri,tt),kt),this.preview,t.info.hide(),u.hide(),e).draggable({handle:"div.elfinder-quicklook-titlebar"}).on("open",function(r,u){function b(n){f=n;t.update(1,t.value);t.change();c.trigger("resize."+i.namespace)}var s,o,l,v,y,c=t.window,p=t.value,w=i.getUI("cwd");st||0!==f?4===f&&(i.getUI("navdock").data("addNode")(yt),b(3),t.preview.trigger("changesize"),i.storage("previewDocked","1"),0===i.getUI("navdock").width()&&c.trigger("navdockout")):(p&&p.hash!==vt&&(w=i.cwdHash2Elm(p.hash.split("/",2)[0])),a="",e.attr("style",""),f=1,w.trigger("scrolltoview"),ft(),c.css(u||it(w)).show().animate((s=t.options.contain||i.options.dialogContained,o=s?i.getUI():n(window),l=i.getUI().offset(),v=Math.min(ct,o.width()-10),y=Math.min(lt,o.height()-80),{opacity:1,width:v,height:y,top:parseInt((o.height()-y-60)/2+(s?0:o.scrollTop()-l.top)),left:parseInt((o.width()-v)/2+(s?0:o.scrollLeft()-l.left))}),550,function(){b(2);h()}),i.toFront(c))}).on("close",function(n,r){function e(n,e){f=n;e&&i.toHide(u);h.children().remove();t.update(0,t.value);u.data("hash","");r&&r.resolve()}var s,u=t.window,h=t.preview.trigger("change"),l=(t.value,(u.data("hash")||"").split("/",2)[0]);t.opened()&&(o&&"pending"===o.state()&&o.reject(),t.docked()?(yt=i.getUI("navdock").data("removeNode")(t.window.attr("id"),"detach"),e(4),i.storage("previewDocked","2")):(f=1,u.hasClass(c)&&dt.click(),l&&(s=b.find("#"+l)).length?u.animate(it(s),500,function(){h.off("changesize");e(0,!0)}):e(0,!0)))}).on("navdockin",function(n,r){var u=t.window,o=i.getUI("navdock"),h=k||o.width(),s=r||{};st&&(s.init=!0);f=3;at=u.attr("style");u.toggleClass("ui-front").removeClass("ui-widget").draggable("disable").resizable("disable").removeAttr("style").css({width:"100%",height:h,boxSizing:"border-box",paddingBottom:0,zIndex:"unset"});e.hide();tt.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize");i.toHide(u,!0);o.data("addNode")(u,s);t.preview.trigger("changesize");i.storage("previewDocked","1")}).on("navdockout",function(){var r=t.window,u=i.getUI("navdock"),e=(n.Deferred(),it(t.preview));k=r.outerHeight();u.data("removeNode")(r.attr("id"),i.getUI());r.toggleClass("ui-front").addClass("ui-widget").draggable("enable").resizable("enable").attr("style",at);tt.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize");f=0;r.trigger("open",e);i.storage("previewDocked","0")}).on("resize."+i.namespace,function(){t.preview.trigger("changesize")});this.alwaysEnabled=!0;this.value=null;this.handlers={select:function(n){ut&&cancelAnimationFrame(ut);n.data&&n.data.selected&&n.data.selected.length?t.opened()&&rt():ut=requestAnimationFrame(function(){t.opened()&&rt()})},error:function(){t.window.is(":visible")&&t.window.trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")},navbarshow:function(){requestAnimationFrame(function(){t.docked()&&t.preview.trigger("changesize")})},destroy:function(){t.window.remove()}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:r("audio/ogg;"),webm:r("audio/webm;"),mp3:r("audio/mpeg;"),wav:r("audio/wav;"),m4a:r("audio/mp4;")||r("audio/x-m4a;")||r("audio/aac;"),flac:r("audio/flac;"),amr:r("audio/amr;")},video:{ogg:r("video/ogg;"),webm:r("video/webm;"),mp4:r("video/mp4;"),mkv:r("video/x-matroska;")||r("video/webm;"),"3gp":r("video/3gpp;")||r("video/mp4;"),m3u8:r("application/x-mpegURL","video")||r("application/vnd.apple.mpegURL","video"),mpd:r("application/dash+xml","video")}};d={};this.closed=function(){return 0==f||4==f};this.opened=function(){return 2==f||3==f};this.docked=function(){return 3==f};this.addIntegration=function(n){requestAnimationFrame(function(){i.trigger("helpIntegration",Object.assign({cmd:"quicklook"},n))})};this.init=function(){var e,r=this.options,f=this.window,o=this.preview;ct=0<r.width?parseInt(r.width):450;lt=0<r.height?parseInt(r.height):300;"auto"!==r.dockHeight&&(k=(k=parseInt(r.dockHeight))||void 0);i.one("load",function(){(wt=i.getUI("navdock").data("dockEnabled"))||tt.hide();w=i.getUI();b=i.getUI("cwd");i.zIndex&&f.css("z-index",i.zIndex+1);f.appendTo(w);n(document).on("keydown."+i.namespace,function(i){i.keyCode==n.ui.keyCode.ESCAPE&&t.opened()&&!t.docked()&&f.hasClass("elfinder-frontmost")&&f.trigger("close")});f.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){o.trigger("changesize")}});t.change(function(){t.opened()&&t.value&&(t.value.tmb&&1==t.value.tmb&&(t.value=Object.assign({},i.file(t.value.hash))),o.trigger(n.Event(v,{file:t.value})))});o.on(v,function(n){var u,f,o;if(u=n.file){if(f=u.hash,o=i.searchStatus.mixed&&1<i.searchStatus.state,"directory"!==u.mime)if(parseInt(u.size)||u.mime.match(r.mimeRegexNotEmptyCheck)){if(t.dispInlineRegex=e,o||i.optionsByHashes[f])try{t.dispInlineRegex=new RegExp(i.option("dispInlineRegex",f),"i")}catch(n){try{t.dispInlineRegex=new RegExp(i.isRoot(u)?i.options.dispInlineRegex:i.option("dispInlineRegex",u.phash),"i")}catch(n){t.dispInlineRegex=/^$/}}}else n.stopImmediatePropagation();else t.dispInlineRegex=/^$/;t.info.show()}else n.stopImmediatePropagation()});n.each(i.commands.quicklook.plugins||[],function(n,i){"function"==typeof i&&new i(t)})}).one("open",function(){var n,u=Number(i.storage("previewDocked")||r.docked);wt&&1<=u&&(n=t.window,t.exec(),n.trigger("navdockin",{init:!0}),2===u?n.trigger("close"):(t.update(void 0,i.cwd()),t.change()));st=!1}).bind("open",function(){vt=i.cwd().hash;t.value=i.cwd();try{e=new RegExp(i.option("dispInlineRegex"),"i")}catch(n){e=/^$/}}).bind("change",function(i){i.data&&i.data.changed&&t.opened()&&n.each(i.data.changed,function(){if(t.window.data("hash")===this.hash)return t.window.data("hash",null),t.preview.trigger(v),!1})}).bind("navdockresizestart navdockresizestop",function(n){u["navdockresizestart"===n.type?"show":"hide"]()})};this.getstate=function(){return t.opened()?1:0};this.exec=function(){return t.closed()&&rt(),t.enabled()&&t.window.trigger(t.opened()?"close":"open"),n.Deferred().resolve()};this.hideinfo=function(){this.info.stop(!0,!0).hide()}}).prototype={forceLoad:!0},r.prototype.commands.quicklook.plugins=[function(t){var f,r=["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],e=t.fm.returnBytes(t.options.getDimThreshold||0),i=t.preview,u=new Image;u.onload=u.onerror=function(){2==u.height&&r.push("image/webp")};u.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";n.each(navigator.mimeTypes,function(t,i){var u=i.type;0===u.indexOf("image/")&&n.inArray(u,r)&&r.push(u)});i.on(t.evUpdate,function(u){function y(n){var t=c.file(o.hash);t.width=n[0];t.height=n[1]}function v(){var n,t,u,f,r;l&&l.state&&"pending"===l.state()&&l.reject();w||(w=!0,n=s.get(0),(t=o.width&&o.height?{w:o.width,h:o.height}:n.naturalWidth?null:{w:s.width(),h:s.height()})&&s.removeAttr("width").removeAttr("height"),u=o.width||n.naturalWidth||n.width||s.width(),f=o.height||n.naturalHeight||n.height||s.height(),o.width&&o.height||y([u,f]),t&&s.width(t.w).height(t.h),r=(u/f).toFixed(2),i.on("changesize",function(){var t,n,f=parseInt(i.width()),u=parseInt(i.height());r<(f/u).toFixed(2)?(n=u,t=Math.floor(n*r)):(t=f,n=Math.floor(t/r));s.width(t).height(n).css("margin-top",n<u?Math.floor((u-n)/2):0)}).trigger("changesize"),s.fadeIn(100))}var s,a,p,h,c=t.fm,o=u.file,w=!1,l=null;(f=f||c.arrayFlip(r))[o.mime]&&t.dispInlineRegex.test(o.mime)&&(u.stopImmediatePropagation(),a=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+c.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),p=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(a),s=n("<img/>").hide().appendTo(i).on("load",function(){a.remove();t.hideinfo();v()}).on("error",function(){a.remove()}),h=c.openUrl(o.hash,!1,function(n){s.attr("src",n)},{progressBar:p}),i.one("change",function(){h&&h.state&&"pending"===h.state()&&h.reject()}),o.width&&o.height?v():o.size>e&&(l=c.request({data:{cmd:"dim",target:o.hash},preventDefault:!0}).done(function(n){var t;n.dim&&(t=n.dim.split("x"),o.width=t[0],o.height=t[1],y(t),v())})))})},function(t){var i=t.fm,r=t.preview;window.Worker&&window.Uint8Array&&r.on(t.evUpdate,function(u){function h(n){f&&f.terminate();e.remove();i.debug("error",n)}var e,c,l,f,o,s=u.file;"image/tiff"===s.mime&&(u.stopImmediatePropagation(),e=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),c=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(e),r.one("change",function(){f&&f.terminate();e.remove()}),o=i.getContents(s.hash,"arraybuffer",{progressBar:c}).done(function(u){if(u){l=n("<div><\/div>").css({width:"100%",height:"100%"}).hide().appendTo(r);try{(f=i.getWorker()).onmessage=function(u){var h,a,y,c,v,p,o=u.data;f&&f.terminate();a=(h=document.createElement("canvas")).getContext("2d");h.width=o.width;h.height=o.height;(y=a.createImageData(o.width,o.height)).data.set(new Uint8Array(o.image));a.putImageData(y,0,0);l.append(h).show();e.remove();c=(o.width/o.height).toFixed(2);r.on("changesize",function(){var i,t,f=parseInt(r.width()),u=parseInt(r.height());c<(f/u).toFixed(2)?(t=u,i=Math.floor(t*c)):(i=f,t=Math.floor(i/c));n(h).width(i).height(t).css("margin-top",t<u?Math.floor((u-t)/2):0)}).trigger("changesize");s.width&&s.height||(v=[o.width,o.height],(p=i.file(s.hash)).width=v[0],p.height=v[1]);t.hideinfo()};f.onerror=h;f.postMessage({scripts:[i.options.cdns.tiff,i.getWorkerUrl("quicklook.tiff.js")],data:{data:u}})}catch(u){h(u)}}else h()}),r.one("change",function(){o&&o.state&&"pending"===o.state()&&o.reject()}))})},function(t){function f(n,f,e){try{i.replaceXhrSend();u.fromURL(n).then(function(n){var i;f.attr("src",n.image.toBase64());requestAnimationFrame(function(){i=(f.width()/f.height()).toFixed(2);r.on("changesize",function(){var t,n,e=parseInt(r.width()),u=parseInt(r.height());i<(e/u).toFixed(2)?(n=u,t=Math.floor(n*i)):(t=e,n=Math.floor(t/i));f.width(t).height(n).css("margin-top",n<u?Math.floor((u-n)/2):0)}).trigger("changesize");e.remove();t.hideinfo();f.fadeIn(100)})},function(){e.remove();f.remove()});i.restoreXhrSend()}catch(n){i.restoreXhrSend();e.remove();f.remove()}}var u,i=t.fm,e=i.arrayFlip(["image/vnd.adobe.photoshop","image/x-photoshop"]),r=t.preview;r.on(t.evUpdate,function(o){var c,h,y,l,a,s,v=o.file;e[v.mime]&&i.options.cdns.psd&&!i.UA.ltIE10&&t.dispInlineRegex.test(v.mime)&&(o.stopImmediatePropagation(),h=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),y=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(h),s=i.openUrl(v.hash,"sameorigin",function(t){t&&(c=n("<img/>").hide().appendTo(r),u?f(t,c,h):(l=window.define,a=window.require,window.require=null,window.define=null,i.loadScript([i.options.cdns.psd],function(){u=require("psd");l?window.define=l:delete window.define;a?window.require=a:delete window.require;f(t,c,h)})))},{progressBar:y}),r.one("change",function(){s&&s.state&&"pending"===s.state()&&s.reject()}))})},function(t){var i=t.fm,u=i.arrayFlip(["text/html","application/xhtml+xml"]),r=t.preview;r.on(t.evUpdate,function(f){var o,s,h,e=f.file;u[e.mime]&&t.dispInlineRegex.test(e.mime)&&(!t.options.getSizeMax||e.size<=t.options.getSizeMax)&&(f.stopImmediatePropagation(),s=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),h=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(s),r.one("change",function(){"pending"==o.state()&&o.reject()}).addClass("elfinder-overflow-auto"),o=i.request({data:{cmd:"get",target:e.hash,conv:1,_t:e.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:h}).done(function(i){t.hideinfo();var u=n('<iframe class="elfinder-quicklook-preview-html"><\/iframe>').appendTo(r)[0].contentWindow.document;u.open();u.write(i.content);u.close()}).always(function(){s.remove()}))})},function(t){function e(r,u){t.hideinfo();var e=n('<iframe class="elfinder-quicklook-preview-html"><\/iframe>').appendTo(f)[0].contentWindow.document;e.open();e.write(i(r.content));e.close();u.remove()}function u(n){i=!1;n.remove()}var r=t.fm,o=r.arrayFlip(["text/x-markdown"]),f=t.preview,i=null;f.on(t.evUpdate,function(s){var l,h,a,c=s.file;o[c.mime]&&r.options.cdns.marked&&!1!==i&&t.dispInlineRegex.test(c.mime)&&(!t.options.getSizeMax||c.size<=t.options.getSizeMax)&&(s.stopImmediatePropagation(),h=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+r.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),a=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(h),f.one("change",function(){"pending"==l.state()&&l.reject()}).addClass("elfinder-overflow-auto"),l=r.request({data:{cmd:"get",target:c.hash,conv:1,_t:c.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:a}).done(function(n){i||window.marked?(i=i||window.marked,e(n,h)):r.loadScript([r.options.cdns.marked],function(t){i=t||window.marked||!1;delete window.marked;i?e(n,h):u(h)},{tryRequire:!0,error:function(){u(h)}})}).fail(function(){u(h)}))})},function(t){var u,r,i,o,f,s,e;t.options.viewerjs&&(u=t.fm,r=t.preview,i=t.options.viewerjs,o=i.url?u.arrayFlip(i.mimes||[]):[],f=t.window,s=t.navbar,e=function(){s.css("bottom",f.hasClass("elfinder-quicklook-fullscreen")?"30px":"")},i.url&&r.on("update",function(s){var l,h,v,c,a=s.file;!o[a.mime]||"application/pdf"===a.mime&&i.pdfNative&&t.flags.pdfNative||(s.stopImmediatePropagation(),h=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+u.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),v=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(h),c=u.openUrl(a.hash,"sameorigin",function(u){u&&(l=n('<iframe class="elfinder-quicklook-preview-iframe"><\/iframe>').css("background-color","transparent").on("load",function(){t.hideinfo();h.remove();l.css("background-color","#fff")}).on("error",function(){h.remove();l.remove()}).appendTo(r).attr("src",i.url+"#"+u),f.on("viewchange.viewerjs",e),e(),r.one("change",function(){f.off("viewchange.viewerjs");h.remove();l.off("load").remove()}))},{progressBar:v}),r.one("change",function(){c&&c.state&&"pending"===c.state()&&c.reject()}))}))},function(t){var i=t.fm,f="application/pdf",u=t.preview,r=!1,e="";i.UA.Safari&&"mac"===i.OS&&!i.UA.iOS||i.UA.IE||i.UA.Firefox?r=!0:n.each(navigator.plugins,function(t,i){n.each(i,function(n,t){if(t.type===f)return!(r=!0)})});(t.flags.pdfNative=r)&&(void 0===t.options.pdfToolbar||t.options.pdfToolbar||(e="#toolbar=0"),u.on(t.evUpdate,function(o){var s,h=o.file;r&&h.mime===f&&t.dispInlineRegex.test(h.mime)&&(o.stopImmediatePropagation(),s=i.openUrl(h.hash,!1,function(f){f&&(t.hideinfo(),t.cover.addClass("elfinder-quicklook-coverbg"),n('<object class="elfinder-quicklook-preview-pdf" data="'+f+e+'" type="application/pdf" ><\/object>').on("error",function(){r=!1;t.update(void 0,i.cwd());t.update(void 0,h)}).appendTo(u))}),u.one("change",function(){s&&s.state&&"pending"===s.state()&&s.reject()}))}))},function(t){var f=t.fm,r="application/x-shockwave-flash",i=t.preview,u=!1;n.each(navigator.plugins,function(t,i){n.each(i,function(n,t){if(t.type===r)return!(u=!0)})});u&&i.on(t.evUpdate,function(u){var e,o=u.file;o.mime===r&&t.dispInlineRegex.test(o.mime)&&(u.stopImmediatePropagation(),e=f.openUrl(o.hash,!1,function(r){r&&(t.hideinfo(),n('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+r+'" quality="high" type="application/x-shockwave-flash" wmode="transparent" />').appendTo(i))}),i.one("change",function(){e&&e.state&&"pending"===e.state()&&e.reject()}))})},function(t){function o(){w.css("bottom",c.hasClass("elfinder-quicklook-fullscreen")?"50px":"")}function a(t,r){return n('<audio class="elfinder-quicklook-preview-audio ui-front" controls'+b+' preload="auto" autobuffer><source src="'+t+'" ><\/source><\/audio>').on("change",function(n){n.stopPropagation()}).on("error",function(){i&&i.data("hash")===r&&l()}).data("hash",r).appendTo(h)}function v(n){var t,r=i.data("hash");y&&(t=n.play());t&&t.catch&&t.catch(function(){n.paused||i&&i.data("hash")===r&&l()})}var i,e,u,y,f,s,r=t.fm,h=t.preview,p={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg","audio/webm":"webm","audio/flac":"flac","audio/x-flac":"flac","audio/amr":"amr"},c=t.window,w=t.navbar,b="string"==typeof t.options.mediaControlsList&&t.options.mediaControlsList?' controlsList="'+r.escape(t.options.mediaControlsList)+'"':"",l=function(){if(i&&i.parent().length){var n=i[0],t=i.children("source").attr("src");c.off("viewchange.audio");try{n.pause();i.empty();t.match(/^blob:/)&&URL.revokeObjectURL(t);n.src="";n.load()}catch(n){}i.remove();i=null}};h.on(t.evUpdate,function(l){var nt,k,tt,it,w,d,b=l.file,g=p[b.mime];p[b.mime]&&t.dispInlineRegex.test(b.mime)&&((nt=t.support.audio[g])||"amr"===g)&&(y=t.autoPlay(),e=b.hash,nt?(l.stopImmediatePropagation(),f=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+r.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),s=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(f),k=r.openUrl(e,!1,function(n){f.remove();n?(i=a(n,e),v(i[0]),c.on("viewchange.audio",o),o()):i.remove()},{progressBar:s}),h.one("change",function(){k&&k.state&&"pending"===k.state()&&k.reject()})):r.options.cdns.amr&&"amr"===g&&!1!==u&&(l.stopImmediatePropagation(),f=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+r.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),s=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(f),i=a("",e),tt=b.hash,w=n.Deferred(),d=n.Deferred().done(function(){var n=r.getContents(tt,"arraybuffer",{progressBar:s}).done(function(n){try{var t=u.toWAV(new Uint8Array(n));t?w.resolve(URL.createObjectURL(new Blob([t],{type:"audio/x-wav"}))):w.reject()}catch(n){w.reject()}}).fail(function(){w.reject()});h.one("change",function(){n&&n.state&&"pending"===n.state()&&n.reject()})}).fail(function(){u=!1;w.reject()}),window.TextEncoder&&window.URL&&URL.createObjectURL&&void 0===u?(it=window.AMR,delete window.AMR,r.loadScript([r.options.cdns.amr],function(){u=!!window.AMR&&window.AMR;window.AMR=it;d[u?"resolve":"reject"]()},{error:function(){d.reject()}})):d[u?"resolve":"reject"](),w.done(function(n){if(f.remove(),e===b.hash){var t=i[0];try{i.children("source").attr("src",n);t.pause();t.load();v(t);c.on("viewchange.audio",o);o()}catch(t){URL.revokeObjectURL(n);i.remove()}}else URL.revokeObjectURL(n)}).fail(function(){i.remove()})))}).one("change",l)},function(t){function k(){i.UA.iOS?w.hasClass("elfinder-quicklook-fullscreen")?(e.css("height","-webkit-calc(100% - 50px)"),rt._show()):e.css("height",""):rt.css("bottom",w.hasClass("elfinder-quicklook-fullscreen")?"50px":"")}function c(u,f){function o(){1<c&&(l&&clearTimeout(l),l=setTimeout(function(){h||a(!0)},800))}var h,c=0;s=null;f=f||{};t.hideinfo();(r=n('<video class="elfinder-quicklook-preview-video" controls'+ut+' preload="auto" autobuffer playsinline><\/video>').on("change",function(n){n.stopPropagation()}).on("timeupdate progress",o).on("canplay",function(){h=!0}).data("hash",u.hash))[0].addEventListener("error",function(n){f.src&&i.convAbsUrl(f.src)===i.convAbsUrl(n.target.src)&&(++c,o())},!0);f.src&&r.append('<source src="'+f.src+'" type="'+u.mime+'"><\/source><source src="'+f.src+'"><\/source>');r.appendTo(e);w.on("viewchange.video",k);k()}function d(n){var f,t=i.openUrl(n.hash,!1,function(t){u.remove();t&&(c(n),(f=new o).loadSource(t),f.attachMedia(r[0]),p&&f.on(o.Events.MANIFEST_PARSED,function(){b(r[0])}))},{progressBar:h});e.one("change",function(){t&&t.state&&"pending"===t.state()&&t.reject()})}function g(n){var t=i.openUrl(n.hash,!1,function(t){var i;u.remove();t&&(c(n),(i=(s=window.dashjs.MediaPlayer().create()).getDebug()).setLogLevel?i.setLogLevel(dashjs.Debug.LOG_LEVEL_FATAL):i.setLogToBrowserConsole&&i.setLogToBrowserConsole(!1),s.initialize(r[0],t,p),s.on("error",function(){a(!0)}))},{progressBar:h});e.one("change",function(){t&&t.state&&"pending"===t.state()&&t.reject()})}function nt(n){var t;f.isSupported()?(t=i.openUrl(n.hash,!1,function(t){var i;u.remove();t&&(i=f.createPlayer({type:"flv",url:t}),c(n),i.on(f.Events.ERROR,function(){i.destroy();a(!0)}),i.attachMediaElement(r[0]),i.load(),b(i))},{progressBar:h}),e.one("change",function(){t&&t.state&&"pending"===t.state()&&t.reject()})):f=!1}function tt(n){var t=i.openUrl(n.hash,!1,function(t){u.remove();t&&(c(n),r[0].src=t,y(r[0],{src:t}))},{progressBar:h});e.one("change",function(){t&&t.state&&"pending"===t.state()&&t.reject()})}var r,o,v,s,f,y,p,l,u,h,i=t.fm,e=t.preview,it={"video/mp4":"mp4","video/x-m4v":"mp4","video/quicktime":"mp4","video/mpeg":"mpeg","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm","video/x-matroska":"mkv","video/3gpp":"3gp","application/vnd.apple.mpegurl":"m3u8","application/x-mpegurl":"m3u8","application/dash+xml":"mpd","video/x-flv":"flv","video/x-msvideo":"avi"},w=t.window,rt=t.navbar,ut="string"==typeof t.options.mediaControlsList&&t.options.mediaControlsList?' controlsList="'+i.escape(t.options.mediaControlsList)+'"':"",b=function(n){var t,i=r.data("hash");p&&(t=n.play());t&&t.catch&&t.catch(function(){n.paused||r&&r.data("hash")===i&&a(!0)})},a=function(n){if(l&&clearTimeout(l),r&&r.parent().length){var i=r[0];w.off("viewchange.video");s&&s.reset();try{i.pause();r.empty();i.src="";i.load()}catch(n){}r.remove();r=null}n&&t.info.show()};e.on(t.evUpdate,function(s){var k,a,l=s.file,rt=l.mime.toLowerCase(),w=it[rt];it[rt]&&t.dispInlineRegex.test(l.mime)&&(p=t.autoPlay(),u=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>'),h=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(u),t.support.video[w]&&("m3u8"!==w||i.UA.Safari)?(s.stopImmediatePropagation(),u.appendTo(t.info.find(".elfinder-quicklook-info")),a=i.openUrl(l.hash,!1,function(n){u.remove();n&&(c(l,{src:n}),b(r[0]))},{progressBar:h}),e.one("change",function(){a&&a.state&&"pending"===a.state()&&a.reject()})):!1!==o&&i.options.cdns.hls&&"m3u8"===w?(s.stopImmediatePropagation(),u.appendTo(t.info.find(".elfinder-quicklook-info")),o?d(l):(k=window.Hls,delete window.Hls,i.loadScript([i.options.cdns.hls],function(n){o=n||window.Hls||!1;window.Hls=k;o&&d(l)},{tryRequire:!0,error:function(){o=!1}}))):!1!==v&&i.options.cdns.dash&&"mpd"===w?(s.stopImmediatePropagation(),u.appendTo(t.info.find(".elfinder-quicklook-info")),v?g(l):i.loadScript([i.options.cdns.dash],function(){(v=!!window.dashjs)&&g(l)},{tryRequire:!0,error:function(){v=!1}})):!1!==f&&i.options.cdns.flv&&"flv"===w?(s.stopImmediatePropagation(),u.appendTo(t.info.find(".elfinder-quicklook-info")),f?nt(l):(k=window.flvjs,delete window.flvjs,i.loadScript([i.options.cdns.flv],function(n){f=n||window.flvjs||!1;window.flvjs=k;f&&nt(l)},{tryRequire:!0,error:function(){f=!1}}))):i.options.cdns.videojs&&(s.stopImmediatePropagation(),u.appendTo(t.info.find(".elfinder-quicklook-info")),y?tt(l):i.loadScript([i.options.cdns.videojs+"/video.min.js"],function(n){(y=n||window.videojs||!1)&&tt(l)},{tryRequire:!0,error:function(){y=!1}}).loadCss([i.options.cdns.videojs+"/video-js.min.css"])))}).one("change",a)},function(t){var i,u=t.preview,r=[],f=t.window,e=t.navbar;n.each(navigator.plugins,function(t,i){n.each(i,function(n,t){0!==t.type.indexOf("audio/")&&0!==t.type.indexOf("video/")||r.push(t.type)})});r=t.fm.arrayFlip(r);u.on(t.evUpdate,function(o){function l(){e.css("bottom",f.hasClass("elfinder-quicklook-fullscreen")?"50px":"")}var a,s,c,v,h=o.file,y=h.mime;r[h.mime]&&t.dispInlineRegex.test(h.mime)&&(o.stopImmediatePropagation(),c=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),v=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(c),s=t.fm.openUrl(h.hash,!1,function(r){c.remove();r&&((a=0===y.indexOf("video/"))&&t.hideinfo(),i=n('<embed src="'+r+'" type="'+y+'" class="elfinder-quicklook-preview-'+(a?"video":"audio")+'"/>').appendTo(u),f.on("viewchange.embed",l),l())},{progressBar:v}),u.one("change",function(){s&&s.state&&"pending"===s.state()&&s.reject()}))}).one("change",function(){i&&i.parent().length&&(f.off("viewchange.embed"),i.remove(),i=null)})},function(t){var i=t.fm,o=i.arrayFlip(["application/zip","application/x-gzip","application/x-tar","application/x-bzip2"]),r=t.preview,u=i.returnBytes(t.options.unzipMaxSize||0),f=!(!i.options.cdns.zlibUnzip||!i.options.cdns.zlibGunzip),e=!!i.options.cdns.bzip2;window.Worker&&window.Uint8Array&&window.DataView&&r.on(t.evUpdate,function(s){var a,c,l,v,y,h=s.file,b="application/x-tar"===h.mime,p="application/x-bzip2"===h.mime,w="application/zip"===h.mime||"application/x-gzip"===h.mime;o[h.mime]&&(!u||h.size<=u)&&(b||p&&e||w&&f)&&(y=function(u){var f,e,o=0;u&&u.length&&((u=n.map(u,function(n){return i.decodeRawString(n)})).sort(),e=i.escape(u.join("\n").replace(/\{formatSize\((\d+)\)\}/g,function(n,t){return o+=parseInt(t),i.formatSize(t)})),f="<strong>"+i.escape(h.mime)+"<\/strong> ("+i.formatSize(h.size)+" / "+i.formatSize(o)+")<hr/>",n('<div class="elfinder-quicklook-preview-archive-wrapper">'+f+'<pre class="elfinder-quicklook-preview-text">'+e+"<\/pre><\/div>").on("touchstart",function(t){5<n(this)["scroll"+("ltr"===i.direction?"Right":"Left")]()&&(t.originalEvent._preventSwipeX=!0)}).appendTo(r),t.hideinfo());l.remove()},s.stopImmediatePropagation(),l=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),v=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(l),r.one("change",function(){"pending"===a.state()&&a.reject();c&&c.terminate();l.remove()}),a=i.getContents(h.hash,"arraybuffer",{progressBar:v}).fail(function(){l.remove()}).done(function(n){function t(n){c&&c.terminate();l.remove();w?f=!1:p&&(e=!1);i.debug("error",n)}try{(c=i.getWorker()).onmessage=function(n){c&&c.terminate();l.remove();!n.data||n.data.error?new Error(n.data&&n.data.error?n.data.error:""):y(n.data.files)};c.onerror=t;"application/x-tar"===h.mime?c.postMessage({scripts:[i.getWorkerUrl("quicklook.unzip.js")],data:{type:"tar",bin:n}}):"application/zip"===h.mime?c.postMessage({scripts:[i.options.cdns.zlibUnzip,i.getWorkerUrl("quicklook.unzip.js")],data:{type:"zip",bin:n}}):"application/x-gzip"===h.mime?c.postMessage({scripts:[i.options.cdns.zlibGunzip,i.getWorkerUrl("quicklook.unzip.js")],data:{type:"gzip",bin:n}}):"application/x-bzip2"===h.mime&&c.postMessage({scripts:[i.options.cdns.bzip2,i.getWorkerUrl("quicklook.unzip.js")],data:{type:"bzip2",bin:n}})}catch(n){t(n)}}))})},function(t){var r,i=t.fm,f=i.arrayFlip(["application/x-rar"]),u=t.preview;window.DataView&&u.on(t.evUpdate,function(e){var o,p,h,v,c,l,y,s,a=e.file;f[a.mime]&&i.options.cdns.rar&&!1!==r&&(c=function(f){if(v)o.remove();else try{h=r({file:f,type:2,xhrHeaders:i.customHeaders,xhrFields:i.xhrFields},function(r){o.remove();var e,f=[];v||r?r&&i.debug("error",r):(n.each(h.entries,function(){f.push(this.path+(this.size?" ("+i.formatSize(this.size)+")":""))}),f.length&&((f=n.map(f,function(n){return i.decodeRawString(n)})).sort(),e="<strong>"+i.escape(a.mime)+"<\/strong> ("+i.formatSize(a.size)+")<hr/>",n('<div class="elfinder-quicklook-preview-archive-wrapper">'+e+'<pre class="elfinder-quicklook-preview-text">'+i.escape(f.join("\n"))+"<\/pre><\/div>").on("touchstart",function(t){5<n(this)["scroll"+("ltr"===i.direction?"Right":"Left")]()&&(t.originalEvent._preventSwipeX=!0)}).appendTo(u),t.hideinfo()))})}catch(f){o.remove()}},l=function(){r=!1;o.remove()},e.stopImmediatePropagation(),o=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),p=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(o),u.one("change",function(){h&&(h.abort=!0);o.remove();v=!0}),s=i.openUrl(a.hash,"sameorigin",function(n){n&&(r?c(n):(window.RarArchive&&(y=window.RarArchive,delete window.RarArchive),i.loadScript([i.options.cdns.rar],function(){i.hasRequire?require(["rar"],function(t){r=t;c(n)},l):(r=window.RarArchive)?(y?window.RarArchive=y:delete window.RarArchive,c(n)):l()},{tryRequire:!0,error:l})))},{progressBar:p,temporary:!0}),u.one("change",function(){s&&s.state&&"pending"===s.state()&&s.reject()}))})},function(t){var u,i=t.fm,f=i.arrayFlip(t.options.sharecadMimes||[]),r=t.preview;t.window;t.options.sharecadMimes.length&&t.addIntegration({title:"ShareCAD.org CAD and 3D-Models viewer",link:"https://sharecad.org/DWGOnlinePlugin"});r.on(t.evUpdate,function(e){var s,h,c,o=e.file;f[o.mime.toLowerCase()]&&i.option("onetimeUrl",o.hash)&&(t.window,e.stopImmediatePropagation(),"1"==o.url&&(r.hide(),n('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+i.i18n("getLink")+"<\/button><\/div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click",function(){var u=n(this);u.html('<span class="elfinder-spinner">');i.request({data:{cmd:"url",target:o.hash},preventDefault:!0,progressBar:h}).always(function(){u.html("")}).done(function(n){var u=i.file(o.hash);o.url=u.url=n.url||"";o.url&&r.trigger({type:t.evUpdate,file:o,forceUpdate:!0})})})),""!==o.url&&"1"!=o.url&&(r.one("change",function(){s.remove();u.off("load").remove();u=null}).addClass("elfinder-overflow-auto"),s=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),h=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(s),c=i.convAbsUrl(i.url(o.hash)),u=n('<iframe class="elfinder-quicklook-preview-iframe" scrolling="no"><\/iframe>').css("background-color","transparent").appendTo(r).on("load",function(){t.hideinfo();s.remove();t.preview.after(t.info);n(this).css("background-color","#fff").show()}).on("error",function(){s.remove();t.preview.after(t.info)}).attr("src","//sharecad.org/cadframe/load?url="+encodeURIComponent(c)),t.info.after(t.preview)))})},function(t){var r,o,s,f,e,i=t.fm,h={"application/vnd.google-earth.kml+xml":!0,"application/vnd.google-earth.kmz":!0},u=t.preview;t.options.googleMapsApiKey&&(t.addIntegration({title:"Google Maps",link:"https://www.google.com/intl/"+i.lang.replace("_","-")+"/help/terms_maps.html"}),r=window.google&&google.maps,o=function(n,u,e){var o=t.options.googleMapsOpts.maps;i.forExternalUrl(n.hash,{progressBar:e}).done(function(n){if(n)try{new r.KmlLayer(n,Object.assign({map:new r.Map(u.get(0),o)},t.options.googleMapsOpts.kml));t.hideinfo()}catch(n){f()}else f()})},s=window.gm_authFailure,f=function(){e=null},e="https://maps.googleapis.com/maps/api/js?key="+t.options.googleMapsApiKey,window.gm_authFailure=function(){f();s&&s()},u.on(t.evUpdate,function(f){var a,v,l,c,s=f.file;e&&h[s.mime.toLowerCase()]&&(t.window,a="1"==s.url&&!i.option("onetimeUrl",s.hash),f.stopImmediatePropagation(),v=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),l=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(v),a&&(u.hide(),n('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+i.i18n("getLink")+"<\/button><\/div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click",function(){var r=n(this);r.html('<span class="elfinder-spinner">');i.request({data:{cmd:"url",target:s.hash},preventDefault:!0,progressBar:l}).always(function(){v.remove();r.html("")}).done(function(n){var r=i.file(s.hash);s.url=r.url=n.url||"";s.url&&u.trigger({type:t.evUpdate,file:s,forceUpdate:!0})})})),""===s.url||a||(c=n('<div style="width:100%;height:100%;"><\/div>').appendTo(u),u.one("change",function(){c.remove();c=null}),r?o(s,c,l):i.loadScript([e],function(){(r=window.google&&google.maps)&&o(s,c,l)})))}))},function(t){var i,f,r=t.fm,o=Object.assign(r.arrayFlip(t.options.googleDocsMimes||[],"g"),r.arrayFlip(t.options.officeOnlineMimes||[],"m")),u=t.preview,s=(t.window,t.navbar),h={g:"docs.google.com/gview?embedded=true&url=",m:"view.officeapps.live.com/op/embed.aspx?wdStartOn=0&src="},c={g:"56px",m:"24px"},e={xls:5242880,xlsb:5242880,xlsx:5242880,xlsm:5242880,other:10485760};t.options.googleDocsMimes.length&&(f=!0,t.addIntegration({title:"Google Docs Viewer",link:"https://docs.google.com/"}));t.options.officeOnlineMimes.length&&(f=!0,t.addIntegration({title:"MS Online Doc Viewer",link:"https://products.office.com/office-online/view-office-documents-online"}));f&&u.on(t.evUpdate,function(f){var v,y,w,b,k,d,a,g,p,l=f.file;l.size<=26214400&&(v=o[l.mime])&&(w=t.window,b=function(){s.css("bottom",w.hasClass("elfinder-quicklook-fullscreen")?c[v]:"")},k=r.mimeTypes[l.mime],d="1"==l.url&&!r.option("onetimeUrl",l.hash),"m"===v&&(e[k]&&l.size>e[k]||l.size>e.other)&&(v="g"),d&&(u.hide(),n('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+r.i18n("getLink")+"<\/button><\/div>").appendTo(t.info.find(".elfinder-quicklook-info")).on("click",function(){var i=n(this);i.html('<span class="elfinder-spinner">');r.request({data:{cmd:"url",target:l.hash},preventDefault:!0}).always(function(){i.html("")}).done(function(n){var i=r.file(l.hash);l.url=i.url=n.url||"";l.url&&u.trigger({type:t.evUpdate,file:l,forceUpdate:!0})})})),""===l.url||d||(f.stopImmediatePropagation(),u.one("change",function(){y&&y.status&&"pending"===y.status()&&y.reject();w.off("viewchange.googledocs");a.remove();i.off("load").remove();i=null}).addClass("elfinder-overflow-auto"),a=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+r.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),g=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(a),i=n('<iframe class="elfinder-quicklook-preview-iframe"><\/iframe>').css("background-color","transparent").appendTo(u),y=r.forExternalUrl(l.hash,{progressBar:g}).done(function(r){var u=function(){try{i&&(!i.attr("src")||i.get(0).contentWindow.document)&&(i.attr("src","https://"+h[v]+encodeURIComponent(r)),p=setTimeout(u,2e3))}catch(r){}};r?(l.ts&&(r+=(r.match(/\?/)?"&":"?")+"_t="+l.ts),i.on("load",function(){p&&clearTimeout(p);t.hideinfo();a.remove();t.preview.after(t.info);n(this).css("background-color","#fff").show()}).on("error",function(){p&&clearTimeout(p);a.remove();t.preview.after(t.info)}),u()):(a.remove(),i.remove())}),w.on("viewchange.googledocs",b),b(),t.info.after(t.preview)))})},function(t){"use strict";function o(){e=function(){return!1};u&&(window.PR=u);r=!1}var r,u,i=t.fm,f=t.preview,h=parseInt(t.options.textInitialLines)||150,l=parseInt(t.options.prettifyMaxLines)||500,e=function(n){i.options.cdns.prettify?(e=function(n){return setTimeout(function(){s(n)},100),"pending"},window.PR&&(u=window.PR),i.loadScript([i.options.cdns.prettify+(i.options.cdns.prettify.match(/\?/)?"&":"?")+"autorun=false"],function(t){"object"==typeof(r=t||window.PR)?(e=function(){return!0},u?window.PR=u:delete window.PR,c(n)):o()},{tryRequire:!0,error:o})):o()},c=function(n){n&&!n.hasClass("prettyprinted")&&(n.css("cursor","wait"),requestAnimationFrame(function(){r.prettyPrint&&r.prettyPrint(null,n.get(0));n.css("cursor","")}))},s=function(n){!0===e(n)&&c(n)};f.on(t.evUpdate,function(u){var c,a,v,o,e=u.file;e.mime;i.mimeIsText(e.mime)&&(!t.options.getSizeMax||e.size<=t.options.getSizeMax)&&!1!==r&&(u.stopImmediatePropagation(),a=n('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'<\/span><span class="elfinder-spinner"><\/span><\/div>').appendTo(t.info.find(".elfinder-quicklook-info")),v=n('<div class="elfinder-quicklook-info-progress"><\/div>').appendTo(a),f.one("change",function(){"pending"==c.state()&&c.reject();o&&o.remove()}),c=i.request({data:{cmd:"get",target:e.hash,conv:e.encoding||1,_t:e.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:v}).done(function(r){var v,c,u,a,y,p=new RegExp("^(data:"+e.mime.replace(/([.+])/g,"\\$1")+";base64,)","i"),o=r.content;"string"==typeof o&&(t.hideinfo(),window.atob&&(y=o.match(p))&&(o=atob(o.substr(y[1].length))),10<(c=(a=o.match(/([^\r\n]{1,100}[\r\n]*)/g)).length-h)?v=a.splice(0,h).join(""):c=0,u=n('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text prettyprint"><\/pre><\/div>'),c&&u.append(n('<div class="elfinder-quicklook-preview-charsleft"><hr/><span>'+i.i18n("linesLeft",i.toLocaleString(c))+"<\/span><\/div>").on("click",function(){var t=u.scrollTop();n(this).remove();u.children("pre").removeClass("prettyprinted").text(o).scrollTop(t);a.length<=l&&s(u)})),u.children("pre").text(v||o),u.on("touchstart",function(t){5<n(this)["scroll"+("ltr"===i.direction?"Right":"Left")]()&&(t.originalEvent._preventSwipeX=!0)}).appendTo(f),r.toasts&&Array.isArray(r.toasts)&&n.each(r.toasts,function(){this.msg&&i.toast(this)}),s(u))}).always(function(r){var h,s,u;(h=i.getCommand("edit"))&&(u=[],r&&r.encoding&&u.push({value:r.encoding}),u.push({value:"UTF-8"}),(s=h.getEncSelect(u)).on("change",function(){e.encoding=s.val();i.cache(e,"change");f.trigger({type:t.evUpdate,file:e,forceUpdate:!0})}),o=n('<div class="elfinder-quicklook-encoding"><\/div>').append(s),t.window.append(o));a.remove()}))})}],(r.prototype.commands.reload=function(){"use strict";var t=this,i=!1;this.alwaysEnabled=!0;this.updateOnSelect=!0;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0};this.init=function(){this.fm.bind("search searchend",function(){i="search"==this.type})};this.fm.bind("contextmenu",function(){var i=t.fm;1e3<=i.options.sync&&(t.extra={icon:"accept",node:n("<span><\/span>").attr({title:i.i18n("autoSync")}).on("click touchstart",function(t){"touchstart"===t.type&&1<t.originalEvent.touches.length||(t.stopPropagation(),t.preventDefault(),n(this).parent().toggleClass("ui-state-disabled",i.options.syncStart).parent().removeClass("ui-state-hover"),i.options.syncStart=!i.options.syncStart,i.autoSync(i.options.syncStart?null:"stop"))}).on("ready",function(){n(this).parent().toggleClass("ui-state-disabled",!i.options.syncStart).css("pointer-events","auto")})})});this.exec=function(){var t=this.fm,r,u;if(!i)return r=t.sync(),u=setTimeout(function(){t.notify({type:"reload",cnt:1,hideCnt:!0});r.always(function(){t.notify({type:"reload",cnt:-1})})},t.notifyDelay),r.always(function(){clearTimeout(u);t.trigger("reload")});n("div.elfinder-toolbar > div."+t.res("class","searchbtn")+" > span.ui-icon-search").click()}}).prototype={forceLoad:!0},r.prototype.commands.rename=function(){"use strict";function r(i,r,u,f){var s,e=r?[u.hash].concat(r):[u.hash],h=e.length,o={};if(t.lockfiles({files:e}),t.isRoot(u)&&!u.netkey){if((s=t.storage("rootNames"))||(s={}),""===f){if(!s[u.hash])return i&&i.reject(),void t.unlockfiles({files:e}).trigger("selectfiles",{files:e});u.name=u._name;u.i18=u._i18;delete s[u.hash];delete u._name;delete u._i18}else void 0===u._name&&(u._name=u.name,u._i18=u.i18),u.name=s[u.hash]=f,delete u.i18;return t.storage("rootNames",s),o={changed:[u]},t.updateCache(o),t.change(o),i&&i.resolve(o),void t.unlockfiles({files:e}).trigger("selectfiles",{files:e})}o={cmd:"rename",name:f,target:u.hash};1<h&&(o.targets=r,f.match(/\*/)&&(o.q=f));t.request({data:o,notify:{type:"rename",cnt:h},navigate:{}}).fail(function(n){var r=t.parseError(n);i&&i.reject();r&&Array.isArray(r)&&"errRename"===r[0]||t.sync()}).done(function(r){var e;r.added&&r.added.length&&1===h&&(r.undo={cmd:"rename",callback:function(){return t.request({data:{cmd:"rename",target:r.added[0].hash,name:u.name},notify:{type:"undo",cnt:1}})}},r.redo={cmd:"rename",callback:function(){return t.request({data:{cmd:"rename",target:u.hash,name:f},notify:{type:"rename",cnt:1}})}});i&&i.resolve(r);(e=t.cwd().hash)&&e!==u.hash||t.exec("open",n.map(r.added,function(n){return"directory"===n.mime?n.hash:null})[0])}).always(function(){t.unlockfiles({files:e}).trigger("selectfiles",{files:e})})}function u(n,i){var u,e,o=i||t.selected(),r=t.splitFileExtention(n),s=t.file(o[0]),h=t.file(o[1]),f=r[1]?"."+r[1]:"";return r[1]&&"*"===r[0]?(u='"'+t.splitFileExtention(s.name)[0]+f+'", ',u+='"'+t.splitFileExtention(h.name)[0]+f+'"'):1<r[0].length&&("*"===r[0].substr(-1)?(u='"'+(e=r[0].substr(0,r[0].length-1))+s.name+'", ',u+='"'+e+h.name+'"'):"*"===r[0].substr(0,1)&&(e=r[0].substr(1),u='"'+t.splitFileExtention(s.name)[0]+e+f+'", ',u+='"'+t.splitFileExtention(h.name)[0]+e+f+'"')),u=u||'"'+r[0]+"1"+f+'", "'+r[0]+"2"+f+'"',2<o.length&&(u+=" ..."),u}function f(){function e(i,r){return n('<label class="elfinder-rename-batch-checks">'+t.i18n(r)+"<\/label>").prepend(i)}function y(){var n=c.val(),i=t.splitFileExtention(t.file(h[0]).name)[1];return""===n&&!f.is(":checked")||(p.is(":checked")?n+="*":w.is(":checked")?n="*"+n+"."+i:b.is(":checked")?n="*."+n:i&&(n+="."+i)),n}var s,h=t.selected(),o='<input name="type" type="radio" class="elfinder-tabstop">',c=n('<input type="text" class="ui-corner-all elfinder-tabstop">'),f=n(o),p=n(o),w=n(o),b=n(o),l=n("<div><\/div>").append(e(f,"plusNumber"),e(p,"asPrefix"),e(w,"asSuffix"),e(b,"changeExtention")),a=n('<div class="elfinder-rename-batch-preview"><\/div>'),d=n('<div class="elfinder-rename-batch"><\/div>').append(n('<div class="elfinder-rename-batch-name"><\/div>').append(c),n('<div class="elfinder-rename-batch-type"><\/div>').append(l),a),v={title:t.i18n("batchRename"),modal:!0,destroyOnClose:!0,width:Math.min(380,t.getUI().width()-20),buttons:{},open:function(){c.on("input",k).trigger("focus")}},k=function(){var n=y();""!==n?a.html(t.i18n(["renameMultiple",h.length,u(n)])):a.empty()},g=l.find("input:radio").on("change",k);v.buttons[t.i18n("btnApply")]=function(){var i,n,u=y();""!==u&&(s.elfinderdialog("close"),n=h,i=t.file(n.shift()),r(void 0,n,i,u))};v.buttons[t.i18n("btnCancel")]=function(){s.elfinderdialog("close")};n.fn.checkboxradio?g.checkboxradio({create:function(){this===f.get(0)&&f.prop("checked",!0).change()}}):l.buttonset({create:function(){f.prop("checked",!0).change()}});s=i.fmDialog(d,v)}this.alwaysEnabled=!0;this.syncTitleOnChange=!0;var i=this,t=i.fm;this.noChangeDirOnRemovedCwd=!0;this.shortcuts=[{pattern:"f2"+("mac"==t.OS?" enter":"")},{pattern:"shift+f2",description:"batchRename",callback:function(){1<t.selected().length&&f()}}];this.getstate=function(r){var c,l,a,s,o,h,u=this.files(r),e=u.length;return e?(1<e&&u[0].phash&&(c=u[0].phash,l=t.splitFileExtention(u[0].name)[1].toLowerCase(),a=u[0].mime),1===e&&(h=t.isRoot(u[0])),o=1===e&&(t.cookieEnabled&&h||!u[0].locked)||2.103<t.api&&e===n.grep(u,function(n){return!(s||n.locked||n.phash!==c||t.isRoot(n)||a!==n.mime&&l!==t.splitFileExtention(n.name)[1].toLowerCase())||(s=s&&!0,!1)}).length?0:-1,!h&&0===o&&t.option("disabledFlip",u[0].hash).rename&&(o=-1),-1!==o&&1<e?i.extra={icon:"preference",node:n("<span><\/span>").attr({title:t.i18n("batchRename")}).on("click touchstart",function(n){"touchstart"===n.type&&1<n.originalEvent.touches.length||(n.stopPropagation(),n.preventDefault(),t.getUI().trigger("click"),f())})}:delete i.extra,o):-1};this.exec=function(i,f){function tt(){requestAnimationFrame(function(){o&&o.trigger("blur")})}function it(){v.is(":hidden")||v.elfinderoverlay("hide").off("click close",nt);c.removeClass("ui-front").css("position","").off("unselect."+t.namespace,tt);b?h&&h.css("max-height",""):s||c.css("width","").parent("td").css("overflow","")}function rt(){function y(){o.off();it();s?o.replaceWith(t.escape(i)):h.html(t.escape(i));r(l,p,e,i)}var i=n.trim(o.val()),f=(t.splitFileExtention(i),!0);if(v.is(":hidden")||c.css("z-index",""),""===i){if(!t.isRoot(e))return nt();s?o.replaceWith(t.escape(e.name)):h.html(t.escape(e.name))}if(!a&&c.length){if(o.off("blur"),1===w&&i===e.name)return l.reject();if(t.options.validName&&t.options.validName.test)try{f=t.options.validName.test(i)}catch(e){f=!1}if("."===i||".."===i||!f)return a=!0,t.error("directory"===e.mime?"errInvDirname":"errInvName",{modal:!0,close:function(){setTimeout(d,120)}}),!1;if(1===w&&t.fileByName(i,e.phash))return a=!0,t.error(["errExists",i],{modal:!0,close:function(){setTimeout(d,120)}}),!1;1===w?y():(t.confirm({title:"cmdrename",text:["renameMultiple",w,u(i,[e.hash].concat(p))],accept:{label:"btnYes",callback:y},cancel:{label:"btnCancel",callback:function(){setTimeout(function(){a=!0;d()},120)}}}),setTimeout(function(){t.trigger("unselectfiles",{files:t.selected()}).trigger("selectfiles",{files:[e.hash].concat(p)})},120))}}t.getUI("cwd");var y,p=i||!!t.selected().length&&t.selected()||[t.cwd().hash],w=p.length,e=t.file(p.shift()),ut=".elfinder-cwd-filename",g=f||{},et=t.cwd().hash==e.hash,s="files"!==("navbar"===g._currentType||"files"===g._currentType?g._currentType:et?"navbar":"files"),k=t[s?"navHash2Elm":"cwdHash2Elm"](e.hash),b=!s&&"list"!=t.storage("view"),l=n.Deferred().fail(function(n){var r=o.parent(),i=t.escape(e.i18||e.name);o.off();b&&(i=i.replace(/([_.])/g,"&#8203;$1"));requestAnimationFrame(function(){s?o.replaceWith(i):r.length?(o.remove(),r.html(i)):k.find(ut).html(i)});n&&t.error(n)}).always(function(){it();t.unbind("resize",ft);t.enable()}),o=n(b?"<textarea><\/textarea>":'<input type="text"/>').on("keyup text",function(){b?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):y&&(this.style.width=y+"px",this.scrollWidth>y&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(t){t.stopImmediatePropagation();t.keyCode==n.ui.keyCode.ESCAPE?l.reject():t.keyCode==n.ui.keyCode.ENTER&&(t.preventDefault(),o.trigger("blur"))}).on("mousedown click dblclick",function(n){n.stopPropagation();"dblclick"===n.type&&n.preventDefault()}).on("blur",rt).on("dragenter dragleave dragover drop",function(n){n.stopPropagation()}),d=function(){var n=t.splitFileExtention(o.val())[0];a||!t.UA.Mobile||t.UA.iOS||(v.on("click close",nt).elfinderoverlay("show"),c.css("z-index",v.css("z-index")+1));t.enabled()||t.enable();a&&(a=!1,o.on("blur",rt));o.trigger("focus").trigger("select");o[0].setSelectionRange&&o[0].setSelectionRange(0,n.length)},h=s?k.contents().filter(function(){return 3==this.nodeType&&n(this).parent().attr("id")===t.navHash2Id(e.hash)}):k.find(ut),c=h.parent(),v=t.getUI("overlay"),nt=function(n){v.is(":hidden")||c.css("z-index","");a||(l.reject(),n&&(n.stopPropagation(),n.preventDefault()))},ft=function(){k.trigger("scrolltoview",{blink:!1})},a=!1;return c.addClass("ui-front").css("position","relative").on("unselect."+t.namespace,tt),t.bind("resize",ft),s?h.replaceWith(o.val(e.name)):(b?h.css("max-height","none"):s||(y=c.width(),c.width(y-15).parent("td").css("overflow","visible")),h.empty().append(o.val(e.name))),1<w&&t.api<=2.103?l.reject():e&&h.length?e.locked&&!t.isRoot(e)?l.reject(["errLocked",e.name]):(t.one("select",function(){o.parent().length&&e&&-1===n.inArray(e.hash,t.selected())&&o.trigger("blur")}),o.trigger("keyup"),d(),l):l.reject("errCmdParams",this.title)};t.bind("select contextmenucreate closecontextmenu",function(n){var u,r=(n.data?n.data.selected||n.data.targets:null)||t.selected();i.title=r&&1===r.length&&(u=t.file(r[0]))&&t.isRoot(u)?t.i18n("kindAlias")+" ("+t.i18n("preference")+")":t.i18n("cmdrename");"closecontextmenu"!==n.type?i.update(void 0,i.title):requestAnimationFrame(function(){i.update(void 0,i.title)})}).remove(function(i){var r;i.data&&i.data.removed&&(r=t.storage("rootNames"))&&(n.each(i.data.removed,function(n,t){r[t]&&delete r[t]}),t.storage("rootNames",r))})},r.prototype.commands.resize=function(){"use strict";var t=this.fm,i=0;this.updateOnSelect=!1;this.getstate=function(){var n=t.selectedFiles();return 1==n.length&&n[0].read&&n[0].write&&-1!==n[0].mime.indexOf("image/")?0:-1};this.resizeRequest=function(i,r,u){var f=r||t.file(i.target),e;return(f&&f.tmb,t.isCommandEnabled("resize",i.target)&&(!f||f&&f.read&&f.write&&-1!==f.mime.indexOf("image/")))?t.request({data:Object.assign(i,{cmd:"resize"}),notify:{type:"resize",cnt:1}}).fail(function(n){u&&u.reject(n)}).done(function(){i.quality&&t.storage("jpgQuality",i.quality===t.option("jpgQuality")?null:i.quality);u&&u.resolve()}):(e=f?-1===f.mime.indexOf("image/")?["errResize",f.name,"errUsupportType"]:["errResize",f.name,"errPerm"]:["errResize",i.target,"errPerm"],u?u.reject(e):t.error(e),n.Deferred().reject(e))};this.exec=function(r){function b(r,o,l){function ir(){yr=!0}function rr(){yr&&(yr=!1,ti.trigger("change"))}function of(n){var t,i,r,u;try{t=wr[Math.round(n.offsetX)][Math.round(n.offsetY)]}catch(n){}t&&(i=t[0],r=t[1],u=t[2],t[3],t[4],t[5],er(i,r,u,"click"===n.type))}function sf(t){er(n(this).css("backgroundColor"),"","","click"===t.type)}function ou(){function i(){si.parent().hide();ei.hide()}var u=Math.min(ci,ri)/Math.sqrt(Math.pow(y,2)+Math.pow(b,2));kr=Math.ceil(y*u);uu=Math.ceil(b*u);it.width(kr).height(uu).css("margin-top",(ri-uu)/2+"px").css("margin-left",(ci-kr)/2+"px");it.is(":visible")&&si.is(":visible")&&("image/png"!==r.mime?(g.css("backgroundColor",si.val()),vr=n("<img>"),t.isCORS&&vr.attr("crossorigin","use-credentials"),vr.on("load",function(){ki&&ki.width!==kr&&lf()}).on("error",i).attr("src",ff)):i())}function su(){kt.updateView(y,b);ou();hr.width(nt.width()).height(nt.height());cr.width(nt.width()).height(nt.height());vt.updateView();wi()}function hu(n){var i=t.file(r.hash);i.width=n[0];i.height=n[1]}function ar(){var u,f,e;gu||(gu=!0,sr&&sr.state&&"pending"===sr.state()&&sr.reject(),2.103<=t.api?0===i&&t.request({data:{cmd:"resize",target:r.hash,degree:0,mode:"rotate"},preventDefault:!0}).done(function(n){1==(i=n.losslessRotate?1:-1)&&bt.val()%90==0&&pi.children("div.elfinder-resize-quality").hide()}).fail(function(){i=-1}):i=-1,u=nt.get(0),(f=r.width&&r.height?{w:r.width,h:r.height}:u.naturalWidth?null:{w:nt.width(),h:nt.height()})&&nt.removeAttr("width").removeAttr("height"),y=r.width||u.naturalWidth||u.width||nt.width(),b=r.height||u.naturalHeight||u.height||nt.height(),r.width&&r.height||hu([y,b]),f&&nt.width(f.w).height(f.h),lu.show(),(e=b/y)<1&&g.height()>g.width()*e&&g.height(g.width()*e),g.height()>nt.height()+20&&g.height(nt.height()+20),ri=g.height()-(ft.outerHeight()-ft.height()),iu.remove(),br=y/b,ft.append(nt.show()).show(),st.val(y),ht.val(b),function(){try{ki=document.createElement("canvas");ur=ki.getContext("2d")}catch(n){ru.hide();ei.hide()}}(),lr.on("click","span.elfinder-resize-preset",function(){var r=n(this),t=r.data("s")[0],i=r.data("s")[1],u=y/b;r.data("s",[i,t]).text(i+"x"+t);t<y||i<b?!(y<=t)&&(b<=i||b-i<y-t)?i=tt(t/u):t=tt(i*u):(t=y,i=b);st.val(t);ht.val(i);kt.updateView(t,i);wi()}),bi.on("click","span.elfinder-resize-preset",function(){var r=n(this),t=r.data("s")[0],i=r.data("s")[1],u=lt.val(),f=at.val();r.data("s",[i,t]).text(i+"x"+t);t<=y&&i<=b&&(y-t-u<0&&(u=y-t),b-i-f<0&&(f=b-i),lt.val(u),at.val(f),pt.val(t),wt.val(i),vt.updateView(),wi())}),bi.children("span.elfinder-resize-preset").each(function(){var t=n(this),i=t.data("s")[0],r=t.data("s")[1];t[i<=y&&r<=b?"show":"hide"]()}),su(),fr[c]("enable"),ti.find("input,select").prop("disabled",!1).filter(":text").on("keydown",function(i){var r;if(i.keyCode==n.ui.keyCode.ENTER)return i.stopPropagation(),i.preventDefault(),r={title:n("input:checked",fr).val(),text:"confirmReq",accept:{label:"btnApply",callback:function(){eu()}},cancel:{label:"btnCancel",callback:function(){n(this).trigger("focus")}}},ef&&(r.buttons=[{label:"btnSaveAs",callback:function(){requestAnimationFrame(uf)}}]),void t.confirm(r)}).on("keyup",function(){var t=n(this);t.hasClass("elfinder-resize-bg")||requestAnimationFrame(function(){t.val(t.val().replace(/[^0-9]/g,""))})}).filter(":first"),du(),t.UA.Mobile||st.trigger("focus"),fu())}function cu(){var n,i,u,f,r,e,o="";if("resize"==ui)n=parseInt(st.val())||0,i=parseInt(ht.val())||0;else if("crop"==ui)n=parseInt(pt.val())||0,i=parseInt(wt.val())||0,u=parseInt(lt.val())||0,f=parseInt(at.val())||0;else if("rotate"==ui){if(n=y,i=b,(r=parseInt(bt.val())||0)<0||360<r)return t.error("Invalid rotate degree"),!1;if(0==r||360==r)return t.error("errResizeNoChange"),!1;o=si.val()}if(e=fi?parseInt(fi.val()):0,"rotate"!=ui){if(n<=0||i<=0)return t.error("Invalid image size"),!1;if(n==y&&i==b&&parseInt(p/1e3)===parseInt(a/1e3))return t.error("errResizeNoChange"),!1}return{w:n,h:i,x:u,y:f,d:r,q:e,b:o}}var vr,ki,ur,lu,dt,au,nu,di="image/jpeg"===r.mime,ni=n('<div class="elfinder-resize-container"><\/div>'),vi='<input type="number" class="ui-corner-all"/>',ot='<div class="elfinder-resize-row"><\/div>',yt='<div class="elfinder-resize-label"><\/div>',tu=null,yr=!1,ti=n('<div class="elfinder-resize-control"><\/div>').on("focus","input[type=text],input[type=number]",function(){n(this).trigger("select")}).on("change",function(){tu&&cancelAnimationFrame(tu);tu=requestAnimationFrame(function(){var c,p,f,i,s,g,nt,r,u,tt,w,k,l,v,h,it,d,e,o;nr&&!yr&&(f=nr.data("canvas"))&&(c=ti.children("div.elfinder-resize-control-panel:visible"),(p=c.find("input.elfinder-resize-quality")).is(":visible")&&(i=nr.data("ctx"),s=nr.get(0),c.hasClass("elfinder-resize-uiresize")?(r=f.width=st.val(),u=f.height=ht.val(),i.drawImage(s,0,0,r,u)):c.hasClass("elfinder-resize-uicrop")?(g=lt.val(),nt=at.val(),r=pt.val(),u=wt.val(),f.width=r,f.height=u,i.drawImage(s,g,nt,r,u,0,0,r,u)):(tt=bt.val(),w=bt.val()*Math.PI/180,h=w,it=[{x:(l=y)/2,y:(v=b)/2},{x:-l/2,y:v/2},{x:-l/2,y:-v/2},{x:l/2,y:-v/2}],d=[],e={x:Number.MAX_VALUE,y:Number.MAX_VALUE},o={x:Number.MIN_VALUE,y:Number.MIN_VALUE},n.each(it,function(n,t){d.push({x:t.x*Math.cos(h)-t.y*Math.sin(h),y:t.x*Math.sin(h)+t.y*Math.cos(h)})}),n.each(d,function(n,t){e.x=Math.min(e.x,t.x);e.y=Math.min(e.y,t.y);o.x=Math.max(o.x,t.x);o.y=Math.max(o.y,t.y)}),k={width:o.x-e.x,height:o.y-e.y},r=f.width=k.width,u=f.height=k.height,i.save(),tt%90!=0&&(i.fillStyle=si.val()||"#FFF",i.fillRect(0,0,r,u)),i.translate(r/2,u/2),i.rotate(w),i.drawImage(s,-s.width/2,-s.height/2,y,b),i.restore()),f.toBlob(function(n){n&&(a=n.size,p.next("span").text(" ("+t.formatSize(n.size)+")"))},"image/jpeg",Math.max(Math.min(p.val(),100),1)/100)))})}).on("mouseup","input",function(t){n(t.target).trigger("change")}),g=n('<div class="elfinder-resize-preview"><\/div>').on("touchmove",function(t){n(t.target).hasClass("touch-punch")&&(t.stopPropagation(),t.preventDefault())}),iu=n('<div class="elfinder-resize-loading">'+t.i18n("ntfloadimg")+"<\/div>"),ft=n('<div class="elfinder-resize-handle touch-punch"><\/div>'),et=n('<div class="elfinder-resize-handle touch-punch"><\/div>'),oi=n('<div class="elfinder-resize-uiresize elfinder-resize-control-panel"><\/div>'),yi=n('<div class="elfinder-resize-uicrop elfinder-resize-control-panel"><\/div>'),pi=n('<div class="elfinder-resize-rotate elfinder-resize-control-panel"><\/div>'),vu=n("<button><\/button>").attr("title",t.i18n("rotate-cw")).append(n('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"><\/span>')),yu=n("<button><\/button>").attr("title",t.i18n("rotate-ccw")).append(n('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"><\/span>')),pu=n("<span ><\/span>"),wu=n('<button class="elfinder-resize-reset">').text(t.i18n("reset")).on("click",function(){nf()}).button({icons:{primary:"ui-icon-arrowrefresh-1-n"},text:!1}),fr=n('<div class="elfinder-resize-type"><\/div>').append('<input type="radio" name="type" id="'+o+'-resize" value="resize" checked="checked" /><label for="'+o+'-resize">'+t.i18n("resize")+"<\/label>",'<input class="api2" type="radio" name="type" id="'+o+'-crop" value="crop" /><label class="api2" for="'+o+'-crop">'+t.i18n("crop")+"<\/label>",'<input class="api2" type="radio" name="type" id="'+o+'-rotate" value="rotate" /><label class="api2" for="'+o+'-rotate">'+t.i18n("rotate")+"<\/label>"),ui="resize",st=(fr[c]()[c]("disable").find("input").on("change",function(){ui=n(this).val();nf();fu(!0);tf(!0);rf(!0);"resize"==ui?(oi.show(),pi.hide(),yi.hide(),fu(),di&&dr.insertAfter(oi.find(".elfinder-resize-grid8"))):"crop"==ui?(pi.hide(),oi.hide(),yi.show(),tf(),di&&dr.insertAfter(yi.find(".elfinder-resize-grid8"))):"rotate"==ui&&(oi.hide(),yi.hide(),pi.show(),rf())}),n(vi).on("change",function(){var n=tt(parseInt(st.val())),t=tt(ii?n/br:parseInt(ht.val()));0<n&&0<t&&(kt.updateView(n,t),st.val(n),ht.val(t))}).addClass("elfinder-focus")),ht=n(vi).on("change",function(){var n=tt(parseInt(ht.val())),t=tt(ii?n*br:parseInt(st.val()));0<t&&0<n&&(kt.updateView(t,n),st.val(t),ht.val(n))}),lt=n(vi).on("change",function(){vt.updateView()}),at=n(vi).on("change",function(){vt.updateView()}),pt=n(vi).on("change",function(){vt.updateView("w")}),wt=n(vi).on("change",function(){vt.updateView("h")}),fi=di&&f?n(vi).val(0<t.storage("jpgQuality")?t.storage("jpgQuality"):t.option("jpgQuality")).addClass("elfinder-resize-quality").attr("min","1").attr("max","100").attr("title","1 - 100").on("blur",function(){var n=Math.min(100,Math.max(1,parseInt(this.value)));ti.find("input.elfinder-resize-quality").val(n)}):null,bt=n('<input type="number" class="ui-corner-all" maxlength="3" value="0" />').on("change",function(){rt.update()}),pr=n('<div class="elfinder-resize-rotate-slider touch-punch"><\/div>').slider({min:0,max:360,value:bt.val(),animate:!0,start:ir,stop:rr,change:function(n,t){t.value!=pr.slider("value")&&rt.update(t.value)},slide:function(n,t){rt.update(t.value,!1)}}).find(".ui-slider-handle").addClass("elfinder-tabstop").off("keydown").on("keydown",function(t){t.keyCode!=n.ui.keyCode.LEFT&&t.keyCode!=n.ui.keyCode.RIGHT||(t.stopPropagation(),t.preventDefault(),rt.update(Number(bt.val())+(t.keyCode==n.ui.keyCode.RIGHT?1:-1),!1))}).end(),wr={},er=function(t,i,r,u){var o,f,e;"string"==typeof t&&(i="",t&&(o=n("<span>").css("backgroundColor",t).css("backgroundColor"))&&(f=o.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))&&(t=Number(f[1]),i=Number(f[2]),r=Number(f[3])));e=""===i?t:"#"+hf(t,i,r);si.val(e).css({backgroundColor:e,backgroundImage:"none",color:t+i+r<384?"#fff":"#000"});g.css("backgroundColor",e);u&&(it.off(".picker").removeClass("elfinder-resize-picking"),ei.off(".picker").removeClass("elfinder-resize-picking"))},hf=function(t,i,r){return n.map([t,i,r],function(n){return("0"+parseInt(n).toString(16)).slice(-2)}).join("")},ru=n("<button>").text(t.i18n("colorPicker")).on("click",function(){it.on("mousemove.picker click.picker",of).addClass("elfinder-resize-picking");ei.on("mousemove.picker click.picker","span",sf).addClass("elfinder-resize-picking")}).button({icons:{primary:"ui-icon-pin-s"},text:!1}),cf=n("<button>").text(t.i18n("reset")).on("click",function(){er("","","",!0)}).button({icons:{primary:"ui-icon-arrowrefresh-1-n"},text:!1}),si=n('<input class="ui-corner-all elfinder-resize-bg" type="text">').on("focus",function(){n(this).attr("style","")}).on("blur",function(){er(n(this).val())}),ei=n('<div class="elfinder-resize-pallet">').on("click","span",function(){er(n(this).css("backgroundColor"))}),br=1,ct=1,y=0,b=0,ii=!0,hi=!1,ci=0,ri=0,kr=0,uu=0,or=0,gt=di&&k,bu=n("<button>").html(t.i18n("aspectRatio")).on("click",function(){ii=!ii;bu.button("option",{icons:{primary:ii?"ui-icon-locked":"ui-icon-unlocked"}});kt.fixHeight();ft.resizable("option","aspectRatio",ii).data("uiResizable")._aspectRatio=ii}).button({icons:{primary:ii?"ui-icon-locked":"ui-icon-unlocked"},text:!1}),ku=n("<button>").html(t.i18n("aspectRatio")).on("click",function(){hi=!hi;ku.button("option",{icons:{primary:hi?"ui-icon-locked":"ui-icon-unlocked"}});et.resizable("option","aspectRatio",hi).data("uiResizable")._aspectRatio=hi}).button({icons:{primary:hi?"ui-icon-locked":"ui-icon-unlocked"},text:!1}),dr=n("<button>").html(t.i18n(gt?"enabled":"disabled")).toggleClass("ui-state-active",gt).on("click",function(){gt=!gt;dr.html(t.i18n(gt?"enabled":"disabled")).toggleClass("ui-state-active",gt);du()}).button(),du=function(){var t=gt?8:1;n.each([st,ht,pt,wt,lt,at],function(){this.attr("step",t)});gt&&(st.val(tt(st.val())),ht.val(tt(ht.val())),pt.val(tt(pt.val())),wt.val(tt(wt.val())),lt.val(tt(lt.val())),at.val(tt(at.val())),oi.is(":visible")?kt.updateView(st.val(),ht.val()):yi.is(":visible")&&vt.updateView())},lf=function(){var u,i,f,e,o,s,t,h;if(ur){var a,r,c,v,p,w,rt,ut,b,ft,l,d,et,ot,st,ht,g,nt,k={},ct=[],tt=function(n){return 8*Math.round(n/8)};n:try{for(r=ki.width=it.width(),c=ki.height=it.height(),d=r/y,ur.scale(d,d),ur.drawImage(vr.get(0),0,0),l=ur.getImageData(0,0,r,c).data,et=.1*r,ot=.9*r,st=.1*c,ht=.9*c,u=0;u<c-1;u++)for(i=0;i<r-1;i++){if(v=l[a=4*i+u*r*4],p=l[1+a],w=l[2+a],255!==l[3+a]){si.parent().hide();ei.hide();break n}f=v;e=p;o=w;s=void 0;t=Math.max(Math.max(f,e),o);h=Math.min(Math.min(f,e),o);t===h?s=0:f===t?s=((e-o)/(t-h)*60+360)%360:e===t?s=(o-f)/(t-h)*60+120:o===t&&(s=(f-e)/(t-h)*60+240);b=[s,(t-h)/t,(.3*f+.59*e+.11*o)/255,"hsl"];ft=Math.round(b[0]);rt=Math.round(100*b[1]);ut=Math.round(100*b[2]);wr[i]||(wr[i]={});wr[i][u]=[v,p,w,ft,rt,ut];(i<et||ot<i)&&(u<st||ht<u)&&(k[g=tt(v)+","+tt(p)+","+tt(w)]?++k[g]:k[g]=1)}ei.children(":first").length||(nt=1,n.each(k,function(n,t){ct.push({c:n,v:t})}),n.each(ct.sort(function(n,t){return n.v>t.v?-1:1}),function(){if(this.v<2||10<nt)return!1;ei.append(n('<span style="width:20px;height:20px;display:inline-block;background-color:rgb('+this.c+');">'));++nt}))}catch(a){ru.hide();ei.hide()}}},sr=null,gu=!1,nt=n("<img/>").on("load",ar).on("error",function(){iu.html(t.i18n("ntfsmth")).css("background","transparent")}),hr=n("<div><\/div>"),cr=n("<img/>"),gi=n("<div><\/div>"),it=n('<img class="elfinder-resize-imgrotate" />'),tt=function(n,t){return n=gt?8*Math.round(n/8):Math.round(n),n=Math.max(0,n),t&&t<n&&(n=gt?8*Math.floor(t/8):t),n},nf=function(){st.val(y);ht.val(b);kt.updateView(y,b);lt.val(0);at.val(0);pt.val(y);wt.val(b);vt.updateView();wi()},kt={update:function(){st.val(tt(nt.width()/ct));ht.val(tt(nt.height()/ct));wi()},updateView:function(n,t){ci<n||ri<t?t/ri<n/ci?(ct=ci/n,nt.width(ci).height(tt(t*ct))):(ct=ri/t,nt.height(ri).width(tt(n*ct))):nt.width(tt(n)).height(tt(t));ct=nt.width()/n;pu.text("1 : "+(1/ct).toFixed(2));kt.updateHandle()},updateHandle:function(){ft.width(nt.width()).height(nt.height())},fixHeight:function(){var n,t;ii&&(n=st.val(),t=tt(n/br),kt.updateView(n,t),ht.val(t))}},vt={update:function(n){lt.val(tt((et.data("x")||et.position().left)/ct,y));at.val(tt((et.data("y")||et.position().top)/ct,b));"xy"!==n&&(pt.val(tt((et.data("w")||et.width())/ct,y-lt.val())),wt.val(tt((et.data("h")||et.height())/ct,b-at.val())));wi()},updateView:function(n){var r,u,f,t,i;lt.val(tt(lt.val(),y-(gt?8:1)));at.val(tt(at.val(),b-(gt?8:1)));pt.val(tt(pt.val(),y-lt.val()));wt.val(tt(wt.val(),b-at.val()));hi&&(r=gi.width()/gi.height(),"w"===n?wt.val(tt(parseInt(pt.val())/r)):"h"===n&&pt.val(tt(parseInt(wt.val())*r)));u=Math.round(parseInt(lt.val())*ct);f=Math.round(parseInt(at.val())*ct);i="xy"!==n?(t=Math.round(parseInt(pt.val())*ct),Math.round(parseInt(wt.val())*ct)):(t=et.data("w"),et.data("h"));et.data({x:u,y:f,w:t,h:i}).width(t).height(i).css({left:u,top:f});gi.width(t).height(i)},resize_update:function(n,t){et.data({x:t.position.left,y:t.position.top,w:t.size.width,h:t.size.height});vt.update();vt.updateView()},drag_update:function(n,t){et.data({x:t.position.left,y:t.position.top});vt.update("xy")}},rt={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:!1,setQuality:function(){pi.children("div.elfinder-resize-quality")[0<i&&bt.val()%90==0?"hide":"show"]()},update:function(n,i){void 0===n&&(or=n=parseInt(bt.val()));void 0===i&&(i=!0);!i||t.UA.Opera||t.UA.ltIE8?it.rotate(n):it.animate({rotate:n+"deg"});(n%=360)<0&&(n+=360);bt.val(parseInt(n));pr.slider("value",bt.val());rt.setQuality()},execute:function(n){if(rt.imageBeingRotated){var i=rt.getCenter(it),r=n.originalEvent.touches?n.originalEvent.touches[0]:n,u=r.pageX-i[0],f=r.pageY-i[1],t=Math.atan2(f,u)-rt.mouseStartAngle+rt.imageStartAngle,t=Math.round(180*parseFloat(t)/Math.PI);return n.shiftKey&&(t=15*Math.round((t+6)/15)),it.rotate(t),(t%=360)<0&&(t+=360),bt.val(t),pr.slider("value",bt.val()),rt.setQuality(),!1}},start:function(t){if(!it.hasClass("elfinder-resize-picking")){ir();rt.imageBeingRotated=!0;var i=rt.getCenter(it),r=t.originalEvent.touches?t.originalEvent.touches[0]:t,u=r.pageX-i[0],f=r.pageY-i[1];return rt.mouseStartAngle=Math.atan2(f,u),rt.imageStartAngle=parseFloat(it.rotate())*Math.PI/180,n(document).on("mousemove",rt.execute),it.on("touchmove",rt.execute),!1}},stop:function(){if(rt.imageBeingRotated)return n(document).off("mousemove",rt.execute),it.off("touchmove",rt.execute),requestAnimationFrame(function(){rt.imageBeingRotated=!1}),rr(),!1},getCenter:function(){var t=it.rotate();it.rotate(0);var n=it.offset(),i=n.left+it.width()/2,r=n.top+it.height()/2;return it.rotate(t),Array(i,r)}},fu=function(n){n?(ft.filter(":ui-resizable").resizable("destroy"),ft.hide()):(ft.show(),ft.resizable({alsoResize:nt,aspectRatio:ii,resize:kt.update,start:ir,stop:function(){kt.fixHeight;kt.updateView(st.val(),ht.val());rr()}}),tr())},tf=function(n){n?(et.filter(":ui-resizable").resizable("destroy").filter(":ui-draggable").draggable("destroy"),hr.hide()):(hr.show(),et.resizable({containment:hr,aspectRatio:hi,resize:vt.resize_update,start:ir,stop:rr,handles:"all"}).draggable({handle:gi,containment:cr,drag:vt.drag_update,start:ir,stop:function(){vt.updateView("xy");rr()}}),tr(),vt.update())},rf=function(n){n?it.hide():(it.show(),tr())},eu=function(){var n;(n=cu())&&(ni.elfinderdialog("close"),u.resizeRequest({target:r.hash,width:n.w,height:n.h,x:n.x,y:n.y,degree:n.d,quality:n.q,bg:n.b,mode:ui},r,h))},uf=function(){function i(){f.addClass(v).fadeIn(function(){dt.addClass(w)});t.disable()}function o(){u.mime=r.mime;u.prefix=r.name.replace(/ \d+(\.[^.]+)?$/,"$1");u.requestCmd="mkfile";u.nextAction={};u.data={target:r.phash};n.proxy(t.res("mixin","make"),u)().done(function(u){var o,e;u.added&&u.added.length?(o=u.added[0].hash,e=t.api<2.1032?t.url(r.hash,{async:!0,temporary:!0}):null,n.when(e).done(function(n){t.request({options:{type:"post"},data:{cmd:"put",target:o,encoding:e?"scheme":"hash",content:e?t.convAbsUrl(n):r.hash},notify:{type:"copy",cnt:1},syncOnFail:!0}).fail(i).done(function(n){n=t.normalize(n);t.updateCache(n);r=t.file(o);n.changed&&n.changed.length&&t.change(n);dt.show().find(".elfinder-dialog-title").html(t.escape(r.name));eu();f.fadeIn()})}).fail(i)):i()}).fail(i).always(function(){delete u.mime;delete u.prefix;delete u.nextAction;delete u.data});t.trigger("unselectfiles",{files:[r.hash]})}var f,e=null;cu()&&(f=s.children("."+u.dialogClass+":visible").removeClass(v).fadeOut(),dt.removeClass(w),t.enable(),t.searchStatus.state<2&&r.phash!==t.cwd().hash&&(e=t.exec("open",[r.phash],{thash:r.phash})),n.when([e]).done(function(){e?t.one("cwdrender",o):o()}).fail(i))},gr={},li="elfinder-resize-handle-hline",ai="elfinder-resize-handle-vline",ut="elfinder-resize-handle-point",ff=l,nr=fi?n("<img>").attr("crossorigin",t.isCORS?"use-credentials":"").attr("src",ff).on("load",function(){try{var n=document.createElement("canvas");nr.data("canvas",n).data("ctx",n.getContext("2d"));wi()}catch(n){nr.removeData("canvas").removeData("ctx")}}):null,wi=function(){ti.find("input.elfinder-resize-quality:visible").trigger("change")},tr=function(){var c,i,o,r,u,f,e,h;dt.hasClass("elfinder-dialog-minimized")||dt.is(":hidden")||(lr.hide(),bi.hide(),i=(c=t.options.dialogContained?s:n(window)).height(),o=c.width(),r="auto",u=!0,dt.width(Math.min(650,o-30)),g.attr("style",""),y&&b&&(ci=g.width()-(ft.outerWidth()-ft.width()),ri=g.height()-(ft.outerHeight()-ft.height()),kt.updateView(y,b)),e=ni.find("div.elfinder-resize-control").width(),h=g.width(),(f=ni.width()-20)<h?(g.width(f),u=!1):f-h<e&&(i<o?g.width(f-e-20):(g.css({float:"none",marginLeft:"auto",marginRight:"auto"}),u=!1)),u&&(r=e),ci=g.width()-(ft.outerWidth()-ft.width()),s.hasClass("elfinder-fullscreen")?dt.height()>i&&(i-=2,g.height(i-dt.height()+g.height()),dt.css("top",0-s.offset().top)):(i-=30,g.height()>i&&g.height(i)),ri=g.height()-(ft.outerHeight()-ft.height()),y&&b&&su(),nt.height()&&g.height()>nt.height()+20&&(g.height(nt.height()+20),ri=g.height()-(ft.outerHeight()-ft.height()),ou()),lr.css("width",r).show(),bi.css("width",r).show(),bi.children("span.elfinder-resize-preset:visible").length||bi.hide(),ni.elfinderdialog("posInit"))},lr=(nu=n('<fieldset class="elfinder-resize-preset-container">').append(n("<legend>").html(t.i18n("presets"))).css("box-sizing","border-box").hide(),n.each(d,function(t,i){2===i.length&&(au=!0,nu.append(n('<span class="elfinder-resize-preset"><\/span>').data("s",i).text(i[0]+"x"+i[1]).button()))}),au?nu:n()),bi=lr.clone(!0),ef=t.uploadMimeCheck(r.mime,r.phash);p=a=r.size;oi.append(n(ot).append(n(yt).text(t.i18n("width")),st),n(ot).append(n(yt).text(t.i18n("height")),ht,n('<div class="elfinder-resize-whctrls">').append(bu,wu)),fi?n(ot).append(n(yt).text(t.i18n("quality")),fi,n("<span><\/span>")):n(),di?n(ot).append(n(yt).text(t.i18n("8pxgrid")).addClass("elfinder-resize-grid8"),dr):n(),n(ot).append(n(yt).text(t.i18n("scale")),pu),n(ot).append(lr));f&&(yi.append(n(ot).append(n(yt).text("X"),lt),n(ot).append(n(yt).text("Y")).append(at),n(ot).append(n(yt).text(t.i18n("width")),pt),n(ot).append(n(yt).text(t.i18n("height")),wt,n('<div class="elfinder-resize-whctrls">').append(ku,wu.clone(!0))),fi?n(ot).append(n(yt).text(t.i18n("quality")),fi.clone(!0),n("<span><\/span>")):n(),di?n(ot).append(n(yt).text(t.i18n("8pxgrid")).addClass("elfinder-resize-grid8")):n(),n(ot).append(bi)),pi.append(n(ot).addClass("elfinder-resize-degree").append(n(yt).text(t.i18n("rotate")),bt,n("<span><\/span>").text(t.i18n("degree")),n("<div><\/div>").append(vu,yu)[c]()),n(ot).css("height","20px").append(pr),fi?n(ot)[i<1?"show":"hide"]().addClass("elfinder-resize-quality").append(n(yt).text(t.i18n("quality")),fi.clone(!0),n("<span><\/span>")):n(),n(ot).append(n(yt).text(t.i18n("bgcolor")),si,ru,cf),n(ot).css("height","20px").append(ei)),vu.on("click",function(){or-=90;rt.update(or)}),yu.on("click",function(){or+=90;rt.update(or)}));ni.append(fr).on("resize",function(n){n.stopPropagation()});f?ti.append(oi,yi.hide(),pi.hide()):ti.append(oi);ft.append('<div class="'+li+" "+li+'-top"><\/div>','<div class="'+li+" "+li+'-bottom"><\/div>','<div class="'+ai+" "+ai+'-left"><\/div>','<div class="'+ai+" "+ai+'-right"><\/div>','<div class="'+ut+" "+ut+'-e"><\/div>','<div class="'+ut+" "+ut+'-se"><\/div>','<div class="'+ut+" "+ut+'-s"><\/div>');g.append(iu).append(ft.hide()).append(nt.hide());f&&(et.css("position","absolute").append('<div class="'+li+" "+li+'-top"><\/div>','<div class="'+li+" "+li+'-bottom"><\/div>','<div class="'+ai+" "+ai+'-left"><\/div>','<div class="'+ai+" "+ai+'-right"><\/div>','<div class="'+ut+" "+ut+'-n"><\/div>','<div class="'+ut+" "+ut+'-e"><\/div>','<div class="'+ut+" "+ut+'-s"><\/div>','<div class="'+ut+" "+ut+'-w"><\/div>','<div class="'+ut+" "+ut+'-ne"><\/div>','<div class="'+ut+" "+ut+'-se"><\/div>','<div class="'+ut+" "+ut+'-sw"><\/div>','<div class="'+ut+" "+ut+'-nw"><\/div>'),g.append(hr.css("position","absolute").hide().append(cr,et.append(gi))),g.append(it.hide()));g.css("overflow","hidden");ni.append(g,ti);gr[t.i18n("btnApply")]=eu;ef&&(gr[t.i18n("btnSaveAs")]=function(){requestAnimationFrame(uf)});gr[t.i18n("btnCancel")]=function(){ni.elfinderdialog("close")};ni.find("input,button").addClass("elfinder-tabstop");dt=u.fmDialog(ni,{title:t.escape(r.name),width:650,resizable:!1,buttons:gr,open:function(){function n(){sr=t.request({data:{cmd:"dim",target:r.hash,substitute:u?400:""},preventDefault:!0}).done(function(n){if(!n.url&&i)ni.elfinderdialog("close"),t.error(["errOpen",r.name]);else if(n.dim){var u=n.dim.split("x");return r.width=u[0],r.height=u[1],hu(u),n.url&&(nt.attr("src",n.url),cr.attr("src",n.url),it.attr("src",n.url)),ar()}})}var i=!{"image/jpeg":!0,"image/png":!0,"image/gif":!0}[r.mime],u=!(!t.option("substituteImg",r.hash)||!(i||r.size>e.dimSubImgSize)),o=!(!r.width||!r.height);if(lu=dt.find(".ui-dialog-titlebar .elfinder-titlebar-minimize").hide(),t.bind("resize",tr),nt.attr("src",l).one("error.dimreq",function(){n()}),cr.attr("src",l),it.attr("src",l),f&&(it.on("mousedown touchstart",rt.start).on("touchend",rt.stop),dt.on("mouseup",rt.stop)),o&&!u)return ar();if(r.size>(e.getDimThreshold||0))nt.off("error.dimreq"),n();else if(o)return ar()},close:function(){f&&(it.off("mousedown touchstart",rt.start).off("touchend",rt.stop),n(document).off("mouseup",rt.stop));t.unbind("resize",tr);n(this).elfinderdialog("destroy")},resize:function(n,t){t&&"off"===t.minimize&&tr()}}).attr("id",o).closest(".ui-dialog").addClass(v);t.UA.ltIE8&&n(".elfinder-dialog").css("filter","");gi.css({opacity:.2,"background-color":"#fff",position:"absolute"});et.css("cursor","move");et.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:.5,"border-color":"#000"});f||fr.find(".api2").remove();ti.find("input,select").prop("disabled",!0);ti.find("input.elfinder-resize-quality").next("span").addClass("elfinder-resize-jpgsize").attr("title",t.i18n("roughFileSize"))}var l,y,p,a,u=this,o=this.files(r),h=n.Deferred(),f=1<t.api,e=this.options,s=t.getUI(),c=n().controlgroup?"controlgroup":"buttonset",k=void 0===e.grid8px||"disable"!==e.grid8px,d=Array.isArray(e.presetSize)?e.presetSize:[],w="elfinder-dialog-active",v=t.res("class","editing");return o.length&&-1!==o[0].mime.indexOf("image/")?(l="resize-"+t.namespace+"-"+o[0].hash,(y=s.find("#"+l)).length?(y.elfinderdialog("toTop"),h.resolve()):(t.openUrl(o[0].hash,"sameorigin",function(n){b(o[0],l,n)}),h)):h.reject()}},(f=jQuery).cssHooks.rotate={get:function(n){return f(n).rotate()},set:function(n,t){return f(n).rotate(t),t}},f.cssHooks.transform={get:function(n){var t=ft(n.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return n.style[t]},set:function(n,t){var i=ft(n.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return n.style[i]=t}},f.fn.rotate=function(n){var t;return void 0===n?window.opera?(t=this.css("transform").match(/rotate\((.*?)\)/))&&t[1]?Math.round(180*parseFloat(t[1])/Math.PI):0:(t=this.css("transform").match(/rotate\((.*?)\)/))&&t[1]?parseInt(t[1]):0:(this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(n)+"deg)"),this)},f.fx.step.rotate=function(n){0==n.state&&(n.start=f(n.elem).rotate(),n.now=n.start);f(n.elem).rotate(n.now)},void 0===window.addEventListener&&void 0===document.getElementsByClassName&&(rt=function(n){var t;"static"==n.currentStyle.position&&(t=function(n){for(var t=n,i=t.offsetLeft,r=t.offsetTop;t.offsetParent&&((t=t.offsetParent)==document.body||"static"==t.currentStyle.position);)t!=document.body&&t!=document.documentElement&&(i-=t.scrollLeft,r-=t.scrollTop),i+=t.offsetLeft,r+=t.offsetTop;return{x:i,y:r}}(n),n.style.position="absolute",n.style.left=t.x+"px",n.style.top=t.y+"px")},ut=f.cssHooks.transform.set,f.cssHooks.transform.set=function(n,t){return ut.apply(this,[n,t]),function(n,t){var u,o=1,s=1,h=1,c=1,i;if(void 0===n.style.msTransform){rt(n);i=(u=t.match(/rotate\((.*?)\)/))&&u[1]?parseInt(u[1]):0;(i%=360)<0&&(i=360+i);var r=i*Math.PI/180,l=Math.cos(r),a=Math.sin(r);o*=l;s*=-a;h*=a;c*=l;n.style.filter=(n.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+"progid:DXImageTransform.Microsoft.Matrix(M11="+o+",M12="+s+",M21="+h+",M22="+c+",FilterType='bilinear',sizingMethod='auto expand')";var f=parseInt(n.style.width||n.width||0),e=parseInt(n.style.height||n.height||0),r=i*Math.PI/180,v=Math.abs(Math.cos(r)),y=Math.abs(Math.sin(r)),p=(f-(f*v+e*y))/2,w=(e-(f*y+e*v))/2;n.style.marginLeft=Math.floor(p)+"px";n.style.marginTop=Math.floor(w)+"px"}}(n,t),t}),(r.prototype.commands.restore=function(){"use strict";var i=this,t=this.fm,r=0,u=function(i){var o,f=n.Deferred(),s=[],e=[],h=[],c=[];return f._xhrReject=function(){n.each(h,function(){this&&this.reject&&this.reject()});o&&o._xhrReject()},n.each(i,function(n,t){"directory"===t.mime?s.push(t):e.push(t)}),s.length?(n.each(s,function(n,i){h.push(t.request({data:{cmd:"open",target:i.hash},preventDefault:!0,asNotOpen:!0}));c[n]=i.hash}),n.when.apply(n,h).fail(function(){f.reject()}).done(function(){var i=[];n.each(arguments,function(n,t){t.files&&(t.files.length?i=i.concat(t.files):i.push({hash:"fakefile_"+r++,phash:c[n],mime:"fakefile",name:"fakefile",ts:0}))});t.cache(i);o=u(i).done(function(n){e=e.concat(n);f.resolve(e)})})):f.resolve(e),f};this.restore=function(i,f,e,o){var h,l,a,s={},c=[],v=!1,p=o||{},y=+new Date;t.lockfiles({files:e});h=n.map(f,function(n){return"directory"===n.mime?n.hash:null});i.done(function(){h&&t.exec("rm",h,{forceRm:!0,quiet:!0})}).always(function(){t.unlockfiles({files:e})});l=setTimeout(function(){t.notify({type:"search",id:y,cnt:1,hideCnt:!0,cancel:function(){a&&a._xhrReject();i.reject()}})},t.notifyDelay);r=0;a=u(f).always(function(){l&&clearTimeout(l);t.notify({type:"search",id:y,cnt:-1,hideCnt:!0})}).fail(function(){i.reject("errRestore","errFileNotFound")}).done(function(r){var f=["errRestore","errFolderNotFound"],u="";r.length?(n.each(r,function(i,r){for(var h,o,f,e=r.phash;e;){if(o=t.trashes[e]){if(!s[o]){if(v)return c.push(r.hash),null;s[o]={};v=!0}""===(f=(f=t.path(r.hash).substr(t.path(e).length).replace(/\\/g,"/")).replace(/\/[^\/]+?$/,""))&&(f="/");s[o][f]||(s[o][f]=[]);"fakefile"===r.mime?t.updateCache({removed:[r.hash]}):s[o][f].push(r.hash);(!u||u.length>f.length)&&(u=f);break}(h=t.file(e))?e=h.phash:(e=!1,n.each(t.trashes,function(n){var i=t.file(n),u=t.path(n);if((!i.volumeid||0===r.hash.indexOf(i.volumeid))&&0===t.path(r.hash).indexOf(u))return e=n,!1}))}}),v?n.each(s,function(r,o){var h=Object.keys(o),s=h.length;t.request({data:{cmd:"mkdir",target:r,dirs:h},notify:{type:"chkdir",cnt:s},preventFail:!0}).fail(function(n){i.reject(n);t.unlockfiles({files:e})}).done(function(r){var e;(e=r.hashes)?t.getCommand("paste")?t.one("mkdirdone",function(){var r=!1;n.each(o,function(n,o){e[n]&&(o.length?t.file(e[n])?(t.clipboard(o,!0),t.exec("paste",[e[n]],{_cmd:"restore",noToast:p.noToast||n!==u}).done(function(n){n&&(n.error||n.warning)&&(r=!0)}).fail(function(){r=!0}).always(function(){--s<1&&(i[r?"reject":"resolve"](),c.length&&t.exec("restore",c))})):i.reject(f):--s<1&&(i.resolve(),c.length&&t.exec("restore",c)))})}):i.reject(["errRestore","errCmdNoSupport","(paste)"]):i.reject(f)})}):i.reject(f)):(i.reject("errFileNotFound"),h&&t.exec("rm",h,{forceRm:!0,quiet:!0}))})};this.linkedCmds=["copy","paste","mkdir","rm"];this.updateOnSelect=!1;this.init=function(){t=(i=this).fm};this.getstate=function(i){return(i=i||t.selected()).length&&n.grep(i,function(n){var i=t.file(n);return!(!i||i.locked||t.isRoot(i))}).length==i.length?0:-1};this.exec=function(r,u){var f=n.Deferred().fail(function(n){n&&t.error(n)}),e=i.files(r);return e.length?(n.each(e,function(n,i){return t.isRoot(i)?!f.reject(["errRestore",i.name]):i.locked?!f.reject(["errLocked",i.name]):void 0}),"pending"===f.state()&&this.restore(f,e,r,u),f):f.reject()}}).prototype={forceLoad:!0},r.prototype.commands.rm=function(){"use strict";function f(i){var u,r=null;return i&&i.length&&(1<i.length&&2===t.searchStatus.state?(u=t.file(t.root(i[0])).volumeid,n.grep(i,function(n){return 0!==n.indexOf(u)}).length||(r=t.option("trashHash",i[0]))):r=t.option("trashHash",i[0])),r}var i=this,t=this.fm,e='<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"><\/span>{title}<div class="elfinder-rm-desc">{desc}<\/div><\/div>',u=function(n,i,r){var u=r?{}:{type:"rm",cnt:i.length};t.request({data:{cmd:"rm",targets:i},notify:u,preventFail:!0}).fail(function(t){n.reject(t)}).done(function(t){(t.error||t.warning)&&(t.sync=!0);n.resolve(t)}).always(function(){t.unlockfiles({files:i})})},r=!1;this.confirm=function(f,o,s,h,c){var p,v,a,l,b,k=o.length,g=t.cwd().hash,y=[],d=t.i18n("calc")+'<span class="elfinder-spinner"><\/span>',w=1<k?(a=0,n.each(s,function(n,t){if(!t.size||"unknown"==t.size||"directory"===t.mime)return!(a="unknown");var i=parseInt(t.size);0<=i&&0<=a&&(a+=i)}),r="unknown"===a,y.push(t.i18n("size")+": "+(r?d:t.formatSize(a))),[n(e.replace("{class}","elfinder-cwd-icon-group").replace("{title}","<strong>"+t.i18n("items")+": "+k+"<\/strong>").replace("{desc}",y.join("<br>")))]):(l=s[0],v=t.tmb(l),r="directory"===l.mime,y.push(t.i18n("size")+": "+(r?d:t.formatSize(l.size))),y.push(t.i18n("modify")+": "+t.formatDate(l)),b=t.escape(l.i18||l.name).replace(/([_.])/g,"&#8203;$1"),[n(e.replace("{class}",t.mime2class(l.mime)).replace("{title}","<strong>"+b+"<\/strong>").replace("{desc}",y.join("<br>")))]);c&&(w=w.concat(c));w.push(h?"confirmTrash":"confirmRm");p=t.confirm({title:i.title,text:w,accept:{label:"btnRm",callback:function(){h?i.toTrash(f,o,h):u(f,o)}},cancel:{label:"btnCancel",callback:function(){t.unlockfiles({files:o});1===o.length&&t.file(o[0]).phash!==g?t.select({selected:o}):t.selectfiles({files:o});f.reject()}}});v&&n("<img/>").on("load",function(){p.find(".elfinder-cwd-icon").addClass(v.className).css("background-image","url('"+v.url+"')")}).attr("src",v.url);r=r&&t.getSize(n.map(s,function(n){return"directory"===n.mime?n.hash:null})).done(function(n){p.find("span.elfinder-spinner").parent().html(t.i18n("size")+": "+n.formated)}).fail(function(){p.find("span.elfinder-spinner").parent().html(t.i18n("size")+": "+t.i18n("unknown"))}).always(function(){r=!1})};this.toTrash=function(r,u,f){var e,c,o,s={},v=u.length,a=i.options.toTrashMaxItems,l=[],h=n.Deferred();a<v?i.confirm(r,u,i.files(u),null,[t.i18n("tooManyToTrash")]):(n.each(u,function(n,i){var u=t.file(i),r=t.path(i).replace(/\\/g,"/").match(/^[^\/]+?(\/(?:[^\/]+?\/)*)[^\/]+?$/);u&&(r&&(r[1]=r[1].replace(/(^\/.*?)\/?$/,"$1"),s[r[1]]||(s[r[1]]=[]),s[r[1]].push(i)),"directory"===u.mime&&l.push(i))}),l.length?(e=t.request({data:{cmd:"size",targets:l},notify:{type:"readdir",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(n){var t=0;n.fileCnt&&(t+=parseInt(n.fileCnt));n.dirCnt&&(t+=parseInt(n.dirCnt));h[a<t?"reject":"resolve"]()}).fail(function(){h.reject()}),setTimeout(function(){var n=e&&e.xhr?e.xhr:null;n&&"pending"==n.state()&&(e.syncOnFail(!1),e.reject(),h.reject())},1e3*i.options.infoCheckWait)):h.resolve(),h.done(function(){c=Object.keys(s);(o=c.length)?t.request({data:{cmd:"mkdir",target:f,dirs:c},notify:{type:"chkdir",cnt:o},preventFail:!0}).fail(function(n){r.reject(n);t.unlockfiles({files:u})}).done(function(i){function v(){return t.ui.notify.children(".elfinder-notify-trash").length}var h,c,l,a,e=["errTrash"],f={};(h=i.hashes)?(l=100/o,a=1===o?100:5,c=setTimeout(function(){t.notify({type:"trash",cnt:1,hideCnt:!0,progress:a})},t.notifyDelay),n.each(s,function(i,s){var y;t.file(s[0]).phash;h[i]&&(y={cmd:"paste",dst:h[i],targets:s,cut:1},t.request({data:y,preventDefault:!0}).fail(function(n){n&&(e=e.concat(n))}).done(function(i){var r,h,o,c,s,l;i=t.normalize(i);t.updateCache(i);r=i;h=y;n.each(r,function(n,t){Array.isArray(t)&&(f[n]=f[n]?f[n].concat(t):t)});r.sync&&(f.sync=1);r.added&&r.added.length&&(o=function(){var i=[],u=n.map(r.added,function(n){return"directory"===n.mime?n.hash:null});return n.each(r.added,function(t,r){-1===n.inArray(r.phash,u)&&i.push(r.hash)}),t.exec("restore",i,{noToast:!0})},s=function(){return t.request({data:h,notify:{type:"redo",cnt:u.length}})},f.undo?(c=f.undo,f.undo=function(){o();c()}):f.undo=o,f.redo?(l=f.redo,f.redo=function(){s();l()}):f.redo=s);i.warning&&(e=e.concat(i.warning),delete i.warning);i.removed&&i.removed.length&&t.remove(i);i.added&&i.added.length&&t.add(i);i.changed&&i.changed.length&&t.change(i);t.trigger("paste",i);t.trigger("pastedone");i.sync&&t.sync()}).always(function(){var s=[],i=2;v()?t.notify({type:"trash",cnt:0,hideCnt:!0,progress:l}):a+=l;--o<1&&(c&&clearTimeout(c),v()&&t.notify({type:"trash",cnt:-1}),t.unlockfiles({files:u}),Object.keys(f).length?(1<e.length&&((f.removed||f.removed.length)&&(s=n.grep(u,function(t){return-1===n.inArray(t,f.removed)})),s.length?(e.length>i&&(i=-1===(t.messages[e[i-1]]||"").indexOf("$")?i:i+1),r.reject(),t.exec("rm",s,{addTexts:e.slice(0,i),forceRm:!0})):t.error(e)),f._noSound=!0,f.undo&&f.redo&&(f.undo={cmd:"trash",callback:f.undo},f.redo={cmd:"trash",callback:f.redo}),r.resolve(f)):r.reject(e))}))})):(r.reject("errFolderNotFound"),t.unlockfiles({files:u}))}):(r.reject(["error","The folder hierarchy to be deleting can not be determined."]),t.unlockfiles({files:u}))}).fail(function(){i.confirm(r,u,i.files(u),null,[t.i18n("tooManyToTrash")])}))};this.remove=u;this.syncTitleOnChange=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"delete ctrl+backspace shift+delete"}];this.value="rm";this.init=function(){t=(i=this).fm;i.change(function(){var r;delete i.extra;i.title=t.i18n("cmd"+i.value);i.className=i.value;i.button&&i.button.children("span.elfinder-button-icon")["trash"===i.value?"addClass":"removeClass"]("elfinder-button-icon-trash");"trash"===i.value&&(i.extra={icon:"rm",node:n("<span><\/span>").attr({title:t.i18n("cmdrm")}).on("ready",function(n,t){r=t.targets}).on("click touchstart",function(n){"touchstart"===n.type&&1<n.originalEvent.touches.length||(n.stopPropagation(),n.preventDefault(),t.getUI().trigger("click"),t.exec("rm",r,{_userAction:!0,forceRm:!0}))})})})};this.getstate=function(i){var r=this.hashes(i);return r.length&&n.grep(r,function(n){var i=t.file(n);return!(!i||i.locked||t.isRoot(i))}).length==r.length?0:-1};this.exec=function(e,o){var h,l=o||{},s=n.Deferred().always(function(){r&&r.state&&"pending"===r.state()&&r.reject()}).fail(function(n){n&&t.error(n)}).done(function(n){!l.quiet&&!n._noSound&&n.removed&&n.removed.length&&t.trigger("playsound",{soundFile:"rm.wav"})}),a=i.files(e),v=a.length,c=null,p=l.addTexts?l.addTexts:null,w=l.forceRm,y=l.quiet;return v?(n.each(a,function(n,i){return t.isRoot(i)?!s.reject(["errRm",i.name,"errPerm"]):i.locked?!s.reject(["errLocked",i.name]):void 0}),"pending"===s.state()&&(h=i.hashes(e),v=a.length,(w||i.event&&i.event.originalEvent&&i.event.originalEvent.shiftKey)&&(c="",i.title=t.i18n("cmdrm")),null===c&&(c=f(h)),t.lockfiles({files:h}),c&&i.options.quickTrash?i.toTrash(s,h,c):y?u(s,h,y):i.confirm(s,h,a,c,p)),s):s.reject()};t.bind("select contextmenucreate closecontextmenu",function(n){var r=(n.data?n.data.selected||n.data.targets:null)||t.selected();r&&r.length&&i.update(void 0,(r?f(r):t.option("trashHash"))?"trash":"rm")})},r.prototype.commands.search=function(){"use strict";this.title="Find files";this.options={ui:"searchbutton"};this.alwaysEnabled=!0;this.updateOnSelect=!1;this.getstate=function(){return 0};this.exec=function(t,i,r,u){function h(n){return c&&"SearchName"!==c&&"SearchMime"!==c&&(n.type=c),n}var o,l,f=this.fm,e=[],c=u||"",s=f.options.onlyMimes,a=[];return"string"==typeof t&&t?("object"==typeof i&&(r=i.mime||"",i=i.target||""),i=i||"",r?(r=n.trim(r).replace(","," ").split(" "),s.length&&(r=n.map(r,function(t){return(t=n.trim(t))&&(-1!==n.inArray(t,s)||n.grep(s,function(n){return 0===t.indexOf(n)}).length)?t:null}))):r=[].concat(s),f.trigger("searchstart",h({query:t,target:i,mimes:r})),!s.length||r.length?""===i&&2.1<=f.api?(l=Object.keys(f.roots).length,n.each(f.roots,function(n,i){e.push(f.request({data:h({cmd:"search",q:t,target:i,mimes:r}),notify:{type:"search",cnt:1,hideCnt:!(1<l)},cancel:!0,preventDone:!0}))})):(e.push(f.request({data:h({cmd:"search",q:t,target:i,mimes:r}),notify:{type:"search",cnt:1,hideCnt:!0},cancel:!0,preventDone:!0})),""!==i&&2.1<=f.api&&Object.keys(f.leafRoots).length&&n.each(f.leafRoots,function(u,s){for(o=u;o;)i===o&&n.each(s,function(){var n=f.file(this);n&&n.volumeid&&a.push(n.volumeid);e.push(f.request({data:h({cmd:"search",q:t,target:this,mimes:r}),notify:{type:"search",cnt:1,hideCnt:!1},cancel:!0,preventDone:!0}))}),o=(f.file(o)||{}).phash})):e=[n.Deferred().resolve({files:[]})],f.searchStatus.mixed=1<e.length&&a,n.when.apply(n,e).done(function(n){var t,i=arguments.length;if(n.warning&&f.error(n.warning),1<i)for(n.files=n.files||[],t=1;t<i;t++)arguments[t].warning&&f.error(arguments[t].warning),arguments[t].files&&n.files.push.apply(n.files,arguments[t].files);n.files&&n.files.length&&f.cache(n.files);f.lazy(function(){f.trigger("search",n)}).then(function(){return f.lazy(function(){f.trigger("searchdone")})}).then(function(){n.sync&&f.sync()})})):(f.getUI("toolbar").find("."+f.res("class","searchbtn")+" :text").trigger("focus"),n.Deferred().reject())}},r.prototype.commands.selectall=function(){"use strict";var t=0;this.fm.bind("select",function(n){t=n.data&&n.data.selectall?-1:0});this.state=0;this.updateOnSelect=!1;this.getstate=function(){return t};this.exec=function(){return n(document).trigger(n.Event("keydown",{keyCode:65,ctrlKey:!0,shiftKey:!1,altKey:!1,metaKey:!1})),n.Deferred().resolve()}},r.prototype.commands.selectinvert=function(){"use strict";this.updateOnSelect=!1;this.getstate=function(){return 0};this.exec=function(){return n(document).trigger(n.Event("keydown",{keyCode:73,ctrlKey:!0,shiftKey:!0,altKey:!1,metaKey:!1})),n.Deferred().resolve()}},r.prototype.commands.selectnone=function(){"use strict";var t=this.fm,i=-1;t.bind("select",function(n){i=n.data&&n.data.unselectall?-1:0});this.state=-1;this.updateOnSelect=!1;this.getstate=function(){return i};this.exec=function(){return t.getUI("cwd").trigger("unselectall"),n.Deferred().resolve()}},r.prototype.commands.sort=function(){"use strict";function u(){i.variants=[];n.each(t.sortRules,function(n){var r;t.sorters[n]&&(r=n===t.sortType?"asc"===t.sortOrder?"n":"s":"",i.variants.push([n,(r?'<span class="ui-icon ui-icon-arrowthick-1-'+r+'"><\/span>':"")+"&nbsp;"+t.i18n("sort"+n)]))});i.variants.push("|");i.variants.push(["stick",(t.sortStickFolders?'<span class="ui-icon ui-icon-check"><\/span>':"")+"&nbsp;"+t.i18n("sortFoldersFirst")]);t.ui.tree&&null!==t.options.sortAlsoTreeview&&(i.variants.push("|"),i.variants.push(["tree",(t.sortAlsoTreeview?'<span class="ui-icon ui-icon-check"><\/span>':"")+"&nbsp;"+t.i18n("sortAlsoTreeview")]));f()}var i=this,t=i.fm,f=function(){var i,u=t.getUI("contextmenu");u.is(":visible")&&((i=u.find("span.elfinder-button-icon-sort").siblings("div.elfinder-contextmenu-sub")).find("span.ui-icon").remove(),i.children("div.elfinder-contextsubmenu-item").each(function(){var f,i=n(this).children("span"),u=i.text().trim();u===(r.stick||(r.stick=t.i18n("sortFoldersFirst")))?t.sortStickFolders&&i.prepend('<span class="ui-icon ui-icon-check"><\/span>'):u===(r.tree||(r.tree=t.i18n("sortAlsoTreeview")))?t.sortAlsoTreeview&&i.prepend('<span class="ui-icon ui-icon-check"><\/span>'):u===(r[t.sortType]||(r[t.sortType]=t.i18n("sort"+t.sortType)))&&(f="asc"===t.sortOrder?"n":"s",i.prepend('<span class="ui-icon ui-icon-arrowthick-1-'+f+'"><\/span>'))}))},r={};this.options={ui:"sortbutton"};this.keepContextmenu=!0;t.bind("sortchange",u).bind("sorterupdate",function(){u();t.getUI().children(".elfinder-button-sort-menu").children(".elfinder-button-menu-item").each(function(){var i=n(this),r=i.attr("rel");i.toggle(!(r&&!t.sorters[r]))})}).bind("cwdrender",function(){var i=n(t.cwd).find("div.elfinder-cwd-wrapper-list table");i.length&&n.each(t.sortRules,function(r){var f,e,o,u=i.find("thead tr td.elfinder-cwd-view-th-"+r);u.length&&(f=r==t.sortType,e={type:r,order:f?"asc"==t.sortOrder?"desc":"asc":t.sortOrder},f&&(u.addClass("ui-state-active"),o="asc"==t.sortOrder?"n":"s",n('<span class="ui-icon ui-icon-triangle-1-'+o+'"><\/span>').appendTo(u)),n(u).on("click",function(i){n(this).data("dragging")||(i.stopPropagation(),t.getUI("cwd").data("longtap")||t.exec("sort",[],e))}).on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"===t.type)}))})});this.getstate=function(){return 0};this.exec=function(t,i){var u,r=this.fm,e=n.isPlainObject(i)?i:(u={},"stick"==(i+="")?u.stick=!r.sortStickFolders:"tree"===i?u.tree=!r.sortAlsoTreeview:r.sorters[i]&&(r.sortType===i?u.order="asc"===r.sortOrder?"desc":"asc":u.type=i),u),f=Object.assign({type:r.sortType,order:r.sortOrder,stick:r.sortStickFolders,tree:r.sortAlsoTreeview},e);return r.lazy(function(){r.setSort(f.type,f.order,f.stick,f.tree);this.resolve()})}},r.prototype.commands.undo=function(){"use strict";function u(n){n?(i.title=r.i18n("cmdundo")+" "+r.i18n("cmd"+n.cmd),i.state=0):(i.title=r.i18n("cmdundo"),i.state=-1);i.change()}var i=this,r=this.fm,t=[];this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+z"}];this.syncTitleOnChange=!0;this.getstate=function(){return t.length?0:-1};this.setUndo=function(i,f){var e={};i&&n.isPlainObject(i)&&i.cmd&&i.callback&&(Object.assign(e,i),f?(delete f.undo,e.redo=f):r.getCommand("redo").setRedo(null),t.push(e),u(e))};this.exec=function(){var f,o,s=r.getCommand("redo"),i=n.Deferred(),e={};return t.length?((f=t.pop()).redo?(Object.assign(e,f.redo),delete f.redo):e=null,i.done(function(){e&&s.setRedo(e,f)}),u(t.length?t[t.length-1]:void 0),(o=f.callback())&&o.done?o.done(function(){i.resolve()}).fail(function(){i.reject()}):i.resolve(),t.length?this.update(0,t[t.length-1].name):this.update(-1,"")):i.reject(),i};r.bind("exec",function(n){var t=n.data||{};t.opts&&t.opts._userAction&&t.dfrd&&t.dfrd.done&&t.dfrd.done(function(n){n&&n.undo&&n.redo&&(n.undo.redo=n.redo,i.setUndo(n.undo))})})},r.prototype.commands.redo=function(){"use strict";function u(n){n&&n.callback?(i.title=r.i18n("cmdredo")+" "+r.i18n("cmd"+n.cmd),i.state=0):(i.title=r.i18n("cmdredo"),i.state=-1);i.change()}var i=this,r=this.fm,t=[];this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"shift+ctrl+z ctrl+y"}];this.syncTitleOnChange=!0;this.getstate=function(){return t.length?0:-1};this.setRedo=function(n,i){null===n?(t=[],u()):n&&n.cmd&&n.callback&&(i&&(n.undo=i),t.push(n),u(n))};this.exec=function(){var f,e,h=r.getCommand("undo"),i=n.Deferred(),s={},o={};return t.length?((f=t.pop()).undo&&(Object.assign(s,f.undo),Object.assign(o,f),delete o.undo,i.done(function(){h.setUndo(s,o)})),u(t.length?t[t.length-1]:void 0),(e=f.callback())&&e.done?e.done(function(){i.resolve()}).fail(function(){i.reject()}):i.resolve(),i):i.reject()}},(r.prototype.commands.up=function(){"use strict";this.alwaysEnabled=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1};this.exec=function(){var t=this.fm,i=t.cwd().hash;return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash).done(function(){t.one("opendone",function(){t.selectfiles({files:[i]})})}):n.Deferred().reject()}}).prototype={forceLoad:!0},r.prototype.commands.upload=function(){"use strict";var t=this.fm.res("class","hover");this.disableOnSearch=!0;this.updateOnSelect=!1;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(n){var t,i=this.fm,r=n||[i.cwd().hash];return this._disabled||1!=r.length||(t=i.file(r[0])),t&&"directory"==t.mime&&t.write?0:-1};this.exec=function(i){function h(t){r.upload(t).fail(function(n){s.reject(n)}).done(function(t){var i,u;r.getUI("cwd");s.resolve(t);t&&t.added&&t.added[0]&&!r.ui.notify.children(".elfinder-notify-upload").length&&((u=r.findCwdNodes(t.added)).length?u.trigger("scrolltoview"):(e.hash!==y?i=n("<div><\/div>").append(n('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+r.i18n("cmdopendir")+"<\/span><\/button>").on("mouseenter mouseleave",function(t){n(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click",function(){r.exec("open",p).done(function(){r.one("opendone",function(){r.trigger("selectfiles",{files:n.map(t.added,function(n){return n.hash})})})})})):r.trigger("selectfiles",{files:n.map(t.added,function(n){return n.hash})}),r.toast({msg:r.i18n(["complete",r.i18n("cmdupload")]),extNode:i})))}).progress(function(){s.notifyWith(this,Array.from(arguments))})}function c(n){f.elfinderdialog("close");u&&(n.target=u[0]);h(n)}function w(){var i=e.hash,t=n.map(r.files(i),function(n){return"directory"===n.mime&&n.write?n:null});return t.length?n('<div class="elfinder-upload-dirselect elfinder-tabstop" title="'+r.i18n("folders")+'"><\/div>').on("click",function(i){function o(n,t){return{label:r.escape(n.i18||n.name),icon:t,remain:!1,callback:function(){var t=h.children(".ui-dialog-titlebar:first").find("span.elfinder-upload-target");u=[n.hash];t.html(" - "+r.escape(n.i18||n.name));s.trigger("focus")},options:{className:u&&u.length&&n.hash===u[0]?"ui-state-active":"",iconClass:n.csscls||"",iconImg:n.icon||""}}}i.stopPropagation();i.preventDefault();t=r.sortFiles(t);var s=n(this),h=(r.cwd(),f.closest("div.ui-dialog")),c=[o(e,"opendir"),"|"];n.each(t,function(n,t){c.push(o(t,"dir"))});s.trigger("blur");r.trigger("contextmenu",{raw:c,x:i.pageX||n(this).offset().left,y:i.pageY||n(this).offset().top,prevNode:h,fitHeight:!0})}).append('<span class="elfinder-button-icon elfinder-button-icon-dir" ><\/span>'):n()}function b(i,u){var f=n('<input type="file" '+i+"/>").on("click",function(){r.UA.IE&&setTimeout(function(){e.css("display","none").css("position","relative");requestAnimationFrame(function(){e.css("display","").css("position","")})},100)}).on("change",function(){c({input:f.get(0),type:"files"})}).on("dragover",function(n){n.originalEvent.dataTransfer.dropEffect="copy"}),e=n("<form><\/form>").append(f).on("click",function(n){n.stopPropagation()});return n('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">'+r.i18n(u)+"<\/span><\/div>").append(e).on("click",function(n){n.stopPropagation();n.preventDefault();f.trigger("click")}).on("mouseenter mouseleave",function(i){n(this).toggleClass(t,"mouseenter"===i.type)})}function k(t){t.stopPropagation();t.preventDefault();var c,u=!1,f="",v=null,l="",e=null,a=t._target||null,i=t.dataTransfer||null,o=i.items&&i.items.length&&i.items[0].kind?i.items[0].kind:"";if(i){try{if((v=i.getData("elfinderfrom"))&&(l=window.location.href+r.cwd().hash,!a&&v===l||a===l))return void s.reject()}catch(t){}if("file"===o&&(i.items[0].getAsEntry||i.items[0].webkitGetAsEntry))u=i,f="data";else if("string"!==o&&i.files&&i.files.length&&-1===n.inArray("Text",i.types))u=i.files,f="files";else{try{(e=i.getData("text/html"))&&e.match(/<(?:img|a)/i)&&(u=[e],f="html")}catch(t){}u||((e=i.getData("text"))?(u=[e],f="text"):i&&i.files&&(o="file"))}}u?h({files:u,type:f,target:a,dropEvt:t}):(c=["errUploadNoFiles"],"file"===o&&c.push("errFolderUpload"),r.error(c),s.reject())}var f,l,a,d,v,o,g,r=this.fm,y=r.cwd().hash,u=(o=i&&i instanceof Array?i:null,(!i||i instanceof Array)&&(o||1!==(v=r.selected()).length||"directory"!==r.file(v[0]).mime?o&&1===o.length&&"directory"===r.file(o[0]).mime||(o=[y]):o=v),o),p=u?u[0]:i&&i.target?i.target:null,e=p?r.file(p):r.cwd(),s=n.Deferred();return!u&&i?i.input||i.files?(i.type="files",h(i)):i.dropEvt&&k(i.dropEvt):(l=function(t){var e,i=t.originalEvent||t,f=[],o=[],u,r;if(i.clipboardData){if(i.clipboardData.items&&i.clipboardData.items.length)for(o=i.clipboardData.items,u=0;u<o.length;u++)"file"==i.clipboardData.items[u].kind&&(e=i.clipboardData.items[u].getAsFile(),f.push(e));else i.clipboardData.files&&i.clipboardData.files.length&&(f=i.clipboardData.files);if(f.length)return void c({files:f,type:"files",clipdata:!0})}r=i.target||i.srcElement;requestAnimationFrame(function(){var t,i="text";r.innerHTML&&(n(r).find("img").each(function(t,i){i.src.match(/^webkit-fake-url:\/\//)&&n(i).remove()}),n(r).find("a,img").length&&(i="html"),t=r.innerHTML,r.innerHTML="",c({files:[t],type:i}))})},f=n('<div class="elfinder-upload-dialog-wrapper"><\/div>').append(b("multiple","selectForUpload")),r.UA.Mobile||void 0===(g=document.createElement("input")).webkitdirectory&&void 0===g.directory||f.append(b("multiple webkitdirectory directory","selectFolder")),e.dirs&&(e.hash===y||r.navHash2Elm(e.hash).hasClass("elfinder-subtree-loaded")?w().appendTo(f):(a=n('<div class="elfinder-upload-dirselect" title="'+r.i18n("nowLoading")+'"><\/div>').append('<span class="elfinder-button-icon elfinder-button-icon-spinner" ><\/span>').appendTo(f),r.request({cmd:"tree",target:e.hash}).done(function(){r.one("treedone",function(){a.replaceWith(w());d.elfinderdialog("tabstopsInit")})}).fail(function(){a.remove()}))),r.dragUpload?n('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="'+r.i18n("dropPasteFiles")+'"><\/div>').on("paste",function(n){l(n)}).on("mousedown click",function(){n(this).trigger("focus")}).on("focus",function(){this.innerHTML=""}).on("mouseover",function(){n(this).addClass(t)}).on("mouseout",function(){n(this).removeClass(t)}).on("dragenter",function(i){i.stopPropagation();i.preventDefault();n(this).addClass(t)}).on("dragleave",function(i){i.stopPropagation();i.preventDefault();n(this).removeClass(t)}).on("dragover",function(i){i.stopPropagation();i.preventDefault();i.originalEvent.dataTransfer.dropEffect="copy";n(this).addClass(t)}).on("drop",function(n){f.elfinderdialog("close");u&&(n.originalEvent._target=u[0]);k(n.originalEvent)}).prependTo(f).after('<div class="elfinder-upload-dialog-or">'+r.i18n("or")+"<\/div>")[0]:n('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">'+r.i18n("dropFilesBrowser")+"<\/div>").on("paste drop",function(n){l(n)}).on("mousedown click",function(){n(this).trigger("focus")}).on("focus",function(){this.innerHTML=""}).on("dragenter mouseover",function(){n(this).addClass(t)}).on("dragleave mouseout",function(){n(this).removeClass(t)}).prependTo(f).after('<div class="elfinder-upload-dialog-or">'+r.i18n("or")+"<\/div>")[0],d=this.fmDialog(f,{title:this.title+'<span class="elfinder-upload-target">'+(e?" - "+r.escape(e.i18||e.name):"")+"<\/span>",modal:!0,resizable:!1,destroyOnClose:!0,propagationEvents:["mousemove","mouseup","click"],close:function(){var n=r.getUI("contextmenu");n.is(":visible")&&n.click()}})),s}},r.prototype.commands.view=function(){"use strict";var i,r=this,t=this.fm;this.value=t.viewType;this.alwaysEnabled=!0;this.updateOnSelect=!1;this.options={ui:"viewbutton"};this.getstate=function(){return 0};this.extra={icon:"menu",node:n("<span><\/span>").attr({title:t.i18n("viewtype")}).on("click touchstart",function(i){var r;"touchstart"===i.type&&1<i.originalEvent.touches.length||(r=n(this),i.stopPropagation(),i.preventDefault(),t.trigger("contextmenu",{raw:getSubMenuRaw(),x:r.offset().left,y:r.offset().top}))})};this.exec=function(){var i=this,n="list"==this.value?"icons":"list";return t.storage("view",n),t.lazy(function(){t.viewchange();i.update(void 0,n);this.resolve()})};t.bind("init",function(){i=function(){for(var u=t.getUI("cwd"),i=[],f=t.options.uiOptions.cwd.iconsView.sizeNames,e=t.options.uiOptions.cwd.iconsView.sizeMax,n=0;n<=e;n++)i.push({label:t.i18n(f[n]||"Size-"+n+" icons"),icon:"view",callback:function(n){return function(){u.trigger("iconpref",{size:n});t.storage("iconsize",n);"list"===r.value&&r.exec()}}(n)});return i.push("|"),i.push({label:t.i18n("viewlist"),icon:"view-list",callback:function(){"list"!==r.value&&r.exec()}}),i}()}).bind("contextmenucreate",function(){r.extra={icon:"menu",node:n("<span><\/span>").attr({title:t.i18n("cmdview")}).on("click touchstart",function(u){if(!("touchstart"===u.type&&1<u.originalEvent.touches.length)){for(var e=n(this),o=(i.concat(),"list"===r.value?i.length-1:parseInt(t.storage("iconsize")||0)),f=0;f<i.length;f++)"|"!==i[f]&&(i[f].options=f===o?{className:"ui-state-active"}:void 0);u.stopPropagation();u.preventDefault();t.trigger("contextmenu",{raw:i,x:e.offset().left,y:e.offset().top})}})}})},r});